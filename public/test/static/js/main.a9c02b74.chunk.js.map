{"version":3,"sources":["favicon.png","images/redcoat-1-grey.png","functions/getCookie.js","functions/ScrollToTop.js","views/SharedComponents/ProfileIcon.js","views/SharedComponents/Navbar.js","globals/base_url.js","views/SharedComponents/CategoryHierarchy.js","views/TaggingInterfaceView/documentComponents.js","functions/formatDate.js","views/SharedComponents/Comment.js","views/SharedComponents/ControlBar.js","views/TaggingInterfaceView/Annotation.js","views/TaggingInterfaceView/initAnnotationsArray.js","views/Errors/Error403Page.js","views/Errors/Error404Page.js","views/TaggingInterfaceView.js","views/FeaturesPage.js","functions/_fetch.js","views/ProjectListView.js","views/ProjectView/CategoryHierarchyPage.js","views/ProjectView/InvitationsPage.js","views/Errors/Error401Redirect.js","views/ProjectView/CurationInterface.js","views/ProjectView.js","views/HomeView.js","views/NewProjectView/NewProjectFormHelpIcon.js","views/NewProjectView/FileUploadForm.js","views/NewProjectView/NewProjectDetails.js","views/NewProjectView/functions/hierarchy_presets.js","views/NewProjectView/NewProjectEntityHierarchy.js","views/NewProjectView/NewProjectAutomaticTagging.js","views/NewProjectView/NewProjectAnnotators.js","views/NewProjectView/NewProjectProjectOptions.js","views/NewProjectView.js","views/UserProfileView.js","views/Errors/Error500Page.js","views/SharedComponents/ErrorClearer.js","App.js","serviceWorker.js","index.js","views/NewProjectView/functions/hierarchy_helpers.js"],"names":["module","exports","getCookie","name","cookieValue","undefined","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","ScrollToTop","pathname","useLocation","useEffect","window","scrollTo","ProfileIcon","props","user","this","className","size","style","profile_icon","background","icon","foreground","Component","Navbar","$","prop","off","click","e","focus","project_invitations","invitations","outstandingInvitationNum","inv","accepted","declined","id","to","src","logo","map","invite","index","key","inviting_user_username","project_name","pending","onClick","acceptInvitation","declineInvitation","project_id","username","loading","NewCategoryButton","disabled","newItem","Category","state","isHovered","nameInputRef","React","createRef","changeNameTimeoutFn","nameCanUpdateTimeoutFn","nameCanUpdate","item","current","setState","slice","prevProps","prevState","clearTimeout","hovered","path","target","value","setTimeout","itemNameChange","bind","userIsModifying","children","colorId","modifiable","colorByIndex","childItems","open","openedItems","has","full_name","isTopLevelCategory","concat","hotkeyMap","hotkeyChain","applyTag","itemDescChange","deleteItem","hasHotkey","hasOwnProperty","hotkeyStr","join","content","data-hotkey-id","required","onKeyDown","keyCode","preventDefault","errorEntityNames","placeholder","ref","maxLength","onChange","description","setHovered","onMouseEnter","onMouseLeave","draggable","toString","draggableId","provided","snapshot","innerRef","draggableProps","isDragging","parseInt","dragHandleProps","reorder","list","startIndex","endIndex","result","Array","from","splice","removed","setupItemOrder","items","itemOrder","CategoryHierarchy","orderedItems","Set","onDragEnd","_","isEqual","delete","add","destination","source","order","getOrderedItems","initHotkeyMap","visible","displayOnly","tableForm","droppableId","droppableProps","isDraggingOver","toggleCategory","ModifiableCategoryHierarchy","userIsModifyingFn","updateHierarchy","currentItems","parentItem","push","markModified","console","log","t0","performance","now","newName","full_name_s","t1","newDesc","deleteRef","limitHeight","getColourIdx","entityClass","entityColourMap","Label","truncatedLabel","colourIdx","deleteTag","Word","selected","wordInnerRef","text","highlighting","output","ReactHtmlParser","hasLabel","entityClasses","tagClass","bioTag","isLastInSpan","labels","getHighlightedWord","wordColourClass","onMouseUp","updateSelections","onMouseDown","Sentence","sentenceRef","wordIndex","action","selections","element","bodyRect","body","getBoundingClientRect","offset","top","left","behavior","isWordSelected","selection","wordEndIndex","wordStartIndex","words","word","annotations","dateFormat","require","formatDate","d","options","no_hours","Comment","user_profile_icon","author","created_at","hideDocumentString","document_string","BASE_URL","document_id","class","CommentInput","comment","submitComment","onSubmit","setComment","maxlength","SaveButton","buttonClass","changesMade","recentlySaved","saving","iconClass","submitAnnotations","ProgressBar","show","totalPagesAvailable","totalPages","DocumentSearchBar","inputRef","searchDocuments","blur","inSearchMode","submit","updateValue","ControlBar","pageNumber","pageNumberError","pageInputRef","ele","val","clearPageNumberInput","goToPage","groupName","changePageNumber","latestGroup","lastModified","curationPage","querying","loadPreviousPage","showingProgressBar","showDocsPerPage","setDocsPerPage","docsPerPageOptions","p","docsPerPage","showSortBy","setSortBy","sortByOptions","sortBy","showSaveButton","title","loadNextPage","Annotation","token","tokenIndex","spanText","spanStartIdx","spanEndIdx","alreadyHasLabel","indexOf","otherAnnotation","startIdx","endIdx","initAnnotationsArray","documents","automaticAnnotations","searchTerm","oneDocument","repeatedDocs","searchTermArray","doc_idx","searchIdx","token_idx","foundIdx","setHighlighting","mention_idx","mention","start","end","label_idx","label","k","addLabel","Error403Page","Error404Page","fetchConfigGET","method","headers","ConfidenceButton","docIdx","checked","updateConfidence","ConfidenceButtons","confidence","DocumentContainerHeader","DocumentContainer","commentsOpen","documentUnderneathRef","commentBoxRef","t","node","domtoimage","toBlob","bgcolor","then","blob","saveAs","message","next","scrollTop","scrollHeight","displayIndex","comments","toggleOpenComments","saveToPng","nextNode","hasChildNodes","firstChild","nextSibling","parentNode","HotkeyInfo","ec","chain","WikipediaSummary","_isMounted","wikipediaSummary","wikipediaReadMoreUrl","tokens","snippet","wurl","wikipediaTitle","toLowerCase","ajax","url","data","srsearch","format","dataType","success","query","search","replace","err","getResult","queryWikipedia","summary","href","toggleVisibility","TaggingInterfaceView","documentGroupAnnotationId","documentIds","documentAnnotationIds","categoryHierarchy","confidences","getEmptySelectionsArray","currentSelection","getEmptyCurrentSelection","mostRecentSelectionText","reverseHotkeyMap","terminalHotkeys","hotkeyBindingFn","hotkeyTimeoutFn","holdingCtrl","holdingShift","docGroupLastModified","selectionChangeFn","windowMouseUpFn","firstLoad","taggingCompletePage","sel","getSelection","rangeCount","r","range","startContainer","endNode","endContainer","rangeNodes","commonAncestorContainer","unshift","getRangeSelectedNodes","getRangeAt","removeClass","find","addClass","classList","contains","sentenceIndex","removeEventListener","selectionChange","windowMouseUp","addEventListener","moveSelectionHorizontally","moveSelectionVertically","hotkeyChainStr","is","prototype","hotkeyTimeout","bindHotkeys","traverseChild","child","hotkeys","firstPass","Math","min","buildReverseHotkeyMap","setupHotkeyKeybinds","ec_idx","each","width","offsetWidth","newWidth","ceil","css","nextPageNumber","queryAPI","prevDocsPerPage","newPageNumber","floor","route","fetch","response","status","Error","JSON","parse","alert","tagging_complete","initConfidencesArray","initEntityColourMap","projectTitle","projectAuthor","setProject","initKeybinds","initMouseEvents","clearWordJustification","justifyWords","selectFirstWord","catch","setErrorCode","annotationsJSON","docLabels","ann","csrfToken","annotationsToJSON","fetchConfigPOST","stringify","newTotalPagesAvailable","Date","direction","newSelections","j","x","max","numDocs","clearSelections","s","empty","removeAllRanges","sel_idx","annotationSpanStart","annotationSpanEnd","notAllEqual","annotation","removeAllLabels","setSpanEndIdx","setSpanStartIdx","changeBioTag","ann_idx","labelWasModified","captureEvent","spanStart","spanEnd","removeLabel","documentIndex","documentId","eventAction","error","doc","TaggingCompletePage","FeaturesPage","FileDownload","fetchConfig","credentials","wait","ms","a","Promise","resolve","postBody","fileUpload","delay","fileDownload","fileDownloadName","api_url","fetchConf","errorCode","reject","_fetch","ProjectListView","projects","getDummyProjects","numUserInvolvedIn","numCreatedByUser","numDocGroupsAnnotated","totalDocGroups","view","randomString","minLength","randomLength","random","dummyProjects","total_users","icon_name","setView","filter","project","userIsCreator","color","lineWidth","startAngle","animate","animationDuration","_id","creator","total_comments","CategoryHierarchyPage","arr","fill","stringOfRandomLength","minlen","maxlen","generateEmptyTable","InvitationsTable","pending_invitations","active_users","colspan","email","InvitationsPage","Error401Redirect","clearErrorCode","CurationInterface","compiledAnnotation","annotatorAgreement","documentIdQuery","refreshDataFn","saveState","queryString","users","saveTimes","toFixed","saveTime","specialName","specialDescription","CurationDocumentContainer","defaults","global","defaultFontFamily","animation","duration","chartColours","AnnotationsTable","combined_annotations_available","downloadCombinedAnnotations","num_annotations","downloadAnnotationsOfUser","WaffleChart","maxValue","total","reduce","b","ratio","tooltips","tooltipSide","totalSquares","count","squares","frequency","groupIndex","square","squareIndex","numberWithCommas","setActivityChartStyles","activityChartData","datasets","Object","assign","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","darken","colourRGB","amount","String","convertToRGB","aRgbHex","match","EntityFrequenciesChart","multicolour","entityColours","entityChartData","borderWidth","colourIndexes","colourHex","colourRGBBorder","getColouredData","height","responsive","maintainAspectRatio","legend","display","scales","yAxes","ticks","beginAtZero","precision","scaleLabel","labelString","ActivityChart","cumulative","cumulativeData","cumulativeDatasets","cumulativeDataset","c","getCumulative","processActivityChartData","redraw","xAxes","type","time","unit","ProjectDashboard","entityChartMulticolour","activityChartCumulative","avgAgreement","round","avgTimePerDocument","userDocsAnnotated","userAnnotationsRequired","toggleEntityChartColours","toggleActivityChartCumulative","annotationsChartData","ProjectViewSidenav","currentLocation","location","menuItems","ProjectViewSidenavSubmenu","pathName","firstChildPathName","parentPath","ProjectViewSidenavButton","EmptyThing","ProjectView","dashboard","date","curationInterfaceState","project_author","docId","TransitionGroup","CSSTransition","timeout","enter","exit","classNames","render","setCurationInterfaceData","annotationsTable","num_combined_available","invitationsTable","withRouter","lipsum","getRandomString","LettersBackground","characters","characterChangeFn","clearInterval","setInterval","changeCharacters","HomeViewRegister","autoFocus","HomeViewLogin","password","errorMessage","json","setUserData","submitForm","handleUsernameChange","handlePasswordChange","HomeViewForgotPassword","HomeViewMain","data-content","HomeView","component","NewProjectFormHelpIcon","FileUploadForm","file","filename","errorCleared","updateFile","hasError","files","file_metadata","htmlFor","NewProjectDetails","project_description","dataset","updateFormPageData","reset_form","dataHelp","errorPaths","updateProjectName","updateProjectDescription","toggleFormHelp","updateDataset","hierarchyPresets","NewProjectEntityHierarchy","entity_hierarchy","hierarchy_preset","preset_is_modified","selectLabelRef","selectRef","endsWith","preset","preset_name","entities","hierarchy","descriptions","txt2json","slash2txt","getPreset","offsetTop","help","getPresetName","errors","names","getErrorLines","changePreset","selectedPreset","NewProjectAutomaticTagging","use_automatic_tagging","updateUseAutomaticTagging","hidden","UserDetails","is_registered","NewProjectAnnotators","showingSuggestions","userSearchResults","userSuggestions","suggestedUsers","suggested_users","isEmail","str","u","getElementById","eles","getElementsByClassName","remove","changeSearchTerm","alreadyAddedUser","addUser","removeUser","deleteHighlightRow","removeHighlightRow","NewProjectProjectOptions","hierarchy_permissions","overlap","num_users","setPermissions","changeOverlap","Modal","setAppElement","FormLoadingSkeleton","page","NewProjectHeaderItem","gotoFormPage","active","ready","pageProgress","getErrorPathsSet","NewProjectView","sharedProps","formErrors","formPages","formPageDependencies","currentFormPageIndex","formErrorShake","wasModified","isSaved","formHelpContent","verifyFormPageChange","nextPageAfterVerification","verifySubmitNewProjectForm","creatingNewProject","creatingNewProjectErrors","creatingNewProjectSuccess","newlyCreatedProjectId","formPageProgress","formPage","getFormPagePathname","latestFormPage","latest_form_page","latestFormPageIndex","form_page_progress","is_saved","updateCurrentFormPageIndex","post_url","formData","FormData","append","json2slash","clear_automatic_tagging","renderWithErrors","updated_data","isModified","prevIndex","nextIndex","formPageIndex","formIsComplete","checkFormIsComplete","lastPage","formPath","submitFormPage","isOpen","contentLabel","onRequestClose","handleCloseModal","overlayClassName","app","currentFormPage","submitNewProjectForm","renderFormPage","shakeForm","iconOptions","colourOptions","UserProfileView","setUserProfileIcon","colour","hex","colors","onChangeComplete","handleForegroundColourChange","handleBackgroundColourChange","setIcon","saveChanges","Error500Page","ErrorClearer","MainTemplate","pageTitle","pageComponent","ProjectListTemplate","TaggingInterfaceTemplate","LoadingScreen","fadingOut","ProjectViewTemplate","Footer","Logout","logout","App","loadingFadeOut","loggingOut","profileIcon","invitation_id","getUserData","params","PrivateRoute","rest","Boolean","hostname","ReactDOM","StrictMode","navigator","serviceWorker","registration","unregister","removeEmptyChildren","obj","slash","txt","fieldname","lines","depth","root","parents","cleanLine","newDepth","slashData","prev","txt2slash","allNodes","addNode","forEach","_children","json2text"],"mappings":"yGAAAA,EAAOC,QAAU,kkG,0HCAjBD,EAAOC,QAAU,IAA0B,4C,iLCiB5BC,MAhBf,SAAmBC,GACf,IAAIC,OAAcC,EAClB,GAAIC,SAASC,QAA8B,KAApBD,SAASC,OAE5B,IADA,IAAMC,EAAUF,SAASC,OAAOE,MAAM,KAC7BC,EAAI,EAAGA,EAAIF,EAAQG,OAAQD,IAAK,CACrC,IAAMH,EAASC,EAAQE,GAAGE,OAE1B,GAAIL,EAAOM,UAAU,EAAGV,EAAKQ,OAAS,KAAQR,EAAO,IAAM,CACvDC,EAAcU,mBAAmBP,EAAOM,UAAUV,EAAKQ,OAAS,IAChE,OAIZ,OAAOP,GCXI,SAASW,IAAe,IAC7BC,EAAaC,cAAbD,SAMR,OAJAE,qBAAU,WACRC,OAAOC,SAAS,EAAG,KAClB,CAACJ,IAEG,K,+CCeMK,E,kDArBd,WAAYC,GAAQ,uCACbA,G,qDAIN,IAAIC,EAAOC,KAAKF,MAAMC,KACtB,OAAIA,EAOH,yBAAKE,UAAW,6BAA+BD,KAAKF,MAAMI,MAAQ,SAASC,MAAO,CAAC,WAAcJ,EAAKK,aAAaC,aAClH,uBAAGJ,UAAW,wBAA0BF,EAAKK,aAAaE,KAAMH,MAAO,CAAC,MAASJ,EAAKK,aAAaG,eANnG,yBAAKN,UAAW,6BAA+BD,KAAKF,MAAMI,MAAQ,SAASC,MAAO,CAAC,WAAc,c,GAT3EK,aC8JXC,E,kDAhJb,WAAYX,GAAQ,uCACZA,G,iEAONY,IAAE,yBAAyBC,KAAK,UAAW,MAAMC,IAAI,SACrDF,IAAE,yBAAyBG,OAAM,SAASC,GACxCJ,IAAE,uBAAuBK,a,+BAMnB,IAAD,OAEP,GAAGf,KAAKF,MAAMC,MAAQC,KAAKF,MAAMC,KAAKiB,oBAAqB,CACzD,IADyD,EACrDC,EAAcjB,KAAKF,MAAMC,KAAKiB,oBAC9BE,EAA2B,EAF0B,cAG1CD,GAH0C,IAGzD,IAAI,EAAJ,qBAA4B,CAAC,IAArBE,EAAoB,QACtBA,EAAIC,UAAaD,EAAIE,UAAUH,KAJoB,+BAS3D,OACE,yBAAKI,GAAG,UACN,yBAAKrB,UAAU,eACb,yBAAKqB,GAAG,QACN,kBAAC,IAAD,CAAMC,GChDD,KDiDH,yBAAKC,IAAKC,MADZ,IACoB,0BAAMxB,UAAU,QAAhB,aAGpBD,KAAKF,MAAMC,MACX,yBAAKE,UAAU,iBACb,4CACA,wBAAIA,UAAU,uBACZ,4BAAI,kBAAC,IAAD,CAAMsB,GAAI,aAAV,kBACJ,4BAAI,kBAAC,IAAD,CAAMA,GAAI,iBAAV,mBAMZ,yBAAKtB,UAAU,kBACf,yBAAKA,UAAU,gBAEXD,KAAKF,MAAMC,MAEX,yBAAKE,UAAW,6BAA4D,IAA7BiB,EAAiC,YAAa,IAAKI,GAAG,oBACnG,4BAAQA,GAAG,sBAAqB,uBAAGrB,UAAU,mBAAsBiB,EAA2B,GAAK,0BAAMjB,UAAU,gBAAgBqB,GAAG,iBAAiBJ,IAErJlB,KAAKF,MAAMC,KAAKiB,qBAAuBC,EAAY9B,OAAS,EAE5D,wBAAIc,UAAU,uBACbgB,EAAYS,KAAI,SAACC,EAAQC,GAAT,OAEf,wBAAIC,IAAKD,GACP,0BAAM3B,UAAU,UACd,0BAAMA,UAAU,QAAQ0B,EAAOG,wBADjC,gCAC4F,0BAAM7B,UAAU,QAAQ0B,EAAOI,cAD3H,KAGKJ,EAAOP,WAAaO,EAAON,WAAaM,EAAOK,SAChD,yBAAK/B,UAAU,eACb,4BAAQA,UAAU,SAASgC,QAAS,kBAAM,EAAKnC,MAAMoC,iBAAiBN,KAAtE,UACA,4BAAQ3B,UAAU,UAAUgC,QAAS,kBAAM,EAAKnC,MAAMqC,kBAAkBP,KAAxE,YAIFD,EAAOK,SACP,yBAAK/B,UAAU,uBACb,8BAAM,uBAAGA,UAAU,sBAAnB,mBAIF0B,EAAOP,UAEP,yBAAKnB,UAAU,wBACb,8BAAM,uBAAGA,UAAU,gBAAnB,4BAAgE,kBAAC,IAAD,CAAMsB,GAAI,aAA8BI,EAAOS,WAAa,cAA5D,qBAGlET,EAAON,UACT,yBAAKpB,UAAU,wBACb,8BAAM,uBAAGA,UAAU,gBAAnB,mCAaR,wBAAIA,UAAU,uBACZ,4BAAI,0BAAMA,UAAU,UAAhB,sCAUVD,KAAKF,MAAMC,MAIX,yBAAKE,UAAU,iBACb,4BAAQA,UAAU,QAAO,kBAAC,EAAD,CAAaF,KAAMC,KAAKF,MAAMC,OAAO,8CAAoBC,KAAKF,MAAMC,KAAKsC,WAClG,wBAAIpC,UAAU,uBACZ,4BAAI,kBAAC,IAAD,CAAMsB,GAAI,YAAV,YACJ,4BAAI,kBAAC,IAAD,CAAMA,GAAI,WAAV,cAKPvB,KAAKF,MAAMC,MAIZ,yBAAKE,UAAU,wBACb,wDAAiC,uBAAGA,UAAU,8BAC9C,wBAAIA,UAAU,uBACZ,4BAAI,kBAAC,IAAD,CAAMsB,GAAI,UAAV,UACJ,4BAAI,kBAAC,IAAD,CAAMA,GAAI,aAAV,gBAKRvB,KAAKF,MAAMwC,SAAW,yBAAKrC,UAAU,uBACrC,kBAAC,IAAD,CAAMsB,GAAI,aAAV,YAGFvB,KAAKF,MAAMwC,SAAW,4BAAQrC,UAAU,wB,GA5I7BO,a,6DEPf+B,E,kDACJ,WAAYzC,GAAQ,uCACZA,G,qDAIN,OACE,wBAAIG,UAAU,gBACZ,0BAAMA,UAAU,mBACd,0BAAMA,UAAW,iBAAmBD,KAAKF,MAAM0C,SAAW,YAAc,IAAKP,QAASjC,KAAKF,MAAM2C,SAAU,uBAAGxC,UAAU,eAAxH,sB,GATsBO,aAiB1BkC,E,kDAEJ,WAAY5C,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXC,WAAW,EACXjE,KAAM,IAER,EAAKkE,aAAeC,IAAMC,YAE1B,EAAKC,oBAAsB,KAC3B,EAAKC,uBAAyB,KAC9B,EAAKC,eAAgB,EAVJ,E,gEAckB,IAAhClD,KAAKF,MAAMqD,KAAKxE,KAAKQ,QACtBa,KAAK6C,aAAaO,QAAQrC,QAE5Bf,KAAKqD,SAAS,CACZ1E,KAAMqB,KAAKF,MAAMqD,KAAKxE,KAAK2E,Y,yCAIZC,EAAWC,GACxBD,EAAUJ,KAAKxE,OAASqB,KAAK2C,MAAMhE,MAAU6E,EAAU7E,OAASqB,KAAK2C,MAAMhE,MAASqB,KAAKkD,eAC3FlD,KAAKqD,SAAS,CACZ1E,KAAMqB,KAAKF,MAAMqD,KAAKxE,KAAK2E,Y,6CAM5BtD,KAAKgD,qBAAqBrD,OAAO8D,aAAazD,KAAKgD,qBACnDhD,KAAKiD,wBAAwBtD,OAAO8D,aAAazD,KAAKiD,0B,iCAGhDS,GACT1D,KAAKqD,SAAS,CACZT,UAAWc,M,qCAMA5C,EAAG6C,GAAO,IAAD,OAClBhF,EAAOmC,EAAE8C,OAAOC,MAEpB,SAASX,IACPlD,KAAKkD,eAAgB,EAIvBlD,KAAKqD,SAAS,CACZ1E,KAAMA,IACL,WACE,EAAKqE,qBAAqBrD,OAAO8D,aAAa,EAAKT,qBACtD,EAAKA,oBAAsBrD,OAAOmE,WAAY,EAAKhE,MAAMiE,eAAgB,IAAMpF,EAAMgF,GAErF,EAAKT,eAAgB,EAClB,EAAKD,wBAAwBtD,OAAO8D,aAAa,EAAKR,wBACzD,EAAKA,uBAAyBtD,OAAOmE,WAAYZ,EAAcc,KAAK,GAAO,KAE3E,EAAKlE,MAAMmE,uB,+BAKL,IAAD,OACHd,EAAOnD,KAAKF,MAAMqD,KAClBvB,EAAQ5B,KAAKF,MAAM8B,MACnBsC,EAAWlE,KAAKF,MAAMqD,KAAKe,SAC3BC,EAAUhB,EAAKgB,QACfC,EAAapE,KAAKF,MAAMsE,WAExBT,EAAO3D,KAAKF,MAAM6D,KAOtB,GALG3D,KAAKF,MAAMuE,eACZF,EAAUvC,GAITsC,EACD,IAAII,EACF,wBAAIrE,UAAWD,KAAKF,MAAMyE,KAAO,GAAK,UAClCL,EAASxC,KAAI,SAACyB,EAAMvB,GAAP,OACb,kBAACc,EAAD,CAAUb,IAAKD,EACLuB,KAAMA,EACNoB,KAAM,EAAKzE,MAAM0E,YAAYC,IAAItB,EAAKuB,WACtCC,oBAAoB,EACpBhB,KAAM,EAAK7D,MAAM6D,KAAKiB,OAAO,CAAChD,IAE9B4C,YAAa,EAAK1E,MAAM0E,YACxBvC,QAAS,EAAKnC,MAAMmC,QACpB4C,UAAW,EAAK/E,MAAM+E,UACtBC,YAAa,EAAKhF,MAAMgF,YACxBC,SAAU,EAAKjF,MAAMiF,SACrBV,aAAc,EAAKvE,MAAMuE,aACzBD,WAAY,EAAKtE,MAAMsE,WACvBL,eAAgB,EAAKjE,MAAMiE,eAC3BiB,eAAgB,EAAKlF,MAAMkF,eAC3BC,WAAY,EAAKnF,MAAMmF,WACvBxC,QAAS,EAAK3C,MAAM2C,QACpBwB,gBAAiB,EAAKnE,MAAMmE,2BAKxCK,EAAa,GAKnB,GAAGtE,KAAKF,MAAM+E,UACZ,IAAIK,EAAYlF,KAAKF,MAAM+E,UAAUM,eAAenF,KAAKF,MAAMqD,KAAKuB,WAChEU,EAAYF,EAAYlF,KAAKF,MAAM+E,UAAU7E,KAAKF,MAAMqD,KAAKuB,WAAWW,KAAK,IAAM,QAEvFH,GAAY,EACZE,EAAY,GAId,IAAIE,EACF,0BAAMrF,UAAU,mBAEd,0BAAMA,UAAU,SAEbiE,GAAYE,IAAe,0BAAMnE,UAAW,eAAiBiE,EAAW,GAAK,qBAAuBf,EAAKxE,KAAKQ,OAAS,EAAI,GAAK,WAAY8C,QAAS,kBAAM,EAAKnC,MAAMmC,QAAQkB,EAAKuB,aAAY,uBAAGzE,UAAW,kBAAoBD,KAAKF,MAAMyE,KAAO,KAAO,WAE7P,0BAAMtE,UAAW,iBAAmBiF,EAAY,cAAe,KAAOd,EAAa,cAAe,KAAOpE,KAAKF,MAAMgF,cAAgBM,EAAY,iBAAmB,IAC7JG,iBAAgBH,EAAWnD,QAASjC,KAAKF,MAAMiF,SAAW,kBAAM,EAAKjF,MAAMiF,SAAS,EAAKjF,MAAMqD,KAAKuB,YAAa,MACjHN,EAAa,2BAAOoB,UAAQ,EAACC,UAAW,SAAC3E,GAAD,OAAmB,IAAbA,EAAE4E,QAAgB5E,EAAE6E,iBAAkB,IAAI1F,UAAsC,IAA3BD,KAAK2C,MAAMhE,KAAKQ,OAAe,QAAWa,KAAKF,MAAM8F,kBAAoB5F,KAAKF,MAAM8F,iBAAiBnB,IAAItB,EAAKuB,WAAa,SAAW,GACvOmB,YAAY,YAAYC,IAAK9F,KAAK6C,aAAckD,UAAW,GAC3DlC,MAAO7D,KAAK2C,MAAMhE,KAAMqH,SAAU,SAAClF,GAAD,OAAO,EAAKiD,eAAejD,EAAG6C,MAAYR,EAAKxE,OAIzF,0BAAMsB,UAAU,SACd,0BAAMA,UAAW,eAAiBmE,EAAa,cAAgB,KAC9DA,EAAa,2BAAO2B,UAAW,IAAKN,UAAW,SAAC3E,GAAD,OAAmB,IAAbA,EAAE4E,QAAgB5E,EAAE6E,iBAAkB,IAAI9B,MAAOV,EAAK8C,aAAe,GAAID,SAAU,SAAClF,GAAD,OAAO,EAAKhB,MAAMkF,eAAelE,EAAG6C,IAAOkC,YAAY,qBAAwB1C,EAAK8C,aAAe,KAG5O7B,GAAc,0BAAMnE,UAAU,2BAA0B,0BAAMA,UAAU,gBAAgBgC,QAAS,WAAO,EAAKiE,YAAW,GAAQ,EAAKpG,MAAMmF,WAAWtB,IAAQwC,aAAc,kBAAM,EAAKD,YAAW,IAAOE,aAAc,kBAAM,EAAKF,YAAW,KAAQ,uBAAGjG,UAAU,mBAOxQ,OAAGD,KAAKF,MAAM6E,mBAGT3E,KAAKF,MAAMuG,UAEV,kBAAC,IAAD,CAAWxE,IAAKsB,EAAK7B,GAAGgF,WAAYC,YAAapD,EAAK7B,GAAGgF,WAAY1E,MAAOA,IACzE,SAAC4E,EAAUC,GAAX,OACC,sCAAKX,IAAKU,EAASE,UAAcF,EAASG,eAA1C,CAA0D1G,UAAW,cAAgBwG,EAASG,WAAa,WAAY,gBAAkB,WAAcC,SAAS1C,GA/KrJ,GA+KoL,IAAM,EAAKxB,MAAMC,UAAY,gBAAkB,MAC5O,yCAAS4D,EAASM,gBAAlB,CAAmC7G,UAAU,0BAAwB,0BAAMA,UAAU,iBAEnFqF,EACAhB,EAGA,EAAKxE,MAAMyE,MAAQ,EAAKzE,MAAMsE,YAAc,4BAAI,kBAAC,EAAD,CAAmB3B,QAAS,kBAAM,EAAK3C,MAAM2C,QAAQkB,WAQ7G,wBAAI1D,UAAW,WAAc4G,SAAS1C,GA9LvB,GA8LsD,IAAMnE,KAAK2C,MAAMC,UAAY,gBAAkB,KAChH0C,EACAhB,EACAtE,KAAKF,MAAMyE,MAAQvE,KAAKF,MAAMsE,YAAc,4BAAI,kBAAC,EAAD,CAAmB3B,QAAS,kBAAM,EAAK3C,MAAM2C,QAAQkB,QAQ3G,wBAAI1D,UAAYD,KAAK2C,MAAMC,UAAY,gBAAkB,IACrD0C,EACAhB,EACAtE,KAAKF,MAAMyE,MAAQvE,KAAKF,MAAMsE,YAAc,4BAAI,kBAAC,EAAD,CAAmB3B,QAAS,kBAAM,EAAK3C,MAAM2C,QAAQkB,Y,GAzL1FnD,aAoMjBuG,EAAU,SAACC,EAAMC,EAAYC,GACjC,IAAMC,EAASC,MAAMC,KAAKL,GADoB,EAE5BG,EAAOG,OAAOL,EAAY,GAArCM,EAFuC,oBAK9C,OAFAJ,EAAOG,OAAOJ,EAAU,EAAGK,GAEpBJ,GAYT,SAASK,EAAeC,GAEtB,IADA,IAAIC,EAAY,IAAIN,MAAMK,EAAMtI,QACxBD,EAAI,EAAGA,EAAIwI,EAAUvI,OAAQD,IACnCwI,EAAUxI,GAAKA,EAEjB,OAAOwI,E,IAKHC,E,kDACJ,WAAY7H,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACX+E,UAAW,GAEXE,aAAc,GACdpD,YAAa,IAAIqD,KAEnB,EAAKC,UAAY,EAAKA,UAAU9D,KAAf,gBARA,E,+DAaAT,EAAWC,GAC5B,IAAIkE,EAAYF,EAAexH,KAAKF,MAAM2H,OACtCM,IAAEC,QAAQzE,EAAUkE,MAAOzH,KAAKF,MAAM2H,QACxCzH,KAAKqD,SAAS,CACZmB,YAAa,IAAIqD,IACjBD,aAAc5H,KAAKF,MAAM2H,MACzBC,UAAWA,M,2CAMf,IAAIA,EAAYF,EAAexH,KAAKF,MAAM2H,OAE1CzH,KAAKqD,SAAS,CACZmB,YAAa,IAAIqD,IACjBD,aAAc5H,KAAKF,MAAM2H,MACzBC,UAAWA,M,qCAUAhD,GACb,IAAIF,EAAcxE,KAAK2C,MAAM6B,YAE1BA,EAAYC,IAAIC,GACjBF,EAAYyD,OAAOvD,GAEnBF,EAAY0D,IAAIxD,GAGlB1E,KAAKqD,SAAS,CACZmB,YAAaA,M,gCAKP2C,GAAS,IAAD,OAEhB,GAAKA,EAAOgB,YAAZ,CAIA,IAAMT,EAAYX,EAChB/G,KAAK2C,MAAM+E,UACXP,EAAOiB,OAAOxG,MACduF,EAAOgB,YAAYvG,OAGjBgG,EAtFR,SAAyBH,EAAOY,GAE9B,IADA,IAAIT,EAAe,IAAIR,MAAMK,EAAMtI,QAC3BD,EAAI,EAAGA,EAAImJ,EAAMlJ,OAAQD,IAC/B0I,EAAa1I,GAAKuI,EAAMY,EAAMnJ,IAEhC,OAAO0I,EAiFcU,CAAgBtI,KAAKF,MAAM2H,MAAOC,GAErD1H,KAAKF,MAAMyI,cAAcX,GAAc,kBACrC,EAAKvE,SAAS,CACZqE,UAAWA,EACXE,aAAcA,U,+BAMV,IAAD,OAEHH,EAAczH,KAAK2C,MAAMiF,aACzBpD,EAAcxE,KAAK2C,MAAM6B,YAI7B,OACE,yBAAKlD,GAAG,0BAA0BrB,WAAYD,KAAKF,MAAM0I,QAAU,GAAK,WAAaxI,KAAKF,MAAM2I,YAAc,gBAAkB,KAAOzI,KAAKF,MAAM4I,UAAY,cAAgB,KAC5K,kBAAC,IAAD,CAAiBZ,UAAW9H,KAAK8H,WAC/B,kBAAC,IAAD,CAAWa,YAAY,cACpB,SAACnC,EAAUC,GAAX,OACC,wCACMD,EAASoC,eADf,CAEE3I,UAAW,kBAAoBwG,EAASoC,eAAiB,YAAc,IACvE/C,IAAKU,EAASE,WAGb,EAAK5G,MAAM2I,aAAe,wBAAIxI,UAAU,cAAa,0BAAMA,UAAU,mBAAkB,0BAAMA,UAAU,iBAAhB,gBAAmD,0BAAMA,UAAU,eAAhB,iBAC1IwH,EAAM/F,KAAI,SAACyB,EAAMvB,GAAP,OACT,kBAAC,EAAD,CACUC,IAAKD,EACLuB,KAAMA,EACNvB,MAAOA,EACPK,QAAS,EAAK6G,eAAe9E,KAAK,GAClCO,KAAMC,EAAYC,IAAItB,EAAKxE,MAC3B6F,YAAa,EAAK7B,MAAM6B,YACxBK,UAAW,EAAK/E,MAAM+E,UACtBC,YAAa,EAAKhF,MAAMgF,YACxBH,oBAAoB,EACpBI,SAAU,EAAKjF,MAAMiF,SACrBsB,UAAW,EAAKvG,MAAMuG,UACtBtC,eAAgB,EAAKjE,MAAMiE,eAC3BJ,KAAM,CAAC/B,QAGlB4E,EAASX,sB,GAnHMrF,aA6H1BuI,E,kDACJ,WAAYjJ,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACX8E,MAAO,GACPjD,YAAa,IAAIqD,IACjBjC,iBAAkB,IAAIiC,IACtB5D,iBAAiB,GAEnB,EAAK+E,kBAAoB,KARR,E,gEAYjBhJ,KAAKqD,SAAS,CACZoE,MAAOzH,KAAKF,MAAM2H,U,yCAGHlE,EAAWC,IAGxBuE,IAAEC,QAAQhI,KAAKF,MAAM2H,MAAOzH,KAAK2C,MAAM8E,QAAUM,IAAEC,QAAQxE,EAAUiE,MAAOzH,KAAK2C,MAAM8E,QAC1FzH,KAAKqD,SAAS,CACboE,MAAOzH,KAAKF,MAAM2H,MAClBjD,YAAa,IAAIqD,IACjBjC,iBAAkB5F,KAAKF,MAAM8F,mBAI5B5F,KAAKF,MAAM8F,mBAAqB5F,KAAK2C,MAAMiD,kBAC5C5F,KAAKqD,SAAS,CACZuC,iBAAkB5F,KAAKF,MAAM8F,qB,qCA2BpBlB,GACb,IAAIF,EAAcxE,KAAK2C,MAAM6B,YAE1BA,EAAYC,IAAIC,GACjBF,EAAYyD,OAAOvD,GAEnBF,EAAY0D,IAAIxD,GAGlB1E,KAAKqD,SAAS,CACZmB,YAAaA,M,yEAMD2C,G,0EAETA,EAAOgB,Y,wDAICnI,KAAK2C,MAAM8E,MAClBA,EAAQV,EACZ/G,KAAK2C,MAAM8E,MACXN,EAAOiB,OAAOxG,MACduF,EAAOgB,YAAYvG,O,SAIf5B,KAAKqD,SAAS,CAClBoE,MAAOA,I,OAETzH,KAAKF,MAAMmJ,gBAAgBjJ,KAAK2C,MAAM8E,O,qIAMhC9D,GAAO,IAAD,OAER8D,EAAQzH,KAAK2C,MAAM8E,MAEvB,GAAG9D,EAAKxE,OAAS,EAAG,CAElB,IADA,IAAI+J,EAAezB,EACXvI,EAAI,EAAGA,EAAIyE,EAAKxE,OAAS,EAAGD,IAAK,CAEvCgK,EAAeA,EADHvF,EAAKzE,IACkBgF,SAGrC,IAAIiF,EAAaD,EAAavF,EAAKA,EAAKxE,OAAS,IAElCgK,EAAWjF,WAExBiF,EAAWjF,SAAW,IAAIkD,OAExB3E,EAAU,CACZ9D,KAAM,GACNsH,YAAa,GACb9B,QAASgF,EAAWhF,QACpBO,UAAWyE,EAAWzE,UAAY,KAEpCyE,EAAWjF,SAASkF,KAAK3G,OAEtB,CACH,IAAIA,EAAU,CACZ9D,KAAM,GACNsH,YAAa,GACb9B,QAAUnE,KAAK2C,MAAM8E,MAAMtI,OAAS,EACpCuF,UAAW,GACXpD,GAAItB,KAAK2C,MAAM8E,MAAMtI,OAAS,GAEhCsI,EAAM2B,KAAK3G,GAObzC,KAAKqD,SAAS,CACZoE,MAAOA,IACN,WACD,EAAK3H,MAAMuJ,eACXC,QAAQC,IAAI,mBAAoB,EAAK5G,MAAM8E,Y,wCAO5B,IAAD,OAYbzH,KAAKgJ,mBAAmBrJ,OAAO8D,aAAazD,KAAKgJ,mBACpDhJ,KAAKgJ,kBAAoBrJ,OAAOmE,WAXhC,WAAiC,IAAD,OAC9B9D,KAAKqD,SAAS,CACZY,iBAAiB,IAChB,WACD,EAAKnE,MAAMmE,iBAAgB,OAOiCD,KAAKhE,MAAO,KAE5EA,KAAKqD,SAAS,CACZY,iBAAiB,IAChB,WACD,EAAKnE,MAAMmE,iBAAgB,Q,qCAOhBtF,EAAMgF,GAOnB,IAP0B,IAAD,OACrB6F,EAAKC,YAAYC,MAEjBC,EAAUhL,EAEV8I,EAAQzH,KAAK2C,MAAM8E,MACnByB,EAAezB,EACXvI,EAAI,EAAGA,EAAIyE,EAAKxE,OAAS,EAAGD,IAAK,CAEvCgK,EAAeA,EADHvF,EAAKzE,IACkBgF,SAIrC,IAAIf,EAAO+F,EAAavF,EAAKA,EAAKxE,OAAS,IAE3CgE,EAAKxE,KAAOgL,EAGZ,IAAIpF,GAAO,EACPC,EAAcxE,KAAK2C,MAAM6B,YAC1BxE,KAAK2C,MAAM6B,YAAYC,IAAItB,EAAKuB,aACjCH,GAAO,EACPC,EAAYyD,OAAO9E,EAAKuB,YAI1B,IAAIkF,EAAczG,EAAKuB,UAAUzF,MAAM,KACvC2K,EAAYA,EAAYzK,OAAS,GAAKwK,EACtCxG,EAAKuB,UAAYkF,EAAYvE,KAAK,KAE/Bd,GAAMC,EAAY0D,IAAI/E,EAAKuB,WAI9B1E,KAAKqD,SAAS,CACZoE,MAAOA,EACPjD,YAAaA,IACZ,WACD,IAAIqF,EAAKJ,YAAYC,MACrBJ,QAAQC,IAAIM,EAAGL,GACf,EAAK1J,MAAMuJ,oB,qCAOAvI,EAAG6C,GAKhB,IALuB,IAAD,OAClBmG,EAAUhJ,EAAE8C,OAAOC,MAEnB4D,EAAQzH,KAAK2C,MAAM8E,MACnByB,EAAezB,EACXvI,EAAI,EAAGA,EAAIyE,EAAKxE,OAAS,EAAGD,IAAK,CAEvCgK,EAAeA,EADHvF,EAAKzE,IACkBgF,SAI1BgF,EAAavF,EAAKA,EAAKxE,OAAS,IACtC8G,YAAc6D,EACnB9J,KAAKqD,SAAS,CACZoE,MAAOA,IACN,WACD,EAAK3H,MAAMuJ,oB,0EAOE1F,G,mFAIf,GAFI8D,EAAQzH,KAAK2C,MAAM8E,MACnByB,EAAezB,EAChB9D,EAAKxE,OAAS,EACf,IAAQD,EAAI,EAAGA,EAAIyE,EAAKxE,OAAS,EAAGD,IAC9B0C,EAAQ+B,EAAKzE,GACb6K,EAAYb,EAAatH,GAC7BsH,EAAeA,EAAatH,GAAOsC,S,OAOnCM,EAAcxE,KAAK2C,MAAM6B,YACzBrB,EAAO+F,EAAavF,EAAKA,EAAKxE,OAAS,IAC3CqF,EAAYyD,OAAO9E,EAAKuB,WAExBwE,EAAa5B,OAAO3D,EAAKA,EAAKxE,OAAS,GAAI,GAChB,IAAxB+J,EAAa/J,QAAgBwE,EAAKxE,OAAS,UAAY4K,EAAU7F,S,UAE9DlE,KAAKqD,SAAS,CAClBoE,MAAOA,EACPjD,YAAaA,I,QAEfxE,KAAKF,MAAMuJ,e,uIAKH,IAAD,OACH5B,EAAczH,KAAK2C,MAAM8E,MACzBjD,EAAcxE,KAAK2C,MAAM6B,YAE7B,OACE,yBAAKlD,GAAG,0BAA0BrB,UAAU,2BAC1C,4BACE,wBAAIA,UAAU,cAAa,0BAAMA,UAAU,mBAAkB,0BAAMA,UAAU,QAAO,0BAAMA,UAAU,iBAAhB,iBAA0D,0BAAMA,UAAU,SAAQ,0BAAMA,UAAU,eAAhB,gBAAuD,0BAAMA,UAAU,2BAA0B,0BAAMA,UAAU,sBAGzR,kBAAC,IAAD,CAAiB6H,UAAW9H,KAAK8H,UAAU9D,KAAKhE,OAC9C,kBAAC,IAAD,CAAW2I,YAAY,cACpB,SAACnC,EAAUC,GAAX,OAEC,sCAAIxG,UAAW,oCAAsC,EAAKH,MAAMkK,YAAc,eAAiB,KAAOvD,EAASoC,eAAiB,YAAc,KAAO,EAAKlG,MAAMsB,gBAAkB,iBAAkB,KAC9LuC,EAASoC,eADf,CAEE9C,IAAKU,EAASE,WAIbe,EAAM/F,KAAI,SAACyB,EAAMvB,GAAP,OACT,kBAAC,EAAD,CACEC,IAAKD,EACLuB,KAAMA,EACNvB,MAAOA,EACPK,QAAS,EAAK6G,eAAe9E,KAAK,GAClCO,KAAMC,EAAYC,IAAItB,EAAKxE,MAC3B6F,YAAa,EAAK7B,MAAM6B,YACxBG,oBAAoB,EACpB0B,WAAW,EACXhC,cAAc,EACdD,YAAY,EACZL,eAAgB,EAAKA,eAAeC,KAAK,GACzCgB,eAAgB,EAAKA,eAAehB,KAAK,GACzCiB,WAAY,EAAKA,WAAWjB,KAAK,GACjCvB,QAAS,EAAKA,QAAQuB,KAAK,GAC3B4B,iBAAkB,EAAKjD,MAAMiD,iBAC7B3B,gBAAiB,EAAKA,gBAAgBD,KAAK,GAE3CL,KAAM,CAAC/B,QAIV4E,EAASX,YAEV,kBAAC,EAAD,CAAmBpD,QAAS,kBAAM,EAAKA,QAAQ,iB,GA9TrBjC,aA6U3BmH,I,kBC3rBf,SAASsC,EAAaC,EAAaC,GAEjC,OAAOA,EADSD,EAAYjL,MAAM,KAAKqE,MAAM,EAAG,GAAG,I,IAK/C8G,E,kDACJ,WAAYtK,GAAQ,uCACZA,G,qDAGE,IAAD,OAEHb,EAAQe,KAAKF,MAAMoK,YAAYjL,MAAM,KACrCoL,EAAiBpL,EAAME,OAAS,EAAI,IAAM,GAG9C,OAFAkL,GAAkCpL,EAAMA,EAAME,OAAS,GAGrD,0BAAMc,UAAW,aAAeD,KAAKF,MAAMwK,UAAWrI,QAAS,SAACnB,GAAO,EAAKhB,MAAMyK,UAAU,EAAKzK,MAAMoK,eAAkB,0BAAMjK,UAAU,cAAcoK,Q,GAZzI7J,aAsBdgK,E,kDACJ,WAAY1K,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACX8H,UAAU,GAEZ,EAAKC,aAAe5H,IAAMC,YALT,E,sDASTmH,GACRlK,KAAKF,MAAMyK,UAAUvK,KAAKF,MAAM8B,MAAOsI,K,yCAItB3G,EAAWC,M,2CAyB5B,IALA,IAAImH,EAAO3K,KAAKF,MAAM6K,KAClBC,EAAe5K,KAAKF,MAAM8K,aAE1BC,EAAS,GAEL3L,EAAI,EAAGA,EAAIyL,EAAKxL,OAAQD,IAC3BA,IAAM0L,EAAa,KACpBC,GAAU,mCAEZA,GAAUF,EAAKzL,GACZA,IAAM0L,EAAa,KACpBC,GAAU,WAKd,OAAOC,IAAgBD,K,+BAGf,IAAD,OAEHE,EAAW/K,KAAKF,MAAMkL,cAAc7L,OAAS,EAE7C8L,EAAWF,EAAY,SAAkC,MAAtB/K,KAAKF,MAAMoL,OAAkB,YAAc,KAAOlL,KAAKF,MAAMqL,aAAe,WAAa,IAAO,GAEvI,GAAGJ,EACD,IAAIK,EAASpL,KAAKF,MAAMkL,cAActJ,KAAI,SAACwI,EAAahL,GAAd,OAC9B,kBAAC,EAAD,CAAOqL,UAAW,EAAKA,UAAUvG,KAAK,GAAOnC,IAAK3C,EAAGgM,OAAQ,EAAKpL,MAAMoL,OAAQhB,YAAaA,EAAaI,UAAWL,EAAaC,EAAa,EAAKpK,MAAMqK,2BAIlKiB,EAAS,GAGf,IAAIT,EAAO3K,KAAKF,MAAM6K,KACnB3K,KAAKF,MAAM8K,eACZD,EAAO3K,KAAKqL,sBAGd,IAAIC,EAAmBP,EAAY,QAAUd,EAAajK,KAAKF,MAAMkL,cAAc,GAAIhL,KAAKF,MAAMqK,iBAAoB,GACtH,OACE,0BAAMlK,UAAW,QAAUD,KAAKF,MAAM2K,SAAW,YAAc,IAAMQ,GAEnE,0BAAMhL,UAAW,aAAeqL,GAAmBtL,KAAKF,MAAM8K,aAAe,oBAAsB,IAAM9E,IAAK9F,KAAK0K,aAC7Ga,UAAa,kBAAM,EAAKzL,MAAM0L,iBAAiB,EAAK1L,MAAM8B,MAAO,OACjE6J,YAAa,kBAAM,EAAK3L,MAAM0L,iBAAiB,EAAK1L,MAAM8B,MAAO,UAEpE+I,GAEFS,O,GApFU5K,aA4FbkL,E,kDACJ,WAAY5L,GAAQ,IAAD,8BACjB,cAAMA,IACD6L,YAAc7I,IAAMC,YAFR,E,6DAMF6I,EAAWC,GAC1B7L,KAAKF,MAAM0L,iBAAiBxL,KAAKF,MAAM8B,MAAOgK,EAAWC,K,gCAGjDD,EAAW1B,GACnBlK,KAAKF,MAAMyK,UAAUvK,KAAKF,MAAM8B,MAAOgK,EAAW1B,K,yCAKjC3G,EAAWC,GAC5B,GAAIxD,KAAKF,MAAMgM,YAAgD,IAAhCvI,EAAUuI,WAAW3M,QAAgBa,KAAKF,MAAMgM,WAAW3M,OAAS,EAAI,CAErG,IAAI4M,EAAU/L,KAAK2L,YAAYvI,QAC3B4I,EAAWlN,SAASmN,KAAKC,wBAEzBC,EADWJ,EAAQG,wBACCE,IAAMJ,EAASI,IAEtCzM,OAAOC,SAAS,CACfwM,IAAKD,EAAS,IACdE,KAAM,EACNC,SAAU,c,+BAKN,IAAD,OAEHR,EAAa9L,KAAKF,MAAMgM,WAI5B,SAASS,EAAeX,GACtB,GAAyB,IAAtBE,EAAW3M,OAAc,OAAO,EACnC,IAAI,IAAID,EAAI,EAAGA,EAAI4M,EAAW3M,OAAQD,IAAK,CACzC,IAAIsN,EAAYV,EAAW5M,GAC3B,KAAGsN,EAAUC,aAAe,KACzBD,EAAUC,cAAgBb,GAAaA,GAAaY,EAAUE,gBAC/D,OAAO,EAGX,OAAO,EAKT,OAAG1M,KAAKF,MAAM2I,YAEV,yBAAKxI,UAAW,kBAAoBD,KAAKF,MAAM2I,YAAc,gBAAkB,IAAK3C,IAAK9F,KAAK2L,aAC1F3L,KAAKF,MAAM6M,MAAMjL,KAAI,SAACkL,EAAM1N,GAAP,OACrB,kBAAC,EAAD,CAAM2C,IAAK3C,EACL0C,MAAO1C,EACPyL,KAAMiC,EACN5B,cAAe,EAAKlL,MAAM+M,YAAY3N,GAAG8L,eAAiB,GAC1DE,OAAQ,EAAKpL,MAAM+M,YAAY3N,GAAGgM,OAClCf,gBAAiB,EAAKrK,MAAMqK,gBAC5BS,aAAc,EAAK9K,MAAM+M,YAAY3N,GAAG0L,aACxCY,iBAAkB,WAAO,OAAO,MAChCjB,UAAW,WAAO,OAAO,MACzBY,aAAc,EAAKrL,MAAM+M,YAAY3N,GAAGiM,qBASpD,yBAAKlL,UAAU,iBAAiB6F,IAAK9F,KAAK2L,aACtC3L,KAAKF,MAAM6M,MAAMjL,KAAI,SAACkL,EAAM1N,GAAP,OACrB,kBAAC,EAAD,CAAM2C,IAAK3C,EACL0C,MAAO1C,EACPyL,KAAMiC,EACNnC,SAAU8B,EAAerN,GACzB8L,cAAe,EAAKlL,MAAM+M,YAAY3N,GAAG8L,eAAiB,GAC1DG,aAAc,EAAKrL,MAAM+M,YAAY3N,GAAGiM,eACxCD,OAAQ,EAAKpL,MAAM+M,YAAY3N,GAAGgM,OAClCM,iBAAkB,EAAKA,iBAAiBxH,KAAK,GAC7CmG,gBAAiB,EAAKrK,MAAMqK,gBAC5BI,UAAW,EAAKA,UAAUvG,KAAK,GAC/B4G,aAAc,EAAK9K,MAAM+M,YAAY3N,GAAG0L,uB,GAvFjCpK,aC/HjBsM,EAAaC,EAAQ,KAUZC,MAPf,SAAoBC,EAAGC,GACrB,OAAGA,GAAWA,EAAQC,SACdL,EAAWG,EAAG,UAEfH,EAAWG,EAAG,UAAY,OAASH,EAAWG,EAAG,YCCpDG,E,kDACJ,WAAYtN,GAAQ,uCACZA,G,qDAIN,OACE,yBAAKG,UAAU,eACb,yBAAKA,UAAU,gBACb,yBAAKA,UAAU,2BAA2BE,MAAO,CAAC,WAAcH,KAAKF,MAAMuN,kBAAkBhN,aAAa,uBAAGJ,UAAW,wBAA0BD,KAAKF,MAAMuN,kBAAkB/M,KAAMH,MAAO,CAAC,MAASH,KAAKF,MAAMuN,kBAAkB9M,gBAErO,yBAAKN,UAAU,iBACb,yBAAKA,UAAW,qBAAsBD,KAAKF,MAAMwN,OAAO,0BAAMrN,UAAU,mBAAmB+M,EAAWhN,KAAKF,MAAMyN,eAC/GvN,KAAKF,MAAM0N,oBACX,gCAAYvN,UAAU,uBACpB,0BAAMA,UAAU,mBAAmBD,KAAKF,MAAM2N,iBAC9C,kBAAC,IAAD,CAAMlM,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,+BAAiCpC,KAAKF,MAAM6N,aAAa,uBAAGC,MAAM,0BAEjI,yBAAK3N,UAAU,4BAA4BD,KAAKF,MAAM6K,Y,GAlB1CnK,aA0BhBqN,E,kDACJ,WAAY/N,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXmL,QAAS,IAHM,E,qDAOVhN,GAAI,IAAD,OACVA,EAAE6E,iBAE+B,IAA9B3F,KAAK2C,MAAMmL,QAAQ3O,QAEtBa,KAAKF,MAAMiO,cAAc/N,KAAK2C,MAAMmL,SAAS,WAC3C,EAAKzK,SAAS,CACZyK,QAAS,U,iCAMJhN,GACTd,KAAKqD,SAAS,CACZyK,QAAShN,EAAE8C,OAAOC,U,+BAKpB,OACE,0BAAM5D,UAAU,oBAAoB+N,SAAUhO,KAAKgO,SAAShK,KAAKhE,OAC/D,yBAAKC,UAAU,eACb,yBAAKA,UAAU,gBACXD,KAAKF,MAAMuN,mBACb,yBAAKpN,UAAU,2BAA2BE,MAAO,CAAC,WAAcH,KAAKF,MAAMuN,kBAAkBhN,aAAa,uBAAGJ,UAAW,wBAA0BD,KAAKF,MAAMuN,kBAAkB/M,KAAMH,MAAO,CAAC,MAASH,KAAKF,MAAMuN,kBAAkB9M,gBAGrO,yBAAKN,UAAU,8BACb,yBAAKA,UAAU,gBACb,8BAAUtB,KAAK,gBAAgBsB,UAAU,gBAAgB4F,YAAY,qBAAqBG,SAAUhG,KAAKiO,WAAWjK,KAAKhE,MAAO6D,MAAO7D,KAAK2C,MAAMmL,QAASI,UAAU,WAU3K,yBAAKjO,UAAU,0BAAyB,4BAAQA,UAAU,kBAAiB,uBAAG2N,MAAM,sB,GAhDjEpN,aC5BrB2N,E,kDACJ,WAAYrO,GAAQ,uCACZA,G,qDAIN,IAAIsO,EAAc,YACfpO,KAAKF,MAAMuO,cAAaD,EAAc,IACtCpO,KAAKF,MAAMwO,gBAAeF,EAAc,mBACxCpO,KAAKF,MAAMyO,SAAQH,EAAc,WAEpC,IAAII,EAAY,UACbxO,KAAKF,MAAMwO,gBAAeE,EAAY,YACtCxO,KAAKF,MAAMyO,SAAQC,EAAY,kBAElC,IAAI7D,EAAO,OAIX,OAHG3K,KAAKF,MAAMwO,gBAAe3D,EAAO,SACjC3K,KAAKF,MAAMyO,SAAQ5D,EAAO,UAG3B,4BAAQ1K,UAAW,cAAgBmO,EAAanM,QAASjC,KAAKF,MAAM2O,mBAClE,uBAAGxO,UAAW,MAAQuO,IACpB7D,O,GAtBenK,aA8BnBkO,E,kDACJ,WAAY5O,GAAQ,uCACZA,G,qDAIN,OACE,yBAAKwB,GAAG,uBAAuBrB,UAAYD,KAAKF,MAAM6O,KAAO,OAAS,QACpE,0BAAM1O,UAAU,gBACd,0BAAMA,UAAU,QAAQE,MAAO,CAAC,OAAUH,KAAKF,MAAM8O,oBAAsB,GAAK5O,KAAKF,MAAM+O,WAAa,IAAM,a,GAT9FrO,aAsBpBsO,E,kDACJ,WAAYhP,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXkB,MAAO,IAET,EAAKkL,SAAWjM,IAAMC,YALL,E,wDAQPjC,GACV,IAAI+C,EAAQ/C,EAAE8C,OAAOC,MACM,IAAxBA,EAAMzE,OAAOD,SACd0E,EAAQ,IAEV7D,KAAKqD,SAAS,CACZQ,MAAOA,M,6BAIJ/C,GAaL,OAVAd,KAAKF,MAAMkP,gBAAgBhP,KAAK2C,MAAMkB,OAK1BnD,IAAEV,KAAK+O,SAAS3L,SACtB6L,OAGNnO,EAAE6E,iBACK,O,+BAIC,IAAD,OACP,OACE,0BAAM1F,UAAW,oBAAsBD,KAAKF,MAAMoP,aAAe,UAAY,IAAKlB,SAAUhO,KAAKmP,OAAOnL,KAAKhE,OAC3G,2BAAO8F,IAAK9F,KAAK+O,SAAU9O,UAAU,aAAaqB,GAAG,sBAAsBuE,YAAY,YAAYhC,MAAO7D,KAAK2C,MAAMkB,MAAOmC,SAAU,SAAClF,GAAD,OAAO,EAAKsO,YAAYtO,MAAa,4BAAQb,UAAU,iBAAgB,uBAAG2N,MAAM,uB,GAvC9LpN,aA8MjB6O,E,kDA3Jb,WAAYvP,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAS,CACZ2M,WAAY,KACZC,iBAAiB,GAEnB,EAAKC,aAAe1M,IAAMC,YANT,E,mEAiBjB,IAAI0M,EAAM/O,IAAEV,KAAKwP,aAAapM,SAC9BqM,EAAIC,IAAI,IACRD,EAAIR,S,+BAGGnO,GAAI,IAAD,OAGV,OADAd,KAAK2P,uBACwB,KAA1B3P,KAAK2C,MAAM2M,YACZtP,KAAKqD,SAAS,CAAEiM,WAAYtP,KAAKF,MAAMwP,aACvCxO,EAAE6E,iBACK,MAKN3F,KAAK2C,MAAM2M,aAAezI,SAAS7G,KAAK2C,MAAM2M,YAAYhJ,YAC3DtG,KAAKqD,SAAS,CACZiM,WAAYtP,KAAKF,MAAM8O,sBACtB,WAAQ,EAAK9O,MAAM8P,SAAS,EAAKjN,MAAM2M,eAC1CxO,EAAE6E,iBACK,OAGN3F,KAAK2C,MAAM2M,WAAa,EACzBtP,KAAKqD,SAAS,CACZiM,WAAY,IACX,WAAQ,EAAKxP,MAAM8P,SAAS,EAAKjN,MAAM2M,eACjCtP,KAAK2C,MAAM2M,WAAatP,KAAKF,MAAM8O,oBAC5C5O,KAAKqD,SAAS,CACZiM,WAAYtP,KAAKF,MAAM8O,sBACtB,WAAQ,EAAK9O,MAAM8P,SAAS,EAAKjN,MAAM2M,eAE1CtP,KAAKF,MAAM8P,SAAS5P,KAAK2C,MAAM2M,YAIjCxO,EAAE6E,iBACK,Q,2CAIH3F,KAAK2C,MAAM2M,YAActP,KAAKF,MAAMwP,YACtCtP,KAAKqD,SAAS,CACZiM,WAAYtP,KAAKF,MAAMwP,e,yCAKV/L,EAAWC,GACzBxD,KAAKF,MAAMwP,aAAe/L,EAAU+L,YACrCtP,KAAKqD,SAAS,CACZiM,WAAYtP,KAAKF,MAAMwP,e,uCAMZxO,GACfd,KAAKqD,SAAS,CACZiM,WAAYxO,EAAE8C,OAAOC,U,+BAIf,IAAD,OAEHgM,EACF,0BAAM5P,UAAW,cACf,sCAAW,2BACT,0BAAM+N,SAAUhO,KAAK4P,SAAS5L,KAAKhE,OACnC,2BACOsB,GAAG,aACHrB,UAAW,cAAgBD,KAAK2C,MAAM4M,gBAAkB,SAAW,IACnE1J,YAAa7F,KAAK2C,MAAM2M,WACxB3Q,KAAK,aACLqH,SAAU,SAAClF,GAAD,OAAO,EAAKgP,iBAAiBhP,IACvCgF,IAAK9F,KAAKwP,iBARnB,OAYQ,2BAAIxP,KAAKF,MAAM+O,cAIvBkB,EAAe/P,KAAKF,MAAM8O,sBAAyB5O,KAAKF,MAAMwP,WAE9DU,EAAehQ,KAAKF,MAAMuO,YAAerO,KAAKF,MAAMyO,OAAS,GAAK,oBAAwBvO,KAAKF,MAAMkQ,aAAe,YAAchD,EAAWhN,KAAKF,MAAMkQ,cAAgB,GAE5K,OACE,yBAAK1O,GAAG,aAAarB,UAAWD,KAAKF,MAAMmQ,aAAe,gBAAkB,IAC1E,yBAAKhQ,UAAU,uCACb,4BAAQA,UAAsC,IAA1BD,KAAKF,MAAMwP,WAAmB,YAAetP,KAAKF,MAAMoQ,SAAW,UAAY,GAAMjO,QAASjC,KAAKF,MAAMqQ,kBAAkB,uBAAGlQ,UAAU,uBAA5J,SAGF,yBAAKA,UAAU,eACb,kBAAC,EAAD,CAAmBiP,aAAclP,KAAKF,MAAMoP,aAAcF,gBAAiBhP,KAAKF,MAAMkP,mBAExF,yBAAK/O,UAAW,0BAA4BD,KAAKF,MAAMsQ,mBAAqB,2BAA6B,KACrGP,EAGA7P,KAAKF,MAAMuQ,iBAAmB,yBAAKpQ,UAAU,kCAC7C,4CACA,4BAAQA,UAAU,uBAAuB+F,SAAU,SAAClF,GAAO,EAAKhB,MAAMwQ,eAAexP,GAAIJ,IAAEI,EAAE8C,QAAQqL,SAClGjP,KAAKF,MAAMyQ,mBAAmB7O,KAAI,SAAC8O,EAAG5O,GAAJ,OACjC,4BAAQiC,MAAO2M,EAAG/F,SAAU+F,IAAM,EAAK1Q,MAAM2Q,aAAcD,QAK/DxQ,KAAKF,MAAM4Q,YAAc,yBAAKzQ,UAAU,kCACxC,2CACA,4BAAQA,UAAU,+BAA+B+F,SAAU,SAAClF,GAAO,EAAKhB,MAAM6Q,UAAU7P,GAAIJ,IAAEI,EAAE8C,QAAQqL,SACrGjP,KAAKF,MAAM8Q,cAAclP,KAAI,SAAC8O,EAAG5O,GAAJ,OAC5B,4BAAQiC,MAAO2M,EAAG/F,SAAU+F,IAAM,EAAK1Q,MAAM+Q,QAAe,gBAANL,EAAsB,gBAAkBA,QAOpG,kBAAC,EAAD,CACE7B,KAAM3O,KAAKF,MAAMsQ,mBACjBxB,oBAAqB5O,KAAKF,MAAM8O,oBAChCC,WAAY7O,KAAKF,MAAM+O,cAG3B,yBAAK5O,UAAU,uBAAuB+P,GAEpChQ,KAAKF,MAAMgR,gBAAkB,yBAAK7Q,UAAU,0BAA0B,kBAAC,EAAD,CAAYoO,YAAarO,KAAKF,MAAMuO,YAAaC,cAAetO,KAAKF,MAAMwO,cAAeC,OAAQvO,KAAKF,MAAMyO,OAAQE,kBAAmBzO,KAAKF,MAAM2O,qBAC3N,yBAAKxO,UAAU,kCAAkC8Q,MAAOhB,IAAgB/P,KAAKF,MAAMoP,aAAe,2DAA6D,IAC7J,4BAAQjP,UAAY8P,EAAe,YAAe/P,KAAKF,MAAMoQ,SAAW,UAAY,GAAOjO,QAASjC,KAAKF,MAAMkR,cAA/G,OAAiI,uBAAG/Q,UAAU,+B,GAtJ/HO,aC+CVyQ,G,WA1Ib,WAAYC,EAAOC,GAAa,oBAC9BnR,KAAKkR,MAAQA,EACblR,KAAKmR,WAAaA,EAClBnR,KAAKkL,OAAS,IACdlL,KAAK4K,aAAe,K,qDAWbM,EAAQhB,EAAakH,EAAUC,EAAcC,QAE1BzS,IAAvBmB,KAAKgL,gBAA6BhL,KAAKgL,cAAgB,IAAI5D,OAE9D,IAAImK,GAA+D,IAA7CvR,KAAKgL,cAAcwG,QAAQtH,GACjD,OAAGlK,KAAKkL,SAAWA,GAAUlL,KAAKoR,WAAaA,GAAYpR,KAAKqR,eAAiBA,GAAgBrR,KAAKsR,aAAeA,IAAcC,KAKnIvR,KAAKkL,OAASA,EACdlL,KAAKoR,SAAWA,EAChBpR,KAAKqR,aAAeA,EACpBrR,KAAKsR,WAAaA,EAIdC,GACFvR,KAAKgL,cAAc5B,KAAKc,IAEnB,K,+CA2BAlK,KAAKgL,qBACLhL,KAAKoR,gBACLpR,KAAKqR,oBACLrR,KAAKsR,WACZtR,KAAKkL,OAAS,M,kCAIJuG,GACV,OAAOA,EAAgBJ,eAAiBrR,KAAKqR,cAAgBI,EAAgBH,aAAetR,KAAKsR,a,wCAIjFG,GAChB,OAAO1J,IAAEC,QAAQhI,KAAKgL,cAAeyG,EAAgBzG,iB,kCAK3Cd,GACV,IAAItI,EAAQ5B,KAAKgL,cAAcwG,QAAQtH,IACzB,IAAXtI,GAIH5B,KAAKgL,cAAc1D,OAAO1F,EAAO,GACA,IAA9B5B,KAAKgL,cAAc7L,SACpBa,KAAKkL,OAAS,WACPlL,KAAKgL,qBACLhL,KAAKoR,gBACLpR,KAAKqR,oBACLrR,KAAKsR,aATZhI,QAAQC,IAAI,qF,mCAcH2B,GACXlL,KAAKkL,OAASA,I,iCAKd,MAAuB,MAAhBlL,KAAKkL,S,qCAKZ,OAAOlL,KAAKsR,aAAetR,KAAKmR,a,sCAGlBE,GACdrR,KAAKqR,aAAeA,I,oCAGRC,GACZtR,KAAKsR,WAAaA,I,sCAIJI,EAAUC,GACxB3R,KAAK4K,aAAe,CAAC8G,EAAUC,K,oCAK/BrI,QAAQC,IAAI,aAAcvJ,KAAKkR,OAC/B5H,QAAQC,IAAI,aAAcvJ,KAAKkL,QAC/B5B,QAAQC,IAAI,aAAcvJ,KAAKoR,UAC/B9H,QAAQC,IAAI,aAAcvJ,KAAKqR,cAC/B/H,QAAQC,IAAI,WAAYvJ,KAAKsR,YAC7BhI,QAAQC,IAAI,eAAgBvJ,KAAKgL,eACjC1B,QAAQC,IAAI,U,KC/DDqI,OA/Ef,SAA8BC,EAAWC,EAAsBC,EAAYC,GAGzE1I,QAAQC,IAAIsI,GACZvI,QAAQC,IAAIuI,GACZxI,QAAQC,IAAI,OAEZ,IAAI0I,EAAe,IAAI7K,MACvB,GAAG4K,EAAa,CACd,IAAI,IAAI9S,KAAK4S,EACXG,EAAa7I,KAAKyI,EAAU,IAE9BA,EAAYI,EAGd,GAAGF,EACD,IAAIG,EAAkBH,EAAW9S,MAAM,KAMzC,IAAI4N,EAAc,IAAIzF,MAAMyK,EAAU1S,QACtC,IAAI,IAAIgT,KAAWN,EAAW,CAC5BhF,EAAYsF,GAAW,IAAI/K,MAAMyK,EAAUM,GAAShT,QAGpD,IAAIiT,EAAY,EAChB,IAAI,IAAIC,KAAaR,EAAUM,GAK7B,GAJAtF,EAAYsF,GAASE,GAAa,IAAIpB,GAAWY,EAAUM,GAASE,GAAYxL,SAASwL,IAItFN,EAAY,CACb,IACIO,EADQT,EAAUM,GAASE,GACVb,QAAQU,EAAgBE,IAC1CE,GAAY,GACbzF,EAAYsF,GAASE,GAAWE,gBAAgBD,EAAUA,EAAWJ,EAAgBE,GAAWjT,OAAS,GACzGiT,KAEAA,EAAY,GAQpB,IAAIN,EAAsB,OAAOjF,EAKjC,IAAI,IAAIsF,KAAWL,EACjB,GAAIA,EAAqBK,GACzB,IAAI,IAAIK,KAAeV,EAAqBK,GAArB,SAA2C,CAGhE,IAAIM,EAAUX,EAAqBK,GAArB,SAA0CK,GACpDE,EAAQD,EAAO,MACfE,EAAMF,EAAO,IAEjB,IAAI,IAAIG,KAAaH,EAAO,OAG1B,IAFA,IAAII,EAAQJ,EAAO,OAAWG,GAEtBE,EAAIJ,EAAOI,EAAIH,EAAKG,IAAK,CAC/B,IAAI5H,EAAS4H,IAAMJ,EAAQ,IAAM,IAGjC7F,EAAYsF,GAASW,GAAGC,SAAS7H,EAAQ2H,EAAOhB,EAAUM,GAAS7O,MAAMoP,EAAOC,GAAKtN,KAAK,KAAMqN,EAAOC,EAAM,IAOrH,OAAO9F,GCjEMmG,G,kDAdb,WAAYlT,GAAQ,uCACZA,G,qDAIN,OACE,0BAAM8N,MAAM,cACV,mDACA,4F,GATmBpN,aCkBZyS,G,kDAjBb,WAAYnT,GAAQ,uCACZA,G,qDAIN,OACE,0BAAM8N,MAAM,cAEV,oDACA,iF,GAVmBpN,aC8BrB0S,GAAiB,CACrBC,OAAQ,MACRC,QAAS,CACP,OAAU,mBACV,eAAgB,qB,IA2BdC,G,kDACJ,WAAYvT,GAAQ,uCACZA,G,qDAEE,IAAD,OACHwT,EAAStT,KAAKF,MAAMwT,OACpBzP,EAAQ7D,KAAKF,MAAM+D,MACvB,OACE,0BAAM5D,UAAW,0BAA4B4D,GAAS7D,KAAKF,MAAMyT,QAAU,WAAa,IAClFtR,QAAS,kBAAM,EAAKnC,MAAM0T,iBAAiBF,EAAQzP,IAAQkN,MAAO,YAAclN,EAAQ,sC,GATrErD,aAezBiT,G,kDACJ,WAAY3T,GAAQ,uCACZA,G,qDAIN,OACE,yBAAKG,UAAW,sBACd,kBAAC,GAAD,eAAkB4D,MAAM,MAAS0P,QAAmC,QAA1BvT,KAAKF,MAAM4T,YAA2B1T,KAAKF,QACrF,kBAAC,GAAD,eAAkB+D,MAAM,SAAS0P,QAAmC,WAA1BvT,KAAKF,MAAM4T,YAA8B1T,KAAKF,QACxF,kBAAC,GAAD,eAAkB+D,MAAM,OAAS0P,QAAmC,SAA1BvT,KAAKF,MAAM4T,YAA4B1T,KAAKF,a,GAV9DU,aAkB1BmT,G,kDACJ,WAAY7T,GAAQ,uCACZA,G,qDAGN,OACE,yBAAKG,UAAU,6BACb,yBAAKA,UAAU,mBACb,yBAAKA,UAAU,mBACf,yBAAKA,UAAU,YAAf,YACA,yBAAKA,UAAU,sBAAf,oB,GAV4BO,aAkBhCoT,G,kDACJ,WAAY9T,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXkR,cAAc,GAGhB,EAAKlI,YAAc7I,IAAMC,YACzB,EAAK+Q,sBAAwBhR,IAAMC,YACnC,EAAKgR,cAAgBjR,IAAMC,YARV,E,+DAaAQ,EAAWC,IACxBuE,IAAEC,QAAQzE,EAAUoJ,MAAO3M,KAAKF,MAAM6M,QAAU3M,KAAK2C,MAAMkR,cAC7D7T,KAAKqD,SAAS,CACZwQ,cAAc,M,2CAuBlB7T,KAAKqD,SAAS,CAEZwQ,cAAe7T,KAAK2C,MAAMkR,eACzB,iB,kCAMH,IAAIG,EAAIhU,KACJiU,EAAOjU,KAAK2L,YAAYvI,QAS5B8Q,IAAWC,OAAOF,EAAM,CAACG,QAAS,YACjCC,MAAK,SAASC,GACbC,iBAAOD,EAAM,YAAcN,EAAElU,MAAM8B,MAAQ,a,oCAKjC4S,EAASC,GACrB,IAAIT,EAAIhU,KACRA,KAAKF,MAAMiO,cAAcyG,EAASxU,KAAKF,MAAM8B,OAAO,WAClD6S,IACAT,EAAED,cAAc3Q,QAAQsR,UAAYV,EAAED,cAAc3Q,QAAQuR,kB,+BAQ9D,OACE,yBAAK1U,UAAW,sBAAwBD,KAAKF,MAAM4T,WAAa,cAAgB1T,KAAKF,MAAM4T,WAAa,KAEtG,yBAAKzT,UAAU,oBACb,yBAAKA,UAAU,YACb,yBAAKA,UAAU,kBAAiB,0BAAMA,UAAU,SAASD,KAAKF,MAAM8U,eACpE,yBAAK3U,UAAU,WAAW6F,IAAK9F,KAAK2L,aAClC,kBAAC,EAAD,CACE/J,MAAO5B,KAAKF,MAAM8B,MAClB+K,MAAO3M,KAAKF,MAAM6M,MAClBE,YAAa7M,KAAKF,MAAM+M,YACxBf,WAAY9L,KAAKF,MAAMgM,WACvBN,iBAAkBxL,KAAKF,MAAM0L,iBAC7BrB,gBAAiBnK,KAAKF,MAAMqK,gBAC5BI,UAAWvK,KAAKF,MAAMyK,aAG1B,kBAAC,GAAD,CAAmB+I,OAAQtT,KAAKF,MAAM8B,MAAO8R,WAAY1T,KAAKF,MAAM4T,WAAYF,iBAAkBxT,KAAKF,MAAM0T,oBAK/G,yBAAKvT,UAAW,gCAAkCD,KAAK2C,MAAMkR,aAAe,QAAU,IAAK/N,IAAK9F,KAAK8T,uBACnG,yBAAK7T,UAAU,mBACf,yBAAKA,UAAU,YAEb,yBAAKA,UAAU,kBAGb,yBAAKA,UAAW,wBAA0BD,KAAKF,MAAM+U,SAAS1V,OAAS,EAAI,eAAiB,KAC1F,0BAAMc,UAAU,QAAQgC,QAASjC,KAAK8U,mBAAmB9Q,KAAKhE,OAC5D,uBAAGC,UAAU,kBACb,0BAAMA,UAAU,gBAAgBD,KAAKF,MAAM+U,SAAS1V,UAIxD,yBAAKc,UAAU,cAAcgC,QAASjC,KAAK+U,UAAU/Q,KAAKhE,MAAO+Q,MAAM,kDAAiD,0BAAM9Q,UAAU,SAAQ,uBAAGA,UAAU,sBAM7JD,KAAKF,MAAMC,MACX,yBAAKE,UAAU,oBACb,yBAAKA,UAAU,kBACb,yBAAKA,UAAU,2BAA2B6F,IAAK9F,KAAK+T,eAChD/T,KAAKF,MAAM+U,SAASnT,KAAI,SAACoM,EAAS5O,GAAV,OAAgB,kBAAC,EAAD,eAAS0C,MAAO1C,GAAO4O,EAAvB,CAAgCN,oBAAoB,SAEhG,kBAAC,EAAD,CAAcH,kBAAmBrN,KAAKF,MAAMC,KAAKK,aAAc2N,cAAe/N,KAAK+N,cAAc/J,KAAKhE,WAM9G,yBAAKC,UAAU,8B,GApIKO,aAsJhC,SAASwU,GAASf,GACd,GAAIA,EAAKgB,gBACL,OAAOhB,EAAKiB,WAEd,KAAOjB,IAASA,EAAKkB,aACjBlB,EAAOA,EAAKmB,WAEhB,OAAKnB,EAGEA,EAAKkB,YAFD,K,IAoCXE,G,kDACJ,WAAYvV,GAAQ,uCACZA,G,qDAKN,IAAIwV,EAAKtV,KAAKF,MAAMoK,YAKpB,YAJUrL,IAAPyW,IACDA,EAAK,uBAIL,yBAAKrV,UAAW,eAA6C,IAA5BD,KAAKF,MAAMyV,MAAMpW,OAAe,UAAW,KAC1E,0BAAMc,UAAU,SAASD,KAAKF,MAAMyV,OADtC,KACqD,8BAAOD,Q,GAdzC9U,a,IAiCnBgV,G,kDAIJ,WAAY1V,GAAQ,IAAD,8BACjB,cAAMA,IAHR2V,YAAa,EAIX,EAAK9S,MAAQ,CACX6F,SAAS,EACT0H,UAAU,EACVwF,iBAAkB,KAClBC,qBAAsB,MANP,E,6DAYD,IAAD,OACf,IAAG3V,KAAK2C,MAAMuN,SAAd,CAEA,IAAI0F,EAAS5V,KAAKF,MAAM8V,OA6BxB5V,KAAKqD,SAAS,CACZ6M,UAAU,IACT,WACD,IAAIwF,EAAkBC,EA7BNlB,EA8BZT,EAAI,EA9BQS,EAgCP,SAAS1D,EAAO8E,EAASC,GAChC,GAAI9B,EAAEyB,WAAN,CAGA,IAAIM,EAAiBH,EAClBC,GACE9E,EAAMiF,gBAAkBJ,EAAOI,gBAChCD,EAAiBhF,GAEnB2E,EAAmBG,EAAU,MAC7BF,EAAuBG,IAEvBH,EAAuB,KACvBD,EAAmB,MAGrB1B,EAAE3Q,SAAS,CACT0S,eAAgBA,EAChBL,iBAAkBA,EAClBC,qBAAsBA,EACtBzF,UAAU,MApCdxP,IAAEuV,KAAK,CACLC,IAAK,qCACLC,KAAM,CAAEtK,OAAQ,QAAS7E,KAAM,SAAUoP,SAAUR,EAAQS,OAAQ,QACnEC,SAAU,QACVC,QAAS,SAASJ,IAjBpB,SAAmBA,EAAM1B,GAIvB,IAISA,EAHK0B,EAAKK,MAAMC,OAAO,GAAG1F,MACToF,EAAKK,MAAMC,OAAO,GAAGZ,QAJlCa,QAAQ,kBAAmB,IAK3B,iCAAmCP,EAAKK,MAAMC,OAAO,GAAG1F,MAAM2F,QAAQ,KAAM,MAEvF,MAAMC,GACNlC,KAQAmC,CAAUT,EAAM1B,Y,0CAyCtBzU,KAAKyV,YAAa,I,6CAIlBzV,KAAKyV,YAAa,I,yCAIlBzV,KAAKqD,SAAS,CACZmF,SAAUxI,KAAK2C,MAAM6F,Y,yCAKNjF,EAAWC,GACzBD,EAAUqS,SAAW5V,KAAKF,MAAM8V,QACjC5V,KAAK6W,mB,+BAMP,IAAI7W,KAAK2C,MAAMuN,UAAYlQ,KAAK2C,MAAMoT,gBAAkB/V,KAAK2C,MAAMoT,iBAAmB/V,KAAKF,MAAM8V,OAC/F,IAAI7E,EAAQ,0BAAM9Q,UAAU,aAAhB,IAA8BD,KAAK2C,MAAMoT,eAAzC,WAEZhF,EAAQ,GAGV,IAAI+F,EAAU9W,KAAK2C,MAAM+S,iBAAmB1V,KAAK2C,MAAM+S,iBAAmB,uBAS1E,OARI1V,KAAKF,MAAM8V,SACbkB,EAAU,wEAET9W,KAAK2C,MAAMuN,WACZ4G,EAAU,8BAAM,uBAAG7W,UAAU,sBAAnB,uBAKV,yBAAKA,UAAU,eACb,yBAAKqB,GAAG,8BAA8BrB,UAAWD,KAAK2C,MAAM6F,QAAU,OAAS,UAC7E,uBAAGvI,UAAU,UAAUD,KAAKF,MAAM8V,QAAU,oBAC5C,uBAAG3V,UAAU,WAAY8Q,EAAS+F,GAClC,0BAAM7W,UAAU,cACZD,KAAK2C,MAAMuN,WAAalQ,KAAKF,MAAM8V,SAAW,0BAAM3V,UAAU,OAAOE,MAAO,CAAC,MAAS,qBAAxC,MAC9CH,KAAK2C,MAAMuN,UAAYlQ,KAAKF,MAAM8V,QAAU,0BAAM3V,UAAU,QAAhB,0BAC9C,0BAAMA,UAAU,UACXD,KAAK2C,MAAMuN,UAAYlQ,KAAKF,MAAM8V,QAAU,uBAAGtU,GAAG,eAAeyV,KAAM/W,KAAK2C,MAAMgT,qBAAsB/R,OAAO,UAAnE,aAAsF,uBAAG3D,UAAU,kCAIxJ,4BAAQqB,GAAG,sBAAsBrB,UAAWD,KAAK2C,MAAM6F,QAAU,KAAO,OAAQvG,QAASjC,KAAKgX,iBAAiBhT,KAAKhE,OAApH,a,GAtIuBQ,aA6IzByW,G,kDACJ,WAAYnX,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CAYXuU,0BAA2B,KAM3BrF,UAAa,GACbsF,YAAa,GAEbC,sBAAuB,GAEvBC,kBAAmB,CAAC,SAAY,IAIhCxK,YAAa,GACbyK,YAAa,GACbzC,SAAa,GAMb/I,WAAY,EAAKyL,wBAAwB,IAGzCC,iBAAkB,EAAKC,2BAEvBC,wBAAyB,KAEzB7S,UAAW,GACX8S,iBAAkB,GAClBC,gBAAiB,IAAI/P,IAErB/C,YAAa,GACb+S,gBAAiB,KAEjBC,gBAAiB,KAGjBC,aAAa,EACbC,cAAc,EAEd7N,gBAAiB,GAEjB8N,qBAAsB,KAEtB3I,YAAa,EACbV,qBAAsB,EAEtBP,aAAa,EACbC,eAAe,EAEf4J,kBAAmB,KACnBC,gBAAiB,KAEjB7V,QAAS,CACP4N,UAAU,EACV3B,QAAQ,EACR6J,WAAW,GAEbhI,oBAAoB,EAEpB2B,WAAY,KAEZtB,YAAa,GAEb4H,qBAAqB,GAjFN,E,4DA4FHvX,EAAG6L,GACjB,KAAG3M,KAAK2C,MAAM6U,iBAAiB9K,eAAiB,GAAhD,CAGA,IAAI4L,EAAM3Y,OAAO4Y,cAAgB5Y,OAAO4Y,eAExC,GAAID,GAAOA,EAAIE,WAAa,EAAG,CAC7B,IAAIC,EA7SV,SAA+BC,GAC3B,IAAIzE,EAAOyE,EAAMC,eACbC,EAAUF,EAAMG,aAGpB,GAAI5E,GAAQ2E,EACR,MAAO,CAAC3E,EAAKmB,YAKjB,IADA,IAAI0D,EAAa,GACV7E,GAAQA,GAAQ2E,GACnBE,EAAW1P,KAAM6K,EAAOe,GAASf,IAKrC,IADAA,EAAOyE,EAAMC,eACN1E,GAAQA,GAAQyE,EAAMK,yBACzBD,EAAWE,QAAQ/E,GACnBA,EAAOA,EAAKmB,WAGhB,OAAO0D,EAuRIG,CAAsBX,EAAIY,WAAW,IAC9CvM,EAAMwM,YAAY,eAClBzY,IAAE+X,GAAGW,KAAK,eAAeC,SAAS,mB,oCAMxBvY,EAAG6L,GACf,KAAG7L,EAAE8C,OAAO0V,UAAUC,SAAS,eAAiBzY,EAAE8C,OAAO0V,UAAUC,SAAS,kBAAoBzY,EAAE8C,OAAO0V,UAAUC,SAAS,iBAE5H5M,EAAMwM,YAAY,iBACfnZ,KAAK2C,MAAM6U,iBAAiB9K,eAAiB,KAI5C5L,EAAE8C,OAAO0V,UAAUC,SAAS,eAAe,CAC7C,IAAIC,EAAgBxZ,KAAK2C,MAAM6U,iBAAiBgC,cAChDxZ,KAAKwL,iBAAiBgO,EAAexZ,KAAK2C,MAAMkP,UAAU2H,GAAera,OAAS,EAAG,S,wCAWtE,IAAD,OAEZwN,EAAQjM,IAAE,eAMd5B,SAAS2a,oBAAoB,kBAAmBzZ,KAAK2C,MAAMuV,mBAC3DvY,OAAO8Z,oBAAoB,UAAWzZ,KAAK2C,MAAMwV,iBAEjDnY,KAAKqD,SAAS,CACZ6U,kBARsB,SAACpX,GAAD,OAAO,EAAK4Y,gBAAgB5Y,EAAG6L,IASrDwL,gBARoB,SAACrX,GAAD,OAAO,EAAK6Y,cAAc7Y,EAAG6L,MAShD,WAED7N,SAAS8a,iBAAiB,kBAAmB,EAAKjX,MAAMuV,mBACxDvY,OAAOia,iBAAiB,UAAW,EAAKjX,MAAMwV,sB,qCAMlC,IAAD,OAEbrZ,SAAS8a,iBAAiB,WAAW,SAAC9Y,GACpC,OAAOA,EAAEe,KACP,IAAK,QAAmB,EAAKc,MAAMqV,cAAc,EAAK3U,SAAS,CAAE2U,cAAc,IAAS,MACxF,IAAK,UAAmB,EAAKrV,MAAMoV,aAAa,EAAK1U,SAAS,CAAE0U,aAAa,IAAS,MAGtF,IAAK,YAAejX,EAAE6E,iBAAkB,EAAKkU,0BAA0B,QAAS,MAChF,IAAK,UAAe/Y,EAAE6E,iBAAkB,EAAKmU,wBAAwB,MAAO,MAC5E,IAAK,aAAehZ,EAAE6E,iBAAkB,EAAKkU,0BAA0B,SAAU,MACjF,IAAK,YAAe/Y,EAAE6E,iBAAkB,EAAKmU,wBAAwB,YAIzEhb,SAAS8a,iBAAiB,SAAS,SAAC9Y,GAClC,OAAOA,EAAEe,KACP,IAAK,QAAc,EAAKc,MAAMqV,cAAc,EAAK3U,SAAS,CAAE2U,cAAc,IAAU,MACpF,IAAK,UAAc,EAAKrV,MAAMoV,aAAa,EAAK1U,SAAS,CAAE0U,aAAa,U,sCAY5E,IAAIgC,EAAiB/Z,KAAK2C,MAAMmC,YAAYO,KAAK,IAE7C6E,EAAclK,KAAK2C,MAAMgV,iBAAiBoC,QAC3Blb,IAAhBqL,GAA2BlK,KAAK+E,SAASmF,GAG5CvK,OAAO8D,aAAazD,KAAK2C,MAAMmV,iBAC/B9X,KAAKqD,SAAS,CACZyU,gBAAiB,KACjBhT,YAAa,O,kCAOLhE,EAAG+D,GAAY,IAAD,OACxB,KAAG/D,EAAE4E,QAAU,IAAM5E,EAAE4E,QAAU,IAAjC,CACA,IAAI7D,EAAMf,EAAE4E,QAAU,GAGtB,IAAGhF,IAAE,eAAesZ,GAAG,YACpBtZ,IAAE,YAAYsZ,GAAG,UAApB,CAGA,IAAIlV,EAAcsC,MAAM6S,UAAUrV,OAAO5E,KAAK2C,MAAMmC,YAAajD,GACjE7B,KAAKqD,SAAS,CACZyB,YAAaA,IACZ,WAQD,GALAnF,OAAO8D,aAAa,EAAKd,MAAMmV,iBAK5B,EAAKnV,MAAMiV,gBAAgBnT,IAAIK,EAAYO,KAAK,KACjD,EAAK6U,oBACA,CACL,IAAIpC,EAAkBnY,OAAOmE,YAAW,kBAAM,EAAKoW,kBAAiB,KACpE,EAAK7W,SAAS,CACZyU,gBAAiBA,Y,4CAUF,IAAD,OAEpBxO,QAAQC,IAAI,iCAEZD,QAAQC,IAAIvJ,KAAK2C,MAAMgV,kBAGvB7Y,SAAS2a,oBAAoB,UAAWzZ,KAAK2C,MAAMkV,iBACnD,IAAIA,EAAkB,SAAC/W,GAAD,OAAO,EAAKqZ,YAAYrZ,EAAG,EAAK6B,MAAMkC,YAE5D/F,SAAS8a,iBAAiB,UAAW/B,GAGrC7X,KAAKqD,SAAS,CACZwU,gBAAiBA,M,oCAMPjQ,EAAc6M,GAAO,IAAD,OAEhCnL,QAAQC,IAAI,4BAsCZ,IAAI0D,EA1BJ,SAASmN,EAAcC,EAAOzY,EAAOiD,EAAWyV,EAAS1C,EAAiB2C,GAIxE,GAHIA,IACF1V,EAAUwV,EAAM3V,WAAa4V,GAE5BD,EAAMnW,SACP,IAAI,IAAIhF,EAAI,EAAGA,EAAIsb,KAAKC,IAAI,EAAGJ,EAAMnW,SAAS/E,QAASD,IACrDkb,EAAcC,EAAMnW,SAAShF,GAAIA,EAAI,EAAG2F,EAAWuC,MAAM6S,UAAUrV,OAAO0V,EAASpb,EAAI,GAAI0Y,QAG7FA,EAAgB1P,IAAIoS,EAAQjV,KAAK,KAEnC,MAAO,CAACR,UAAWA,EAAW+S,gBAAiBA,GAezCwC,CAAc,CAAClW,SAAU0D,GAAe,EAAG,GAAI,GAAI,IAAIC,KAAO,GAClEhD,EAAYoI,EAAEpI,UACd+S,EAAkB3K,EAAE2K,gBACpBD,EAbJ,SAA+B9S,GAC7B,IAAI8S,EAAmB,GACvB,IAAI,IAAI9V,KAAOgD,EAAU,CAEvB8S,EADU9S,EAAUhD,GAAKwD,KAAK,KACNxD,EAE1B,OAAO8V,EAOc+C,CAAsB7V,GAG7C7E,KAAKqD,SAAS,CACZwB,UAAWA,EACX8S,iBAAkBA,EAClBC,gBAAiBA,IAChB,WAAQ,EAAK+C,sBAA0BlG,GAAMA,S,2CAO7B5C,GAEnB,OADkB,IAAIzK,MAAMyK,EAAU1S,U,0CAMpBkY,GAClB,IAAIlN,EAAkB,GACtB,IAAI,IAAIyQ,KAAUvD,EAAmB,CACnC,IAAInN,EAAcmN,EAAkBuD,GACpCzQ,EAAgBD,EAAYvL,MAAQuL,EAAY/F,QAAU,EAE5D,OAAOgG,I,qCAUPzJ,IAAE,eAAema,MAAK,SAAC3b,EAAGuQ,GACxB,IAAIqL,EAAQrL,EAAIsL,YACZC,EAAmC,GAAxBR,KAAKS,KAAKH,EAAQ,IACjCpa,IAAE+O,GAAKyL,IAAI,YAAaF,EAAW,W,+CAOrCta,IAAE,+BAA+Bma,MAAK,SAAC3b,EAAGuQ,GACvC/O,IAAE+O,GAAKyL,IAAI,YAAa,a,qCAW3B,IAAGlb,KAAK2C,MAAML,QAAQ4N,SAAtB,CACA,IAAIiL,EAAiBnb,KAAK2C,MAAM2M,WAAa,EAE1C6L,IAAoBnb,KAAK2C,MAAMiM,qBAA0B5O,KAAK2C,MAAMoP,WAGrE/R,KAAKob,UAAS,EAAOD,GAFrBnb,KAAKob,UAAS,M,+BAMT9L,GACJtP,KAAK2C,MAAML,QAAQ4N,WAEtB5G,QAAQC,IAAI+F,GACTtP,KAAK2C,MAAMoP,WACZ/R,KAAKob,UAAS,EAAO9L,GAIpBA,IAAetP,KAAK2C,MAAMiM,oBAC3B5O,KAAKob,UAAS,GAEdpb,KAAKob,UAAS,EAAO9L,M,yCAMvBtP,KAAKob,UAAS,EAAOpb,KAAK2C,MAAM2M,WAAa,K,sCAI/ByC,GAAa,IAAD,OAC1B/R,KAAKqD,SAAS,CACZ0O,WAAYA,IACX,WACEA,EACD,EAAKqJ,UAAS,EAAO,GAErB,EAAKA,UAAS,Q,qCAMLta,GAAI,IAAD,OAEZ2P,EAAc3P,EAAE8C,OAAOC,MACvByL,EAAatP,KAAK2C,MAAM2M,WACxB+L,EAAkBrb,KAAK2C,MAAM8N,YAG7B6K,EAAgBd,KAAKC,IAAIza,KAAK2C,MAAMiM,oBAAsB,EAAG4L,KAAKe,MAAMjM,EAAamB,EAAc4K,IACpGC,IAAkBtb,KAAK2C,MAAMiM,oBAAsB,IACpD0M,EAAgB,MAGlBtb,KAAKqD,SAAS,CACZoN,YAAaA,IACZ,WAED,EAAK2K,UAAS,EAAOE,Q,+BAShBlD,EAAW9I,GAElB,IAAIkM,EACAzJ,EAAa/R,KAAK2C,MAAMoP,WAK1ByJ,EAFClM,EAEO,+BAAiCA,EAAa,YAActP,KAAK2C,MAAM8N,YAEvE,8CAAgDzQ,KAAK2C,MAAM8N,YAElEsB,IACDyJ,GAAS,eAAiBzJ,GAK5B/R,KAAKqD,SAAS,CACZf,QAAS,CACP4N,UAAU,EACV3B,QAAQ,EACR6J,UAAWA,IAEZ,WAAY,IAAD,OACZqD,MAAM,sCAAwCzb,KAAKF,MAAMsC,WAAa,YAAcoZ,EAAOtI,IACxFmB,MAAK,SAACqH,GACH,GAAuB,MAApBA,EAASC,OAAgB,CAC1B,IAAI3H,EAAI0H,EAAS/Q,OAEjB,MADArB,QAAQC,IAAIyK,GACN,IAAI4H,MAAMF,EAASC,QAE3B,OAAOD,EAAS/Q,UAEnB0J,MAAK,SAAC8B,GAEL,IACE,IAAIlJ,EAAI4O,KAAKC,MAAM3F,GACnB,MAAMQ,GAEN,YADAoF,MAAMpF,GAKR,GAAG1J,EAAE+O,iBAkBH,OAhBA,EAAK3Y,SAAS,CACZgV,qBAAqB,EAErB/I,WAAYrC,EAAEqC,WACdT,WAAY5B,EAAE4B,WACdD,oBAAqB3B,EAAE2B,oBAAsB,EAE7CP,aAAa,EACbC,eAAe,EAEfhM,QAAS,CACP4N,UAAU,EACV3B,QAAQ,UAGZjF,QAAQC,IAAI0D,GAKd,EAAK5J,SACH,CAEE8S,KAAMlJ,EAEN4E,UAAa5E,EAAE4E,UACfsF,YAAalK,EAAEkK,YAEfC,sBAAuBnK,EAAEmK,sBAAwBnK,EAAEmK,sBAAwB,KAE3EE,YAAa,EAAK2E,qBAAqBhP,EAAE4E,WACzChF,YAAa+E,GAAqB3E,EAAE4E,UAAW5E,EAAE6E,sBAEjD+C,SAAa5H,EAAE4H,SAEfwC,kBAAmBpK,EAAEoK,kBAErBlN,gBAAiB,EAAK+R,oBAAoBjP,EAAEoK,kBAAkBnT,UAE9D4H,WAAY,EAAKyL,wBAAwBtK,EAAE4E,UAAU1S,QACrDuY,wBAAyB,KAEzBpI,WAAYrC,EAAEqC,WACdT,WAAY5B,EAAE4B,WACdD,oBAAqB3B,EAAE2B,oBAEvBqJ,qBAAsBhL,EAAE+C,aACxBkH,0BAA2BjK,EAAEiK,0BAE7B7I,aAAa,EACbC,eAAe,EACfhM,QAAS,CACP4N,UAAU,EACV3B,QAAQ,GAEV8J,qBAAqB,IACpB,WAEEpL,EAAEkP,cAAgBlP,EAAEmP,eACrB,EAAKtc,MAAMuc,WAAWpP,EAAEkP,aAAclP,EAAEmP,eAIvChE,IACD,EAAKkE,eACL,EAAK/T,cAAc,EAAK5F,MAAM0U,kBAAkBnT,WAGlD,EAAKqY,kBACL,EAAKC,yBACL,EAAKC,eACL,EAAKC,kBAGL/c,OAAOC,SAAS,EAAG,SAEtB+c,OAAM,SAAChG,GACRrN,QAAQC,IAAIoN,EAAInC,SAEhB,EAAK1U,MAAM8c,aAAa/V,SAAS8P,EAAInC,cAKzCxQ,KAAKhE,S,0CAKP,IAAI6M,EAAc7M,KAAK2C,MAAMkK,YACzBgQ,EAAkB,GACtB,IAAI,IAAI1K,KAAWtF,EAAa,CAE9B,IAAIiQ,EAAY,GAChB,IAAI,IAAIzK,KAAaxF,EAAYsF,GAAU,CACzC,IAAI4K,EAAMlQ,EAAYsF,GAASE,GAC5B0K,EAAI/R,cACL8R,EAAU1T,KAAK,CAAC2T,EAAI7R,OAAS,IAAK6R,EAAI/R,gBAEtC8R,EAAU1T,KAAK,CAAC,KAGpByT,EAAgBzT,KAAK0T,GAEvB,OAAOD,I,0CAOY,IAAD,OAClB,IAAG7c,KAAK2C,MAAM2L,cAAd,CAMA,IAAM0O,EAAYte,EAAU,cAExBme,EAAkB7c,KAAKid,oBAErBC,EAAkB,CACtB/J,OAAQ,OACRC,QAAS,CACP,OAAU,mBACV,eAAgB,mBAChB,aAAc4J,GAEhB1G,SAAU,OACVrK,KAAM4P,KAAKsB,UAAU,CACnBhG,YAAanX,KAAK2C,MAAMwU,YACxBC,sBAAuBpX,KAAK2C,MAAMyU,sBAClChM,OAAQyR,KAIZ7c,KAAKqD,SAAS,CACZf,QAAS,CACP4N,UAAU,EACV3B,QAAQ,KAET,WAEDkN,MAAM,sCAAwC,EAAK3b,MAAMsC,WAAa,6BAA8B8a,GACnG7I,MAAK,SAACqH,GACL,GAAuB,MAApBA,EAASC,OACV,MAAM,IAAIC,MAAMF,EAASC,QAE3B,OAAOD,EAAS/Q,UAEjB0J,MAAK,SAAC8B,GACL,IACE,IAEIiB,EAFIyE,KAAKC,MAAM3F,GAEWiB,sBAM9B,GAJA9N,QAAQC,IAAI,4BAIT,EAAK5G,MAAM2M,aAAe,EAAK3M,MAAMiM,qBAAwB,EAAKjM,MAAMoP,WAWrEqL,EAAyB,EAAKza,MAAMiM,wBAX6C,CACrF,IAAIwO,EAAyB,EAAKza,MAAMiM,oBAAsB,EAC9D,EAAKvL,SAAS,CACZ+M,oBAAoB,IACnB,WACDzQ,OAAOmE,YAAW,kBAAM,EAAKT,SAAS,CACpC+M,oBAAoB,MAClB,QAOR,EAAK/M,SAAS,CACX4U,qBAAsBoF,KAAK3T,MAE3BkF,oBAAqBwO,EAErBhG,sBAAuBA,EAEvB/I,aAAa,EACbC,eAAe,EACfhM,QAAS,CACR4N,UAAU,EACV3B,QAAQ,KAGZ,MAAMoI,GACNrN,QAAQC,IAAI,SAAUoN,GACtBoF,MAAM5F,OAGPwG,OAAM,SAAChG,GACRrN,QAAQC,IAAIoN,EAAInC,SAChB,EAAK1U,MAAM8c,aAAa/V,SAAS8P,EAAInC,mB,2CA4BzCxU,KAAKob,UAAS,K,iDAQd,MAAO,CACL1O,gBAAiB,EACjBD,cAAe,EACf+M,eAAgB,K,8CAMI8D,GACtBhU,QAAQC,IAAI,SAAU+T,GAUtB,IARA,IAII5F,EAJA5L,EAAa9L,KAAK2C,MAAMmJ,WAExByR,EAAgBvd,KAAKuX,0BAMjBrY,EAAI,EAAGA,EAAI4M,EAAW3M,OAAQD,IACpC,IAAI,IAAIse,EAAI,EAAGA,EAAI1R,EAAW5M,GAAGC,OAAQqe,IAAK,CAE5B1R,EAAW5M,GAAGse,GAG9B,GAAiB,OAAdF,EAAoB,CACrB,IAAIG,GAAK,EACA,IAANve,IAASue,EAAI,QAEX,GAAkB,SAAdH,EAAsB,CAE3BG,EAAI,EACLve,IAAM4M,EAAW3M,OAAS,IAAGse,EAAI,GAEtCF,EAAcre,EAAIue,GAAK,CAAC,CACtB/Q,eAAgB,EAChBD,aAAc,IAEhBiL,EAA0B1X,KAAK2C,MAAMkP,UAAU3S,EAAIue,GAAGna,MAAM,EAAG,GAAG+B,KAAK,KAG3ErF,KAAKqD,SAAS,CACZyI,WAAYyR,EACZ7F,wBAAyBA,M,gDAMH4F,GACxBhU,QAAQC,IAAI,SAAU+T,GAMtB,IAJA,IACI5F,EADA5L,EAAa9L,KAAK2C,MAAMmJ,WAIpB5M,EAAI,EAAGA,EAAI4M,EAAW3M,OAAQD,IACpC,IAAI,IAAIse,EAAI,EAAGA,EAAI1R,EAAW5M,GAAGC,OAAQqe,IAAK,CAC5C,IAAIhR,EAAYV,EAAW5M,GAAGse,GAGb,SAAdF,EACGtd,KAAK2C,MAAMqV,aAIVxL,EAAUC,aAAeD,EAAUE,eACpCF,EAAUC,eAEVD,EAAUE,eAAiB8N,KAAKkD,IAAIlR,EAAUE,eAAiB,EAAG,IANpEF,EAAUE,eAAiB8N,KAAKkD,IAAIlR,EAAUE,eAAiB,EAAG,GAClEF,EAAUC,aAAeD,EAAUE,gBAQd,UAAd4Q,IACLtd,KAAK2C,MAAMqV,eACbxL,EAAUE,eAAiB8N,KAAKC,IAAIza,KAAK2C,MAAMkP,UAAU3S,GAAGC,OAAS,EAAGqN,EAAUC,aAAe,IAEnGD,EAAUC,aAAiB+N,KAAKC,IAAIza,KAAK2C,MAAMkP,UAAU3S,GAAGC,OAAS,EAAGqN,EAAUC,aAAe,IAGnGiL,EAA0B1X,KAAK2C,MAAMkP,UAAU3S,GAAGoE,MAAMkJ,EAAUE,eAAgBF,EAAUC,aAAe,GAAGpH,KAAK,KAGvHrF,KAAKqD,SAAS,CACZyI,WAAYA,EACZ4L,wBAAyBA,M,8CAKLiG,GACtB,IAAIA,EACEA,EAAU3d,KAAK2C,MAAMkP,UAAU1S,OAGrC,IADA,IAAI2M,EAAa,IAAI1E,MAAMuW,GACnBze,EAAI,EAAGA,EAAI4M,EAAW3M,OAAQD,IACpC4M,EAAW5M,GAAK,IAAIkI,MAEtB,OAAO0E,I,wCAMP,IAAIA,EAAa9L,KAAK2C,MAAMmJ,WACH,IAAtBA,EAAW3M,SACd2M,EAAW,GAAG1C,KAAK,CACjBsD,eAAgB,EAChBD,aAAc,IAEhBzM,KAAKqD,SAAS,CACZyI,WAAYA,EACZ4L,wBAAyB1X,KAAK2C,MAAMkP,UAAU1S,OAAS,EAAIa,KAAK2C,MAAMkP,UAAU,GAAG,GAAK,Q,wCAM1F7R,KAAKqD,SAAU,CACbmU,iBAAkBxX,KAAKyX,2BACvB3L,WAAY9L,KAAKuX,8B,uCASJiC,EAAe5N,EAAWC,GACzC,IAAIa,EAAgBD,EAEhBX,EAAa9L,KAAK2C,MAAMmJ,WACxB0L,EAAmBxX,KAAK2C,MAAM6U,iBAElC,GAAe,SAAX3L,EAEE7L,KAAK2C,MAAMoV,cACbjM,EAAa9L,KAAKuX,2BAGpB9K,GAAgB,EAGhB+K,EAAmB,CACjBgC,cAAeA,EACf9M,eANFA,EAAiBd,QASZ,GAAc,OAAXC,EAAiB,CAGzB,IAAwC,IAArC2L,EAAiB9K,eAElB,YADA1M,KAAK4d,kBAcP,GAVAlR,EAAiB8K,EAAiB9K,eAG/B8K,EAAiBgC,gBAAkBA,IACpC9M,EAAiB,GAGnBD,EAAeb,EAGZA,EAAYc,EAAgB,CAC7B,IAAImR,EAAInR,EACRA,EAAiBd,EACjBa,EAAeoR,EAIjBrG,EAAmBxX,KAAKyX,2BACxB3L,EAAW0N,GAAepQ,KAAK,CAC7BsD,eAAgBA,EAChBD,aAAcA,IAEhB,IAAIiL,EAA0B1X,KAAK2C,MAAMkP,UAAU2H,GAAelW,MAAMoJ,EAAgBD,EAAe,GAAGpH,KAAK,KAzyC/G1F,OAAO4Y,aACL5Y,OAAO4Y,eAAeuF,MACxBne,OAAO4Y,eAAeuF,QACbne,OAAO4Y,eAAewF,iBAC/Bpe,OAAO4Y,eAAewF,kBAEfjf,SAAS0N,WAClB1N,SAAS0N,UAAUsR,QAuyCnB9d,KAAKqD,SAAS,CACZmU,iBAAkBA,EAClB1L,WAAYA,EACZ4L,wBAAyBA,GAAoD1X,KAAK2C,MAAM+U,4B,+BAYnFxN,GAAc,IAAD,OAEhB4B,EAAa9L,KAAK2C,MAAMmJ,WACxB+F,EAAY7R,KAAK2C,MAAMkP,UACvBhF,EAAc7M,KAAK2C,MAAMkK,YAE7B,IAAI,IAAIsF,KAAWrG,EACjB,IAAI,IAAIkS,KAAWlS,EAAWqG,GAAU,CAYtC,IAXA,IAAImG,EAAMxM,EAAWqG,GAAS6L,GAC1BtL,EAAQ4F,EAAI5L,eACZiG,EAAM2F,EAAI7L,aAMVwR,EAAsBpR,EAAYsF,GAASO,GAAOrB,aAClD6M,EAAsBrR,EAAYsF,GAASO,GAAOpB,WAClD6M,GAAc,EACVrL,EAAIJ,EAAQ,EAAGI,GAAKH,EAAKG,IAAK,CACpC,IAAIrB,EAAkB5E,EAAYsF,GAASW,GAC3C,GAAGmL,IAAwBxM,EAAgBJ,cAAgB6M,IAAsBzM,EAAgBH,WAAY,CAC3G6M,GAAc,EACd,OAQJ,GAAGA,EAAa,CACd,IAAQrL,EAAIJ,EAAOI,GAAKH,EAAKG,IAAK,EAC5BsL,EAAavR,EAAYsF,GAASW,IAC3BuL,kBAKb,IAAI,IAAIZ,KAAK5Q,EAAYsF,GAAU,EAC7BiM,EAAavR,EAAYsF,GAASsL,IAMxBnM,YAAcoB,GAAS0L,EAAW/M,cAAgBqB,GAC9D0L,EAAWE,cAAc5L,EAAQ,GAMhC0L,EAAW/M,cAAgBsB,IAC5ByL,EAAWG,gBAAgB5L,EAAM,GAC9ByL,EAAWjN,aAAgBwB,EAAM,GAClCyL,EAAWI,aAAa,OAUhC,IAAI,IAAIC,KAAW5R,EAAYsF,GAAS7O,MAAM,EAAGoP,GAAQ,EACnD0L,EAAavR,EAAYsF,GAASsM,IACxBpN,aAAeqB,GAAS0L,EAAW9M,YAAcqB,GAC7DyL,EAAWE,cAAc5L,EAAQ,GAMrC,IAAI,IAAI+L,KAAW5R,EAAYsF,GAAS7O,MAAMqP,EAAM,EAAG9F,EAAYsF,GAAShT,QAAS,CACnF,IAAIif,KAAavR,EAAYsF,GAAStL,SAAS4X,GAAW9L,EAAM,IAClDtB,cAAgBqB,GAAS0L,EAAW9M,YAAcqB,IAC9DyL,EAAWG,gBAAgB5L,EAAM,GAClB,MAAZ8L,GACDL,EAAWI,aAAa,MAO9B,IAAIE,GAAmB,EACvB,IAAQ5L,EAAIJ,EAAOI,GAAKH,EAAKG,IAAK,CAChC,IAAI5H,EAAS4H,IAAMJ,EAAQ,IAAM,IAC7BtB,EAAWS,EAAUM,GAAS7O,MAAMoP,EAAOC,EAAM,GAAGtN,KAAK,KAK7DqZ,EAAmB7R,EAAYsF,GAASW,GAAGC,SAAS7H,EAAQhB,EAAakH,EAAUsB,EAAOC,GAIzF+L,GAAkB1e,KAAK2e,aAAa,gBAAiB9X,SAASsL,GAAUO,EAAOC,EAAKzI,GAG3FlK,KAAKqD,SAAS,CACZwJ,YAAaA,IACZ,WACD,EAAK4P,oB,gCAWCjD,EAAe5N,EAAW1B,GAElC,IAAI2C,EAAc7M,KAAK2C,MAAMkK,YACzBuR,EAAavR,EAAY2M,GAAe5N,GAGxCgT,EAAYR,EAAW/M,aACvBwN,EAAUT,EAAW9M,WAMzB,IAAI,IAAImN,KAJRze,KAAK2e,aAAa,gBAAiBnF,EAAeoF,EAAWC,EAAS3U,GAInD2C,EAAY2M,GAAgB,CAC7C,IAAI/H,EAAkB5E,EAAY2M,GAAeiF,GAC9ChN,EAAgBJ,eAAiBuN,GAAanN,EAAgBH,aAAeuN,GAC9EpN,EAAgBqN,YAAY5U,GAIhClK,KAAKqD,SAAS,CACZwJ,YAAaA,M,uCASA2M,EAAe9F,GAC9B,IAAI4D,EAActX,KAAK2C,MAAM2U,YAC1BA,EAAYkC,KAAmB9F,EAChC4D,EAAYkC,QAAiB3a,EAE7ByY,EAAYkC,GAAiB9F,EAE/B1T,KAAKqD,SAAS,CACZiU,YAAaA,M,oCAOH9C,EAASuK,EAAetK,GAAO,IAAD,OAC1CnL,QAAQC,IAAI,WAAYiL,EAAS,iBAAkBuK,GAEnD,IAEM7B,EAAkB,CACtB/J,OAAQ,OACRC,QAAS,CACP,OAAU,mBACV,eAAgB,mBAChB,aAPc1U,EAAU,eAS1B4X,SAAU,OACVrK,KAAM4P,KAAKsB,UAAU,CACnBxS,KAAM6J,EACNwK,WAAYhf,KAAK2C,MAAMwU,YAAY4H,MAIvCtD,MAAM,sCAAwCzb,KAAKF,MAAMsC,WAAa,mBAAoB8a,GACzF7I,MAAK,SAACqH,GACH,GAAuB,MAApBA,EAASC,OACV,MAAM,IAAIC,MAAMF,EAASC,QAE3B,OAAOD,EAAS/Q,UAEnB0J,MAAK,SAAC8B,GACL7M,QAAQC,IAAI4M,GACZ,IACE,IAAIlJ,EAAI4O,KAAKC,MAAM3F,GAGnB7M,QAAQC,IAAI,wBAEZ,IAAIsL,EAAW,EAAKlS,MAAMkS,SAC1BA,EAASkK,GAAe3V,KAAK6D,EAAEa,SAE/B,EAAKzK,SAAS,CACXwR,SAAUA,GACVJ,GACH,MAAMkC,GACNrN,QAAQC,IAAI,SAAUoN,OAEvBgG,OAAM,SAAChG,GACRrN,QAAQC,IAAIoN,EAAInC,SAEhB,EAAK1U,MAAM8c,aAAa/V,SAAS8P,EAAInC,e,mCAY5ByK,EAAazF,EAAeoF,EAAWC,EAAS3U,GAEzClK,KAAK2C,MAAMkP,UAAU2H,GAAelW,MAAMsb,EAAWC,EAAU,GAAGxZ,KAAK,KAatE,kBAAhB4Z,GAAmD,kBAAhBA,GACpCjf,KAAKqD,SAAS,CACZgL,aAAa,EACbC,eAAe,M,+BASX,IAAD,OACH+J,EAAsBrY,KAAK2C,MAAM0V,oBAIrC,OACI,8BACIrY,KAAK2C,MAAMuc,OACb,yBAAK5d,GAAG,oBAAoBrB,WAAYD,KAAK2C,MAAML,QAAQ4N,SAAW,UAAY,KAAOmI,EAAsB,yBAA2B,KAExI,yBAAK/W,GAAG,qBACJ+W,GAAuB,kBAAC,GAAD,MACzB,yBAAK/W,GAAG,oBAEJtB,KAAK2C,MAAML,QAAQ8V,WACnB,yBAAKnY,UAAU,mBACb,uBAAGA,UAAU,sBADf,cAKF,kBAAC,EAAD,CACEmQ,mBAAsBpQ,KAAK2C,MAAMyN,mBACjCd,WAActP,KAAK2C,MAAM2M,WACzBT,WAAc7O,KAAK2C,MAAMkM,WACzBD,oBAAuB5O,KAAK2C,MAAMiM,oBAClCoB,aAAchQ,KAAK2C,MAAMsV,qBACzB3J,cAAetO,KAAK2C,MAAM2L,cAC1BD,YAAarO,KAAK2C,MAAM0L,YACxB6B,SAAUlQ,KAAK2C,MAAML,QAAQ4N,SAC7B3B,OAAQvO,KAAK2C,MAAML,QAAQiM,OAC3BW,aAAclP,KAAK2C,MAAMoP,WAEzB1B,iBAAiB,EACjBI,YAAazQ,KAAK2C,MAAM8N,YACxBF,mBAAoB,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,IAEtCO,gBAAgB,EAEhB9B,gBAAiBhP,KAAKgP,gBAAgBhL,KAAKhE,MAC3CyO,kBAAmBzO,KAAKyO,kBAAkBzK,KAAKhE,MAC/CmQ,iBAAkBnQ,KAAKmQ,iBAAiBnM,KAAKhE,MAC7CgR,aAAchR,KAAKgR,aAAahN,KAAKhE,MACrC4P,SAAU5P,KAAK4P,SAAS5L,KAAKhE,MAC7BsQ,eAAgBtQ,KAAKsQ,eAAetM,KAAKhE,QAG3C,kBAAC,GAAD,MAEEA,KAAK2C,MAAMkP,UAAUnQ,KAAI,SAACyd,EAAKjgB,GAAN,OACzB,kBAAC,GAAD,CACE2C,IAAK3C,EACL0C,MAAQ1C,EACR0V,aAA8C,IAA7B,EAAKjS,MAAM2M,WAAa,GAAYpQ,EAAI,EACzDyN,MAAOwS,EACPtS,YAAa,EAAKlK,MAAMkK,YAAY3N,GACpC2V,SAAU,EAAKlS,MAAMkS,SAAS3V,GAC9BwU,WAAY,EAAK/Q,MAAM2U,YAAYpY,GACnC4M,WAAY,EAAKnJ,MAAMmJ,WAAW5M,GAClCsM,iBAAkB,EAAKA,iBAAiBxH,KAAK,GAC7CwP,iBAAkB,EAAKA,iBAAiBxP,KAAK,GAC7CmG,gBAAiB,EAAKxH,MAAMwH,gBAC5BI,UAAW,EAAKA,UAAUvG,KAAK,GAC/B+J,cAAe,EAAKA,cAAc/J,KAAK,GACvCjE,KAAM,EAAKD,MAAMC,WAIfC,KAAK2C,MAAML,QAAQ4N,UAA4C,IAAhClQ,KAAK2C,MAAMkP,UAAU1S,SAAiBa,KAAK2C,MAAM0V,qBAAwB,yBAAKpY,UAAU,oCAAf,uBAOlH,yBAAKqB,GAAG,gBAEN,yBAAKrB,UAAU,gBACb,6BACE,yBAAKA,UAAW,gBAAmBD,KAAKF,MAAMqc,aAAuB,GAAR,OAAahc,MAAO,CAAC,QAAW,UAAU,kBAAC,IAAD,CAAMoB,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,cAAepC,KAAKF,MAAMqc,aAAenc,KAAKF,MAAMqc,aAAe,aACrO,yBAAKlc,UAAW,mBAAsBD,KAAKF,MAAMsc,cAAwB,GAAR,OAAajc,MAAO,CAAC,QAAW,UAAjG,cAAsH,0BAAMF,UAAU,gBAAgBD,KAAKF,MAAMsc,cAAgBpc,KAAKF,MAAMsc,cAAgB,eAIhN,kBAAC,GAAD,CAAkBxG,OAAQ5V,KAAK2C,MAAM+U,0BACrC,kBAAC,GAAD,CACEnC,MAAOvV,KAAK2C,MAAMmC,YAClBoF,YAAalK,KAAK2C,MAAMgV,iBAAiB3X,KAAK2C,MAAMmC,YAAYO,KAAK,OAGvE,kBAAC,EAAD,CACEoC,MAAOzH,KAAK2C,MAAM0U,kBAAkBnT,SACpCW,UAAW7E,KAAK2C,MAAMkC,UACtBC,YAAa9E,KAAK2C,MAAMmC,YAAYO,KAAK,IACzCkD,cAAevI,KAAKuI,cAAcvE,KAAKhE,MACvC+E,SAAU/E,KAAK+E,SAASf,KAAKhE,MAC7BwI,SAAU6P,EACVhS,WAAW,W,GA5tCQ7F,aA0uC7B4e,G,kDAEJ,WAAYtf,GAAQ,uCACZA,G,qDAIN,OACE,yBAAKwB,GAAG,4BACN,0BAAMsM,MAAM,yBACV,oDACA,sF,GAXwBpN,aAsBnByW,MCzmDAoI,G,kDApHb,WAAYvf,GAAQ,uCACZA,G,qDAKN,OACC,6BAASG,UAAU,iBAElB,qFAEA,yIAEA,4BACC,4BAAI,sCACH,4BACC,kJAGF,4BAAI,gDACH,4BACC,4BAAI,8CAAJ,8KACA,4BAAI,iDAAJ,0HACA,4BAAI,uCAAJ,qDACA,4BAAI,mDAAJ,kFACA,4BAAI,uCAAJ,+HAGF,4BAAI,iDACH,4BACC,wMACA,kKACA,uHAGF,4BAAI,mDACH,4BACC,gHACA,6GACA,qHACA,yLACA,wFACA,gLACA,sIACA,6JACA,0EACA,8HAGF,4BAAI,4CACH,4BACC,sHACA,+HAGF,4BAAI,2CACH,4BACC,iEACA,sMAGF,4BAAI,+CACH,4BACC,uMAGF,4BAAI,4CACH,4BACC,8QAMN,6EAEA,iGAEA,4BACC,kDACC,4BACC,2GACA,0GACA,mHACA,iFACA,gGAGF,4CACC,4BACC,iEACA,0DAIF,mDACC,4BACC,iFACA,iHACA,sFACA,iHAKH,4CACA,mFAAwD,uBAAG8W,KAAK,8CAA8ChG,MAAM,cAA5D,cAAxD,SAAqJ,uBAAGgG,KAAK,4BAA4BhG,MAAM,YAA1C,oBAArJ,KACA,uGAA4E,uBAAGgG,KAAK,+CAAR,+CAA5E,U,GA7GwBvW,a,kBCHrBwc,GAAYte,EAAU,cACxB4gB,GAAevS,EAAQ,KAGrBwS,GAAc,CAClB,IAAO,CACLpM,OAAQ,MACRC,QAAS,CACP,OAAU,mBACV,eAAgB,oBAElBoM,YAAa,WAEf,KAAQ,CACNrM,OAAQ,OACRC,QAAS,CACP,aAAc4J,GAEd,OAAU,oBAGZ1G,SAAU,OACVrK,KAAM,O,SAOKwT,G,iFAAf,WAAoBC,GAApB,SAAAC,EAAA,+EACS,IAAIC,SAAQ,SAAAC,GACjB/b,WAAW+b,EAASH,OAFxB,4C,oEAUA,WAAsBxJ,EAAK/C,EAAQyJ,GAAnC,+CAAA+C,EAAA,yDAAiDG,EAAjD,+BAA0D,KAAMC,EAAhE,gCAAkFC,EAAlF,+BAAwF,EAAGC,EAA3F,gCAA+GC,EAA/G,+BAAgI,KAE1HC,EAAU,2BAEVC,EAJN,gBAIuBb,GAAYpM,IACnB,SAAXA,EALL,oBAMQ2M,EANR,uBAMwB,IAAIlE,MAAM,iCANlC,QAOOmE,GACDK,EAAUnU,KAAO6T,SACVM,EAAUhN,UAGjBgN,EAAUnU,KAAO4P,KAAKsB,UAAU2C,GAChCM,EAAUhN,QAAQ,gBAAkB,oBAb1C,yBAiBuBqI,MAAM0E,EAAUjK,EAAKkK,GAjB5C,WAiBM1E,EAjBN,OAkBEpS,QAAQC,IAAImS,EAAS,SACE,MAApBA,EAASC,OAnBd,wBAoBQ0E,EAAYxZ,SAAS6U,EAASC,QAClCiB,EAAayD,GArBjB,kBAsBWT,QAAQC,QAAQ,IAAIjE,MAAMyE,KAtBrC,yBAwBmB3E,EAAS/Q,OAxB5B,WAwBMwL,EAxBN,QA0BK8J,EA1BL,wBA2BIX,GAAanJ,EAAM+J,GA3BvB,kBA4BWN,QAAQC,WA5BnB,eA+BEvW,QAAQC,IAAI4M,GA/Bd,UAiCQlJ,EAAI4O,KAAKC,MAAM3F,GAjCvB,UAkCUsJ,GAAKO,GAlCf,iCAmCWJ,QAAQC,QAAQ5S,IAnC3B,0CAqCI3D,QAAQC,IAAR,MACAqT,EAAa,KAtCjB,kBAuCWgD,QAAQU,OAAO,IAAI1E,MAAM,OAvCpC,4D,sBA2Ce2E,O,iDCiGAC,IA3KahgB,Y,kDAgB1B,WAAYV,GAAQ,IAAD,8BACjB,cAAMA,IAED6C,MAAQ,CACXwT,KAAM,CACJsK,SAAU,EAAKC,mBACfC,kBAAmB,KACnBC,iBAAkB,KAClBC,sBAAuB,EACvBC,eAAgB,GAElBC,KAAM,eACNze,SAAS,GAZM,E,+DAoBjB,SAAS0e,EAAaC,EAAWlb,GAG/B,IAFA,IAAIoB,EAAS,GACT+Z,EAAeD,EAAYzG,KAAKe,MAAMf,KAAK2G,UAAYpb,EAAYkb,IAC/D/hB,EAAI,EAAGA,EAAIgiB,EAAchiB,IAC/BiI,GAAU,IAEZ,OAAOA,EAcT,IADA,IAAIia,EAAgB,GACZliB,EAAI,EAAGA,EAAI,GAAIA,IACrBkiB,EAAchY,KAAK,CACjBzK,KAZKqiB,EAAa,EAAG,IAarB/a,YATMuU,KAAK2G,SACN,GAAY,KACZH,EAAa,GAAI,IAQtBK,YAAc,EACd9T,WAAc,KACd+T,UAAc,KAGlB,OAAOF,I,kKAMPphB,KAAKF,MAAMuc,WAAW,KAAM,M,SAEdkE,GAAO,YAAa,MAAOvgB,KAAKF,MAAM8c,aAAc,G,OAA9D3P,E,OAEJjN,KAAKqD,SAAS,CACZ8S,KAAMlJ,EACN3K,SAAS,I,oIAMLye,GAAO,IAAD,OACZ/gB,KAAKqD,SAAS,CACZ0d,KAAMA,EACNze,SAAS,IAER,WACD3C,OAAOmE,YAAY,WACjB,EAAKT,SAAS,CAEZf,SAAS,MAEV,U,+BAOG,IAAD,OACP,OACE,yBAAKhB,GAAG,0BAEN,yBAAKA,GAAG,yBACN,yBAAKrB,UAAW,cAAoC,iBAApBD,KAAK2C,MAAMoe,KAA2B,UAAY,IAAK9e,QAAU,kBAAM,EAAKsf,QAAQ,kBAApH,gBAAmJ,0BAAMthB,UAAU,WAAYD,KAAK2C,MAAMwT,KAAKwK,oBAC/L,yBAAK1gB,UAAW,cAAoC,kBAApBD,KAAK2C,MAAMoe,KAA2B,UAAY,IAAK9e,QAAU,kBAAO,EAAKsf,QAAQ,mBAArH,iBAAsJ,0BAAMthB,UAAU,WAAYD,KAAK2C,MAAMwT,KAAKyK,oBAGpM,yBAAKtf,GAAG,iBAAiBrB,UAAWD,KAAK2C,MAAML,QAAU,UAAY,IAEnEtC,KAAK2C,MAAMwT,KAAKsK,SAASe,QAAO,SAAAC,GAAO,MAAyB,kBAApB,EAAK9e,MAAMoe,MAA2BU,EAAQC,iBAAuBhgB,KAAI,SAAC+f,EAASviB,GAAV,OAEnH,yBAAKe,UAAU,MAAM2B,MAAO1C,GAC1B,yBAAKe,UAAU,iBAGb,yBAAKA,UAAU,sBACb,EAAK0C,MAAML,SACX,kBAAC,YAAD,CACE6T,KAAM,CACJ,CAAEtS,MAAO,EAAG8d,MAAO,qBACnB,CAAE9d,MAAO,EAAG8d,MAAO,qBAErBthB,WAAY,UACZuhB,UAAW,GACXC,WAAY,OAGX,EAAKlf,MAAML,SACZ,kBAAC,YAAD,CACA6T,KAAM,CACJ,CAAEtS,MAAQ4d,EAAQZ,sBAAwBc,MAAO,qBACjD,CAAE9d,MAAQ4d,EAAQX,eAAiBW,EAAQZ,sBAAwBc,MAAO,qBAE5EthB,WAAY,UACZyhB,SAAS,EACTC,kBAAmB,IACnBH,UAAW,GACXC,WAAY,OAQhB,yBAAK5hB,UAAU,iBACb,yBAAKA,UAAU,gBAAe,kBAAC,IAAD,CAAMsB,GAAImM,aAAyB+T,EAAQO,IAAM,cAAgBP,EAAQ9iB,OACtG8iB,EAAQxb,aAAe,yBAAKhG,UAAU,uBAAwBwhB,EAAQxb,aACvE,yBAAKhG,UAAU,mBAAf,cAA4C,0BAAMA,UAAU,gBAAiBwhB,EAAQQ,YAGzF,yBAAKhiB,UAAU,YACb,0BAAMA,UAAU,sBAAhB,cAAiD+M,EAAWyU,EAAQlU,cAEtE,yBAAKtN,UAAU,aACb,0BAAMA,UAAU,yBAAyB8Q,MAAO,oBAAsB0Q,EAAQS,eAAiB,cAAc,uBAAGtU,MAAM,kBAAtH,IAA2I,0BAAM3N,UAAU,iBAAiBwhB,EAAQS,iBACpL,0BAAMjiB,UAAU,sBAAyB8Q,MAAO,oBAAsB0Q,EAAQJ,YAAc,WAAW,uBAAGzT,MAAM,eAAhH,IAAkI,0BAAM3N,UAAU,cAAcwhB,EAAQJ,yB,GAhJ1J7gB,c,0CCmEf2hB,G,kDAvCb,WAAYriB,GAAQ,uCACZA,G,qDAON,OADAwJ,QAAQC,IAAIvJ,KAAKF,MAAMqW,KAAMnW,KAAKF,MAAMwC,QAAS,OAE/C,0BAAMrC,UAAU,gBAEd,gDAEA,yBAAKA,UAAU,8BACXD,KAAKF,MAAMwC,SA3DvB,WACE,IACI8f,EAAM,IAAIhb,MADN,IACeib,KAAK,GAG5B,SAASC,EAAqBC,EAAQC,GAEpC,IADA,IAAI3E,EAAI,GACA3e,EAAI,EAAGA,EAAIqjB,EAAS/H,KAAKe,MAAMf,KAAK2G,SAAWqB,GAAStjB,IAC9D2e,GAAK,IAEP,OAAOA,EAGT,OACE,2BAAO5d,UAAU,sBACf,+BACGmiB,EAAI1gB,KAAI,SAAC+b,EAAGve,GAAJ,OACT,4BACE,4BAAI,0BAAMe,UAAU,SAAQ,0BAAMA,UAAU,MAAMqiB,EAAqB,GAAI,OAC3E,4BAAI,0BAAMriB,UAAU,SAAQ,0BAAMA,UAAU,MAAMqiB,EAAqB,GAAI,aAwCnDG,IAGpBziB,KAAKF,MAAMwC,SAAY,kBAAC,EAAD,CACvBmF,MAAOzH,KAAKF,MAAMqW,KAAKjS,SACvBsE,SAAS,EACTnC,WAAW,EACXoC,aAAa,EACbC,WAAW,U,GAvBWlI,a,ICnB9BkiB,G,kDACJ,WAAY5iB,GAAQ,uCACZA,G,qDAKN,OADAwJ,QAAQC,IAAIvJ,KAAKF,MAAMqW,KAAKwM,qBAE1B,2BAAO1iB,UAAU,sBACf,+BACGD,KAAKF,MAAMqW,KAAKyM,aAAazjB,OAAS,GAAK,4BAAI,wBAAI0jB,QAAQ,KAAI,0BAAM5iB,UAAU,qBAAhB,YAC/DD,KAAKF,MAAMqW,KAAKyM,aAAalhB,KAAI,SAAC3B,EAAMb,GAAP,OAClC,4BAEE,4BACE,0BAAMe,UAAU,SACd,kBAAC,EAAD,CAAaF,KAAMA,IACnB,8BAAOA,EAAK+iB,MAAZ,KAAqB/iB,EAAKsC,SAA1B,WAMLrC,KAAKF,MAAMqW,KAAKwM,oBAAoBxjB,OAAS,GAAK,4BAAI,wBAAI0jB,QAAQ,KAAI,0BAAM5iB,UAAU,qBAAhB,yBACtED,KAAKF,MAAMqW,KAAKwM,oBAAoBjhB,KAAI,SAAC3B,EAAMb,GAAP,OACzC,4BAEE,4BACE,0BAAMe,UAAU,SACd,kBAAC,EAAD,CAAaF,KAAMA,EAAKK,aAAeL,EAAO,OAC9C,8BAAOA,EAAK+iB,MAAZ,IAAoB/iB,EAAKsC,SAAY,IAAMtC,EAAKsC,SAAW,IAAO,gB,GA9BnD7B,aAiEhBuiB,G,kDAtBb,WAAYjjB,GAAQ,uCACZA,G,qDAMN,OACE,0BAAMG,UAAU,gBAEd,0CAEA,yBAAKA,UAAU,WACXD,KAAKF,MAAMwC,SAnFvB,WACE,IACI8f,EAAM,IAAIhb,MADN,IACeib,KAAK,GAG5B,SAASC,EAAqBC,EAAQC,GAEpC,IADA,IAAI3E,EAAI,GACA3e,EAAI,EAAGA,EAAIqjB,EAAS/H,KAAKe,MAAMf,KAAK2G,SAAWqB,GAAStjB,IAC9D2e,GAAK,IAEP,OAAOA,EAGT,OACE,2BAAO5d,UAAU,sBACf,+BACGmiB,EAAI1gB,KAAI,SAAC+b,EAAGve,GAAJ,OACT,4BACE,4BAAI,0BAAMe,UAAU,SAAQ,0BAAMA,UAAU,MAAMqiB,EAAqB,GAAI,OAC3E,4BAAI,0BAAMriB,UAAU,SAAQ,0BAAMA,UAAU,MAAMqiB,EAAqB,GAAI,aAgEnDG,IACrBziB,KAAKF,MAAMwC,SAAW,kBAAC,GAAD,CAAkB6T,KAAMnW,KAAKF,MAAMqW,a,GAfxC3V,aCrDfwiB,G,kDAfb,WAAYljB,GAAQ,uCACZA,G,gEAINE,KAAKF,MAAMmjB,mB,+BAIX,OACE,kBAAC,IAAD,CAAU1hB,GAAG,e,GAXYf,aCezB0S,GAAiB,CACrBC,OAAQ,MACRC,QAAS,CACP,OAAU,mBACV,eAAgB,qBAMd8P,G,kDACL,WAAYpjB,GAAQ,IAAD,8BAClB,cAAMA,IACD6C,MAAQ,CAEZqc,WAAY,KACZnN,UAAW,GACXhF,YAAa,GACbsW,mBAAoB,KACpBtO,SAAU,GAEVuO,mBAAoB,KAEpB9T,WAAY,EACZT,WAAY,EACZP,eAAe,EACfD,aAAa,EAEb0D,WAAY,KACZlB,OAAQ,cACRwS,gBAAiB,KAEjBlZ,gBAAiB,GAEjB7H,QAAS,CACR4N,UAAU,EACV3B,QAAQ,IAGV,EAAKwF,cAAgBjR,IAAMC,YAC3B,EAAK0S,YAAa,EAClB,EAAK6N,cAAgB,KA9BH,E,iEAkClBtjB,KAAKyV,YAAa,EACfzV,KAAKF,MAAMujB,gBACbrjB,KAAKqD,SAAS,CACbggB,gBAAiBrjB,KAAKF,MAAMujB,iBAC1BrjB,KAAKob,WAMT9R,QAAQC,IAAI,iBAAkBvJ,KAAKF,MAAM0D,WACtCxD,KAAKF,MAAM0D,UACbxD,KAAKqD,SAASrD,KAAKF,MAAM0D,WAEzBxD,KAAKob,c,0FASNpb,KAAKyV,YAAa,I,yCAGAlS,EAAWC,GACzBuE,IAAEC,QAAQxE,EAAWxD,KAAK2C,SAC7B2G,QAAQC,IAAI,iBACZvJ,KAAKF,MAAMyjB,UAAUvjB,KAAK2C,U,2JAQvB3C,KAAKyV,W,iEAEHzV,KAAKqD,SAAS,CACnBf,QAAS,CACR4N,UAAU,EACV3B,QAAQ,K,OAINiV,EAAc,sCAAwCxjB,KAAKF,MAAMsC,WAAa,wBAA0BpC,KAAK2C,MAAM2M,WAAa,WAAatP,KAAK2C,MAAMkO,OACzJ7Q,KAAK2C,MAAMoP,aACbyR,GAAe,eAAiBxjB,KAAK2C,MAAMoP,YAEzC/R,KAAK2C,MAAM0gB,kBACbG,GAAe,eAAiBxjB,KAAK2C,MAAM0gB,iBAG5C5H,MAAM+H,EAAatQ,IAClBmB,MAAK,SAACqH,GACA,GAAuB,MAApBA,EAASC,OACV,MAAM,IAAIC,MAAM,KACX,GAAuB,MAApBF,EAASC,OACjB,MAAM,IAAIC,MAAM,KAElB,OAAOF,EAAS/Q,UAEjB0J,MAAK,SAAC8B,GACN,IAAIlJ,EAAI4O,KAAKC,MAAM3F,GAEnB,EAAK9S,SAAS,CACb2b,WAAY/R,EAAE+R,WACdpJ,OAAQ3I,EAAE2I,OAEV/I,YAAa+E,GAAqB,CAAC3E,EAAE2I,QAAS3I,EAAEJ,YAAa,EAAKlK,MAAMoP,YAAY,GACpFoR,mBAAoBlW,EAAEkW,mBAAqBvR,GAAqB,CAAC3E,EAAE2I,QAAS,CAAC3I,EAAEkW,oBAAqB,EAAKxgB,MAAMoP,YAAY,GAAM,GAAK,KACtI8C,SAAU5H,EAAE4H,SAEZ4O,MAAOxW,EAAEwW,MACTC,UAAWzW,EAAEyW,UAEbL,gBAAiB,KAEjBD,mBAAoBnW,EAAEmW,mBAEtBjZ,gBAAiB,EAAK+R,oBAAoBjP,EAAEoK,kBAAkBnT,UAE9DoL,WAAYrC,EAAEqC,WACdT,WAAY5B,EAAE4B,WAEdvM,QAAS,CACR4N,UAAU,EACV3B,QAAQ,KAEP,WAEC,EAAK+U,eAAe3jB,OAAO8D,aAAa,EAAK6f,eAChD,EAAKA,cAAgB3jB,OAAOmE,WAAW,EAAKsX,SAASpX,KAAK,GAAO,WAIhE2Y,OAAM,SAAChG,GACRrN,QAAQC,IAAIoN,EAAInC,SAChB,EAAK1U,MAAM8c,aAAa/V,SAAS8P,EAAInC,a,4IAS7BzC,GACf/R,KAAKqD,SAAS,CACbiM,WAAY,EACZyC,WAAYA,GACV/R,KAAKob,Y,0CAIR,OAAO,O,yCAIJpb,KAAK2C,MAAML,QAAQ4N,UACO,IAA1BlQ,KAAK2C,MAAM2M,YACdtP,KAAKqD,SAAS,CACbiM,WAAYtP,KAAK2C,MAAM2M,WAAa,GAClCtP,KAAKob,Y,qCAILpb,KAAK2C,MAAML,QAAQ4N,UACnBlQ,KAAK2C,MAAM2M,YAActP,KAAK2C,MAAMkM,YACvC7O,KAAKqD,SAAS,CACbiM,WAAYtP,KAAK2C,MAAM2M,WAAa,GAClCtP,KAAKob,Y,+BAIA9L,GACLtP,KAAK2C,MAAML,QAAQ4N,UACnBZ,EAAa,GAAKA,EAAatP,KAAK2C,MAAMkM,YAC7C7O,KAAKqD,SAAS,CACbiM,WAAYA,GACVtP,KAAKob,Y,gCAGCta,GACT,IAAI+P,EAAS/P,EAAE8C,OAAOC,MAEtB7D,KAAKqD,SAAS,CACbwN,OAAQA,GACN7Q,KAAKob,Y,0CAKW/D,GACnB,IAAIlN,EAAkB,GACtB,IAAI,IAAIyQ,KAAUvD,EAAmB,CACnC,IAAInN,EAAcmN,EAAkBuD,GACpCzQ,EAAgBD,EAAYvL,MAAQuL,EAAY/F,QAAU,EAE5D,OAAOgG,I,oCAIMqK,EAASC,GAAO,IAAD,OACxBT,EAAIhU,KACRsJ,QAAQC,IAAI,WAAYiL,GAExB,IAEM0I,EAAkB,CACtB/J,OAAQ,OACRC,QAAS,CACP,OAAU,mBACV,eAAgB,mBAChB,aAPc1U,EAAU,eAS1B4X,SAAU,OACVrK,KAAM4P,KAAKsB,UAAU,CACnBxS,KAAM6J,EACNwK,WAAYhf,KAAK2C,MAAMqc,cAI3BvD,MAAM,sCAAwCzb,KAAKF,MAAMsC,WAAa,mBAAoB8a,GACzF7I,MAAK,SAACqH,GACA,GAAuB,MAApBA,EAASC,OACV,MAAM,IAAIC,MAAM,KACX,GAAuB,MAApBF,EAASC,OACjB,MAAM,IAAIC,MAAM,KAElB,OAAOF,EAAS/Q,UAEtB0J,MAAK,SAAC8B,GACL7M,QAAQC,IAAI4M,GACZ,IACE,IAAIlJ,EAAI4O,KAAKC,MAAM3F,GAEftB,EAAW,EAAKlS,MAAMkS,SAC1BA,EAASzL,KAAK6D,EAAEa,SAGhB,EAAKzK,SAAS,CACXwR,SAAUA,IACV,WACFJ,IACAT,EAAED,cAAc3Q,QAAQsR,UAAYV,EAAED,cAAc3Q,QAAQuR,gBAE7D,MAAMgC,GACNrN,QAAQC,IAAI,SAAUoN,GACtBlC,QAEDkI,OAAM,SAAChG,GACHrN,QAAQC,IAAIoN,EAAInC,SAChB,EAAK1U,MAAM8c,aAAa/V,SAAS8P,EAAInC,e,+BAKnC,IAAD,OACR,OAEC,yBAAKlT,GAAG,qBACP,yBAAKA,GAAG,mBAAmBrB,UAAU,iBACpC,kBAAC,EAAD,CACcqP,WAActP,KAAK2C,MAAM2M,WACzBT,WAAc7O,KAAK2C,MAAMkM,WACzBD,oBAAuB5O,KAAK2C,MAAMkM,WAClCP,cAAetO,KAAK2C,MAAM2L,cAC1BD,YAAarO,KAAK2C,MAAM0L,YACxB6B,SAAUlQ,KAAK2C,MAAML,QAAQ4N,SAC7B3B,OAAQvO,KAAK2C,MAAML,QAAQiM,OAC3BW,aAAclP,KAAK2C,MAAMoP,WAEzBrB,YAAY,EACVG,OAAQ7Q,KAAK2C,MAAMkO,OACnBD,cAAe,CAAC,cAAe,YAAa,kBAC5CD,UAAW3Q,KAAK2Q,UAAU3M,KAAKhE,MAGjCgP,gBAAiBhP,KAAKgP,gBAAgBhL,KAAKhE,MAC3CyO,kBAAmBzO,KAAKyO,kBAAkBzK,KAAKhE,MAC/CmQ,iBAAkBnQ,KAAKmQ,iBAAiBnM,KAAKhE,MAC7CgR,aAAchR,KAAKgR,aAAahN,KAAKhE,MACrC4P,SAAU5P,KAAK4P,SAAS5L,KAAKhE,MAE7BiQ,cAAc,KAIVjQ,KAAK2C,MAAML,QAAQ4N,WAAalQ,KAAK2C,MAAMiT,QAC7C,yBAAK3V,UAAU,oCAAf,qBAGF,yBAAKA,UAAU,4BACd,yBAAKA,UAAU,kBAAkBqB,GAAG,oBAGjC,yBAAKrB,UAAU,mBACf,0BAAMA,UAAU,QAAhB,cACqC,OAAlCD,KAAK2C,MAAMygB,oBAA+B,0BAAMnjB,UAAU,UAA0C,IAAhCD,KAAK2C,MAAMygB,oBAA0BO,QAAQ,GAAvE,KACR,OAAlC3jB,KAAK2C,MAAMygB,oBAA+B,0BAAMnjB,UAAU,YAAhB,QAIpDD,KAAK2C,MAAMkK,YAAYnL,KAAI,SAACmL,EAAajL,GAAd,OAC3B,kBAAC,GAAD,CACC7B,KAAM,EAAK4C,MAAM8gB,MAAM7hB,IAAU,KACjCA,MAAOA,EACPgU,OAAQ,EAAKjT,MAAMiT,OACnB/I,YAAa,EAAKlK,MAAMkK,YAAYjL,GACpCuI,gBAAiB,EAAKxH,MAAMwH,gBACxB1B,aAAa,EACbmb,SAAU,EAAKjhB,MAAM+gB,UAAU9hB,IAAU,UAG7C5B,KAAK2C,MAAMwgB,oBAAsB,yBAAKljB,UAAU,WAAU,gCAE1DD,KAAK2C,MAAMwgB,oBACZ,kBAAC,GAAD,CACCU,YAAa,kBACbC,mBAAoB,sEACpBlO,OAAQ5V,KAAK2C,MAAMiT,OACnB/I,YAAa7M,KAAK2C,MAAMwgB,mBACxBhZ,gBAAiBnK,KAAK2C,MAAMwH,gBACxB1B,aAAa,KAOd,yBAAKxI,UAAU,iBAEnB,yBAAKA,UAAU,oBACZD,KAAKF,MAAMC,MAAQC,KAAK2C,MAAMkS,UAEhC,yBAAK5U,UAAU,kBAGd,wBAAIA,UAA0C,IAA/BD,KAAK2C,MAAMkS,SAAS1V,OAAe,SAAW,IAA7D,YAA2Ea,KAAK2C,MAAMkS,SAAS1V,OAAS,GAAK,IAAMa,KAAK2C,MAAMkS,SAAS1V,OAAS,KAEhH,IAA/Ba,KAAK2C,MAAMkS,SAAS1V,QAAgB,yBAAKc,UAAU,mBAAf,oBAClC,yBAAKA,UAAU,2BAA2B6F,IAAK9F,KAAK+T,eAChD/T,KAAK2C,MAAMkS,SAASnT,KAAI,SAACoM,EAAS5O,GAAV,OAAgB,kBAAC,EAAD,eAAS0C,MAAO1C,GAAO4O,EAAvB,CAAgCN,oBAAoB,SAEhG,kBAAC,EAAD,CAAcH,kBAAmBrN,KAAKF,MAAMC,KAAKK,aAAc2N,cAAe/N,KAAK+N,cAAc/J,KAAKhE,kB,GArV3FQ,aA0W1BujB,G,kDACL,WAAYjkB,GAAQ,uCACbA,G,qDAKN,OACC,yBAAKG,UAAU,sBACN,yBAAKA,UAAU,oBACd,yBAAKA,UAAW,qBAAyBD,KAAKF,MAAM+jB,aAAgB7jB,KAAKF,MAAMC,KAA+B,GAAvB,wBAEnFC,KAAKF,MAAM+jB,aACd,yBAAK5jB,UAAU,YAEd,kBAAC,EAAD,CAAaF,KAAMC,KAAKF,MAAMC,OAAO,0BAAME,UAAU,YAAYD,KAAKF,MAAMC,MAAQC,KAAKF,MAAMC,KAAKsC,UACpG,yBAAKpC,UAAU,aAAf,YAAqC+M,EAAWhN,KAAKF,MAAM8jB,YAG1D5jB,KAAKF,MAAM+jB,aACZ,yBAAK5jB,UAAU,YACd,0BAAMA,UAAU,YAAW,4BAAKD,KAAKF,MAAM+jB,aAAiB,uBAAGjW,MAAM,oBAAoBmD,MAAO/Q,KAAKF,MAAMgkB,uBAG7G,yBAAK7jB,UAAU,yBAEX,kBAAC,EAAD,CACE2B,MAAO5B,KAAKF,MAAM8B,MAClB+K,MAAO3M,KAAKF,MAAM8V,OAClB/I,YAAa7M,KAAKF,MAAM+M,YACxB1C,gBAAiBnK,KAAKF,MAAMqK,gBAE5B1B,aAAa,Y,GAhCOjI,aA8CzB0iB,MCtZTM,GAAczW,EAAQ,KAG5BiX,YAASC,OAAOC,kBAAoB,YACpCF,YAASC,OAAOE,UAAUC,SAAW,IAGrC,IASMC,GAAe,CACrB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAIMC,G,kDACJ,WAAYxkB,GAAQ,uCACZA,G,+GAGwBC,G,8EAC1BmW,EAAO,YAAclW,KAAKF,MAAMsC,WAAa,yBAA2BrC,EAAKiiB,I,SAC3EzB,GAAOrK,EAAK,MAAOlW,KAAKF,MAAM8c,aAAc,MAAM,EAAO,GAAG,EAAM,eAAiB7c,EAAKsC,SAAW,S,kRAIrG6T,EAAO,YAAclW,KAAKF,MAAMsC,WAAa,iC,SAC3Cme,GAAOrK,EAAK,MAAOlW,KAAKF,MAAM8c,aAAc,MAAM,EAAO,GAAG,EAAM,6B,qIAGhE,IAAD,OAEP,OAEE,0BAAM3c,UAAU,gBACd,2CACA,yBAAKA,UAAU,qCAEwC,IAAnDD,KAAKF,MAAMqW,KAAKoO,+BAChB,0FACA,6BACA,gCAASvkB,KAAKF,MAAMqW,KAAKoO,+BAAzB,KADA,2CAC4G,4BAAQtkB,UAAU,kBAAkBgC,QAAS,kBAAM,EAAKuiB,gCAA+B,uBAAGvkB,UAAU,mBAApG,kBAMhH,yBAAKA,UAAU,+BACb,2BAAOqB,GAAG,oBAAoBrB,UAAU,wCACtC,+BACE,4BACE,yCACA,6CACA,+BAGJ,+BAEED,KAAKF,MAAMqW,KAAKsN,MAAM/hB,KAAI,SAAC3B,EAAM6B,GAAP,OAC1B,4BACE,4BAAI,yBAAK3B,UAAU,YAAW,kBAAC,EAAD,CAAaF,KAAMA,IAAQA,EAAKsC,WAC9D,4BAAKtC,EAAK0kB,iBACV,4BAAI,4BAAQxkB,UAAW,mBAA8C,IAAzBF,EAAK0kB,gBAAwB,YAAc,IAAKxiB,QAAS,kBAAM,EAAKyiB,0BAA0B3kB,KAAO,uBAAGE,UAAU,mBAA1J,yB,GA/CWO,aAgEzBmkB,G,kDACJ,WAAY7kB,GAAQ,uCACZA,G,qDAMN,IAAI8kB,EAAW5kB,KAAKF,MAAMqW,KAAKhX,OAAS,EAEpC0lB,EAAQ7kB,KAAKF,MAAMqW,KAAK2O,QAAO,SAACnF,EAAGoF,GAAJ,OAAUpF,EAAIoF,IAAG,GAChDC,EAAQxK,KAAKC,IAAI,IAAKoK,GAASA,EAE/BI,EAAW,GAEXC,GAAe,EAOfC,EAAe,EACnB,IAAI,IAAIjmB,KAAKc,KAAKF,MAAMqW,KAAM,CAE5B,IAAIiP,EAAQplB,KAAKF,MAAMqW,KAAKjX,GACxBmmB,EAAU7K,KAAKe,MAAM6J,EAAQJ,GAEjCC,EAAS7b,KACP,0BAAMjJ,MAAO,CAAC,IAAuC,GAA/Bqa,KAAKS,KAAKkK,EAAe,IAAY,MAAOllB,UAAW,iCAAmD,IAAhBilB,EAAoB,QAAU,SAE5I,uBAAG/kB,MAAO,CAAC,WAAc,qBAAuBqa,KAAKkD,IAAI,IAAOkH,EAAW1lB,GAAK0lB,GAAa,MACzFA,EAAW1lB,IAAM,EAAK,oBAAwB0lB,EAAW1lB,EAAK,eAAiB0lB,EAAW1lB,IAAM,EAAI,GAAK,MAE7G,0BAAMe,UAAU,YAAYD,KAAKF,MAAMqW,KAAKjX,GAA5C,WAIJgmB,IAAgB,EAEN1K,KAAKe,MAAM8J,EAAU,IAAM,EACrCF,GAAgBE,EAKlB,OACE,yBAAKplB,UAAU,0BACb,yBAAKA,UAAU,uBACb,8BAAO2kB,GACP,yBAAK3kB,UAAU,8BACf,oCAIF,yBAAKA,UAAU,eAAeqB,GAAG,6BAC/B,yBAAKrB,UAAU,wBACXD,KAAKF,MAAMqW,KAAKzU,KAAI,SAAC4jB,EAAWC,GAEhC,IAAI1hB,EAAQ+gB,EAAWW,EAEvB,OAAO,IAAIne,MAAMoT,KAAKe,MAAM+J,EAAYN,IAAQ3C,KAAK,GAAG3gB,KAAI,SAAC8jB,EAAQC,GACnE,OACE,yBAAKxlB,UAAU,gBAAgBE,MAC7B,CAAC,WAAc,qBAAuBqa,KAAKkD,IAAI,GAAO7Z,EAAS+gB,GAAa,MAC1E/gB,UAOZ,yBAAK5D,UAAU,qBAAf,eAAiDua,KAAKS,KAAK,EAAI+J,GAA/D,cACA,yBAAK/kB,UAAU,yBAA0BglB,S,GAzEzBzkB,aAiG1B,SAASklB,GAAiBjI,GACtB,OAAOA,EAAEnX,WAAWoQ,QAAQ,wBAAyB,KAIzD,SAASiP,GAAuBC,GAE9B,IAAI,IAAI1mB,KAAK0mB,EAAkBC,SAAU,CACvC,IAAIvb,EAAYzD,SAAS3H,GAAKmlB,GAAallB,OAC3CymB,EAAkBC,SAAS3mB,GAAK4mB,OAAOC,OAAO,GAAIH,EAAkBC,SAAS3mB,GAA7C4mB,OAAA,KAAAA,CAAA,CAC9BzD,MAAM,EACN2D,YAAa,GACbC,gBAAiB5B,GAAa/Z,GAC9B4b,YAAa7B,GAAa/Z,GAC1B6b,eAAgB,SAChBC,WAAY,GACZC,iBAAkB,EAClBC,gBAAiB,QACjBC,iBAAkBlC,GAAa/Z,GAC/Bkc,qBAAsBnC,GAAa/Z,GACnCmc,iBAAkB,EAClBC,iBAAkB,EAClBC,0BAA2BtC,GAAa/Z,GACxCsc,sBAAuB,sBACvBC,sBAAuB,EACvBC,YAAa,EACbC,eAAgB,IAjBc,cAkBjB,IAIjB,OAAOnB,EAqBT,SAASoB,GAAOC,EAAWC,GACzB,MAAO,CAAC1M,KAAKkD,IAAIuJ,EAAU,GAAKC,EAAQ,GAAI1M,KAAKkD,IAAIuJ,EAAU,GAAKC,EAAQ,GAAI1M,KAAKkD,IAAIuJ,EAAU,GAAKC,EAAQ,IAhBlHC,OAAOlN,UAAUmN,aAAe,WAC5B,GAAkB,GAAfpnB,KAAKb,OACJ,KAAM,yCAGV,IAAIkoB,EAAUrnB,KAAKsnB,MAAM,WAMzB,MALW,CACPzgB,SAASwgB,EAAQ,GAAI,IACrBxgB,SAASwgB,EAAQ,GAAI,IACrBxgB,SAASwgB,EAAQ,GAAI,M,IAWvBE,G,kDACJ,WAAYznB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXwT,KAAM,GACNqR,aAAa,GAJE,E,4DAUHrR,EAAMqR,GAEpB,IAAMC,EAAgB,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAGhJne,QAAQC,IAAI4M,EAAKnL,cAAe,MAChC,IAAI0c,EAAkBvR,EAItB,GAFAuR,EAAgB1c,cAAc6a,SAAS,GAAG8B,YAAc,EAErDH,EAMD,IAAI,IAAItoB,KAJRwoB,EAAgB1c,cAAc6a,SAAS,GAAGI,gBAAkB,GAC5DyB,EAAgB1c,cAAc6a,SAAS,GAAGK,YAAc,GAG3C/P,EAAKnL,cAAcI,OAAQ,CACtC,IAAIyH,EAAQsD,EAAKnL,cAAcI,OAAOlM,GAClCoL,EAAY6L,EAAKyR,cAAc/U,GAEnCvJ,QAAQC,IAAIe,EAAWuI,GACvB,IAAIgV,EAAYJ,EAAcnd,EAAYmd,EAActoB,QAExDmK,QAAQC,IAAIse,GACZ,IAAIZ,EAAYY,EAAUvkB,MAAM,EAAG,GAAG8jB,eAEtCM,EAAgB1c,cAAc6a,SAAS,GAAGI,gBAAgB7c,KAAK,QAAU6d,EAAU,GAAK,KAAOA,EAAU,GAAK,KAAOA,EAAU,GAAK,QAEpI,IAAIa,EAAkBd,GAAOC,EAAW,IACxCS,EAAgB1c,cAAc6a,SAAS,GAAGK,YAAY9c,KAAK,QAAU0e,EAAgB,GAAK,KAAOA,EAAgB,GAAK,KAAOA,EAAgB,GAAK,aAIpJJ,EAAgB1c,cAAc6a,SAAS,GAAGI,gBAAkB,0BAC5DyB,EAAgB1c,cAAc6a,SAAS,GAAGK,YAAc,0BAI1D,OAAOwB,I,2CAIP1nB,KAAKqD,SAAS,CACZ8S,KAAMnW,KAAK+nB,gBAAgB/nB,KAAKF,MAAMqW,KAAMnW,KAAKF,MAAM0nB,aACvDA,YAAaxnB,KAAKF,MAAM0nB,gB,4CAKNjkB,EAAWC,GAC/B,OAAGxD,KAAK2C,MAAM6kB,cAAgBhkB,EAAUgkB,aACrCjkB,EAAUikB,cAAgBxnB,KAAKF,MAAM0nB,c,yCAIvBjkB,EAAWC,GAE5B,IAAIgkB,EAAcxnB,KAAKF,MAAM0nB,YAC7BxnB,KAAKqD,SAAS,CACZmkB,YAAaA,EACbrR,KAAMnW,KAAK+nB,gBAAgB/nB,KAAK2C,MAAMwT,KAAMqR,O,+BAQ9C,OACE,kBAAC,OAAD,CACErR,KAAMnW,KAAK2C,MAAMwT,KAAKnL,cACtBgd,OAAQ,IACR9a,QAAS,CACP+a,YAAY,EACZC,qBAAqB,EACrBC,OAAQ,CACNC,SAAS,GAEXC,OAAQ,CACNC,MAAO,CAAC,CACNC,MAAO,CACLC,aAAa,EACbC,UAAW,GAGbC,WAAY,CACVN,SAAS,EACTO,YAAa,uB,GAlGQnoB,aA8G/BooB,G,kDACJ,WAAY9oB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXwT,KAAM,IAHS,E,iEAQjB7M,QAAQC,IAAIvJ,KAAKF,MAAMqW,MACvBnW,KAAKqD,SAAS,CACZ8S,KAAMnW,KAAKF,MAAMqW,KACjB0S,WAAY7oB,KAAKF,MAAM+oB,e,+CAKFA,GAwBK/C,OAAOC,OAAO,GAAI/lB,KAAKF,MAAMqW,KAAK0P,UAG9D,GAFAvc,QAAQC,IAAI,OAAQsf,GAEjBA,EAAY,CACbvf,QAAQC,IAAIvJ,KAAKF,MAAMqW,KAAKyP,kBAAmB,MAE/C,IAAIkD,EAxBN,SAAuBjD,GAErB,IADA,IAAIkD,EAAqB,GACjB7pB,EAAI,EAAGA,EAAI2mB,EAAS1mB,OAAQD,IAAK,CAMvC,IAJA,IACI8pB,EAAoB,CAACnW,MADbgT,EAAS3mB,GAAG2T,MACesD,KAAM,IAAI/O,MAAMye,EAAS3mB,GAAGiX,KAAKhX,QAAQkjB,KAAK,IAEjF4G,EAAI,EACAzL,EAAIqI,EAAS3mB,GAAGiX,KAAKhX,OAAS,EAAGqe,GAAK,EAAGA,IAC/CyL,GAAKpD,EAAS3mB,GAAGiX,KAAKqH,GACtBwL,EAAkB7S,KAAKqH,GAAKyL,EAE9B3f,QAAQC,IAAIyf,EAAmB,MAC/BD,EAAmB3f,KAAK4f,GAE1B,OAAOD,EAScG,CAAclpB,KAAKF,MAAMqW,KAAK0P,UAE/CmD,EAAoBrD,GAAuB,CAC7Cva,OAAQ0a,OAAOC,OAAO,GAAI/lB,KAAKF,MAAMqW,KAAK/K,QAC1Cya,SAAUiD,IAIZ,OADAxf,QAAQC,IAAIyf,EAAmB,OACxBA,EAGT,OAAOhpB,KAAKF,MAAMqW,O,4CAGE5S,EAAWC,GAC/B,OAAGxD,KAAK2C,MAAMkmB,aAAerlB,EAAUqlB,YACpCtlB,EAAUslB,aAAe7oB,KAAKF,MAAM+oB,a,yCAItBtlB,EAAWC,GAE5B,IAAIqlB,EAAa7oB,KAAKF,MAAM+oB,WAC5B7oB,KAAKqD,SAAS,CACZwlB,WAAYA,EACZ1S,KAAMnW,KAAKmpB,yBAAyBN,O,+BAQtC,OAFAvf,QAAQC,IAAI,cAAevJ,KAAKF,MAAM+oB,YAGpC,kBAAC,QAAD,CACE1S,KAAMnW,KAAK2C,MAAMwT,KACjB6R,OAAQ,IACRoB,QAAM,EACNlc,QAAS,CACP+a,YAAY,EACZC,qBAAqB,EACrBG,OAAQ,CACNgB,MAAO,CAAC,CACNC,KAAM,OACNC,KAAM,CACJC,KAAM,OAERjB,MAAO,CACL7K,IAAK,IAAIL,QAGbiL,MAAO,CAAC,CACNC,MAAO,CACLC,aAAa,EACbC,UAAW,GAGbC,WAAY,CACVN,SAAS,EACTO,YAAa,yB,GA1GDnoB,aAyHtBipB,G,kDACJ,WAAY3pB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACX+mB,wBAAwB,EACxBC,yBAAyB,GAJV,E,uEAUjB3pB,KAAKqD,SAAS,CACZqmB,wBAAyB1pB,KAAK2C,MAAM+mB,2B,sDAKtC1pB,KAAKqD,SAAS,CACZsmB,yBAA0B3pB,KAAK2C,MAAMgnB,4B,+BAQ/B,IAAD,OAcP,OAEE,yBAAKroB,GAAG,oBAAoBrB,UAAW,WAAaD,KAAKF,MAAMwC,QAAU,UAAY,KACnF,yBAAKrC,UAAU,qBACf,yBAAKA,UAAU,uBACb,yBAAKA,UAAU,kBACb,yBAAKA,UAAU,gBAIb,6BACE,yBAAKA,UAAU,QAAf,eACA,yBAAKA,UAAU,SAAQ,0BAAM2N,MAAM,gBAAiB8X,GAAiB1lB,KAAKF,MAAMqW,KAAK0K,uBAA9D,MAA2F6E,GAAiB1lB,KAAKF,MAAMqW,KAAK2K,mBAGrJ,yBAAKlT,MAAM,YAET,0BAAM3N,UAAU,mBAAkB,0BAAMA,UAAU,uBAAuB,IAAMD,KAAKF,MAAMqW,KAAK0K,sBAAwB7gB,KAAKF,MAAMqW,KAAK2K,gBAAgB6C,QAAQ,GAA7H,MAEhC3jB,KAAKF,MAAMwC,SACb,kBAAC,YAAD,CACE6T,KAAM,CACJ,CAAEtS,MAAO,EAAG8d,MAAO,qBACnB,CAAE9d,MAAO,EAAG8d,MAAO,qBAErBthB,WAAY,UACZuhB,UAAW,GACXC,WAAY,OAGX7hB,KAAKF,MAAMwC,SACZ,kBAAC,YAAD,CACA6T,KAAM,CACJ,CAAEtS,MAAQ7D,KAAKF,MAAMqW,KAAK0K,sBAAwBc,MAAO,qBACzD,CAAE9d,MAAQ7D,KAAKF,MAAMqW,KAAK2K,eAAiB9gB,KAAKF,MAAMqW,KAAK0K,sBAAwBc,MAAO,qBAE5FthB,WAAY,UACZyhB,SAAS,EACTC,kBAAmB,IACnBH,UAAW,GACXC,WAAY,SAUpB,yBAAK5hB,UAAU,kBACb,yBAAKA,UAAU,QAAf,iBAAoC,0BAAMA,UAAU,cAAc8Q,MAAM,qFAAoF,uBAAGnD,MAAM,wBACrK,yBAAK3N,UAAU,SAAQ,0BAAM2N,MAAM,gBAAZ,IAA8B5N,KAAKF,MAAMqW,KAAKyT,aAAgBpP,KAAKqP,MAAqC,IAA/B7pB,KAAKF,MAAMqW,KAAKyT,cAAsB,IAAO,KAAtH,OAEzB,yBAAK3pB,UAAU,kBACb,yBAAKA,UAAU,QAAf,0BACA,yBAAKA,UAAU,SAAQ,0BAAM2N,MAAM,gBAAiB5N,KAAKF,MAAMqW,KAAK2T,mBAA7C,eAIzB,kBAAC,IAAD,CAAMvoB,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,WAAYnC,UAAU,mBAAkB,uBAAG2N,MAAM,iBAA5G,WAAuI,yBAAK3N,UAAU,YAAYD,KAAKF,MAAMqW,KAAK4T,kBAA3C,IAA+D/pB,KAAKF,MAAMqW,KAAK6T,wBAA/E,eAMzI,yBAAK/pB,UAAU,yBAGb,yBAAKA,UAAU,iCAIb,yBAAKA,UAAU,0BACb,yBAAKA,UAAU,SACb,yBAAKA,UAAU,yBACb,kDACED,KAAKF,MAAMqW,KAAKuR,iBAAmB,yBAAKzlB,QAASjC,KAAKiqB,yBAAyBjmB,KAAKhE,MAAOC,UAAW,gBAAkBD,KAAK2C,MAAM+mB,uBAAyB,UAAY,KAAK,0BAAMzpB,UAAU,aAAkB,mDAEnN,6BACID,KAAKF,MAAMwC,SACX,yBAAKrC,UAAU,qBAAoB,uBAAG2N,MAAM,sBAA5C,eAEC5N,KAAKF,MAAMwC,UAAYtC,KAAKF,MAAMqW,KAAKuR,iBAAmB,yBAAKznB,UAAU,yCAAf,oDAC1DD,KAAKF,MAAMwC,SAAWtC,KAAKF,MAAMqW,KAAKuR,iBAEvC,kBAAC,GAAD,CAAwBvR,KAAMnW,KAAKF,MAAMqW,KAAKuR,gBAAiBF,YAAaxnB,KAAK2C,MAAM+mB,4BAQ/F,yBAAKzpB,UAAU,yBAGb,yBAAKA,UAAU,SACb,yBAAKA,UAAU,yBACb,wCACED,KAAKF,MAAMqW,KAAKyP,mBAAqB,yBAAK3jB,QAASjC,KAAKkqB,8BAA8BlmB,KAAKhE,MAAOC,UAAW,gBAAkBD,KAAK2C,MAAMgnB,wBAA0B,UAAY,KAAK,0BAAM1pB,UAAU,aAAkB,8CAI3N,6BACID,KAAKF,MAAMwC,SACX,yBAAKrC,UAAU,qBAAoB,uBAAG2N,MAAM,sBAA5C,eAEC5N,KAAKF,MAAMwC,UAAYtC,KAAKF,MAAMqW,KAAKyP,mBAAqB,yBAAK3lB,UAAU,yCAAf,iDAC5DD,KAAKF,MAAMwC,SAAYtC,KAAKF,MAAMqW,KAAKyP,mBACxC,kBAAC,GAAD,CAAezP,KAAMnW,KAAKF,MAAMqW,KAAKyP,kBAAmBiD,WAAY7oB,KAAK2C,MAAMgnB,6BAYvF,yBAAK1pB,UAAU,yBACb,yBAAKA,UAAU,SACb,oDACED,KAAKF,MAAMwC,SACX,yBAAKrC,UAAU,qBAAoB,uBAAG2N,MAAM,sBAA5C,eAEC5N,KAAKF,MAAMwC,SACZ,kBAAC,GAAD,CAAa6T,KAAMnW,KAAKF,MAAMqW,KAAKgU,0BAS7C,yBAAKlqB,UAAU,uCACb,yBAAKA,UAAU,SACb,wCAEA,yBAAKA,UAAW,oBAA0D,IAApCD,KAAKF,MAAMqW,KAAKtB,SAAS1V,OAAe,eAAgB,KAEtD,IAApCa,KAAKF,MAAMqW,KAAKtB,SAAS1V,QAAgB,yBAAKc,UAAU,eAAf,gDAEzCD,KAAKF,MAAMqW,KAAKtB,SAASnT,KAAI,SAACoM,EAAS5O,GAAV,OAAgB,kBAAC,EAAD,eAAS0C,MAAO1C,GAAO4O,EAAvB,CAAgC1L,WAAY,EAAKtC,MAAMsC,0B,GA1LrF5B,aA4MzB4pB,G,kDACJ,WAAYtqB,GAAQ,uCACZA,G,qDAqBN,IAAIuqB,EAAkB1qB,OAAO2qB,SAAS9qB,SAGlCuhB,EAAOsJ,EAAgBprB,MAAM,KAAKqE,MAAM,EAAG+mB,EAAgBprB,MAAM,KAAKE,QAG1E,OAFAmK,QAAQC,IAAIwX,GAGV,yBAAKzf,GAAG,wBACN,yBAAKrB,UAAU,gBACb,yBAAKA,UAAU,yBACb,yBAAKA,UAAW,gBAAmBD,KAAKF,MAAMqc,aAAuB,GAAR,OAAahc,MAAO,CAAC,QAAW,UAAU,kBAAC,IAAD,CAAMoB,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,cAAepC,KAAKF,MAAMqc,aAAenc,KAAKF,MAAMqc,aAAe,aACrO,yBAAKlc,UAAW,mBAAsBD,KAAKF,MAAMsc,cAAwB,GAAR,OAAajc,MAAO,CAAC,QAAW,UAAjG,cAAsH,0BAAMF,UAAU,gBAAgBD,KAAKF,MAAMsc,cAAgBpc,KAAKF,MAAMsc,cAAgB,eAIhN,wBAAInc,UAAU,iBACZ,kBAAC,GAAD,CAA0BmC,WAAYpC,KAAKF,MAAMsC,WAAY2e,KAAMA,EAAMpiB,KAAK,YAAY2B,KAAK,cAC/F,kBAAC,GAAD,CAA0B8B,WAAYpC,KAAKF,MAAMsC,WAAY2e,KAAMA,EAAMpiB,KAAK,mBAAmB2B,KAAK,YAEtG,kBAAC,GAAD,CAA2B8B,WAAYpC,KAAKF,MAAMsC,WAAY2e,KAAMA,EAAMpiB,KAAK,cAAc4rB,UAAY,CAAC,CAAC5rB,KAAM,WAAY2B,KAAM,SAAU,CAAE3B,KAAM,WAAY2B,KAAM,aAAgBA,KAAK,aAE5L,kBAAC,GAAD,CAA0B8B,WAAYpC,KAAKF,MAAMsC,WAAY2e,KAAMA,EAAMpiB,KAAK,aAAa2B,KAAK,SAChG,kBAAC,GAAD,CAA0B8B,WAAYpC,KAAKF,MAAMsC,WAAY2e,KAAMA,EAAMpiB,KAAK,WAAW2B,KAAK,iB,GA7CvEE,aAuD3BgqB,G,kDACJ,WAAY1qB,GAAQ,uCACZA,G,qDAKE,IAAD,OAEH2qB,EAAWzqB,KAAKF,MAAMnB,KAAK+X,QAAQ,IAAK,KAAKV,cAEjD1M,QAAQC,IAAIvJ,KAAKF,MAAMihB,KAAM0J,GAI7B,IAAIC,EAAqB1qB,KAAKF,MAAMyqB,UAAU,GAAG5rB,KAAK+X,QAAQ,IAAK,KAAKV,cACpEzR,EAAOvE,KAAKF,MAAMihB,KAAK,KAAO0J,EAClC,OACE,wBAAIxqB,UAAW,kBAAoBD,KAAKF,MAAMihB,KAAK,KAAO0J,EAAW,UAAY,KAC/E,kBAAC,IAAD,CAAMlpB,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,IAAMqoB,EAAU,IAAMC,GAAqB,uBAAGzqB,UAAW,SAAWD,KAAKF,MAAMQ,OAAYN,KAAKF,MAAMnB,MACjK,wBAAIsB,UAAW,WAAasE,EAAO,QAAU,KAC5CvE,KAAKF,MAAMyqB,UAAU7oB,KAAI,SAACyB,EAAMvB,GAAP,OAAiB,kBAAC,GAAD,CAA0BQ,WAAY,EAAKtC,MAAMsC,WAAY2e,KAAM,EAAKjhB,MAAMihB,KAAMpiB,KAAMwE,EAAKxE,KAAMgsB,WAAYF,EAAUnqB,KAAM6C,EAAK7C,gB,GArBjJE,aA6BlCoqB,G,kDACJ,WAAY9qB,GAAQ,uCACZA,G,qDAIN,IAAI2qB,EAAWzqB,KAAKF,MAAMnB,KAAK+X,QAAQ,IAAK,KAAKV,cAEjD,OADGhW,KAAKF,MAAM6qB,aAAYF,EAAWzqB,KAAKF,MAAM6qB,WAAa,IAAMF,GAEjE,wBAAIxqB,UAAWD,KAAKF,MAAMihB,KAAK1b,KAAK,OAASolB,EAAW,SAAW,IACjE,kBAAC,IAAD,CAAMlpB,GAAImM,aAAyB1N,KAAKF,MAAMsC,WAAa,IAAMqoB,GACjE,uBAAGxqB,UAAW,SAAWD,KAAKF,MAAMQ,OAAYN,KAAKF,MAAMnB,W,GAX5B6B,aAoBjCqqB,G,kDACJ,WAAY/qB,GAAQ,uCACZA,G,qDAGN,OAAS,4E,GALYU,aAwCnBsqB,G,kDACJ,WAAYhrB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXL,SAAS,EAET4c,MAAO,KAEP/I,KAAM,CAEJ4U,UAAW,CAEThB,kBAAmB,EACnBC,wBAAyB,EAEzBnJ,sBAAuB,IACvBC,eAAgB,KAEhB8I,aAAc,GAEdE,mBAAoB,GAMpBjV,SAAU,CACR,CACEvH,OAAQ,WACR0d,KAAM,SACNrgB,KAAM,uCACN8C,gBAAiB,qCACjBJ,kBAAmB,CACjB9M,WAAY,OACZF,WAAY,OACZC,KAAM,YAGV,CACEgN,OAAQ,YACR0d,KAAM,SACNrgB,KAAM,0BACN8C,gBAAiB,yGACjBJ,kBAAmB,CACjB9M,WAAY,OACZF,WAAY,OACZC,KAAM,YAGV,CACEgN,OAAQ,UACR0d,KAAM,SACNrgB,KAAM,4BACN8C,gBAAiB,uEACjBJ,kBAAmB,CACjB9M,WAAY,OACZF,WAAY,OACZC,KAAM,YAGV,CACEgN,OAAQ,UACR0d,KAAM,SACNrgB,KAAM,uCACN8C,gBAAiB,qCACjBJ,kBAAmB,CACjB9M,WAAY,OACZF,WAAY,OACZC,KAAM,YAGV,CACEgN,OAAQ,QACR0d,KAAM,SACNrgB,KAAM,YACN8C,gBAAiB,uEACjBJ,kBAAmB,CACjB9M,WAAY,OACZF,WAAY,OACZC,KAAM,cAKd+W,kBAAmB,CAAEnT,SAAU,MAOnC,EAAK+mB,uBAAyB,KA1Fb,E,iMA8FbjX,EAAIhU,K,kBAGQugB,GAAO,YAAcvgB,KAAKF,MAAMsC,WAAY,MAAOpC,KAAKF,MAAM8c,aAAc,K,QAAtF3P,E,QAEC8d,UAAUnF,oBAAmB3Y,EAAE8d,UAAUnF,kBAAoBD,GAAuB1Y,EAAE8d,UAAUnF,oBACrG5R,EAAE3Q,SAAS,CACTf,SAAS,EACT6T,KAAMlJ,IAEL,WAAQ,EAAKnN,MAAMuc,WAAWpP,EAAElL,aAAckL,EAAEie,mB,gDAEnD5hB,QAAQC,IAAR,M,8JAMqB4M,GACvB7M,QAAQC,IAAI,eAAgB4M,GAC5BnW,KAAKirB,uBAAyB9U,I,+BAGtB,IAAD,OACHmU,EAAWtqB,KAAKF,MAAMwqB,SAC1BhhB,QAAQC,IAAI,yBAA0BvJ,KAAKirB,wBAE3C,IAAIE,EAAQ3H,GAAY1H,MAAMwO,EAAS7T,QAAQ0U,MAG/C,OAIE,yBAAK7pB,GAAG,eAAerB,UAAWD,KAAK2C,MAAML,QAAU,UAAY,IACjE,kBAAC,GAAD,CACoBF,WAAYpC,KAAKF,MAAMsC,WACvB+Z,aAAcnc,KAAKF,MAAMqc,aACzBC,cAAepc,KAAKF,MAAMsc,gBAK9C,yBAAKnc,UAAU,wBACb,kBAACmrB,GAAA,EAAD,CAAiBnrB,UAAU,oBACzB,kBAACorB,GAAA,EAAD,CACAxpB,IAAKyoB,EAASzoB,IACdypB,QAAS,CAAEC,MAAO,IAAKC,KAAK,KAC5BC,WAAW,QAET,6BAASxrB,UAAW,iBAAoBD,KAAK2C,MAAML,QAAsB,GAAZ,YAC5D,kBAAC,IAAD,CAAQgoB,SAAUA,GACf,kBAAC,IAAD,CAAO3mB,KAAK,0BAAoC+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAkBppB,QAAS,EAAKK,MAAML,QAAS6T,KAAM,EAAKxT,MAAMwT,KAAK4U,UAAW3oB,WAAY,EAAKtC,MAAMsC,gBACrK,kBAAC,IAAD,CAAOuB,KAAK,qCAAgD+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAmB3rB,KAAM,EAAKD,MAAMC,KAAMqC,WAAY,EAAKtC,MAAMsC,WAAYoB,UAAW,EAAKynB,uBAAwB1H,UAAW,EAAKoI,yBAAyB3nB,KAAK,GAAO1B,QAAS,EAAKK,MAAML,QAAS+gB,gBAAiB8H,EAAOvO,aAAc,EAAK9c,MAAM8c,kBAClU,kBAAC,IAAD,CAAOjZ,KAAK,qCAAgD+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAkB3rB,KAAM,EAAKD,MAAMC,KAAMqC,WAAY,EAAKtC,MAAMsC,WAAY+T,KAAM,EAAKxT,MAAMwT,KAAKyV,iBAAmB,EAAKjpB,MAAMwT,KAAKyV,iBAAmB,CAACnI,MAAO,GAAIoI,uBAAwB,GAAIjP,aAAc,EAAK9c,MAAM8c,kBACnS,kBAAC,IAAD,CAAOjZ,KAAK,iCAAkC+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAuBppB,QAAS,EAAKK,MAAML,QAAS6T,KAAM,EAAKxT,MAAMwT,KAAKkB,kBAAmBuQ,cAAe,EAAKjlB,MAAMwT,KAAK4U,UAAUrD,gBAAkB,EAAK/kB,MAAMwT,KAAK4U,UAAUrD,gBAAgBE,cAAgB,UAC9Q,kBAAC,IAAD,CAAOjkB,KAAK,2BAAmC+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAiBvV,KAAM,EAAKxT,MAAMwT,KAAK2V,iBAAmB,EAAKnpB,MAAMwT,KAAK2V,iBAAmB,GAAIxpB,QAAS,EAAKK,MAAML,aAClL,kBAAC,IAAD,CAAOqB,KAAK,yBAAoC+nB,OAAQ,kBAAM,kBAAC,GAAe,EAAK/oB,UACnF,kBAAC,IAAD,CAAmB+oB,OAAQ,kBAAM,kBAAC,GAAD,mB,GAzJzBlrB,aAwKXurB,eAAWjB,IC5/BtBkB,GADY,21CACO/sB,MAAM,MAE7B,SAASgtB,KAEP,IADA,IAAI7J,EAAM,GACFljB,EAAI,EAAGA,EAAI,IAAKA,IACtBkjB,EAAIhZ,KAAK4iB,GAAOxR,KAAKe,MAAMf,KAAK2G,SAAW6K,GAAO7sB,SAAW,MAE/D,OAAOijB,EAAI/c,KAAK,I,IASZ6mB,G,kDACJ,WAAYpsB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXwpB,WAAYF,MAEd,EAAKG,kBAAoB,KALR,E,+DASjBpsB,KAAKqD,SAAS,CACZ8oB,WAAYF,S,6CAKdtsB,OAAO0sB,cAAcrsB,KAAKosB,qB,2CAI1BpsB,KAAKosB,kBAAoBzsB,OAAO2sB,YAAYtsB,KAAKusB,iBAAiBvoB,KAAKhE,MAAO,O,+BAK9E,OACE,yBAAKC,UAAU,sBACZD,KAAK2C,MAAMwpB,gB,GA3BY3rB,aAiC1BgsB,G,kDACJ,WAAY1sB,GAAQ,uCACZA,G,qDAIN,OACE,yBAAK8N,MAAM,sBACT,yBAAKA,MAAM,UACT,yCAEF,yBAAKA,MAAM,QACT,yBAAK3N,UAAU,mBAAkB,uBAAGA,UAAU,0BAA9C,cACA,0BAAM4L,OAAO,oBAAoBsH,OAAO,QACtC,6BACE,2CACA,2BAAOmW,KAAK,OAAO3qB,KAAK,WAAW8tB,UAAU,YAAY5mB,YAAY,cAEvE,6BACE,wCACA,2BAAOyjB,KAAK,QAAQ3qB,KAAK,QAAQkH,YAAY,QAAQL,SAAS,cAEhE,6BACE,2CACA,2BAAOlE,GAAG,WAAWgoB,KAAK,WAAW3qB,KAAK,WAAWkH,YAAY,WAAWL,SAAS,aACrF,wDACA,2BAAOlE,GAAG,wBAAwBgoB,KAAK,WAAW3qB,KAAK,wBAAwB6G,SAAS,WAAWK,YAAY,2BAEjH,yBAAK+H,MAAM,WACT,6BAAK,kBAAC,IAAD,CAAMA,MAAM,cAAcrM,GnBxF5B,KmBwF0C,uBAAGqM,MAAM,uBAAjD,kBACL,6BACE,2BAAO0b,KAAK,SAASzlB,MAAM,sB,GA/BZrD,aAyCzBksB,G,kDACJ,WAAY5sB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXmgB,MAAO,GACP6J,SAAU,GACVzN,MAAO,KACP0N,aAAc,MANC,E,iEAUE9rB,GACnBd,KAAKqD,SAAS,CACZyf,MAAOhiB,EAAE8C,OAAOC,U,2CAIC/C,GACnBd,KAAKqD,SAAS,CACZspB,SAAU7rB,EAAE8C,OAAOC,U,iCAIZ/C,GAAI,IAAD,OACZA,EAAE6E,iBACF2D,QAAQC,IAAIzI,GACZ,IAEMoc,EAAkB,CACtB/J,OAAQ,OACRC,QAAS,CACP,OAAU,mBACV,eAAgB,mBAChB,aAPc1U,EAAU,eAS1B4X,SAAU,OACVrK,KAAM4P,KAAKsB,UAAU,CACnB2F,MAAO9iB,KAAK2C,MAAMmgB,MAClB6J,SAAU3sB,KAAK2C,MAAMgqB,WAEvBnN,YAAa,WAIfxf,KAAKqD,SAAS,CACZupB,aAAc,KACdtqB,SAAS,IACR,kBAED3C,OAAOmE,YAAY,WAEjB2X,MAAM,wCAAyCyB,GAC9C7I,KADD,uCACM,WAAOqH,GAAP,eAAAiE,EAAA,yDACmB,MAApBjE,EAASC,OADR,gCAEYD,EAASmR,OAFrB,aAEE5f,EAFF,OAGI,IAAI2O,MAAM3O,EAAEuH,SAHhB,gCAKGkH,EAAS/Q,QALZ,2CADN,uDAQC0J,MAAK,SAAC8B,GACL,IACE,IAAIlJ,EAAI4O,KAAKC,MAAM3F,GACnB,MAAMQ,GAEN,MADArN,QAAQC,IAAIoN,EAAK1J,GACX,IAAI2O,MAAM,mCAGlB,EAAK9b,MAAMgtB,YAAY7f,MACtB0P,OAAM,SAAChG,GACR,EAAKtT,SAAS,CACZupB,aAAcjW,EAAInC,QAClBmY,SAAU,GACVrqB,SAAS,SAGZ,Q,+BAML,OACE,yBAAKsL,MAAO,sBAAwB5N,KAAK2C,MAAML,QAAU,WAAa,KACpE,yBAAKsL,MAAM,UACT,sCAEF,yBAAKA,MAAM,QACT,yBAAK3N,UAAU,mBAAkB,uBAAGA,UAAU,0BAA9C,cACED,KAAK2C,MAAMiqB,cAAgB,yBAAK3sB,UAAU,iBAAgB,0BAAMA,UAAU,SAAhB,WAAuCD,KAAK2C,MAAMiqB,aAAjF,KAE7B,0BAAM5e,SAAUhO,KAAK+sB,WAAW/oB,KAAKhE,MAAOmT,OAAO,QACjD,6BACE,oDACA,2BAAOmW,KAAK,OAAO3qB,KAAK,QAAQ8tB,UAAU,YAAYjnB,SAAS,WAAWK,YAAY,oBAAoBhC,MAAO7D,KAAK2C,MAAMmgB,MAAO9c,SAAUhG,KAAKgtB,qBAAqBhpB,KAAKhE,SAE9K,6BACE,2CACA,2BAAOspB,KAAK,WAAW3qB,KAAK,WAAW6G,SAAS,WAAWK,YAAY,WAAWhC,MAAO7D,KAAK2C,MAAMgqB,SAAU3mB,SAAUhG,KAAKitB,qBAAqBjpB,KAAKhE,SACnJ,kBAAC,IAAD,CAAM4N,MAAM,uBAAuBrM,GAAImM,oBAAvC,oBACN,yBAAKE,MAAM,WACT,6BAAK,kBAAC,IAAD,CAAMA,MAAM,cAAcrM,GnBxM5B,KmBwM0C,uBAAGqM,MAAM,uBAAjD,kBACL,6BACE,2BAAO0b,KAAK,SAASzlB,MAAM,mB,GAtGfrD,aAiHtB0sB,G,kDACJ,WAAYptB,GAAQ,uCACZA,G,qDAIN,OACE,yBAAK8N,MAAM,sBACT,yBAAKA,MAAM,UACT,gDAEF,yBAAKA,MAAM,QACT,0BAAM/B,OAAO,2BAA2BsH,OAAO,QAC7C,2BAAOmW,KAAK,SAAS3qB,KAAK,QAAQkF,MAAM,yCACxC,6BACE,wCACA,2BAAOylB,KAAK,QAAQ3qB,KAAK,QAAQkH,YAAY,QAAQL,SAAS,WAAWinB,UAAU,eAErF,yBAAK7e,MAAM,WACT,6BAAK,kBAAC,IAAD,CAAMA,MAAM,cAAcrM,GAAImM,UAAoB,uBAAGE,MAAM,uBAA3D,kBACL,6BACE,2BAAO0b,KAAK,SAASzlB,MAAM,4B,GArBNrD,aA+B/B2sB,G,kDACJ,WAAYrtB,GAAQ,uCACZA,G,qDAIN,OACE,yBAAKG,UAAU,iBACb,wBAAIqB,GAAG,aAAa8rB,eAAa,WAAjC,WACA,wBAAI9rB,GAAG,YAAY8rB,eAAa,iCAAhC,iCACA,yBAAKxf,MAAM,WAAU,kBAAC,IAAD,CAAMrM,GAAImM,aAC3B,yBAAKE,MAAM,SAAStM,GAAG,mBACrB,0CAGW,kBAAC,IAAD,CAAMC,GAAImM,UACvB,yBAAKE,MAAM,SAAStM,GAAG,gBACrB,6C,GAjBad,aA6BrB6sB,G,kDACJ,WAAYvtB,GAAQ,uCACZA,G,qDAEE,IAAD,OAEHwqB,EAAWtqB,KAAKF,MAAMwqB,SAE1B,OAEE,6BAAShpB,GAAG,WACV,kBAAC,GAAD,MAEA,kBAAC8pB,GAAA,EAAD,CAAiBnrB,UAAU,oBACzB,kBAACorB,GAAA,EAAD,CACAxpB,IAAKyoB,EAASzoB,IACdypB,QAAS,CAAEC,MAAO,IAAKC,KAAK,KAC5BC,WAAW,QAET,6BAASxrB,UAAU,wCAClB,kBAAC,IAAD,CAAQqqB,SAAUA,GAEf,kBAAC,IAAD,CAAO3mB,KAAK,SAAY+nB,OAAQ,kBAAM,kBAAC,GAAD,CAAeoB,YAAa,EAAKhtB,MAAMgtB,iBAC7E,kBAAC,IAAD,CAAOnpB,KAAK,YAAY2pB,UAAWd,KACnC,kBAAC,IAAD,CAAO7oB,KAAK,mBAAmB2pB,UAAWJ,KAC1C,kBAAC,IAAD,CAAOvpB,KAAK,IAAY2pB,UAAWH,c,GAzB5B3sB,aAwCRurB,eAAWsB,I,oBCzSXE,G,kDAXb,WAAYztB,GAAQ,uCACZA,G,qDAIN,OACE,0BAAMG,UAAU,YAAYgC,QAASjC,KAAKF,MAAMmC,SAAU,uBAAGhC,UAAU,6BAA+B,0BAAMA,UAAU,QAAhB,a,GAPvEO,aC6EtBgtB,G,kDA5Eb,WAAY1tB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACX8qB,KAAM,KACNC,SAAU,KACVC,cAAc,GALC,E,+DASApqB,EAAWC,GACxBuE,IAAEC,QAAQxE,EAAUkqB,SAAU1tB,KAAK2C,MAAM+qB,WAC3C1tB,KAAKF,MAAM8tB,WAAW5tB,KAAK2C,MAAM8qB,MAE/BlqB,EAAUsqB,WAAa7tB,KAAKF,MAAM+tB,UAAa7tB,KAAKF,MAAM+tB,UAC5D7tB,KAAKqD,SAAS,CACZsqB,cAAc,M,0EAKH7sB,G,+EACfwI,QAAQC,IAAIzI,EAAE8C,OAAOkqB,MAAM,IACvBhtB,EAAE8C,OAAOkqB,MAAM,G,iDAEnB9tB,KAAKqD,SAAS,CACZoqB,KAAM3sB,EAAE8C,OAAOkqB,MAAM,GACrBJ,SAAU5sB,EAAE8C,OAAOkqB,MAAM,GAAGnvB,KAC5BgvB,cAAc,IACb,WACD,EAAK7tB,MAAM8tB,WAAW,EAAKjrB,MAAM8qB,S,sIAI3B,IAAD,OACP,OACE,yBAAKxtB,UAAU,yBACb,yBAAKA,UAAW,gBAAkBD,KAAKF,MAAMiuB,cAAgB,QAAU,KAAS/tB,KAAKF,MAAM+tB,WAAa7tB,KAAK2C,MAAMgrB,aAAgB,QAAU,KAE3I,2BAAOnoB,UAAWxF,KAAKF,MAAMiuB,cAAezE,KAAK,OAAOhoB,GAAG,iBAAiB3C,KAAK,iBAAiBqH,SAAU,SAAClF,GAAD,OAAO,EAAK8sB,WAAW9sB,MACnI,2BAAOktB,QAAQ,kBAEXhuB,KAAKF,MAAMyO,OACX,0BAAMtO,UAAU,UAAS,uBAAGA,UAAU,gCAAtC,gBACED,KAAKF,MAAM+tB,WAAa7tB,KAAK2C,MAAMgrB,aACnC,0BAAM1tB,UAAU,UAAS,uBAAGA,UAAU,0BAAtC,oCAAmG,6BAAK,4BAAKD,KAAK2C,MAAM+qB,UAAxH,KACC1tB,KAAKF,MAAMiuB,cAER,8BACE,0BAAM9tB,UAAU,UAAS,4BAAKD,KAAKF,MAAMiuB,cAAc,GAAG,IAA1D,2BACA,2BAAO9tB,UAAU,iBACf,+BACED,KAAKF,MAAMiuB,cAAczqB,MAAM,EAAGtD,KAAKF,MAAMiuB,cAAc5uB,QAAQuC,KAAI,SAACyB,EAAMvB,GAAP,OACvE,wBAAIC,IAAKD,GAAO,4BAAKuB,EAAK,GAAV,KAAmB,4BAAKA,EAAK,WAMpDnD,KAAK2C,MAAM+qB,SACT,8BAAM,uBAAGztB,UAAU,0BAAnB,mBAA+D,4BAAKD,KAAK2C,MAAM+qB,UAA/E,KACD,8BAAM,uBAAGztB,UAAU,2BAAnB,0BAAwED,KAAKF,MAAMnB,KAAOqB,KAAKF,MAAMnB,KAAO,UAA5G,Y,GA7DS6B,aCmIdytB,G,kDA7Hb,WAAYnuB,GAAQ,IAAD,8BACjB,cAAMA,IACD6C,MAAQ,CACXwT,KAAM,CACJpU,aAAc,GACdmsB,oBAAqB,GACrBC,QAAS,OANI,E,gEAajBnuB,KAAKqD,SAAS,CACZ8S,KAAMnW,KAAKF,MAAMqW,S,yCAYF5S,EAAWC,GAOxBuE,IAAEC,QAAQhI,KAAKF,MAAMqW,KAAMnW,KAAK2C,MAAMwT,OAAUpO,IAAEC,QAAQxE,EAAU2S,KAAMnW,KAAK2C,MAAMwT,OACvFnW,KAAKF,MAAMsuB,mBAAmBpuB,KAAK2C,MAAMwT,KAAM,CAAEkY,YAAY,M,wCAI/CvtB,GAChB,IAAI+C,EAAQ/C,EAAE8C,OAAOC,MACM,IAAxBA,EAAMzE,OAAOD,SAAc0E,EAAQ,IACtC7D,KAAKqD,SAAS,CACZ8S,KAAK,6BAAMnW,KAAK2C,MAAMwT,MAAlB,IAAwBpU,aAAc8B,Q,+CAIrB/C,GACvB,IAAI+C,EAAQ/C,EAAE8C,OAAOC,MACM,IAAxBA,EAAMzE,OAAOD,SAAc0E,EAAQ,IACtC7D,KAAKqD,SAAS,CACZ8S,KAAK,6BAAMnW,KAAK2C,MAAMwT,MAAlB,IAAwB+X,oBAAqBrqB,Q,oCAIvC4pB,GAAO,IAAD,OAClBztB,KAAKqD,SAAS,CACZ8S,KAAK,6BAAMnW,KAAK2C,MAAMwT,MAAlB,IAAwBgY,QAASV,MACpC,WACDnkB,QAAQC,IAAI,WACZ,EAAKzJ,MAAMsuB,mBAAmB,EAAKzrB,MAAMwT,KAAM,CAAEkY,YAAY,S,+BAIvD,IAAD,OAEHC,EAAY,6BACZ,oCACA,8GAEA,4BACE,4BAAI,uCAAJ,kJACA,8CAAmB,oDAAnB,kGAMN,OACE,6BAEE,yBAAKruB,UAAU,+BAEb,yBAAKA,UAAU,eACb,+CAEA,yBAAKA,UAAW,cAAgBD,KAAKF,MAAMyuB,WAAW9pB,IAAI,gBAAkB,SAAW,KACrF,+CACA,2BAAOe,UAAQ,EACRC,UAAW,SAAC3E,GAAD,OAAmB,IAAbA,EAAE4E,QAAgB5E,EAAE6E,iBAAkB,IACvDI,UAAW,IACXF,YAAY,eACZhC,MAAO7D,KAAK2C,MAAMwT,KAAKpU,cAAgB,GACvCiE,SAAU,SAAClF,GAAD,OAAO,EAAK0tB,kBAAkB1tB,OAGjD,yBAAKb,UAAW,cAAgBD,KAAKF,MAAMyuB,WAAW9pB,IAAI,uBAAyB,SAAW,KAC5F,iEACA,8BAAUsB,UAAW,IACXF,YAAY,sBACZhC,MAAO7D,KAAK2C,MAAMwT,KAAK+X,qBAAuB,GAC9CloB,SAAU,SAAClF,GAAD,OAAO,EAAK2tB,yBAAyB3tB,QAI7D,yBAAKb,UAAU,eACb,oCAAS,kBAAC,GAAD,CAAwBgC,QAAS,kBAAM,EAAKnC,MAAM4uB,eAAeJ,OAG1E,kBAAC,GAAD,CACE/f,OAAQvO,KAAKF,MAAMyO,SAAWvO,KAAKF,MAAMqW,KAAK4X,cAC9CF,SAAU7tB,KAAKF,MAAMyuB,YAAcvuB,KAAKF,MAAMyuB,WAAW9pB,IAAI,WAC7DmpB,WAAY5tB,KAAK2uB,cAAc3qB,KAAKhE,MACpC+tB,cAAe/tB,KAAKF,MAAMqW,KAAK4X,uB,GAjHbvtB,aC4VjBouB,GAnWQ,CAEnB,CACE,KAAQ,iCACR,SAAY,CACN,SACA,eACA,WACA,kBAGR,CACE,KAAQ,0CACF,SAAY,CACZ,SACA,eACA,mBACA,gBACA,iBACA,gBACA,eACA,kBACA,gBACA,kBACA,iBACA,kBACA,oBACA,0BACA,iBACA,mBACA,eACA,uBACA,uBACA,uCACA,mCACA,6BACA,2BACA,sCACA,iCACA,0BACA,+BACA,sCACA,wBACA,2BACA,WACA,gBACA,mBACA,kBACA,oBACA,mBACA,gBACA,kBACA,yBACA,kBACA,oBACA,mBACA,uBACA,oBACA,gBACA,UACA,iBACA,mBACA,cACA,eACA,qBACA,gBACA,iBACA,uBACA,mBACA,mBACA,eACA,qBACA,iBACA,MACA,WACA,WACA,mBACA,gBACA,YACA,QACA,eACA,iBACA,gBACA,0BACA,yBACA,qBACA,yBACA,iBACA,gBACA,YACA,iBACA,cACA,gBACA,sBACA,mBACA,wBACA,gBACA,OACA,QACA,QACA,qBACA,QACA,MACA,YACA,WACA,WACA,MACA,iBACA,mBACA,oBACA,UACA,UACA,OACA,YACA,eACA,SACA,OACA,UACA,oBACA,oBACA,aACA,WACA,iBACA,YACA,uBACA,iBACA,iBAGR,CACE,KAAQ,0BACR,SAAY,CACN,OACA,WACA,WACA,OACA,YACA,cACA,QACA,aACA,cACA,6BACA,2BACA,0BACA,YACA,QACA,SACA,OACA,gBAEN,aAAgB,CACV,KAAQ,sBACR,WAAc,4FACd,SAAY,6BACZ,6BAA8B,iFAC9B,0BAA2B,uBAC3B,2BAA4B,iDAC5B,SAAY,kEACZ,UAAa,oFACb,UAAa,mFACb,MAAS,wCACT,YAAe,wDACf,KAAQ,qFACR,MAAS,yFACT,KAAQ,2BACR,OAAU,+CACV,aAAgB,wBAIxB,CACE,KAAQ,mBACR,SAAY,CAEN,iBACA,gCACA,gCACA,sBACA,wCACA,wCACA,+BACA,4BACA,0BACA,kCACA,+BACA,iCACA,WACA,mBACA,mBACA,mBACA,YACA,sBACA,sBACA,sBACA,sBACA,sBACA,uBACA,YACA,gBACA,sBACA,iCACA,kCACA,qBACA,6BACA,+BACA,gCACA,2BACA,sCACA,uCACA,yBACA,0BACA,yBACA,uCACA,wCACA,sBACA,iCACA,kCACA,iBACA,4BACA,4BACA,iBACA,uBACA,yBACA,uBACA,kBACA,iBACA,qBACA,8BACA,+BACA,qBACA,8BACA,+BACA,uBACA,sBACA,gBACA,sBACA,iCACA,kCACA,qBACA,+BACA,gCACA,qBACA,+BACA,gCACA,0BACA,qBACA,+BACA,gCACA,yBACA,0BACA,sBACA,iCACA,kCACA,iBACA,YACA,sBACA,iBACA,mBACA,2BACA,kBACA,kBACA,mBACA,sBACA,kBACA,iCACA,uCACA,0DACA,0CACA,yCACA,sCACA,gDACA,sCACA,0CACA,iBACA,SACA,gBACA,cACA,SACA,oBACA,cACA,iBACA,2BACA,cACA,4BACA,2BACA,yBACA,sBACA,qBACA,kCACA,kBACA,wBACA,oBACA,8BACA,2BACA,gBACA,uBACA,uBACA,kBACA,kBACA,8BACA,WACA,+BACA,mBACA,kBACA,SACA,qBACA,iBACA,qBACA,cACA,oBACA,iBACA,gBACA,2BACA,kBACA,gBACA,oBACA,wBACA,oBACA,kBACA,kBACA,mBACA,wBACA,sBACA,iB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","file":"static/js/main.a9c02b74.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/redcoat-1-grey.fd5c7c00.png\";","// Function for getting value from a cookie\nfunction getCookie(name) {\n    let cookieValue = undefined;\n    if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n            const cookie = cookies[i].trim();\n            // Does this cookie string begin with the name we want?\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\nexport default getCookie;","import { useEffect } from \"react\";\nimport { useLocation } from \"react-router-dom\";\n\nexport default function ScrollToTop() {\n  const { pathname } = useLocation();\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [pathname]);\n\n  return null;\n}","import React from 'react';\nimport {Component} from 'react';\n\nclass ProfileIcon extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t}\n\n\trender() {\n\t\tvar user = this.props.user;\n\t\tif(!user) {\n\t\t\treturn (\n\t\t\t\t<div className={\"circle-icon profile-icon \" + (this.props.size || \"small\")}style={{'background': \"#ddd\"}}></div>\n\t\t\t)\n\n\t\t}\n\t\treturn (\n\t\t\t<div className={\"circle-icon profile-icon \" + (this.props.size || \"small\")}style={{'background': user.profile_icon.background}}>\n\t\t\t\t<i className={\"profile-icon-i fa fa-\" + user.profile_icon.icon} style={{'color': user.profile_icon.foreground}}></i>\n            </div>\n        )\n\t}\n\n}\n\nexport default ProfileIcon;","import React from \"react\";\nimport { Link, Switch, Route, withRouter } from \"react-router-dom\";\nimport {Component} from 'react';\nimport logo from 'favicon.png'\nimport $ from 'jquery';\n\nimport ProfileIcon from './ProfileIcon';\nimport BASE_URL from 'globals/base_url';\n\n\n//  $(\"#invitations-menu > *\").click(function(e) {\n//    $invitationsButton.focus();\n//  });\n\n// The navbar, which appears at the top of the page.\nclass Navbar extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n\n  componentDidUpdate() {\n    // Make sure the invitations menu stays open when clicking a child of it\n    // Probably better to do this without jquery but oh well\n    $(\"#invitations-menu > *\").prop('onclick', null).off('click');\n    $(\"#invitations-menu > *\").click(function(e) {\n      $(\"#invitations-button\").focus();\n    });\n  }\n\n \n\n  render() {\n    \n    if(this.props.user && this.props.user.project_invitations) {\n      var invitations = this.props.user.project_invitations;\n      var outstandingInvitationNum = 0;\n      for(var inv of invitations) {\n        if(!inv.accepted && !inv.declined) outstandingInvitationNum++;\n      }\n    }\n\n\n    return (\n      <nav id=\"navbar\">\n        <div className=\"navbar-left\">\n          <div id=\"logo\">\n            <Link to={BASE_URL}>             \n              <img src={logo}/> <span className=\"text\">Redcoat</span>         \n            </Link>\n          </div>\n          { this.props.user && \n            <div className=\"dropdown-menu\">\n              <button>Projects</button>\n              <ul className=\"dropdown-menu-items\">\n                <li><Link to={\"\" + BASE_URL + \"projects\"}>Projects list</Link></li>\n                <li><Link to={\"\" + BASE_URL + \"projects/new\"}>New project</Link></li>\n              </ul>\n            </div>\n          }\n   \n        </div>\n        <div className=\"navbar-centre\"></div>\n        <div className=\"navbar-right\">\n\n          { this.props.user && \n\n            <div className={\"dropdown-menu invitations\" + (outstandingInvitationNum === 0 ? \" inactive\": \"\")} id=\"invitations-menu\">\n              <button id=\"invitations-button\"><i className=\"fa fa-envelope\"></i>{outstandingInvitationNum > 0 && <span className=\"invites-count\" id=\"invites-count\">{outstandingInvitationNum}</span>}</button>\n\n              { this.props.user.project_invitations && invitations.length > 0 ? \n\n                <ul className=\"dropdown-menu-items\">\n                {invitations.map((invite, index) => \n\n                  <li key={index}>\n                    <span className=\"invite\">\n                      <span className=\"link\">{invite.inviting_user_username}</span> has invited you to annotate <span className=\"link\">{invite.project_name}</span>.\n\n                      { !invite.accepted && !invite.declined && !invite.pending &&\n                        <div className=\"invite-form\">\n                          <button className=\"accept\" onClick={() => this.props.acceptInvitation(index)}>Accept</button>\n                          <button className=\"decline\" onClick={() => this.props.declineInvitation(index)}>Decline</button>\n                        </div>                        \n                      }\n                      {\n                        invite.pending && \n                        <div className=\"invite-form-loading\">\n                          <span><i className=\"fa fa-cog fa-spin\"></i>&nbsp;Loading...</span>\n                        </div>\n                      }\n\n                      { invite.accepted && \n\n                        <div className=\"invite-form-accepted\">\n                          <span><i className=\"fa fa-check\"></i>&nbsp;Invitation accepted! <Link to={\"\" + BASE_URL + \"projects/\" + invite.project_id + \"/dashboard\"}>(Go to project)</Link></span>\n                        </div>\n                      }\n                      { invite.declined && \n                      <div className=\"invite-form-declined\">\n                        <span><i className=\"fa fa-close\"></i>&nbsp;Invitation declined.</span>\n                      </div>\n                      }\n                    </span>\n                  </li>\n                  \n\n                 )\n\n                }\n                </ul>\n\n                :\n                <ul className=\"dropdown-menu-items\">\n                  <li><span className=\"invite\">You have no active invitations.</span></li>\n                </ul>\n              }\n\n            </div>\n\n\n          }\n\n\n          { this.props.user &&\n\n\n\n            <div className=\"dropdown-menu\">\n              <button className=\"flex\"><ProfileIcon user={this.props.user}/><span>Logged in as {this.props.user.username}</span></button>\n              <ul className=\"dropdown-menu-items\">\n                <li><Link to={\"\" + BASE_URL + \"profile\"}>Profile</Link></li>\n                <li><Link to={\"\" + BASE_URL + \"logout\"}>Logout</Link></li>\n              </ul>\n            </div>\n          }\n\n          { !this.props.user && \n\n\n\n            <div className=\"dropdown-menu log-in\">\n              <button>Not logged in&nbsp;&nbsp;<i className=\"fa fa-xs fa-chevron-down\"></i></button>\n              <ul className=\"dropdown-menu-items\">\n                <li><Link to={\"\" + BASE_URL + \"login\"}>Login</Link></li>\n                <li><Link to={\"\" + BASE_URL + \"register\"}>Register</Link></li>\n              </ul>\n            </div>\n          }\n\n          {!this.props.loading && <div className=\"dropdown-menu short\">\n            <Link to={\"\" + BASE_URL + \"features\"}>v2.0a</Link>\n          </div> }\n        </div>\n        {!this.props.loading && <header className=\"decorative-bar\"></header>}\n      </nav>\n    )\n  }\n}\n\nexport default Navbar;","const BASE_URL = \"/\";\nexport default BASE_URL;","import React from 'react';\nimport {Component} from 'react';\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\nimport styled from 'styled-components';\nimport _ from 'underscore';\n\nconst numEntityColours = 12;\n\nclass NewCategoryButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <li className=\"new-category\">\n        <span className=\"inner-container\">\n          <span className={\"category-name\" + (this.props.disabled ? \" disabled\" : \"\")} onClick={this.props.newItem} ><i className=\"fa fa-plus\"></i>New Category</span>\n        </span>\n      </li>\n    )\n  }\n}\n\n// A single category in the category hierarchy tree.\nclass Category extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isHovered: false,\n      name: '',\n    }\n    this.nameInputRef = React.createRef();\n\n    this.changeNameTimeoutFn = null;\n    this.nameCanUpdateTimeoutFn = null;\n    this.nameCanUpdate = true; // Whether the name can be updated via props\n  }\n\n  componentDidMount() {\n    if(this.props.item.name.length === 0) {\n      this.nameInputRef.current.focus();\n    }\n    this.setState({\n      name: this.props.item.name.slice(),\n    })\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if((prevProps.item.name !== this.state.name) && (prevState.name === this.state.name) && this.nameCanUpdate) {\n      this.setState({\n        name: this.props.item.name.slice(),\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    if(this.changeNameTimeoutFn) window.clearTimeout(this.changeNameTimeoutFn);\n    if(this.nameCanUpdateTimeoutFn) window.clearTimeout(this.nameCanUpdateTimeoutFn);  \n  }\n\n  setHovered(hovered) {\n    this.setState({\n      isHovered: hovered\n    })\n  }\n\n\n  // The parent component will only update 1 second after the user stops typing.\n  itemNameChange(e, path) {\n    var name = e.target.value;\n\n    function nameCanUpdate() {\n      this.nameCanUpdate = true;\n    }\n\n    //console.log(e, path);\n    this.setState({\n      name: name,\n    }, () => {\n      if(this.changeNameTimeoutFn) window.clearTimeout(this.changeNameTimeoutFn);\n      this.changeNameTimeoutFn = window.setTimeout( this.props.itemNameChange, 1000, name, path);\n\n      this.nameCanUpdate = false;\n      if(this.nameCanUpdateTimeoutFn) window.clearTimeout(this.nameCanUpdateTimeoutFn);      \n      this.nameCanUpdateTimeoutFn = window.setTimeout( nameCanUpdate.bind(this), 1000);\n\n      this.props.userIsModifying();\n\n    });\n    //this.props.itemNameChange(e, path)\n  }\n  render() {\n    var item = this.props.item;\n    var index = this.props.index;\n    var children = this.props.item.children;\n    var colorId = item.colorId;\n    var modifiable = this.props.modifiable;\n\n    var path = this.props.path; \n\n    if(this.props.colorByIndex) {\n      colorId = index;\n    }\n\n    // If this component has any children, render each of them.\n    if(children) {\n      var childItems = (\n        <ul className={this.props.open ? \"\" : \"hidden\"}>\n          { children.map((item, index) => (\n            <Category key={index}\n                      item={item}\n                      open={this.props.openedItems.has(item.full_name)}\n                      isTopLevelCategory={false}\n                      path={this.props.path.concat([index])}\n\n                      openedItems={this.props.openedItems}\n                      onClick={this.props.onClick}\n                      hotkeyMap={this.props.hotkeyMap}\n                      hotkeyChain={this.props.hotkeyChain}                      \n                      applyTag={this.props.applyTag}\n                      colorByIndex={this.props.colorByIndex}\n                      modifiable={this.props.modifiable}\n                      itemNameChange={this.props.itemNameChange}\n                      itemDescChange={this.props.itemDescChange}\n                      deleteItem={this.props.deleteItem}\n                      newItem={this.props.newItem}         \n                      userIsModifying={this.props.userIsModifying}             \n            />)) }\n        </ul>\n      );\n    } else {\n      var childItems = '';\n    }\n\n    // Determine whether this category has a hotkey (by checking hotkeyMap).\n    // Also determine hotkeyStr (for example '12' for 'item/pump').\n    if(this.props.hotkeyMap) {\n      var hasHotkey = this.props.hotkeyMap.hasOwnProperty(this.props.item.full_name)\n      var hotkeyStr = hasHotkey ? this.props.hotkeyMap[this.props.item.full_name].join('') : '';\n    } else {\n      hasHotkey = false;\n      hotkeyStr = '';\n    }\n    \n\n    var content = (\n      <span className=\"inner-container\">\n\n        <span className=\"left\">\n        \n         {(children || modifiable) && <span className={\"open-button\" + (children ? \"\" : \" no-children-yet\") + (item.name.length > 0 ? \"\" : \" hidden\")} onClick={() => this.props.onClick(item.full_name)}><i className={\"fa fa-chevron-\" + (this.props.open ? \"up\" : \"down\")}></i></span>}\n\n        <span className={\"category-name\" + (hasHotkey ? \" has-hotkey\" :\"\") + (modifiable ? \" modifiable\" :\"\") + (this.props.hotkeyChain === hotkeyStr ? \" hotkey-active\" : \"\")}\n              data-hotkey-id={hotkeyStr} onClick={this.props.applyTag ? () => this.props.applyTag(this.props.item.full_name) : null}>\n            { modifiable ? <input required onKeyDown={(e)=> e.keyCode == 13 ? e.preventDefault(): ''} className={this.state.name.length === 0 ? \"empty\" : (this.props.errorEntityNames && this.props.errorEntityNames.has(item.full_name) ? \" error\" : \"\")}\n                placeholder=\"(no name)\" ref={this.nameInputRef} maxLength={50}\n                value={this.state.name} onChange={(e) => this.itemNameChange(e, path)} /> : item.name}\n        </span>\n        \n        </span>\n        <span className=\"right\">\n        { <span className={\"description\" + (modifiable ? \" modifiable\" : \"\")}>\n          {modifiable ? <input maxLength={100} onKeyDown={(e)=> e.keyCode == 13 ? e.preventDefault(): ''} value={item.description || \"\"} onChange={(e) => this.props.itemDescChange(e, path)} placeholder=\"(no description)\"/> : (item.description || \"\") }\n        </span>}\n        </span>\n        { modifiable && <span className=\"delete-button-container\"><span className=\"delete-button\" onClick={() => {this.setHovered(false); this.props.deleteItem(path)}} onMouseEnter={() => this.setHovered(true)} onMouseLeave={() => this.setHovered(false)}><i className=\"fa fa-trash\"></i></span></span>}\n      </span>      \n    )\n\n\n    // This component will render differently depending on whether it is a top-level category or not.\n    // Top level categories have the drag handle, which requires a different configuration on the wrapper and li.\n    if(this.props.isTopLevelCategory) {\n\n\n      if(this.props.draggable) {\n        return (\n          <Draggable key={item.id.toString()} draggableId={item.id.toString()} index={index}>\n            {(provided, snapshot) => (\n              <li  ref={provided.innerRef} {...provided.draggableProps} className={\"draggable \" + (snapshot.isDragging ? \"dragging\": \"not-dragging\") + \" color-\" + ((parseInt(colorId) % numEntityColours) + 1) + (this.state.isHovered ? \" delete-hover\" : \"\")}>\n                <div {...provided.dragHandleProps} className=\"drag-handle-container\"><span className=\"drag-handle\"></span></div>\n                \n                { content }\n                { childItems }\n\n\n                { this.props.open && this.props.modifiable && <ul><NewCategoryButton newItem={() => this.props.newItem(path)}/></ul>}\n                \n              </li>              \n            )}\n          </Draggable>\n        )\n      } else {\n        return (\n          <li className={\" color-\" + ((parseInt(colorId) % numEntityColours) + 1) + (this.state.isHovered ? \" delete-hover\" : \"\")}>\n            { content }\n            { childItems }  \n            { this.props.open && this.props.modifiable && <ul><NewCategoryButton newItem={() => this.props.newItem(path)}/></ul>}              \n          </li>\n        )\n      }\n\n\n    } else {\n      return (\n        <li className={(this.state.isHovered ? \" delete-hover\" : \"\")}>\n          { content }\n          { childItems }\n          { this.props.open && this.props.modifiable && <ul><NewCategoryButton newItem={() => this.props.newItem(path)}/></ul>}\n        </li>\n      )\n    }\n  }\n}\n\n\n\n// https://codesandbox.io/s/k260nyxq9v?file=/index.js:154-2795\n// a little function to help us with reordering the result\nconst reorder = (list, startIndex, endIndex) => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n\n  return result;\n};\n\n// Retrieve a list of ordered items based on an order array.\nfunction getOrderedItems(items, order) {\n  var orderedItems = new Array(items.length);\n  for(var i = 0; i < order.length; i++) {\n    orderedItems[i] = items[order[i]];\n  }\n  return orderedItems;\n}\n\nfunction setupItemOrder(items) {\n  var itemOrder = new Array(items.length);\n  for(var i = 0; i < itemOrder.length; i++) {\n    itemOrder[i] = i;\n  }\n  return itemOrder;\n}\n\n\n// The category hierarchy (on the left).\nclass CategoryHierarchy extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      itemOrder: [],      // An array that maintains the ordering of the top-level categories.\n                          // e.g. [0, 1, 3, 2]\n      orderedItems: [],\n      openedItems: new Set(),    // An set keep track of the items that have been open (indexed by name).\n    }\n    this.onDragEnd = this.onDragEnd.bind(this);\n  }\n\n  // When this component's items changes (should be when a new docGroup has been requested), setup a new itemOrder state.\n  // (which defaults to ascending order e.g. 0, 1, 2, 3, 4 ...)\n  componentDidUpdate(prevProps, prevState) {\n    var itemOrder = setupItemOrder(this.props.items);\n    if(!_.isEqual(prevProps.items, this.props.items)) {\n      this.setState({\n        openedItems: new Set(),\n        orderedItems: this.props.items,\n        itemOrder: itemOrder,\n      });      \n    }\n  }\n\n  componentWillMount() {\n    var itemOrder = setupItemOrder(this.props.items);\n\n    this.setState({\n      openedItems: new Set(),\n      orderedItems: this.props.items,\n      itemOrder: itemOrder,\n    });   \n  }\n\n  // Open or close a category.\n  // It's pretty awkward that this function is necessary. It would be ideal to store 'open' as a state variable inside the Category and Subcategory\n  // components, but that results in the wrong categories being open when the top-level categories are moved around.\n  // Storing them in the openedItems array in this component's state allows for the opened categories to be maintained when the user\n  // drags a category from one place to another.\n  // full_name should be the full name of the category, e.g. item/pump/centrifugal_pump, which are unique.\n  toggleCategory(full_name) {\n    var openedItems = this.state.openedItems;    \n\n    if(openedItems.has(full_name)) {\n      openedItems.delete(full_name);\n    } else {\n      openedItems.add(full_name);\n    }\n\n    this.setState({\n      openedItems: openedItems\n    })\n  }\n\n  // When the user has finished dragging a category, determine the new item order and save this order to the state.\n  onDragEnd(result) {\n    // dropped outside the list\n    if (!result.destination) {\n      return;\n    }\n\n    const itemOrder = reorder(\n      this.state.itemOrder,\n      result.source.index,\n      result.destination.index\n    );\n\n    var orderedItems = getOrderedItems(this.props.items, itemOrder)\n\n    this.props.initHotkeyMap(orderedItems, () =>\n      this.setState({\n        itemOrder: itemOrder,\n        orderedItems: orderedItems,\n      })\n    );\n  }\n\n  \n  render() {\n\n    var items       = this.state.orderedItems;\n    var openedItems = this.state.openedItems;\n\n\n\n    return (\n      <div id=\"category-hierarchy-tree\" className={(this.props.visible ? \"\" : \"hidden\") + (this.props.displayOnly ? \" display-only\" : \"\") + (this.props.tableForm ? \" table-form\" : \"\")}>\n        <DragDropContext onDragEnd={this.onDragEnd}>\n          <Droppable droppableId=\"droppable\">\n            {(provided, snapshot) => (\n              <ul\n                {...provided.droppableProps}\n                className={\"draggable-list\" + (snapshot.isDraggingOver ? \" dragging\" : \"\")}\n                ref={provided.innerRef}\n\n              >\n                {this.props.displayOnly && <li className=\"header-row\"><span className=\"inner-container\"><span className=\"category-name\">Entity Class</span><span className=\"description\">Description</span></span></li>}\n                {items.map((item, index) => (\n                  <Category \n                            key={index}\n                            item={item}\n                            index={index}\n                            onClick={this.toggleCategory.bind(this)}\n                            open={openedItems.has(item.name)} \n                            openedItems={this.state.openedItems} \n                            hotkeyMap={this.props.hotkeyMap}\n                            hotkeyChain={this.props.hotkeyChain}\n                            isTopLevelCategory={true}\n                            applyTag={this.props.applyTag}\n                            draggable={this.props.draggable}\n                            itemNameChange={this.props.itemNameChange}\n                            path={[index]}\n                  />\n                ))}\n                {provided.placeholder}\n              </ul>\n            )}\n          </Droppable>\n        </DragDropContext>\n      </div>\n    );\n  }\n}\n\nclass ModifiableCategoryHierarchy extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      items: [],\n      openedItems: new Set(),   \n      errorEntityNames: new Set(),\n      userIsModifying: false, // Whether the user is currently entering a name/description\n    }\n    this.userIsModifyingFn = null;\n  }\n\n  componentDidMount() {\n    this.setState({\n      items: this.props.items,\n    })\n  }\n  componentDidUpdate(prevProps, prevState) {\n\n\n    if(!_.isEqual(this.props.items, this.state.items) && _.isEqual(prevState.items, this.state.items)) {\n     this.setState({\n      items: this.props.items,\n      openedItems: new Set(),\n      errorEntityNames: this.props.errorEntityNames,\n     });      \n    } \n\n    if(this.props.errorEntityNames !== this.state.errorEntityNames) {\n      this.setState({\n        errorEntityNames: this.props.errorEntityNames,\n      })\n    }\n\n\n\n    // if(!_.isEqual(this.props.items, this.state.items) && !_.isEqual(prevState.items, this.state.items)) {\n    //   //this.props.updateFormPageData(this.state.data);\n    //   this.props.updateHierarchy(this.state.items);\n    // } \n  }\n\n\n  // componentDidUpdate(prevProps, prevState) {\n    \n  //   if(!_.isEqual(prevState.items, this.state.items) && this.state.items.length > 0) {      \n  //     this.props.updateHierarchy(this.state.items);\n  //   }\n  //   //if(!_.isEqual(prevProps.items, this.props.items) && !_.isEqual(prevProps.preset, this.props.preset)) {\n  //   if(!_.isEqual(prevProps.items, this.props.items) && _.isEqual(prevState.items, this.state.items)) {\n  //     this.setState({\n  //       openedItems: new Set(),\n  //       items: this.props.items,\n  //     });\n  //   }\n  // }\n\n  toggleCategory(full_name) {\n    var openedItems = this.state.openedItems;    \n\n    if(openedItems.has(full_name)) {\n      openedItems.delete(full_name);\n    } else {\n      openedItems.add(full_name);\n    }\n\n    this.setState({\n      openedItems: openedItems\n    })\n  }\n\n\n  // When the user has finished dragging a category, determine the new item order and save this order to the state.\n  async onDragEnd(result) {\n    // dropped outside the list\n    if (!result.destination) {\n      return;\n    }\n\n    var before = this.state.items;\n    const items = reorder(\n      this.state.items,\n      result.source.index,\n      result.destination.index\n    );\n\n    //this.props.updateHierarchy(items);\n    await this.setState({\n      items: items,\n    });\n    this.props.updateHierarchy(this.state.items)\n  }\n\n\n\n  // Create a new item at the specified path.\n  newItem(path) {\n\n    var items = this.state.items;\n\n    if(path.length > 0) {\n      var currentItems = items;\n      for(var i = 0; i < path.length - 1; i++) {\n        var index = path[i];\n        currentItems = currentItems[index].children;\n      }\n\n      var parentItem = currentItems[path[path.length - 1]];\n\n      var children = parentItem.children;\n      if(!children) {\n        parentItem.children = new Array();\n      }\n      var newItem = {\n        name: \"\",\n        description: \"\",\n        colorId: parentItem.colorId,\n        full_name: parentItem.full_name + \"/\",\n      }\n      parentItem.children.push(newItem)\n    }\n    else {\n      var newItem = {\n        name: \"\",\n        description: \"\",\n        colorId: (this.state.items.length + 1),\n        full_name: \"\",\n        id: this.state.items.length + 1,\n      }\n      items.push(newItem);\n    }\n\n\n\n    \n    \n    this.setState({\n      items: items,\n    }, () => {\n      this.props.markModified();\n      console.log('created new item', this.state.items)\n      //this.props.updateHierarchy(this.state.items);\n    });\n  }\n\n  \n\n  userIsModifying() {\n\n    function userStoppedModifying() {\n      this.setState({\n        userIsModifying: false,\n      }, () => {\n        this.props.userIsModifying(false)\n      })\n    }\n\n    //this.props.markModified();\n\n    if(this.userIsModifyingFn) window.clearTimeout(this.userIsModifyingFn);\n    this.userIsModifyingFn = window.setTimeout(userStoppedModifying.bind(this), 1000);\n\n    this.setState({\n      userIsModifying: true,\n    }, () => {\n      this.props.userIsModifying(true);\n    })\n  }\n\n  // Change the name of an item.\n  // This is possible via the path, which is the path of indexes of the item name to be changed e.g. \n  // [0, 1] means the first item in the tree, and then the second item inside that one.\n  itemNameChange(name, path) {\n    var t0 = performance.now()\n\n    var newName = name;\n\n    var items = this.state.items;\n    var currentItems = items;\n    for(var i = 0; i < path.length - 1; i++) {\n      var index = path[i];\n      currentItems = currentItems[index].children;\n    }\n    \n    // Update the item name\n    var item = currentItems[path[path.length - 1]];\n\n    item.name = newName;\n\n    // If this item is open, remove it from the opened items set and add the updated name later.\n    var open = false;\n    var openedItems = this.state.openedItems;\n    if(this.state.openedItems.has(item.full_name)) {\n      open = true;\n      openedItems.delete(item.full_name);      \n    }\n    \n    // Update the full name as well\n    var full_name_s = item.full_name.split('/');\n    full_name_s[full_name_s.length - 1] = newName;\n    item.full_name = full_name_s.join('/');\n\n    if(open) openedItems.add(item.full_name);\n    \n\n\n    this.setState({\n      items: items,\n      openedItems: openedItems,\n    }, () => {\n      var t1 = performance.now()\n      console.log(t1-t0)\n      this.props.markModified();\n\n      //his.props.updateHierarchy(this.state.items);\n    });\n  }\n\n  // Change the item description of the corresponding item, same as above.\n  itemDescChange(e, path) {\n    var newDesc = e.target.value;\n\n    var items = this.state.items;\n    var currentItems = items;\n    for(var i = 0; i < path.length - 1; i++) {\n      var index = path[i];\n      currentItems = currentItems[index].children;\n    }\n    \n    // Update the item name\n    var item = currentItems[path[path.length - 1]];    \n    item.description = newDesc;\n    this.setState({\n      items: items,\n    }, () => {\n      this.props.markModified();\n      //this.props.updateHierarchy(this.state.items);\n    })\n\n  }\n\n  // Delete the item at the specified path.\n  async deleteItem(path) {\n\n    var items = this.state.items;\n    var currentItems = items;\n    if(path.length > 1) {\n      for(var i = 0; i < path.length - 1; i++) {\n        var index = path[i];\n        var deleteRef = currentItems[index];\n        currentItems = currentItems[index].children;\n\n      }      \n    }\n\n\n    // Remove the item from openedItems\n    var openedItems = this.state.openedItems;    \n    var item = currentItems[path[path.length - 1]];\n    openedItems.delete(item.full_name);\n\n    currentItems.splice(path[path.length - 1], 1);\n    if(currentItems.length === 0 && path.length > 1) { delete deleteRef.children; }\n\n    await this.setState({\n      items: items,\n      openedItems: openedItems,\n    })\n    this.props.markModified();\n    //this.props.updateHierarchy(this.state.items);\n  }\n\n\n  render() {\n    var items       = this.state.items;\n    var openedItems = this.state.openedItems;\n\n    return (\n      <div id=\"category-hierarchy-tree\" className=\"table-form display-only\" >\n        <ul>\n          <li className=\"header-row\"><span className=\"inner-container\"><span className=\"left\"><span className=\"category-name\">Entity Class</span></span><span className=\"right\"><span className=\"description\">Description</span></span><span className=\"delete-button-container\"><span className=\"delete-button\"></span></span></span></li>\n        </ul>\n\n        <DragDropContext onDragEnd={this.onDragEnd.bind(this)}>\n          <Droppable droppableId=\"droppable\">\n            {(provided, snapshot) => (\n\n              <ul className={\"draggable-list reversed-stripes \" + (this.props.limitHeight ? \"limit-height\" : \"\") + (snapshot.isDraggingOver ? \" dragging\" : \"\") + (this.state.userIsModifying ? \" drag-disabled\": \"\")}\n                {...provided.droppableProps}\n                ref={provided.innerRef}\n              >\n\n\n                {items.map((item, index) => (\n                  <Category \n                    key={index}\n                    item={item}\n                    index={index}\n                    onClick={this.toggleCategory.bind(this)}\n                    open={openedItems.has(item.name)} \n                    openedItems={this.state.openedItems} \n                    isTopLevelCategory={true}\n                    draggable={true}\n                    colorByIndex={true}\n                    modifiable={true}\n                    itemNameChange={this.itemNameChange.bind(this)}\n                    itemDescChange={this.itemDescChange.bind(this)}\n                    deleteItem={this.deleteItem.bind(this)}\n                    newItem={this.newItem.bind(this)}\n                    errorEntityNames={this.state.errorEntityNames}\n                    userIsModifying={this.userIsModifying.bind(this)}\n\n                    path={[index]}\n                  />\n                ))}\n\n                {provided.placeholder}\n                \n                <NewCategoryButton newItem={() => this.newItem([])}/>\n                \n            </ul>\n          )}\n        </Droppable>\n        </DragDropContext>\n\n     \n\n\n      </div>\n    )\n  }\n}\n\nexport default CategoryHierarchy;\nexport { ModifiableCategoryHierarchy };","import React from 'react';\nimport {Component} from 'react';\nimport ReactHtmlParser from 'react-html-parser';\n\n\n// Returns the colour id of the given entityClass according to the entityColourMap, e.g.\n// 'item/pump': 1 (because \"item\" is the top level category)\nfunction getColourIdx(entityClass, entityColourMap) {\n  var baseClass = entityClass.split(\"/\").slice(0, 1)[0];\n  return entityColourMap[baseClass];\n}\n\n// A label, drawn underneath a word.\nclass Label extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    var split = this.props.entityClass.split('/');\n    var truncatedLabel = split.length > 1 ? \"/\" : \"\"\n    truncatedLabel = truncatedLabel + split[split.length - 1];\n\n    return (\n      <span className={\"label tag-\" + this.props.colourIdx} onClick={(e) => {this.props.deleteTag(this.props.entityClass);  }}><span className=\"label-name\">{truncatedLabel}</span></span>\n    )\n  }\n}\n\n\n\n\n\n// A single word (or token) in the tagging interface.\nclass Word extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selected: false,\n    }\n    this.wordInnerRef = React.createRef();\n  }\n\n  // Calls this.props.deleteTag with the index of this word as a parameter.\n  deleteTag(entityClass) {\n    this.props.deleteTag(this.props.index, entityClass);\n  }\n\n  // Clear the word justification of this word if it is does not have a label.\n  componentDidUpdate(prevProps, prevState) {\n\n    /* TODO: Fix the below to be much faster.\n       The code should update the width of this word back to auto if this word no longer has a label,\n       but it is too slow on long docs so I took it out.\n    */\n\n    // if(this.props.entityClasses.length === 0) {\n\n    //   var ele =  this.wordInnerRef.current;\n    //   $(ele).css(\"min-width\", \"auto\");\n\n    //   var width = ele.offsetWidth;\n    //   var newWidth = Math.ceil(width / 25) * 25;\n    //   $(ele).css('min-width', newWidth + 'px');        \n\n    // }\n  }\n\n  getHighlightedWord() {\n    var text = this.props.text;\n    var highlighting = this.props.highlighting;\n\n    var output = '';\n\n    for(var i = 0; i < text.length; i++) {\n      if(i === highlighting[0]) {\n        output += '<span class=\"search-highlight\">'\n      }\n      output += text[i];\n      if(i === highlighting[1]) {\n        output += '</span>'\n      }\n    }\n\n    //console.log(output);\n    return ReactHtmlParser(output);\n  }\n\n  render() {\n\n    var hasLabel = this.props.entityClasses.length > 0;\n\n    var tagClass = hasLabel ? (\" tag \" + ((this.props.bioTag === \"B\") ? \"tag-begin\" : \"\") + (this.props.isLastInSpan ? \" tag-end\" : \"\")) : \"\";\n\n    if(hasLabel) {\n      var labels = this.props.entityClasses.map((entityClass, i) => \n                  <Label deleteTag={this.deleteTag.bind(this)} key={i} bioTag={this.props.bioTag} entityClass={entityClass} colourIdx={getColourIdx(entityClass, this.props.entityColourMap)} />\n                  )\n      \n    } else {\n      var labels = '';\n    }\n\n    var text = this.props.text;\n    if(this.props.highlighting) {\n      text = this.getHighlightedWord();\n    }\n\n    var wordColourClass = (hasLabel ? (\" tag-\" + getColourIdx(this.props.entityClasses[0], this.props.entityColourMap)) : \"\")\n    return (\n      <span className={\"word\" + (this.props.selected ? \" selected\" : \"\") + tagClass}>\n\n        <span className={\"word-inner\" + wordColourClass + (this.props.highlighting ? \" search-highlight\" : \"\") } ref={this.wordInnerRef}\n              onMouseUp=  {() => this.props.updateSelections(this.props.index, 'up')}\n              onMouseDown={() => this.props.updateSelections(this.props.index, 'down')}>\n\n          {text}\n        </span>\n        {labels}\n        \n      </span>\n    );\n  }\n}\n\n// A sentence in the tagging interface.\nclass Sentence extends Component {\n  constructor(props) {\n    super(props);\n    this.sentenceRef = React.createRef();\n  }\n\n  // Call the updateSelections function of the parent of this component (i.e. TaggingInterface), with this sentence's index included.\n  updateSelections(wordIndex, action) {\n    this.props.updateSelections(this.props.index, wordIndex, action)\n  }\n\n  deleteTag(wordIndex, entityClass) {\n    this.props.deleteTag(this.props.index, wordIndex, entityClass);\n  }\n\n  // Scroll to this sentence if it receives a new selection.\n  // https://stackoverflow.com/questions/442404/retrieve-the-position-x-y-of-an-html-element-relative-to-the-browser-window\n  componentDidUpdate(prevProps, prevState) {\n    if((this.props.selections) && (prevProps.selections.length === 0 && this.props.selections.length > 0)) {\n\n      var element = this.sentenceRef.current;\n      var bodyRect = document.body.getBoundingClientRect(),\n          elemRect = element.getBoundingClientRect(),\n          offset   = elemRect.top - bodyRect.top;\n\n       window.scrollTo({\n        top: offset - 200,\n        left: 0,\n        behavior: 'smooth',\n      });\n    }\n  }\n\n  render() {\n\n    var selections = this.props.selections;\n\n    // Check props.selections to determine whether the word with a given index in this sentence is selected.\n    // This is passed to the word as a prop so that it can be highlighted accordingly.\n    function isWordSelected(wordIndex) {      \n      if(selections.length === 0) return false;     \n      for(var i = 0; i < selections.length; i++) {\n        var selection = selections[i];\n        if(selection.wordEndIndex < 0) continue;\n        if(selection.wordEndIndex >= wordIndex && wordIndex >= selection.wordStartIndex ) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n\n\n    if(this.props.displayOnly) {\n      return (\n        <div className={\"sentence-inner\" + (this.props.displayOnly ? \" display-only\" : \"\")} ref={this.sentenceRef}>\n          { this.props.words.map((word, i) => \n            <Word key={i}\n                  index={i}\n                  text={word}\n                  entityClasses={this.props.annotations[i].entityClasses || []}\n                  bioTag={this.props.annotations[i].bioTag}\n                  entityColourMap={this.props.entityColourMap}\n                  highlighting={this.props.annotations[i].highlighting}\n                  updateSelections={() => {return null}}\n                  deleteTag={() => {return null}}\n                  isLastInSpan={this.props.annotations[i].isLastInSpan()}\n            />)\n          }   \n        </div>\n      );      \n    }\n\n\n    return (\n      <div className=\"sentence-inner\" ref={this.sentenceRef}>\n        { this.props.words.map((word, i) => \n          <Word key={i}\n                index={i}\n                text={word}\n                selected={isWordSelected(i)}\n                entityClasses={this.props.annotations[i].entityClasses || []}\n                isLastInSpan={this.props.annotations[i].isLastInSpan()}\n                bioTag={this.props.annotations[i].bioTag}\n                updateSelections={this.updateSelections.bind(this)}\n                entityColourMap={this.props.entityColourMap}\n                deleteTag={this.deleteTag.bind(this)}\n                highlighting={this.props.annotations[i].highlighting}\n\n\n          />)\n        }   \n        \n\n\n       \n      </div>\n    );\n  }\n\n}\n\n\n\n\n\nexport { Word };\nexport { Sentence };","const dateFormat = require('dateformat');\n\n// Nicely formats a date\nfunction formatDate(d, options) {\n  if(options && options.no_hours) {\n  \treturn dateFormat(d, 'dd mmm');\n  }\n  return dateFormat(d, 'dd mmm') + ' at ' + dateFormat(d, 'h:MM tt')\n}\n\nexport default formatDate;","import React from 'react';\nimport {Component} from 'react';\nimport BASE_URL from 'globals/base_url';\nimport formatDate from 'functions/formatDate'\nimport { Link } from 'react-router-dom'\n\n// text={comment.text} date={comment.created_at} author={comment.author} document={comment.document_string}\n\nclass Comment extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"comment-box\">\n        <div className=\"comment-left\">    \n          <div className=\"circle-icon profile-icon\" style={{'background': this.props.user_profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.props.user_profile_icon.icon} style={{'color': this.props.user_profile_icon.foreground}}></i></div>\n        </div>\n        <div className=\"comment-right\">\n          <div className={\"comment-author st\"}>{this.props.author}<span className=\"comment-date st\">{formatDate(this.props.created_at)}</span></div>\n          {!this.props.hideDocumentString && \n            <blockquote className=\"comment-document st\">\n              <span className=\"document-string\">{this.props.document_string}</span>\n              <Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/annotations/curation?docId=\" + this.props.document_id}><i class=\"fa fa-external-link\"></i></Link>\n            </blockquote>}\n          <div className=\"comment-text st st-block\">{this.props.text}</div>\n          \n        </div>\n      </div>\n    )\n  }\n}\n\nclass CommentInput extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      comment: '',\n    }\n  }\n\n  onSubmit(e) {\n    e.preventDefault();\n\n    if(this.state.comment.length === 0) return;\n\n    this.props.submitComment(this.state.comment, () => {\n      this.setState({\n        comment: '',\n      })\n    })    \n    return;\n  }\n\n  setComment(e) {\n    this.setState({\n      comment: e.target.value\n    })\n  }\n\n  render() {\n    return (\n      <form className=\"comment-input-box\" onSubmit={this.onSubmit.bind(this)}>\n        <div className=\"comment-box\">\n          <div className=\"comment-left\">     \n            { this.props.user_profile_icon &&              \n            <div className=\"circle-icon profile-icon\" style={{'background': this.props.user_profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.props.user_profile_icon.icon} style={{'color': this.props.user_profile_icon.foreground}}></i></div>\n            }\n          </div>\n          <div className=\"comment-right margin-right\">\n            <div className=\"comment-text\">\n              <textarea name=\"comment-input\" className=\"comment-input\" placeholder=\"Write a comment...\" onChange={this.setComment.bind(this)} value={this.state.comment} maxlength=\"200\" ></textarea>\n\n\n\n            </div> \n\n          </div>     \n           \n\n        </div>\n        <div className=\"submit-comment-wrapper\"><button className=\"submit-comment\"><i class=\"fa fa-send\"></i></button></div>\n      </form>\n    )\n  }\n}\n\nexport { Comment };\nexport { CommentInput };","import React from 'react';\nimport {Component} from 'react';\nimport $ from 'jquery';\nimport formatDate  from 'functions/formatDate';\n\n// The humble save button that appears at the top of the page.\nclass SaveButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n\n    var buttonClass = \" disabled\";\n    if(this.props.changesMade) buttonClass = \"\";\n    if(this.props.recentlySaved) buttonClass = \" recently-saved\";\n    if(this.props.saving) buttonClass = \" saving\";\n\n    var iconClass = \"fa-save\";\n    if(this.props.recentlySaved) iconClass = \"fa-check\";\n    if(this.props.saving) iconClass = \"fa-cog fa-spin\"\n\n    var text = \"Save\";\n    if(this.props.recentlySaved) text = \"Saved\";\n    if(this.props.saving) text = \"Saving\";\n\n    return (\n      <button className={\"save-button\" + buttonClass} onClick={this.props.submitAnnotations}>\n        <i className={\"fa \" + iconClass}></i>\n        { text }\n      </button>\n    )\n  }\n}\n\n\n// The progress bar that appears when the user saves a new doc group.\nclass ProgressBar extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div id=\"tagging-progress-bar\" className={(this.props.show ? \"show\" : \"hide\")}>\n        <span className=\"progress-bar\">\n          <span className=\"inner\" style={{\"width\": (this.props.totalPagesAvailable - 1) / this.props.totalPages * 100 + \"%\"}}></span>\n        </span>\n      </div>\n    )\n  }\n}\n\n\n\n\n\n\n// The search bar that appears in the control bar, for searching through previously annotated docs.\nclass DocumentSearchBar extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: '',\n    }\n    this.inputRef = React.createRef();\n  }  \n\n  updateValue(e) {\n    var value = e.target.value;\n    if(value.trim().length === 0) {\n      value = '';\n    }\n    this.setState({\n      value: value,\n    });\n  }\n\n  submit(e) {\n    \n\n    this.props.searchDocuments(this.state.value);\n\n    // this.setState({\n    //   value: null,\n    // }, () => {\n      var ele = $(this.inputRef.current);\n      ele.blur();\n    // });\n\n    e.preventDefault();\n    return null;\n  }\n\n\n  render() {\n    return (\n      <form className={\"search-container\" + (this.props.inSearchMode ? \" active\" : \"\")} onSubmit={this.submit.bind(this)} >\n        <input ref={this.inputRef} className=\"search-bar\" id=\"document-search-bar\" placeholder=\"Search...\" value={this.state.value} onChange={(e) => this.updateValue(e)} ></input><button className=\"search-button\"><i class=\"fa fa-search\"></i></button>\n      </form>\n    )\n  }\n}\n\n\n\n\n// The 'control bar', which appears at the top of the interface (with page numbers, group number etc).\nclass ControlBar extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state =  {\n      pageNumber: null, // The desired page number of the user (not necessarily the one they are currently on).\n      pageNumberError: false,\n    }\n    this.pageInputRef = React.createRef();\n  }\n\n  // clearPageNumberError() {\n  //   this.setState({\n  //     pageNumber: this.props.pageNumber,\n  //     pageNumberError: false,\n  //   })\n  // }\n\n  clearPageNumberInput() {\n    var ele = $(this.pageInputRef.current);\n    ele.val('');\n    ele.blur();\n  }\n\n  goToPage(e) {\n\n    this.clearPageNumberInput();\n    if(this.state.pageNumber === '') {\n      this.setState({ pageNumber: this.props.pageNumber })\n      e.preventDefault();\n      return null;\n    }\n\n\n\n    if(this.state.pageNumber !== parseInt(this.state.pageNumber).toString()) {\n      this.setState({\n        pageNumber: this.props.totalPagesAvailable,\n      }, () => { this.props.goToPage(this.state.pageNumber)});\n      e.preventDefault();\n      return null;\n    }\n\n    if(this.state.pageNumber < 1) {\n      this.setState({\n        pageNumber: 1,\n      }, () => { this.props.goToPage(this.state.pageNumber)});\n    } else if (this.state.pageNumber > this.props.totalPagesAvailable) {\n      this.setState({\n        pageNumber: this.props.totalPagesAvailable,\n      }, () => { this.props.goToPage(this.state.pageNumber)});\n    } else {\n      this.props.goToPage(this.state.pageNumber);\n    }\n \n\n    e.preventDefault();\n    return null;\n  }\n\n  componentDidMount() {\n    if(!this.state.pageNumber && this.props.pageNumber) {\n      this.setState({\n        pageNumber: this.props.pageNumber\n      })\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(this.props.pageNumber !== prevProps.pageNumber) {\n      this.setState({\n        pageNumber: this.props.pageNumber\n      })\n    }\n  }\n\n\n  changePageNumber(e) {\n    this.setState({\n      pageNumber: e.target.value,\n    });\n  }\n\n  render() {\n\n    var groupName = (\n      <span className={\"group-name\"}>\n        <span>Page <b>\n          <form onSubmit={this.goToPage.bind(this)}>\n          <input \n                 id=\"page-input\"\n                 className={\"page-input\" + (this.state.pageNumberError ? \" error\" : \"\")}\n                 placeholder={this.state.pageNumber}\n                 name=\"page-input\"\n                 onChange={(e) => this.changePageNumber(e)}\n                 ref={this.pageInputRef}\n                 />\n          </form>\n          \n        </b> of <b>{this.props.totalPages}</b></span>\n      </span>\n    );\n\n    var latestGroup = (this.props.totalPagesAvailable) === this.props.pageNumber // Whether the user is looking at the latest group, that they have not yet annotated\n\n    var lastModified = this.props.changesMade ? (this.props.saving ? \"\" : \"Changes not saved\") : (this.props.lastModified ? \"Saved on \" + formatDate(this.props.lastModified) : \"\");\n\n    return (\n      <div id=\"pagination\" className={this.props.curationPage ? \"curation-page\" : \"\"}>\n        <div className=\"page-button-container previous-page\">\n          <button className={(this.props.pageNumber === 1 ? \" disabled\" : (this.props.querying ? \"loading\" : \"\"))} onClick={this.props.loadPreviousPage}><i className=\"fa fa-chevron-left\"></i>Prev\n          </button>\n        </div>\n        <div className=\"filler-left\">\n          <DocumentSearchBar inSearchMode={this.props.inSearchMode} searchDocuments={this.props.searchDocuments} />\n        </div>\n        <div className={\"current-page-container\" + (this.props.showingProgressBar ? \" progress-bar-underneath\" : \"\")}>\n          { groupName }\n\n\n          { this.props.showDocsPerPage && <div className=\"docs-per-page-select-container\">\n            <label>Per page:</label>\n            <select className=\"docs-per-page-select\" onChange={(e) => {this.props.setDocsPerPage(e); $(e.target).blur()}} >\n              {this.props.docsPerPageOptions.map((p, index) => \n                <option value={p} selected={p === this.props.docsPerPage}>{p}</option>\n              )}\n            </select>\n          </div> }\n\n          { this.props.showSortBy && <div className=\"docs-per-page-select-container\">\n            <label>Sort by:</label>\n            <select className=\"docs-per-page-select sort-by\" onChange={(e) => {this.props.setSortBy(e); $(e.target).blur()}} >\n              {this.props.sortByOptions.map((p, index) => \n                <option value={p} selected={p === this.props.sortBy}>{p === \"Annotations\" ? \"# Annotations\" : p}</option>\n              )}\n            </select>\n          </div> }\n\n\n\n          <ProgressBar \n            show={this.props.showingProgressBar}\n            totalPagesAvailable={this.props.totalPagesAvailable}\n            totalPages={this.props.totalPages}\n          />\n        </div>\n        <div className=\"group-last-modified\">{lastModified }</div>\n\n        { this.props.showSaveButton && <div className=\"page-button-container \" ><SaveButton changesMade={this.props.changesMade} recentlySaved={this.props.recentlySaved} saving={this.props.saving} submitAnnotations={this.props.submitAnnotations}  /></div> }\n        <div className=\"page-button-container next-page\" title={latestGroup && !this.props.inSearchMode ? \"Finish annotating this page to move on to the next page.\" : \"\"}>\n          <button className={(latestGroup  ? \" disabled\" : (this.props.querying ? \"loading\" : \"\"))}  onClick={this.props.loadNextPage}>Next<i className=\"fa fa-chevron-right\"></i></button>\n        </div>              \n      </div>\n    )\n  }\n}\n\nexport default ControlBar;","import _ from 'underscore';\n\n// A class to store an annotation for a single token.\n// Seemed more logical to put all the annotation logic in one class rather than sticking it in the TaggingInterface component.\n// Each sentence will have one Annotation object per token.\n// Properties:\n/* \n   token: the token e.g. 'centrifugal'\n   tokenIndex: the index of the token in the sentence\n   bioTag: the BIO tag ('B', 'I' or 'O')\n   entityClasses: the array of entity classes AKA labels (e.g. ['Item', 'Item/Pump'])   \n   spanText: the text of the span that this annotation is within (e.g. 'centrifugal pump')\n   spanStartIdx: the start index of the span this annotation is in, e.g. 0 if it starts at the first word of the sentence\n   spanEndIdx: the end index as above, e.g. 1,\n*/\nclass Annotation {\n  constructor(token, tokenIndex) {\n    this.token = token;\n    this.tokenIndex = tokenIndex;\n    this.bioTag = \"O\";    \n    this.highlighting = null;\n  }\n\n  // Adds the specified entityClass to this annotation.\n  // bioTag: The bioTag, e.g. \"B\" or \"I\",\n  // entityClass: The entity class, e.g. \"Item/Pump\"\n  // text: The text of the span that this annotation is inside, e.g. \"centrifugal pump\".\n  // spanStartIdx, spanEndIdx: self explanatory (as above)\n  // nextAnnotation: The Annotation object for the next token in the sentence.\n  //                 When called during the dictionary annotation tagging, nextAnnotation is not necessary.\n  // Returns whether the label of this annotation was modified at all.\n  addLabel(bioTag, entityClass, spanText, spanStartIdx, spanEndIdx) {\n    \n    if(this.entityClasses === undefined) this.entityClasses = new Array();\n\n    var alreadyHasLabel = this.entityClasses.indexOf(entityClass) !== -1;\n    if(this.bioTag === bioTag && this.spanText === spanText && this.spanStartIdx === spanStartIdx && this.spanEndIdx === spanEndIdx && alreadyHasLabel) {\n      return false;\n    }\n\n    // Adjust the span.\n    this.bioTag = bioTag;\n    this.spanText = spanText;\n    this.spanStartIdx = spanStartIdx;\n    this.spanEndIdx = spanEndIdx;\n\n    // Add the entityClass to the entityClasses array for this Annotation.\n    // If it is already there, don't add it again.\n    if(!alreadyHasLabel) {\n      this.entityClasses.push(entityClass);\n    }\n    return true;\n  \n    // If the nextAnnotation is from the same mention (AKA span) as this one, and does not have exactly the same labels after\n    // the new class has been appended to this annotation's entityClasses, change its BIO tag to B.\n    // This is the part that ensures mentions are split up when the user changes the label of token(s) inside that mention.\n    // if(nextAnnotation) {\n    //   if(this.sameMention(nextAnnotation) && !this.sameEntityClasses(nextAnnotation) && nextAnnotation.hasLabel()) {\n    //     console.log(\"Changing bio tag to B\")\n    //     nextAnnotation.changeBioTag(\"B\");\n    //     nextAnnotation.setSpanStartIdx(spanEndIdx + 1)          \n    //   }\n    // }\n\n    // If the previous annotation is from the same mention as this one, and now no longer has the same labels,\n    // adjust the spanEndIdx to be the start of this new span -1.\n    // This ensures the tags are rendered correctly in the browser.\n    // Note that this seems to get called multiple times when applying tags because they are applied in reverse order,\n    // but the spanEndIdx will be set as below for the next annotation anyway so that shouldn't be an issue.\n    // if(prevAnnotation) {\n    //   if(this.sameMention(prevAnnotation) && !this.sameEntityClasses(prevAnnotation) && prevAnnotation.hasLabel()) {  \n    //     prevAnnotation.setSpanEndIdx(spanStartIdx - 1);\n    //   }\n    // }\n  }\n\n  // Removes all the labels from this annotation and resets the bioTag to \"O\".\n  removeAllLabels() {\n    delete this.entityClasses;\n    delete this.spanText;\n    delete this.spanStartIdx;\n    delete this.spanEndIdx;\n    this.bioTag = \"O\";\n  }\n\n  // Simple function to determine whether this annotation is in the same mention as another annotation.\n  sameMention(otherAnnotation) {\n    return otherAnnotation.spanStartIdx === this.spanStartIdx && otherAnnotation.spanEndIdx === this.spanEndIdx;\n  }\n\n  // Determine whether this annotation has the same labels as another annotation.\n  sameEntityClasses(otherAnnotation) {\n    return _.isEqual(this.entityClasses, otherAnnotation.entityClasses);\n  }\n\n  // Removes a specific label from this annotation.\n  // If it was the last label, reset this annotation's bioTag to \"O\" and delete the entityClasses and other properties.\n  removeLabel(entityClass) {\n    var index = this.entityClasses.indexOf(entityClass);\n    if(index === -1) {\n      console.log(\"Warning: tried to remove an entity class from an annotation that did not exist.\")\n      return;\n    }\n    this.entityClasses.splice(index, 1);\n    if(this.entityClasses.length === 0) {\n      this.bioTag = \"O\";\n      delete this.entityClasses;\n      delete this.spanText;\n      delete this.spanStartIdx;\n      delete this.spanEndIdx;\n    }\n  }\n\n  // Change the bio tag of this annotation to another bio tag.\n  changeBioTag(bioTag) {\n    this.bioTag = bioTag;\n  }\n\n  // Returns whether this annotations has a label.\n  hasLabel() {\n    return this.bioTag !== \"O\";\n  }\n\n  // Determines whether this annotation is the last of its type in the given span.\n  isLastInSpan() {\n    return this.spanEndIdx === this.tokenIndex;\n  }\n\n  setSpanStartIdx(spanStartIdx) {\n    this.spanStartIdx = spanStartIdx;\n  }\n\n  setSpanEndIdx(spanEndIdx) {\n    this.spanEndIdx = spanEndIdx;\n  }\n\n  // Set the highlighting array (for search mode).\n  setHighlighting(startIdx, endIdx) {\n    this.highlighting = [startIdx, endIdx];\n  }\n\n  // Prints this annotation nicely to the console (for debugging).\n  prettyPrint() {\n    console.log(\"Token:    \", this.token);\n    console.log(\"BIO Tag:  \", this.bioTag)\n    console.log(\"Span:     \", this.spanText)\n    console.log(\"StartIdx: \", this.spanStartIdx)\n    console.log(\"EndIdx: \", this.spanEndIdx)\n    console.log(\"Classes:  \\n\", this.entityClasses);\n    console.log('\\n');\n  }\n}\n\n\nexport default Annotation;","import Annotation from './Annotation';\n\n// Sets up an array to store the annotations with the same length as docGroup.\n// Prepopulate the annotations array with the automaticAnnotations if available (after converting them to BIO).\n// This could be either the dictionary-based annotations or the annotations that the user has previously entered.\n//\n// oneDocument = whether this is only being passed one doc but multiple annotations i.e. curation interface\nfunction initAnnotationsArray(documents, automaticAnnotations, searchTerm, oneDocument) {\n\n\n  console.log(documents)\n  console.log(automaticAnnotations);\n  console.log('---')\n\n  var repeatedDocs = new Array();\n  if(oneDocument) {\n    for(var i in automaticAnnotations) {\n      repeatedDocs.push(documents[0]);\n    }\n    documents = repeatedDocs;\n  }\n\n  if(searchTerm) {\n    var searchTermArray = searchTerm.split(' ');\n  }\n\n  //console.log(documents, \"<\");\n  //console.log(automaticAnnotations, \"<\");\n\n  var annotations = new Array(documents.length);\n  for(var doc_idx in documents) {\n    annotations[doc_idx] = new Array(documents[doc_idx].length);\n\n\n    var searchIdx = 0;\n    for(var token_idx in documents[doc_idx]) {\n      annotations[doc_idx][token_idx] = new Annotation(documents[doc_idx][token_idx], parseInt(token_idx));\n\n      // If a search term is present (i.e. user is in search mode), adjust the highlighting of the annotation\n      // so that it displays the searched portion of the token differently        \n      if(searchTerm) {\n        var token = documents[doc_idx][token_idx];\n        var foundIdx = token.indexOf(searchTermArray[searchIdx]);\n        if(foundIdx >= 0) {\n          annotations[doc_idx][token_idx].setHighlighting(foundIdx, foundIdx + searchTermArray[searchIdx].length - 1);\n          searchIdx++;\n        } else {\n          searchIdx = 0;\n        }        \n      }\n    }\n\n    \n  }\n\n  if(!automaticAnnotations) return annotations;\n\n  //console.log(this.state.documents, \"<\")\n\n  // Load annotations from the automaticAnnotations array if present.\n  for(var doc_idx in automaticAnnotations) {\n    if(!automaticAnnotations[doc_idx]) continue;\n    for(var mention_idx in automaticAnnotations[doc_idx]['mentions']) {\n\n\n      var mention = automaticAnnotations[doc_idx]['mentions'][mention_idx];\n      var start = mention['start'];\n      var end = mention['end'];\n\n      for(var label_idx in mention['labels']) {\n        var label = mention['labels'][label_idx];\n\n        for(var k = start; k < end; k++) {\n          var bioTag = k === start ? 'B' : \"I\";\n\n          //console.log(annotations[doc_idx], k, automaticAnnotations[doc_idx]['mentions'])\n          annotations[doc_idx][k].addLabel(bioTag, label, documents[doc_idx].slice(start, end).join(' '), start, end - 1)\n\n\n        }\n      }\n    }        \n  }\n  return annotations;\n}\n\nexport default initAnnotationsArray;","import React from \"react\";\nimport {Component} from \"react\";\n\nclass Error403Page extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <main class=\"error-page\">\n        <h1>403: Access denied.</h1>\n        <p>You do not have permission to access the requested page.</p>\n      </main>\n    )\n  }\n}\n\nexport default Error403Page","import React from \"react\";\nimport {Component} from \"react\";\n\nclass Error404Page extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <main class=\"error-page\">\n\n        <h1>404: Page not found.</h1>\n        <p>The page you were looking for does not exist.</p>\n\n\n      </main>\n    )\n  }\n}\n\nexport default Error404Page","import React from 'react';\n\nimport {Component} from 'react';\nimport $ from 'jquery';\nimport { findDOMNode } from 'react-dom';\nimport { Link } from 'react-router-dom'\nimport BASE_URL from 'globals/base_url';\n//const ReactDragListView = require('react-drag-listview');\n\nimport _ from 'underscore';\n\nimport html2canvas from 'html2canvas';\nimport { saveAs } from 'file-saver';\nimport domtoimage from 'dom-to-image';\n\nimport CategoryHierarchy from 'views/SharedComponents/CategoryHierarchy';\nimport {Word, Sentence} from 'views/TaggingInterfaceView/documentComponents';\n\nimport {Comment, CommentInput} from '../views/SharedComponents/Comment';\nimport ControlBar from 'views/SharedComponents/ControlBar';\n\nimport getCookie from 'functions/getCookie';\n\nimport formatDate  from 'functions/formatDate';\n\nimport initAnnotationsArray from 'views/TaggingInterfaceView/initAnnotationsArray';\nimport Annotation from 'views/TaggingInterfaceView/Annotation';\nimport Error403Page from 'views/Errors/Error403Page';\nimport Error404Page from 'views/Errors/Error404Page';\n\n\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }\n};\n\n\n// https://stackoverflow.com/questions/3169786/clear-text-selection-with-javascript\nfunction clearWindowSelection() {\n  if (window.getSelection) {\n    if (window.getSelection().empty) {  // Chrome\n      window.getSelection().empty();\n    } else if (window.getSelection().removeAllRanges) {  // Firefox\n      window.getSelection().removeAllRanges();\n    }\n  } else if (document.selection) {  // IE?\n    document.selection.empty();\n  }\n}\n\n\n\n\n\n\n\n\n\n// A single confidence button, which may have the value 'low' 'medium' or 'high'.\nclass ConfidenceButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    var docIdx = this.props.docIdx;\n    var value = this.props.value;\n    return (\n      <span className={\"confidence-button conf-\" + value + (this.props.checked ? \" checked\" : \"\")}\n            onClick={() => this.props.updateConfidence(docIdx, value)} title={\"Assign a \" + value + \" confidence to this document.\"} ></span>\n    )\n  }\n}\n\n\nclass ConfidenceButtons extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className={\"confidence-buttons\"}>\n        <ConfidenceButton value=\"low\"    checked={this.props.confidence === \"low\"} { ...this.props }/>\n        <ConfidenceButton value=\"medium\" checked={this.props.confidence === \"medium\"} { ...this.props }/>\n        <ConfidenceButton value=\"high\"   checked={this.props.confidence === \"high\"} { ...this.props }/>        \n      </div>\n    )\n  }\n}\n\n\n// The document container header, which appears at the top of the sentence tagging page.\nclass DocumentContainerHeader extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    return (\n      <div className=\"document-container header\">\n        <div className=\"document header\">\n          <div className=\"sentence-index\"></div>\n          <div className=\"sentence\">Document</div>\n          <div className=\"confidence-buttons\">Confidence</div>\n        </div>\n      </div>\n    )\n  }\n}\n\n// A document container, which contains the sentence index (on the left), the sentence, and the confidence buttons.\nclass DocumentContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      commentsOpen: false,\n      // windowMouseDownFn: null,\n    }\n    this.sentenceRef = React.createRef();\n    this.documentUnderneathRef = React.createRef(); // The reference for the grey area underneath the doc\n    this.commentBoxRef = React.createRef();\n  }\n\n\n  // Close the comment box when changing doc groups.\n  componentDidUpdate(prevProps, prevState) {\n    if(!_.isEqual(prevProps.words, this.props.words) && this.state.commentsOpen) {\n      this.setState({\n        commentsOpen: false,\n      })\n    }\n  }\n\n  // closeCommentBox(e) {\n  //   if(this.documentUnderneathRef.current && this.documentUnderneathRef.current.contains(e.target)) return;\n  //   this.setState({\n  //     commentsOpen: false,\n  //   })\n  // }\n\n  // Opens or closes the comments.\n  // Binds the mouse down function on the window if opening the comment box.\n  toggleOpenComments() {\n\n\n    // var windowMouseDownFn = (e) => this.closeCommentBox(e);\n    \n    // Remove the old event listeners.\n    // window.removeEventListener('mousedown', this.state.windowMouseDownFn);\n    // window.addEventListener('mousedown', windowMouseDownFn);\n\n    this.setState({\n      // windowMouseDownFn: windowMouseDownFn,\n      commentsOpen: !this.state.commentsOpen,\n    }, () => {\n    });\n  }\n\n  // Saves this sentence to a PNG file. wow!\n  saveToPng() {\n    var t = this;\n    var node = this.sentenceRef.current;\n\n    function filter(node) {\n      if(node.classList) {\n        return !node.classList.contains('sentence-index') && !node.classList.contains('confidence-buttons');\n      }\n      return node;\n    }\n\n    domtoimage.toBlob(node, {bgcolor: '#fefefe'})\n    .then(function(blob) {\n      saveAs(blob, \"document-\" + t.props.index + \".png\"); \n    });\n\n  }\n\n  submitComment(message, next) {\n    var t = this;\n    this.props.submitComment(message, this.props.index, () => {\n      next();\n      t.commentBoxRef.current.scrollTop = t.commentBoxRef.current.scrollHeight;\n    });\n  }\n\n  render() {\n\n\n\n    return (\n      <div className={\"document-container\" + (this.props.confidence ? \" conf conf-\" + this.props.confidence : \"\")}>\n\n        <div className=\"document-wrapper\">\n          <div className=\"document\">\n            <div className=\"sentence-index\"><span className=\"inner\">{this.props.displayIndex}</span></div>\n            <div className=\"sentence\" ref={this.sentenceRef}>\n              <Sentence \n                index={this.props.index}\n                words={this.props.words}              \n                annotations={this.props.annotations}  \n                selections={this.props.selections}\n                updateSelections={this.props.updateSelections}\n                entityColourMap={this.props.entityColourMap}\n                deleteTag={this.props.deleteTag}\n              />\n            </div>\n            <ConfidenceButtons docIdx={this.props.index} confidence={this.props.confidence} updateConfidence={this.props.updateConfidence}/>\n          </div>\n\n\n\n          <div className={\"document document-underneath\" + (this.state.commentsOpen ? \" open\" : \"\")} ref={this.documentUnderneathRef}>\n            <div className=\"sentence-index\"></div>\n            <div className=\"sentence\">\n\n              <div className=\"bottom-buttons\">\n            \n            \n                <div className={\"open-comments-button\" + (this.props.comments.length > 0 ? \" has-comment\" : \"\")}>\n                  <span className=\"inner\" onClick={this.toggleOpenComments.bind(this)}>\n                    <i className=\"fa fa-comment\"></i>\n                    <span className=\"num-comments\">{this.props.comments.length}</span>\n                  </span>            \n                </div> \n\n                <div className=\"save-to-png\" onClick={this.saveToPng.bind(this)} title=\"Click to download a .png file of this document\"><span className=\"inner\"><i className=\"fa fa-download\"></i></span>\n                </div>     \n              </div>\n\n\n\n              { this.props.user && \n                <div className=\"comments-wrapper\">\n                  <div className=\"comments-inner\">\n                    <div className=\"comments-even-more-inner\" ref={this.commentBoxRef}>\n                      { this.props.comments.map((comment, i) => <Comment index={i} {...comment} hideDocumentString={true} />) }\n                    </div>\n                    <CommentInput user_profile_icon={this.props.user.profile_icon} submitComment={this.submitComment.bind(this)}/>\n\n                  </div>\n                </div>\n              }\n            </div>\n            <div className=\"confidence-buttons\"></div>\n\n          </div>\n\n\n\n        </div>\n      </div>\n    )\n  }\n\n}\n\n\n\n\n// A simple function for traversing a list of nodes. Goes with the function below.\n// Both functions found on StackOverflow: https://stackoverflow.com/questions/7781963/js-get-array-of-all-selected-nodes-in-contenteditable-div\nfunction nextNode(node) {\n    if (node.hasChildNodes()) {\n        return node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n          node = node.parentNode;\n      }\n      if (!node) {\n          return null;\n      }\n      return node.nextSibling;\n    }\n}\n\n// A function for traversing the nodes present in the range object, which allows us to determine all html nodes\n// corresponding to selected items (items in which part of them are highlighted).\n// Note that you can't see the highlighted text on the screen because it has been hidden by css.\nfunction getRangeSelectedNodes(range) {\n    var node = range.startContainer;\n    var endNode = range.endContainer;\n\n    // Special case for a range that is contained within a single node\n    if (node == endNode) {\n        return [node.parentNode];\n    }\n\n    // Iterate nodes until we hit the end container\n    var rangeNodes = [];\n    while (node && node != endNode) {\n        rangeNodes.push( node = nextNode(node) );\n    }\n\n    // Add partially selected nodes at the start of the range\n    node = range.startContainer;\n    while (node && node != range.commonAncestorContainer) {\n        rangeNodes.unshift(node);\n        node = node.parentNode;\n    }\n\n    return rangeNodes;\n}\n\n\n// A simple class for displaying information related to the hotkeys the user is currently pressing.\nclass HotkeyInfo extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    var ec = this.props.entityClass;\n    if(ec === undefined) {\n      ec = '(not a valid class)';\n    }\n\n    return (\n      <div className={\"hotkey-info\" + (this.props.chain.length === 0 ? \" hidden\": \"\")}>\n        <span className=\"chain\">{this.props.chain}</span>: <span>{ec}</span>\n      </div>\n    )\n\n  }\n}\n\n\n\n// A debug printing function for printing out a list of annotations for a document.\nfunction prettyPrintAnnotations(documentAnnotations) {\n  console.log(\"Annotations:\\n\")\n  console.log(\"=====================\")  \n  for(var token_idx in documentAnnotations) {\n    documentAnnotations[token_idx].prettyPrint();\n  }\n}\n\n// The Wikipedia summary container, at the top-left.\nclass WikipediaSummary extends Component {\n\n  _isMounted = false;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: true,\n      querying: false, // Currently in the middle of a query\n      wikipediaSummary: null,\n      wikipediaReadMoreUrl: null,\n    }\n\n  }\n\n\n  queryWikipedia() {\n    if(this.state.querying) return; // Don't query multiple things at once\n\n    var tokens = this.props.tokens;\n\n    // Query Wikipedia for the currently selected tokens.\n    function runQuery(next) {\n\n      // Processes the result of a Wikipedia query.\n      function getResult(data, next) {\n        function stripTags(str) {\n          return str.replace(/<\\/?[^>]+(>|$)/g, \"\");\n        }\n        try {\n          var title = data.query.search[0].title;\n          var snippet = stripTags(data.query.search[0].snippet);\n          var wurl = \"https://en.wikipedia.org/wiki/\" + data.query.search[0].title.replace(/ /g, '_');\n          return next(title, snippet, wurl);\n        } catch(err) {\n          next();\n        }\n      }\n      $.ajax({\n        url: 'https://en.wikipedia.org/w/api.php',\n        data: { action: 'query', list: 'search', srsearch: tokens, format: 'json' },\n        dataType: 'jsonp',\n        success: function(data) {\n          getResult(data, next);\n        }\n      });\n    } \n\n    this.setState({\n      querying: true\n    }, () => {\n      var wikipediaSummary, wikipediaReadMoreUrl;\n      var t = this;\n\n      runQuery(function(title, snippet, wurl) {\n        if(!t._isMounted) return;\n\n\n        var wikipediaTitle = tokens;\n        if(snippet) {        \n          if(title.toLowerCase() !== tokens.toLowerCase()) {\n            wikipediaTitle = title;\n          }\n          wikipediaSummary = snippet + \"...\";\n          wikipediaReadMoreUrl = wurl;\n        } else {\n          wikipediaReadMoreUrl = null;\n          wikipediaSummary = null;  \n        }      \n\n        t.setState({\n          wikipediaTitle: wikipediaTitle,\n          wikipediaSummary: wikipediaSummary,\n          wikipediaReadMoreUrl: wikipediaReadMoreUrl,\n          querying: false,\n        })  \n      });\n\n    });\n  }\n\n\n  // Ensure API calls to Wikipedia aren't being made while this component is not mounted.\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  toggleVisibility() {\n    this.setState({\n      visible: !this.state.visible\n    })\n  }\n\n\n  componentDidUpdate(prevProps, prevState) {\n    if(prevProps.tokens !== this.props.tokens) {\n      this.queryWikipedia();\n    }\n  }\n\n  render() {    \n\n    if(!this.state.querying && this.state.wikipediaTitle && this.state.wikipediaTitle !== this.props.tokens) {\n      var title = <span className=\"different\">[{this.state.wikipediaTitle}] </span>\n    } else {\n      title = '';\n    }\n\n    var summary = this.state.wikipediaSummary ? this.state.wikipediaSummary : \"(no Wikipedia entry)\";\n    if(!this.props.tokens) {\n      summary = \"Select one or more words to automatically look them up on Wikipedia.\";\n    }\n    if(this.state.querying) {\n      summary = <span><i className=\"fa fa-spin fa-cog\"></i>&nbsp;&nbsp;Loading...</span>\n    }\n\n    // Rendering is a bit awkward, this could be tidied up\n    return (\n      <div className=\"tokens-info\">\n        <div id=\"wikipedia-summary-container\" className={this.state.visible ? \"show\" : \"hidden\"}>\n          <p className=\"tokens\">{this.props.tokens || 'Wikipedia lookup'}</p>\n          <p className=\"summary\">{ title }{ summary }</p>\n          <span className=\"more show\">\n            {(this.state.querying || !this.props.tokens) && <span className=\"left\" style={{\"color\": \"rgba(0, 0, 0, 0)\"}}>.</span>}\n            {!this.state.querying && this.props.tokens && <span className=\"left\">Results from Wikipedia</span>}\n            <span className=\"right\">\n              { !this.state.querying && this.props.tokens && <a id=\"ec-read-more\" href={this.state.wikipediaReadMoreUrl} target=\"_blank\">Read more <i className=\"fa fa-sm fa-external-link\"></i></a> } \n            </span>\n          </span>\n        </div>\n        <button id=\"wikipedia-hide-show\" className={this.state.visible ? \"up\" : \"down\"} onClick={this.toggleVisibility.bind(this)}>Show</button>\n      </div>\n    )\n  }\n}\n\n// The TaggingInterface class. Contains the vast majority of the logic for the interface.\nclass TaggingInterfaceView extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // Data (from the server)\n      // The data in this object is only changed by calling the queryAPI method.\n      // data: {\n      //   documentGroup: [],\n      //   documentIds:   [],\n      //   categoryHierarchy: {'children': []},\n      //   pageNumber: -1,\n      //   annotatedDocGroups: -1,\n      //   username: \"\",\n      // },\n\n      documentGroupAnnotationId: null, // The ID of the document group annotation object related to the document group the user is currently\n                                       // looking at. Will be null if the doc group has not been annotated by the user yet.\n                                       // Will be set when querying the API (for a previously annotated document group) or when\n                                       // submitting the annotations of a document group via submitAnnotations().\n\n\n      documents:   [],    // Stores the current documents\n      documentIds: [],    // Stores the Mongo IDs of the current documents,\n\n      documentAnnotationIds: [],    // Stores the Mongo IDs of the current document annotations (if they exist already)\n\n      categoryHierarchy: {'children': []},  // Stores the category hierarchy\n\n\n\n      annotations: [],  // Stores the user's annotations.\n      confidences: [],  // Stores the user's confidences.\n      comments:    [],  // Stores the comments (made by any user)\n\n\n      \n\n      // Selections\n      selections: this.getEmptySelectionsArray(10),       // The selections is an array containing a sub-array for each document,\n                                                          // which in turn hold all of the current selections made by the user for that\n                                                          // document.\n      currentSelection: this.getEmptyCurrentSelection(),  // The current selection is for when the user clicks a word and is in the process\n                                                          // of selecting an end word. \n      mostRecentSelectionText: null, // Keeps track of the tokens that the user most recently selected (for Wikipedia querying)\n      // Hotkeys\n      hotkeyMap: {},  // Stores a mapping of hotkey to number, e.g. 'item/pump': '11'.\n      reverseHotkeyMap: {}, // Stores the reverse of the above (number to hotkey), e.g. '11': 'item/pump'.\n      terminalHotkeys: new Set(),  // Stores the hotkeys of classes that are terminal, e.g. '1', '2' because Item and Activity do not have subclasses\n\n      hotkeyChain: [], // Stores the current hotkey chain, e.g. [1, 2, 3] = the user has pressed 1, then 2, then 3 in quick succession\n      hotkeyBindingFn: null,  // Stores the function that gets called via an eventlistener when a hotkey is pressed. Must be stored as a state\n                              // variable so that it can be detached when the hotkeys change.\n      hotkeyTimeoutFn: null,   // Stores the current hotkey timeout function.\n\n      // Key events\n      holdingCtrl: false, // Whether the user is currently holding the ctrl key.\n      holdingShift: false, // Whether the user is currently holding the shift key.\n\n      entityColourMap: {}, // A mapping of the top-level entity classes to a colour\n\n      docGroupLastModified: null, // Stores when the current document group was last saved.\n\n      pageNumber: -1, // The current page number the user is looking at.\n      totalPagesAvailable: -1, // The total number of pages available to the user, e.g. if they have annotated 1 group so far, then it's 2.\n\n      changesMade: false, // Stores whether the user has made any changes to the current document group.\n      recentlySaved: false, // Whether the doc group has been recently saved\n\n      selectionChangeFn: null,\n      windowMouseUpFn: null,\n\n      loading: {  // Stores whether this interface is currently requesting a docgroup from the server, or saving one\n        querying: true,\n        saving: false,\n        firstLoad: true,\n      },\n      showingProgressBar: false, // Whether the progress bar is currently visible\n\n      searchTerm: null, // Whether the user is currently searching for docs\n\n      docsPerPage: 10, // The number of docs per page, can be changed by the user\n\n      taggingCompletePage: false, // Set to true when the user is on the 'tagging complete' page.\n\n    }    \n  }\n\n\n\n  // When the user highlights text anywhere on the page, this function captures the event.\n  // If the user never selected a word to begin with, nothing happens.\n  // All it does is apply the 'highlighted' class onto any words that were caught in the highlighting.\n  // This function is purely stylistic, i.e. it doesn't affect any other components etc.\n  selectionChange(e, words) {\n    if(this.state.currentSelection.wordStartIndex < 0) {\n      return;\n    }\n    var sel = window.getSelection && window.getSelection();\n\n    if (sel && sel.rangeCount > 0) {\n      var r =  getRangeSelectedNodes(sel.getRangeAt(0));  \n      words.removeClass('highlighted');\n      $(r).find('.word-inner').addClass('highlighted');  \n    }\n  }\n\n  // When the user releases the mouse, remove all highlighting from words (i.e. the words in the selection).\n  // If the user never selected a word to begin with (i.e. wordStartIndex < 0), don't do anything.\n  windowMouseUp(e, words) {\n    if(e.target.classList.contains('page-input') || e.target.classList.contains('comment-input') || e.target.classList.contains('search-bar')) return;\n\n    words.removeClass('highlighted');\n    if(this.state.currentSelection.wordStartIndex < 0) {\n      //clearWindowSelection();\n      return;\n    }\n    if(!e.target.classList.contains('word-inner')) { // Ensure that the user is not hovering over a word            \n      var sentenceIndex = this.state.currentSelection.sentenceIndex;\n      this.updateSelections(sentenceIndex, this.state.documents[sentenceIndex].length - 1, 'up');\n    } \n  }\n\n  /* Mouse and keyboard events */\n\n  // Set up some mouse events - one for when text is selected (highlighted) in the browser.\n  // Note that in order to see the default browser highlighting the CSS file needs to be modified (it makes it invisible).\n  // Another for when the user releases the mouse anywhere on the page.\n  // Note that the majority of the mouse events are not in this function but are passed down to the Word elements via updateSelections.\n  // The event listeners need to be removed and reapplied to prevent duplication.\n  initMouseEvents() {\n\n    var words = $('.word-inner');\n\n    var selectionChangeFn = (e) => this.selectionChange(e, words);\n    var windowMouseUpFn = (e) => this.windowMouseUp(e, words);\n    \n    // Remove the old event listeners.\n    document.removeEventListener(\"selectionchange\", this.state.selectionChangeFn);   \n    window.removeEventListener('mouseup', this.state.windowMouseUpFn);\n\n    this.setState({\n      selectionChangeFn: selectionChangeFn,\n      windowMouseUpFn: windowMouseUpFn\n    }, () => {\n      // Add the new event listeners.\n      document.addEventListener(\"selectionchange\", this.state.selectionChangeFn);\n      window.addEventListener('mouseup', this.state.windowMouseUpFn);\n    });    \n  }\n\n  // Set up the key binds (ctrl, shift, left right up down etc).\n  // This function does not set up the hotkeys (that is done via setupHotkeyKeybinds)\n  initKeybinds() {\n\n    document.addEventListener('keydown', (e) => {\n      switch(e.key) {\n        case 'Shift':       if(!this.state.holdingShift) this.setState({ holdingShift: true }); break;\n        case 'Control':     if(!this.state.holdingCtrl) this.setState({ holdingCtrl: true }); break;\n\n        // For the arrows, call e.preventDefault() to prevent the window from scrolling\n        case 'ArrowLeft':   e.preventDefault(); this.moveSelectionHorizontally('left'); break; \n        case 'ArrowUp':     e.preventDefault(); this.moveSelectionVertically('up'); break;\n        case 'ArrowRight':  e.preventDefault(); this.moveSelectionHorizontally('right'); break;\n        case 'ArrowDown':   e.preventDefault(); this.moveSelectionVertically('down'); break;\n      }\n    });\n\n    document.addEventListener('keyup', (e) => {\n      switch(e.key) {\n        case 'Shift':   if(this.state.holdingShift) this.setState({ holdingShift: false }); break;\n        case 'Control': if(this.state.holdingCtrl) this.setState({ holdingCtrl: false }); break;\n      }      \n    });\n  }\n\n\n\n  /* Hotkey functions */\n\n  // When the user has pressed a hotkey that is not quickly followed up with another hotkey, this function is called.\n  // Apply the corresponding entity class and reset the hotkey chain.\n  hotkeyTimeout() {\n    var hotkeyChainStr = this.state.hotkeyChain.join('');\n\n    var entityClass = this.state.reverseHotkeyMap[hotkeyChainStr];\n    if(entityClass !== undefined) this.applyTag(entityClass);\n\n    // Clear the existing hotkey timeout fn.\n    window.clearTimeout(this.state.hotkeyTimeoutFn);\n    this.setState({\n      hotkeyTimeoutFn: null,      \n      hotkeyChain: [],\n    })\n  }\n\n  // This function is called when a hotkey is pressed.\n  // If a hotkey was pressed previously within 333ms, the chain will grow until the point the user no longer presses a hotkey\n  // for 333ms.\n  bindHotkeys(e, hotkeyMap) {\n    if(e.keyCode < 49 || e.keyCode > 57) return; // Hotkeys are in the range 1-9, which are keyCode 49-57.\n    var key = e.keyCode - 48;\n\n    // If user is currently focused on the page input, do nothing.\n    if($(\"#page-input\").is(\":focus\")) return;\n    if($(\"textarea\").is(\":focus\")) return;\n\n    // Update the hotkey chain to include the key that was pressed\n    var hotkeyChain = Array.prototype.concat(this.state.hotkeyChain, key);\n    this.setState({\n      hotkeyChain: hotkeyChain\n    }, () => {\n\n      // Remove the previous timeout and set up a new one\n      window.clearTimeout(this.state.hotkeyTimeoutFn);\n\n\n\n      // Check if hotkey was terminal, i.e. at the leaf of the tree\n      if(this.state.terminalHotkeys.has(hotkeyChain.join(''))) {\n        this.hotkeyTimeout();\n      } else {\n        var hotkeyTimeoutFn = window.setTimeout(() => this.hotkeyTimeout(), 333);\n        this.setState({\n          hotkeyTimeoutFn: hotkeyTimeoutFn\n        });\n      }\n\n            \n      \n    });\n  }\n\n  // Assign keybinds to each of the hotkeys in the hotkey map.\n  setupHotkeyKeybinds() {\n    \n    console.log(\"Setting up hotkey keybinds...\")\n\n    console.log(this.state.reverseHotkeyMap);\n\n    // Clear the current hotkey binding function and set up a new one.\n    document.removeEventListener('keydown', this.state.hotkeyBindingFn);\n    var hotkeyBindingFn = (e) => this.bindHotkeys(e, this.state.hotkeyMap);\n\n    document.addEventListener('keydown', hotkeyBindingFn);\n\n    // Store the binding function in this.state so that it can be removed in subsequent calls of this function.\n    this.setState({\n      hotkeyBindingFn: hotkeyBindingFn,\n    });\n  }\n\n  // Builds the hotkey map according to the ordered category hierarchy, and saves it to this component's state.\n  // The hotkey map will change whenever the user changes the order of them items via drag and drop.\n  initHotkeyMap(orderedItems, next) {\n\n    console.log(\"Setting up hotkey map...\")\n    // Annoying that the following is a recursive function but I think it's the only way to do it.\n    // The result is a hotkeyMap as follows:\n    /*  {\n          'item': [1],\n          'item/pump': [1, 1],\n          'item/pump/centrifugal_pump': [1, 1, 1],\n          'item/pump/big_pump': [1, 1, 2],\n          'item/compressor': [1, 2],\n          'activity': [2]\n        }\n    */\n    function traverseChild(child, index, hotkeyMap, hotkeys, terminalHotkeys, firstPass) {\n      if(!firstPass) {\n        hotkeyMap[child.full_name] = hotkeys;\n      }\n      if(child.children) {\n        for(var i = 0; i < Math.min(9, child.children.length); i++) { // Don't go past index 9 so that the hotkeys make sense\n          traverseChild(child.children[i], i + 1, hotkeyMap, Array.prototype.concat(hotkeys, i + 1), terminalHotkeys);\n        }\n      } else {\n        terminalHotkeys.add(hotkeys.join(''));\n      }\n      return {hotkeyMap: hotkeyMap, terminalHotkeys: terminalHotkeys};          \n    }    \n\n    // Build the reverse of the hotkeyMap, i.e. swap the keys with the values.\n    // This assists with the hotkey bindings function.\n    function buildReverseHotkeyMap(hotkeyMap) {\n      var reverseHotkeyMap = {};\n      for(var key in hotkeyMap){\n        var val = hotkeyMap[key].join('');\n        reverseHotkeyMap[val] = key;\n      }\n      return reverseHotkeyMap;    \n    }\n\n\n    var d = traverseChild({children: orderedItems}, 1, [], [], new Set(), true);\n    var hotkeyMap = d.hotkeyMap;\n    var terminalHotkeys = d.terminalHotkeys;\n    var reverseHotkeyMap = buildReverseHotkeyMap(hotkeyMap);\n\n    // Once the hotkeyMap (and reverseHotkeyMap) has been created, set up the hotkey keybinds and call the callback fn.\n    this.setState({\n      hotkeyMap: hotkeyMap,\n      reverseHotkeyMap: reverseHotkeyMap,\n      terminalHotkeys: terminalHotkeys,\n    }, () => { this.setupHotkeyKeybinds(); if(next) next(); });\n  }\n\n\n  \n\n  // Initialise the confidences array.\n  initConfidencesArray(documents) {\n    var confidences = new Array(documents.length);\n    return confidences;\n  }\n\n  // Initialise the entity colour map, which maps entity_class: colour_index, e.g. \"Item\": 1. Passed to the Word components to colour\n  // their labels accordingly.\n  initEntityColourMap(categoryHierarchy) {\n    var entityColourMap = {}\n    for(var ec_idx in categoryHierarchy) {\n      var entityClass = categoryHierarchy[ec_idx];\n      entityColourMap[entityClass.name] = entityClass.colorId + 1;\n    }\n    return entityColourMap;\n  }\n\n\n  /* Miscellaneous */\n\n  // Justify the words to the nearest 25px (i.e. round their width up to the nearest 25px).\n  // Not really necessary but makes the diagonal stripey lines line up properly when multiple tokens are selected.\n  // I spent about 2 hours trying to figure out how to get the stripey lines to line up properly, this is the result :D\n  justifyWords() {\n    $('.word-inner').each((i, ele) => {\n      var width = ele.offsetWidth;\n      var newWidth = Math.ceil(width / 25) * 25;\n      $(ele).css('min-width', newWidth + 'px');\n    });\n  }\n\n  // Remove min-width from words that do not have a tag\n  // (necessary to call between pages)\n  clearWordJustification() {\n    $('.word:not(.tag) .word-inner').each((i, ele) => {\n       $(ele).css('min-width', 'auto');\n    })\n  }\n\n  // Load the next page by calling the API.\n  // Query without a page number (i.e. request the latest group)\n  // if the user is looking at the group before the latest group.\n  //\n  // TODO: Make it so that when the user has made a change to the group they're looking at,\n  // pop up a confirmation window to confirm their changes before loading the next page?\n  loadNextPage() {\n    if(this.state.loading.querying) return; // Don't load new page if currently loading\n    var nextPageNumber = this.state.pageNumber + 1;\n\n    if(nextPageNumber === (this.state.totalPagesAvailable)  && !this.state.searchTerm) {\n      this.queryAPI(false);\n    } else {\n      this.queryAPI(false, nextPageNumber);\n    }\n  }\n\n  goToPage(pageNumber) {\n    if(this.state.loading.querying) return; // Don't load new page if currently loading\n    \n    console.log(pageNumber);\n    if(this.state.searchTerm) {\n      this.queryAPI(false, pageNumber);\n      return;\n    }\n\n    if(pageNumber === this.state.totalPagesAvailable) {\n      this.queryAPI(false);\n    } else {\n      this.queryAPI(false, pageNumber);\n    }\n  }\n\n  // Load the previous page by calling the API.\n  loadPreviousPage() {\n    this.queryAPI(false, this.state.pageNumber - 1);\n  }\n\n  // Search all documents for a specific search term.\n  searchDocuments(searchTerm) {\n    this.setState({\n      searchTerm: searchTerm \n    }, () => {\n      if(searchTerm) {\n        this.queryAPI(false, 1);\n      } else {\n        this.queryAPI(false);\n      }\n      \n    });   \n  }\n\n  setDocsPerPage(e) {\n\n    var docsPerPage = e.target.value;\n    var pageNumber = this.state.pageNumber;\n    var prevDocsPerPage = this.state.docsPerPage;\n\n    // Load the page roughly resembling the position the user is currently in by doing some maths on the page number\n    var newPageNumber = Math.min(this.state.totalPagesAvailable + 1, Math.floor(pageNumber / docsPerPage * prevDocsPerPage));\n    if(newPageNumber === this.state.totalPagesAvailable + 1) {\n      newPageNumber = null;\n    }\n\n    this.setState({\n      docsPerPage: docsPerPage,\n    }, () => {\n      //if(this.state.searchTerm) {\n      this.queryAPI(false, newPageNumber);\n      //} else {\n      //  this.queryAPI(false, newPageNumber);\n      //}\n    })\n  }\n\n  /* API calls */\n\n  queryAPI(firstLoad, pageNumber) {\n\n    var route;\n    var searchTerm = this.state.searchTerm;\n\n    // If this function was called with a pageNumber, load a specific documentGroupAnnotation.\n    if(pageNumber) {\n      //route = 'getPreviouslyAnnotatedDocumentGroup?pageNumber=' + pageNumber + \"&perPage=20\";\n      route = 'getDocumentGroup?pageNumber=' + pageNumber + '&perPage=' + this.state.docsPerPage;\n    } else {\n      route = 'getDocumentGroup?pageNumber=latest&perPage=' + this.state.docsPerPage;\n    }\n    if(searchTerm) {\n      route += \"&searchTerm=\" + searchTerm;\n    }\n\n\n\n    this.setState({\n      loading: {\n        querying: true,\n        saving: false,\n        firstLoad: firstLoad,\n      }\n    }, function() {\n      fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/tagging/' + route, fetchConfigGET) // TODO: move localhost out\n        .then((response) => {\n            if(response.status !== 200) {\n              var t = response.text();\n              console.log(t);\n              throw new Error(response.status); \n            }              \n            return response.text()\n        })\n        .then((data) => {\n          //console.log(\"data:\", data);\n          try { \n            var d = JSON.parse(data);\n          } catch(err) {\n            alert(err);\n            return;\n          }\n\n\n          if(d.tagging_complete) {\n            //console.log(d);\n            this.setState({\n              taggingCompletePage: true,\n\n              pageNumber: d.pageNumber,\n              totalPages: d.totalPages,\n              totalPagesAvailable: d.totalPagesAvailable + 1,\n\n              changesMade: false,\n              recentlySaved: false,\n\n              loading: {\n                querying: false,\n                saving: false,\n              },\n            })\n            console.log(d)\n            return;\n          } \n\n          \n          this.setState(\n            {\n\n              data: d,\n              \n              documents:   d.documents,\n              documentIds: d.documentIds,\n\n              documentAnnotationIds: d.documentAnnotationIds ? d.documentAnnotationIds : null, // Will only be present when querying existing annotations\n\n              confidences: this.initConfidencesArray(d.documents),\n              annotations: initAnnotationsArray(d.documents, d.automaticAnnotations),\n\n              comments:    d.comments,\n\n              categoryHierarchy: d.categoryHierarchy,\n\n              entityColourMap: this.initEntityColourMap(d.categoryHierarchy.children),\n              \n              selections: this.getEmptySelectionsArray(d.documents.length),\n              mostRecentSelectionText: null,\n\n              pageNumber: d.pageNumber,\n              totalPages: d.totalPages,\n              totalPagesAvailable: d.totalPagesAvailable,\n\n              docGroupLastModified: d.lastModified,\n              documentGroupAnnotationId: d.documentGroupAnnotationId, // Will be null if this doc group has not yet been annotated\n\n              changesMade: false,\n              recentlySaved: false,\n              loading: {\n                querying: false,\n                saving: false\n              },     \n              taggingCompletePage: false,         \n            }, () => { \n\n              if(d.projectTitle && d.projectAuthor) {\n                this.props.setProject(d.projectTitle, d.projectAuthor)\n              }\n\n              // Initialise keybinds and mouse events only on the first API call.\n              if(firstLoad) {\n                this.initKeybinds();              \n                this.initHotkeyMap(this.state.categoryHierarchy.children);   \n              }\n\n              this.initMouseEvents();\n              this.clearWordJustification();    \n              this.justifyWords();    \n              this.selectFirstWord();\n\n\n              window.scrollTo(0, 0);\n            })\n        }).catch((err) => {\n          console.log(err.message);\n\n          this.props.setErrorCode(parseInt(err.message));\n\n        });\n        \n\n    }.bind(this));\n  }\n\n  // Convert the annotations array into JSON.\n  annotationsToJSON() {\n    var annotations = this.state.annotations;\n    var annotationsJSON = [];\n    for(var doc_idx in annotations) {\n        \n      var docLabels = [];\n      for(var token_idx in annotations[doc_idx]) {\n        var ann = annotations[doc_idx][token_idx];\n        if(ann.entityClasses) {\n          docLabels.push([ann.bioTag + \"-\", ann.entityClasses]);\n        } else {\n          docLabels.push([\"\"])\n        }\n      }\n      annotationsJSON.push(docLabels);\n    }\n    return annotationsJSON;\n  }\n\n\n  // Submit the annotations of the document group that the user is currently looking at.\n  // TODO: Maybe make it so that you can't save the annoations until the user has put all their confidences in?\n  // Or perhaps do a check and pop a confirmation window up if they click save without doing anything to >= 1 document\n  submitAnnotations() {\n    if(this.state.recentlySaved) { return; } // If the user clicks on the green save button, provide them with the illusion that it is doing\n                                             // something when in fact nothing actually happens. Prevents people from spam clicking the save and\n                                             // calling the API 5000 times...\n                                             // It's kind of like how google sheets allows you to press Ctrl + S despite it saving every action\n                                             // automatically.\n\n    const csrfToken = getCookie('csrf-token');\n\n    var annotationsJSON = this.annotationsToJSON();\n\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify({\n        documentIds: this.state.documentIds,\n        documentAnnotationIds: this.state.documentAnnotationIds,\n        labels: annotationsJSON\n      }),  \n    };\n\n    this.setState({\n      loading: {\n        querying: false,\n        saving: true,\n      }\n    }, () => {\n\n      fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/tagging/submitAnnotations', fetchConfigPOST) // TODO: move localhost out\n      .then((response) => {\n        if(response.status !== 200) {          \n          throw new Error(response.status); \n        }              \n        return response.text()\n      })\n      .then((data) => {\n        try { \n          var d = JSON.parse(data);\n\n          var documentAnnotationIds = d.documentAnnotationIds;\n\n          console.log(\"Submitted annotations OK\");\n\n          // If the user is on the last page (i.e. the 'current group'), add one to the totalPages array so that the user can\n          // click 'Next' to go to the latest doc group.\n          if(this.state.pageNumber === this.state.totalPagesAvailable && !this.state.searchTerm) {\n            var newTotalPagesAvailable = this.state.totalPagesAvailable + 1;\n            this.setState({\n              showingProgressBar: true,\n            }, () => {\n              window.setTimeout(() => this.setState({\n                showingProgressBar: false,\n              }), 3000);\n            })\n\n          } else {\n            var newTotalPagesAvailable = this.state.totalPagesAvailable;\n          }\n\n          this.setState({\n             docGroupLastModified: Date.now(),\n\n             totalPagesAvailable: newTotalPagesAvailable,       \n\n             documentAnnotationIds: documentAnnotationIds,\n\n             changesMade: false,\n             recentlySaved: true,\n             loading: {\n              querying: false,\n              saving: false\n             }\n          });\n        } catch(err) {\n          console.log(\"ERROR:\", err);\n          alert(data);\n        }\n        \n      }).catch((err) => {\n        console.log(err.message);\n        this.props.setErrorCode(parseInt(err.message));\n      });;\n    })\n  }\n\n  /* Mounting function */\n\n  // When this component is mounted, call the API.\n  // Set up the keybinds and mouseup event when done.\n  componentWillMount() {\n\n    // var pathname = window.location.pathname;\n    // var project_id = pathname.split('/')[2];\n    // if(pathname === \"/\") {\n    //   //var project_id = 'RtJp98vxk'; // React development (completed project)\n    //   //var project_id = 'KPJqR4HB8'; // React development (long docs)\n    //   var project_id = '-krXeW3R2'; // React development (big work order one)\n    // }\n    // if(!project_id || project_id.length < 8) {\n    //   alert(\"invalid project\");\n    //   return;\n    // }\n\n\n\n    // this.setState({\n    //   project_id: project_id\n    // }, () => { \n    this.queryAPI(true);\n  }  \n\n  /* Selection functions */\n\n  // Get an empty current selection.\n  // Called when we need to clear the current selection.\n  getEmptyCurrentSelection() {\n    return {\n      wordStartIndex: -1,\n      wordEndIndex: -1,\n      sentenceIndex: -1\n    }\n  }\n\n  // Move the selection up or down.\n  // This function should be called when one of those keys is pressed.\n  moveSelectionVertically(direction) {\n    console.log(\"Moving\", direction) // TODO: Make this move up and down\n\n    var selections = this.state.selections;\n\n    var newSelections = this.getEmptySelectionsArray();\n\n    var mostRecentSelectionText;\n\n    \n    // Move all selections in the specified direction (up or down)\n    for(var i = 0; i < selections.length; i++) {\n      for(var j = 0; j < selections[i].length; j++) {\n\n        var selection = selections[i][j];\n        var x;\n\n        if(direction === \"up\") {     \n          var x = -1;\n          if(i === 0) x = 0;\n\n        } else if (direction === \"down\") {          \n\n          var x = 1;\n          if(i === selections.length - 1) x = 0;\n        }\n        newSelections[i + x] = [{\n          wordStartIndex: 0,\n          wordEndIndex: 0\n        }]\n        mostRecentSelectionText = this.state.documents[i + x].slice(0, 1).join(' ');\n      }\n    }\n    this.setState({\n      selections: newSelections,\n      mostRecentSelectionText: mostRecentSelectionText\n    });\n  }\n\n  // Move the selection in the specified direction ('left', 'right').\n  // This function should be called when one of those keys is pressed.\n  moveSelectionHorizontally(direction) {\n    console.log(\"Moving\", direction)\n\n    var selections = this.state.selections;\n    var mostRecentSelectionText;\n\n    // Move all selections left or right\n    for(var i = 0; i < selections.length; i++) {\n      for(var j = 0; j < selections[i].length; j++) {\n        var selection = selections[i][j];\n\n        // Behaviour depends on whether shift is currently being held down.\n        if(direction === \"left\") {\n          if(!this.state.holdingShift) {\n            selection.wordStartIndex = Math.max(selection.wordStartIndex - 1, 0);\n            selection.wordEndIndex = selection.wordStartIndex;\n          } else { // If shift is being held down, move the wordEndIndex backwards or move the wordStartIndex backwards depending on the current selection.\n            if(selection.wordEndIndex > selection.wordStartIndex) {\n              selection.wordEndIndex--;\n            } else {\n              selection.wordStartIndex = Math.max(selection.wordStartIndex - 1, 0);\n            }\n          }\n        } else if (direction === \"right\") {\n          if(!this.state.holdingShift) { // If shift *is* being held down, this won't happen (the wordStartIndex won't change).\n            selection.wordStartIndex = Math.min(this.state.documents[i].length - 1, selection.wordEndIndex + 1);\n          }\n          selection.wordEndIndex   = Math.min(this.state.documents[i].length - 1, selection.wordEndIndex + 1);\n        }\n\n        mostRecentSelectionText = this.state.documents[i].slice(selection.wordStartIndex, selection.wordEndIndex + 1).join(' ');\n      }\n    }\n    this.setState({\n      selections: selections,\n      mostRecentSelectionText: mostRecentSelectionText\n    });\n  }\n\n  // Get an empty selections array whose length is the number of docs in the current documentGroup.\n  getEmptySelectionsArray(numDocs) {\n    if(!numDocs) {\n      var numDocs = this.state.documents.length;\n    }\n    var selections = new Array(numDocs);\n    for(var i = 0; i < selections.length; i++) {\n      selections[i] = new Array();\n    }    \n    return selections;\n  }  \n\n  // Select the first word in the first sentence.\n  // (called when a new group is loaded).\n  selectFirstWord() {\n    var selections = this.state.selections;\n    if(selections.length === 0) return;\n    selections[0].push({\n      wordStartIndex: 0,\n      wordEndIndex: 0\n    });\n    this.setState({\n      selections: selections,\n      mostRecentSelectionText: this.state.documents.length > 0 ? this.state.documents[0][0] : \"\",\n    });\n  }\n\n  // Clear all active selections by resetting the selections array.\n  clearSelections() {\n    this.setState( {\n      currentSelection: this.getEmptyCurrentSelection(),\n      selections: this.getEmptySelectionsArray()\n    });\n  }\n\n  // Update this component's selections state.\n  // This function is called via the mouse, and has no relation to the keyboard (keyboard selections are handled above).\n  // sentenceIndex: The index of the sentence in which the selection was made.\n  // wordIndex: the index of the word that was clicked on, or hovered over and the mouse released.\n  // action: Whether the mouse was pressed down ('down') or released ('up').\n  updateSelections(sentenceIndex, wordIndex, action) {\n    var wordStartIndex, wordEndIndex;\n\n    var selections = this.state.selections;\n    var currentSelection = this.state.currentSelection;\n\n    if (action === \"down\") { // Mouse down, i.e. a word was clicked.\n\n      if(!this.state.holdingCtrl) {\n        selections = this.getEmptySelectionsArray(); // Reset all selections upon clicking a word, unless Ctrl is being held.\n      }\n      wordStartIndex = wordIndex;\n      wordEndIndex = -1;\n\n      // A new selection is made, capturing the index of the sentence that the user clicked on and the index of the word that they clicked.\n      currentSelection = {\n        sentenceIndex: sentenceIndex,\n        wordStartIndex: wordStartIndex\n      }      \n\n    } else if(action === \"up\") { // Mouse up, i.e. mouse was released when hovering over a word.\n\n      // Only allow selections where the user has clicked on a starting word.\n      if(currentSelection.wordStartIndex === -1) {\n        this.clearSelections();\n        return;\n      }\n\n      wordStartIndex = currentSelection.wordStartIndex;\n\n      // If the first word selected was in a different sentence, the wordStartIndex becomes the start of the sentence where the mouse was released.\n      if(currentSelection.sentenceIndex !== sentenceIndex) {  // TODO: Make this consider mouseX relative to the X of the initial token?\n        wordStartIndex = 0;\n      };\n\n      wordEndIndex = wordIndex;\n\n      // If the second word selected was before the first, swapperino them around (so that backwards selections work as expected).\n      if(wordIndex < wordStartIndex) {\n        var s = wordStartIndex;\n        wordStartIndex = wordIndex;\n        wordEndIndex = s;\n      }     \n\n      // Create a new selections json object and push it to the selections array for this sentence.\n      currentSelection = this.getEmptyCurrentSelection();\n      selections[sentenceIndex].push({\n        wordStartIndex: wordStartIndex,\n        wordEndIndex: wordEndIndex\n      });\n      var mostRecentSelectionText = this.state.documents[sentenceIndex].slice(wordStartIndex, wordEndIndex + 1).join(' ');\n\n      clearWindowSelection(); // Remove the default browser selection highlighty thing.\n    }    \n\n    this.setState({\n      currentSelection: currentSelection,\n      selections: selections,\n      mostRecentSelectionText: mostRecentSelectionText ? mostRecentSelectionText : this.state.mostRecentSelectionText,\n    });\n  }\n\n\n\n\n  /* Tag application function */\n\n  // Apply a specific tag to all current selections.\n  // entityClass: The full name of the entity class, e.g. 'item/pump/centrifugal_pump'.\n  // This function will either be called via clicking on an entity class in the tree, or by using hotkeys.\n  applyTag(entityClass) {    \n    //console.log(\"Applying tag:\", entityClass);\n    var selections = this.state.selections;\n    var documents = this.state.documents;\n    var annotations = this.state.annotations;\n\n    for(var doc_idx in selections) {\n      for(var sel_idx in selections[doc_idx]) {\n        var sel = selections[doc_idx][sel_idx];\n        var start = sel.wordStartIndex;\n        var end = sel.wordEndIndex;\n\n\n        /* 1. Disjoint spans */\n        // Check all labels across this selected span of tokens are the same before proceeding.\n        // If they are not, they must be cleared before adding a label.\n        var annotationSpanStart = annotations[doc_idx][start].spanStartIdx;\n        var annotationSpanEnd   = annotations[doc_idx][start].spanEndIdx;\n        var notAllEqual = false;          \n        for(var k = start + 1; k <= end; k++) {\n          var otherAnnotation = annotations[doc_idx][k]; \n          if(annotationSpanStart !== otherAnnotation.spanStartIdx || annotationSpanEnd !== otherAnnotation.spanEndIdx) {\n            notAllEqual = true;\n            break;\n          }          \n        }        \n\n        // If the labels across all tokens in the selected span are not the same, remove all labels for the entire span.\n        // Then modify the spanEndIdx of any annotations in this document whose spanEndIdx was overlapping the\n        // span that the user selected, setting them to be start index - 1 (before the span).\n        // This ensures the ends of the spans are drawn properly.\n        if(notAllEqual) {\n          for(var k = start; k <= end; k++) {\n            var annotation = annotations[doc_idx][k];\n            annotation.removeAllLabels();\n          }          \n          // Adjust the span end index of all prev labels to be start index - 1\n          // A shame that we have to iterate across all annotations in this document - this could probably be optimised\n          // but it probably barely impacts performance even on large docs (I think)\n          for(var x in annotations[doc_idx]) {\n            var annotation = annotations[doc_idx][x];\n\n\n            // If this new span overlaps the *end* of an existing span, change that span's end index to the start of this new\n            // span, -1\n\n            if(annotation.spanEndIdx >= start && annotation.spanStartIdx <= start) {              \n              annotation.setSpanEndIdx(start - 1);\n\n            }\n\n            // If this new span overlaps the *start* of an existing span, change that span's start index to be the end of this new span -1\n            // and change the BIO tag to \"B\".\n            if(annotation.spanStartIdx <= end) {\n              annotation.setSpanStartIdx(end + 1);              \n              if(annotation.tokenIndex === (end + 1)) {\n                annotation.changeBioTag(\"B\") // I am realising now that this BIO tag is unnecessary - it could be inferred\n              }\n            }\n          }\n        }\n\n        /* 2. Overlapping spans */\n        // Check for any spans that this new span will cut into.\n        // First, check to the left and adjust the spanEndIdx of all Annotation objects\n        // to the left of this span if they overlap.\n        for(var ann_idx in annotations[doc_idx].slice(0, start)) {\n          var annotation = annotations[doc_idx][ann_idx];          \n          if(annotation.spanStartIdx < start && annotation.spanEndIdx >= end) {            \n            annotation.setSpanEndIdx(start - 1);\n          }\n        }\n\n        // Do the same for any Annotation objects on the right hand side of this span, which are part of the same\n        // mention.\n        for(var ann_idx in annotations[doc_idx].slice(end + 1, annotations[doc_idx].length)) {\n          var annotation = annotations[doc_idx][parseInt(ann_idx) + end + 1];\n          if(annotation.spanStartIdx <= start && annotation.spanEndIdx >= end) {\n            annotation.setSpanStartIdx(end + 1);\n            if(ann_idx === '0') {\n              annotation.changeBioTag(\"B\");\n            }\n          }\n        }\n\n        /* 3. Applying the labels */\n        // Now, apply the tags to every token in the selected span.\n        var labelWasModified = false;\n        for(var k = start; k <= end; k++) {\n          var bioTag = k === start ? \"B\" : \"I\";\n          var spanText = documents[doc_idx].slice(start, end + 1).join(' ');\n\n          //var prevAnnotation = k > 0 ? annotations[doc_idx][k - 1] : null;\n          //var nextAnnotation = k < (documents[doc_idx].length - 1) ? annotations[doc_idx][k + 1] : null;          \n\n          labelWasModified = annotations[doc_idx][k].addLabel(bioTag, entityClass, spanText, start, end);\n\n        }\n\n        if(labelWasModified) this.captureEvent('Applied label', parseInt(doc_idx), start, end, entityClass);\n      }\n    }\n    this.setState({\n      annotations: annotations,\n    }, () => {\n      this.justifyWords(); // Justify the words again to ensure the stripey lines line up correctly\n\n      // Debug:\n      //prettyPrintAnnotations(this.state.annotations[0]);\n      //console.log(\"Updated annotations[0]:\", this.state.annotations[0]);\n    })\n\n  }\n\n  // Deletes the specified tag.\n  // Unlike applyTag, this is applied to a specified sentenceIndex and wordIndex rather than to all current selections.\n  deleteTag(sentenceIndex, wordIndex, entityClass) {\n    \n    var annotations = this.state.annotations;\n    var annotation = annotations[sentenceIndex][wordIndex];\n\n    // Retrieve the span start idx and span end idx of the annotation corresponding to (sentence_index, word_index)\n    var spanStart = annotation.spanStartIdx;\n    var spanEnd = annotation.spanEndIdx;\n\n    this.captureEvent('Deleted label', sentenceIndex, spanStart, spanEnd, entityClass);\n\n    // Find all annotations in this document in the same mention span and remove the label from all of them.\n    // (this will also remove the label from the annotation object at (sentence_index, word_index)).\n    for(var ann_idx in annotations[sentenceIndex]) {\n      var otherAnnotation = annotations[sentenceIndex][ann_idx];       \n      if(otherAnnotation.spanStartIdx === spanStart && otherAnnotation.spanEndIdx === spanEnd) {\n        otherAnnotation.removeLabel(entityClass);\n      }\n    }\n\n    this.setState({\n      annotations: annotations\n    });\n\n  }\n\n  /* Confidence */\n\n  // Updates the confidences array for the given doc.\n  // If the user clicks on the button they already clicked, then the confidence is reset to undefined.\n  updateConfidence(sentenceIndex, confidence) {\n    var confidences = this.state.confidences;\n    if(confidences[sentenceIndex] === confidence) {\n      confidences[sentenceIndex] = undefined;\n    } else {\n      confidences[sentenceIndex] = confidence;\n    }\n    this.setState({\n      confidences: confidences\n    });\n  }\n\n\n  /* Comments */\n\n  submitComment(message, documentIndex, next) {\n    console.log(\"Message:\", message, \"Document index\", documentIndex);\n\n    const csrfToken = getCookie('csrf-token');\n\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify({\n        text: message,\n        documentId: this.state.documentIds[documentIndex],\n      }),  \n    };\n\n    fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/comments/submit', fetchConfigPOST) // TODO: move localhost out\n    .then((response) => {\n        if(response.status !== 200) {\n          throw new Error(response.status); \n        }              \n        return response.text()\n    })\n    .then((data) => {\n      console.log(data);\n      try { \n        var d = JSON.parse(data);\n        \n\n        console.log(\"Submitted comment OK\");\n\n        var comments = this.state.comments;\n        comments[documentIndex].push(d.comment);\n\n        this.setState({\n           comments: comments,\n        }, next);\n      } catch(err) {\n        console.log(\"ERROR:\", err);\n      }      \n    }).catch((err) => {\n      console.log(err.message);\n\n      this.props.setErrorCode(parseInt(err.message));\n\n    });\n\n\n    \n  }\n\n  /* Events */\n\n  // Capture an event\n  // TODO: Make it do something\n  captureEvent(eventAction, sentenceIndex, spanStart, spanEnd, entityClass) {\n\n    var tokenString = this.state.documents[sentenceIndex].slice(spanStart, spanEnd + 1).join(' ')\n\n    var event = {\n      \"action\": eventAction,\n      \"sentenceIndex\": sentenceIndex,\n      \"wordIndex\": {\n        \"start\": spanStart,\n        \"end\": spanEnd,\n      },\n      \"entityClass\": entityClass,\n      \"tokenString\": tokenString\n    }\n\n    if(eventAction === \"Applied label\" || eventAction === \"Deleted label\") {\n      this.setState({\n        changesMade: true,\n        recentlySaved: false,\n      })\n    }\n\n  }\n\n  /* Rendering function */\n\n\n  render() {\n    var taggingCompletePage = this.state.taggingCompletePage;\n\n    //console.log(this.state.documents, taggingCompletePage);\n\n    return (\n        <div>   \n          {!this.state.error &&          \n          <div id=\"tagging-interface\" className={(this.state.loading.querying ? \"loading\" : \"\") + (taggingCompletePage ? \" tagging-complete-page\" : \"\")}>\n\n            <div id=\"tagging-container\">\n              { taggingCompletePage && <TaggingCompletePage/>}\n              <div id=\"sentence-tagging\">\n\n                { this.state.loading.firstLoad && \n                  <div className=\"loading-message\">\n                    <i className=\"fa fa-cog fa-spin\"></i>Loading...\n                  </div>\n                }\n\n                <ControlBar\n                  showingProgressBar = {this.state.showingProgressBar}\n                  pageNumber = {this.state.pageNumber}\n                  totalPages = {this.state.totalPages}\n                  totalPagesAvailable = {this.state.totalPagesAvailable}\n                  lastModified={this.state.docGroupLastModified}\n                  recentlySaved={this.state.recentlySaved}\n                  changesMade={this.state.changesMade}\n                  querying={this.state.loading.querying}\n                  saving={this.state.loading.saving}\n                  inSearchMode={this.state.searchTerm}\n\n                  showDocsPerPage={true}\n                  docsPerPage={this.state.docsPerPage}\n                  docsPerPageOptions={[1, 3, 5, 10, 15, 20]}\n\n                  showSaveButton={true}\n\n                  searchDocuments={this.searchDocuments.bind(this)}\n                  submitAnnotations={this.submitAnnotations.bind(this)}\n                  loadPreviousPage={this.loadPreviousPage.bind(this)}\n                  loadNextPage={this.loadNextPage.bind(this)}\n                  goToPage={this.goToPage.bind(this)}\n                  setDocsPerPage={this.setDocsPerPage.bind(this)}\n                />\n\n                <DocumentContainerHeader/>\n                    \n                { this.state.documents.map((doc, i) => \n                  <DocumentContainer\n                    key={i}\n                    index={ i }\n                    displayIndex={( (this.state.pageNumber - 1) * 10 ) + i + 1  }\n                    words={doc}              \n                    annotations={this.state.annotations[i]}  \n                    comments={this.state.comments[i]}\n                    confidence={this.state.confidences[i]}\n                    selections={this.state.selections[i]}\n                    updateSelections={this.updateSelections.bind(this)}\n                    updateConfidence={this.updateConfidence.bind(this)}\n                    entityColourMap={this.state.entityColourMap}\n                    deleteTag={this.deleteTag.bind(this)}\n                    submitComment={this.submitComment.bind(this)}\n                    user={this.props.user}\n                  />\n                  )}\n                  {\n                    (!this.state.loading.querying && this.state.documents.length === 0 && !this.state.taggingCompletePage) && <div className=\"loading-message no-results-found\">No results found.</div>\n\n\n                  }\n\n              </div>\n            </div>\n            <div id=\"tagging-menu\">\n\n              <div className=\"project-card\">\n                <div>\n                  <div className={\"project-name\" + (!this.props.projectTitle ? \" st\" : \"\")} style={{'display': 'block'}}><Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/dashboard\"}>{this.props.projectTitle ? this.props.projectTitle : \"xxxxxxxx\"}</Link></div>\n                  <div className={\"project-creator\" + (!this.props.projectAuthor ? \" st\" : \"\")} style={{'display': 'block'}}>Created by <span className=\"creator-name\">{this.props.projectAuthor ? this.props.projectAuthor : \"xxxxxxxx\"}</span></div>\n                </div>\n              </div>\n\n              <WikipediaSummary tokens={this.state.mostRecentSelectionText}/>\n              <HotkeyInfo \n                chain={this.state.hotkeyChain}\n                entityClass={this.state.reverseHotkeyMap[this.state.hotkeyChain.join('')]}\n              />            \n              \n              <CategoryHierarchy\n                items={this.state.categoryHierarchy.children}\n                hotkeyMap={this.state.hotkeyMap}\n                hotkeyChain={this.state.hotkeyChain.join('')}\n                initHotkeyMap={this.initHotkeyMap.bind(this)}\n                applyTag={this.applyTag.bind(this)}        \n                visible={!taggingCompletePage}      \n                draggable={true}\n              />\n            </div>      \n          </div> }\n   \n        </div>\n       \n    )\n  }\n}\n\n\n\n\nclass TaggingCompletePage extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div id=\"tagging-complete-message\">\n        <span class=\"tagging-complete-text\">\n          <h2>Annotation complete!</h2>\n          <p>Thank you for your participation in this project.</p>\n\n        </span>\n\n\n      </div>\n    )\n\n  }\n}\n\nexport default TaggingInterfaceView","import React from 'react';\nimport {Component} from 'react';\n\n\nclass FeaturesPage extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n\t    <article className=\"features-list\">\n\n\t    \t<h2>Version 2.0 alpha - List of features (3 October 2020)</h2>\n\n\t    \t<p>Redcoat underwent a significant revision for Version 2.0, bringing a wide array of new features including:</p>\n\n\t    \t<ul>\n\t    \t\t<li><b>Overall</b>\n\t\t    \t\t<ul>\n\t\t    \t\t\t<li>The front-end has been completely rebuilt in React. Redcoat now feels significantly more responsive as a result.</li>\n\t\t    \t\t</ul>\n\t\t    \t</li>\n\t    \t\t<li><b>Project dashboard</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li><b>Key information</b>: The dashboard now shows key information at the top such as number of annotations, average agreement score, and average time per doc (which is still a work in progress).</li>\n\t    \t\t\t\t<li><b>Entity frequencies</b>: A chart showing the number of mentions of each entity, which dynamically updates as annotators annotate the project.</li>\n\t    \t\t\t\t<li><b>Activity</b>: A chart showing the activity of each annotator.</li>\n\t    \t\t\t\t<li><b>Annotations/document</b>: A waffle chart showing the number of times each document has been annotated.</li>\n\t    \t\t\t\t<li><b>Comments</b>: A list of all comments made about the project, with links to the corresponding documents in the new Curation Interface.</li>\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t\t<li><b>Curation interface</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>The curation interface visualises all of the annotations made by each annotator and allows each annotator to comment on each doc using the comments window on the right.</li>\n\t    \t\t\t\t<li>The compiled labels are displayed at the bottom of the annotators' annotations when more than one user has annotated the document.</li>\n\t    \t\t\t\t<li>Documents can be searched and sorted in a similar manner to the annotation interface.</li>\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t\t<li><b>Annotation interface</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>Annotators may navigate back to previous documents and update them as necessary.</li>\n\t    \t\t\t\t<li>Annotators can search for specific documents via the search field at the top.</li>\n\t    \t\t\t\t<li>Annotators can choose the number of documents per page - it is no longer fixed at 10.</li>\n\t    \t\t\t\t<li>The categories in the category hierarchy can be dragged and dropped so that annotators can essentially rebind the hotkeys for each category when desired.</li>\n\t    \t\t\t\t<li>Multiple tokens can be selected at once by holding Ctrl.</li>\n\t    \t\t\t\t<li>Users can write comments on any document (visible by anyone also annotating the project) via the comments button at the bottom of each document.</li>\n\t    \t\t\t\t<li>Users may specify their confidence via the Confidence buttons on the right (still a work in progress).</li>\n\t    \t\t\t\t<li>There is a screenshot button at the bottom of each document which automatically saves a screenshot of the doc to a .png file.</li>\n\t    \t\t\t\t<li>The save button has been moved to the top.</li>\n\t    \t\t\t\t<li>The overall design of the interface has changed significantly to make it feel more polished.</li>  \t\t\t\t\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t\t<li><b>Projects page</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>The projects page has also changed in appearance, and now has a more streamlined look.</li>\n\t    \t\t\t\t<li>There are fewer controls over searching/filtering etc - those may be implemented again later.</li>\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t\t<li><b>User profile</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>There is now a User profile page.</li>\n\t    \t\t\t\t<li>Users may customise their profile icon - the background, foreground and icon can be changed. These icons will appear on any comments the user makes on any projects.</li>\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t\t<li><b>New project form</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>The new project form is also remade in React - it is now based on form pages rather than one continuous form so the process of creating a new project is much better.</li>\n\t    \t\t\t</ul>\t\n\t    \t\t</li>\n\t    \t\t<li><b>Other changes</b>\n\t    \t\t\t<ul>\n\t    \t\t\t\t<li>Annotator agreement is now calculated whenever a document annotation is saved. The agreement metric is a jaccard-based similarity metric that incorporates both token similarity and span similarity (will be discussed in a future paper).</li>\n\t    \t\t\t</ul>\n\t    \t\t</li>\n\t    \t</ul>\n\n\n\t\t\t<h2>Version 1.0 - List of features (5 April 2019)</h2>\n\n\t\t\t<p>Below is a list of features that are currently present in Redcoat.</p>\n\n\t\t\t<ul>\n\t\t\t\t<li> Project Setup page\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li>Create annotation projects for Entity Recognition on the Setup Project page</li>\n\t\t\t\t\t\t<li>Automatic tokenisation of data, with summary of number of tokens/documents</li>\n\t\t\t\t\t\t<li>Create a concept hierarchy via an interactive tree, or alternatively via text input</li>\n\t\t\t\t\t\t<li>Multiple built-in hierarchies: NER, FIGER, Mining</li>\n\t\t\t\t\t\t<li>New project and associated data is persistent across refreshes</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</li>\n\t\t\t\t<li>Projects page\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li>Sort, search, and filter projects</li>\n\t\t\t\t\t\t<li>Detailed project summary</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</li>\n\t\t\t\t\n\t\t\t\t<li>Annotation interface\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li>Annotate projects via an intuitive user interface</li>\n\t\t\t\t\t\t<li>Keyboard support on the annotation interface (hotkeys, selection with arrow keys)</li>\n\t\t\t\t\t\t<li>Wikipedia summary of words in the annotation interface</li>\n\t\t\t\t\t\t<li>Search/filter category hierarchy to quickly find the relevant entity category\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</li>\n\t\t\t</ul>\t\t\n\n\t\t\t<h3>Attributions</h3>\n\t\t\t<p>The pencil icon on the tagging interface was made by <a href=\"https://www.flaticon.com/authors/icongeek26\" title=\"Icongeek26\">Icongeek26</a> from <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">www.flaticon.com</a>.</p>\n\t\t\t<p>The Krippendorff Alpha agreement metric calculation was found on GitHub: <a href=\"https://github.com/tanbt/krippendorff-alpha\">https://github.com/tanbt/krippendorff-alpha</a>.</p>\n\t\t</article>\n\n    )\n  }\n}\n\n\n\nexport default FeaturesPage;","import getCookie from 'functions/getCookie';\nconst csrfToken = getCookie('csrf-token');\nvar FileDownload = require('js-file-download');\n\n// Config for all API fetch requests\nconst fetchConfig = {\n  \"GET\": {\n    method: 'GET',\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    },\n    credentials: 'include',\n  },\n  \"POST\": {\n    method: 'POST',\n    headers: {\n      'csrf-token': csrfToken,\n      //'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      //'Content-Type': 'multipart/form-data',\n    },\n    dataType: \"json\",\n    body: null,\n  }\n}\n\n\n\n\nasync function wait(ms) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms);\n  });\n}\n\n// A function to make fetching a little bit easier and avoid a lot of repeated code.\n// This one returns data only when there wasn't an error.\n// Returns 500 error if anything unexpected happens.\n// Todo: fix the args... but to do that I'd have to change all calls of this :()\nasync function _fetch(url, method, setErrorCode, postBody=null, fileUpload=false, delay=0, fileDownload=false, fileDownloadName=null) {\n\n  var api_url = \"https://nlp-tlp.org/api/\";\n\n  var fetchConf = {... fetchConfig[method] };\n  if(method === \"POST\") {\n    if(!postBody) throw new Error(\"Cannot POST without post body\");\n    if(fileUpload) {\n      fetchConf.body = postBody;\n      delete fetchConf.headers;\n    } else {\n\n      fetchConf.body = JSON.stringify(postBody);\n      fetchConf.headers['Content-Type'] = 'application/json';\n    }    \n  }\n\n  var response = await fetch(api_url + url, fetchConf) // TODO: move localhost out\n  console.log(response,'<resp')\n  if(response.status !== 200) {\n    var errorCode = parseInt(response.status)\n    setErrorCode(errorCode);\n    return Promise.resolve(new Error(errorCode));\n  }  \n  var data = await response.text();\n\n  if(fileDownload) {\n    FileDownload(data, fileDownloadName);\n    return Promise.resolve();\n  }\n\n  console.log(data)\n  try {\n    var d = JSON.parse(data);\n    await wait(delay);\n    return Promise.resolve(d); \n  } catch(err) {\n    console.log(err);\n    setErrorCode(500);\n    return Promise.reject(new Error(500));\n  }\n}\n\nexport default _fetch;\n","import React from 'react';\nimport {Component} from 'react';\nimport { Link } from 'react-router-dom'\nimport BASE_URL from 'globals/base_url';\nimport formatDate  from 'functions/formatDate';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport _fetch from 'functions/_fetch';\n\n\nclass ProjectsTable extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (<div></div>)\n\n\n\n\n  }\n}\n\nclass ProjectListView extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: {\n        projects: this.getDummyProjects(),\n        numUserInvolvedIn: null,\n        numCreatedByUser: null,       \n        numDocGroupsAnnotated: 0,\n        totalDocGroups: 1,\n      },\n      view: \"All projects\", // \"All projects\" or \"Your projects\"\n      loading: true,\n\n    }\n  }\n\n  // Get some dummy projects for the first load, so that the table looks nice.\n  getDummyProjects() {\n\n    function randomString(minLength, maxLength) {\n      var result = '';\n      var randomLength = minLength + Math.floor(Math.random() * (maxLength - minLength))\n      for(var i = 0; i < randomLength; i++ ) {\n        result += 'x'\n      }\n      return result;\n  }\n\n    function randomName() {\n      return randomString(5, 20);\n    }\n\n    function randomDesc() {\n      var x = Math.random();\n      if(x < 0.5) return null;\n      return randomString(20, 50);\n    }\n\n    var dummyProjects = [];\n    for(var i = 0; i < 10; i++) {\n      dummyProjects.push({\n        name:         randomName(),\n        description:  randomDesc(),\n        total_users:  0,\n        created_at:   null,\n        icon_name:    \"\",\n      })\n    }\n    return dummyProjects;\n  }\n\n  // Query the API when this component is mounted.\n  // Once done, set this.state.data to the returned projects, numUserInvolvedIn, and numCreatedByUser.\n  async componentWillMount() {\n    this.props.setProject(null, null); // Reset the current project in the sidenav\n\n    var d = await _fetch('projects/', 'GET', this.props.setErrorCode, 1)\n\n    this.setState({\n      data: d,\n      loading: false\n    })\n  }\n\n  // Set this component's view to the specified view.\n  // Should be either \"All projects\" or \"Your projects\".\n  setView(view) {\n    this.setState({\n      view: view,\n      loading: true,\n      \n    }, () => {\n      window.setTimeout( () => {\n        this.setState({\n          \n          loading: false,\n        })\n      }, 100); // Simulate lag ?\n\n    })\n  }\n\n\n\n  render() {\n    return (\n      <div id=\"projects-table-wrapper\">\n\n        <div id=\"projects-table-header\">            \n          <div className={\"row-button\" + (this.state.view === \"All projects\"  ? \" active\" : \"\")} onClick={ () => this.setView('All projects') }>All projects <span className=\"counter\">{ this.state.data.numUserInvolvedIn }</span></div>\n          <div className={\"row-button\" + (this.state.view === \"Your projects\" ? \" active\" : \"\")} onClick={ () =>  this.setView('Your projects') }>Your projects <span className=\"counter\">{ this.state.data.numCreatedByUser }</span></div>\n        </div>\n\n        <div id=\"projects-table\" className={this.state.loading ? \"loading\" : \"\"}>\n        \n        { this.state.data.projects.filter(project => (this.state.view === \"Your projects\" ? project.userIsCreator : true)).map((project, i) => \n          \n            <div className=\"row\" index={i}>\n              <div className=\"col-name-desc\">\n\n\n                <div className=\"projects-table-pie\">\n                { this.state.loading && \n                  <PieChart\n                    data={[\n                      { value: 0, color: \"rgb(109, 201, 34)\"},\n                      { value: 1, color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                    ]}\n                    background={\"#d5d5d5\"}\n                    lineWidth={18}\n                    startAngle={270}\n                  />\n                  }\n                  { !this.state.loading && \n                    <PieChart\n                    data={[\n                      { value: (project.numDocGroupsAnnotated), color: \"rgb(109, 201, 34)\"},\n                      { value: (project.totalDocGroups - project.numDocGroupsAnnotated), color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                    ]}\n                    background={\"#d5d5d5\"}\n                    animate={true}\n                    animationDuration={500}\n                    lineWidth={18}\n                    startAngle={270}\n                  />\n                  }\n                </div>\n\n\n\n\n                <div className=\"name-desc-row\">\n                  <div className=\"project-name\"><Link to={BASE_URL + 'projects/' + project._id + '/dashboard'}>{ project.name}</Link></div>\n                  {project.description && <div className=\"project-description\">{ project.description }</div> }\n                  <div className=\"project-creator\">Created by <span className=\"creator-name\">{ project.creator }</span></div>\n                </div>\n              </div>\n              <div className=\"col-date\">\n                <span className=\"project-created-at\">Created on {formatDate(project.created_at)}</span>\n              </div>\n              <div className=\"col-stats\">\n                <span className=\"project-total-comments\" title={\"This project has \" + project.total_comments + \" comments.\"}><i class=\"fa fa-comment\"></i> <span className=\"comment-count\">{project.total_comments}</span></span>\n                <span className=\"project-total-users\"    title={\"This project has \" + project.total_users + \" users.\"}><i class=\"fa fa-user\"></i> <span className=\"user-count\">{project.total_users}</span></span>\n              </div>\n            </div>      \n          )\n        }\n        </div>\n      </div>  \n    )\n  }\n}\n\n\nexport default ProjectListView;","import React from 'react';\nimport {Component} from 'react';\n\nimport CategoryHierarchy from 'views/SharedComponents/CategoryHierarchy';\n\n\n\nfunction generateEmptyTable() {\n  var n = 15;\n  var arr = new Array(n).fill(0);\n  \n\n  function stringOfRandomLength(minlen, maxlen) {\n    var s = '';\n    for(var i = 0; i < minlen + Math.floor(Math.random() * maxlen); i++) {\n      s += 'x';\n    }\n    return s;\n  }\n\n  return (\n    <table className=\"project-page-table\">\n      <tbody>\n       { arr.map((x, i) => \n        <tr> \n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n        </tr>\n      ) }\n    </tbody>\n  </table>\n  )  \n}\n\n\n// function getColourIndex(row, colourIndexes) {\n//   var s = row.split('/');\n//   var base_class = s.length > 1 ? s[0] : s;\n//   return colourIndexes[base_class] + 1\n// }\n\n// function getRowName(row) {\n//   var s = row.split('/');\n//   var rowName = s.length > 1 ? s[s.length - 1] : s;\n//   var spacing = '';\n//   for(var i = 1; i < s.length; i++) {\n//     spacing += \" - \";\n//   }\n//   return spacing + rowName;\n// }\n\nclass CategoryHierarchyPage extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n    console.log(this.props.data, this.props.loading, 'xxx');\n    return ( \n      <main className=\"project-page\">\n\n        <h2>Entity Hierarchy</h2>\n\n        <div className=\"category-hierarchy-wrapper\">\n          { this.props.loading && generateEmptyTable() }\n\n\n          { ! this.props.loading &&  <CategoryHierarchy\n              items={this.props.data.children}                         \n              visible={true}   \n              draggable={false}\n              displayOnly={true}  \n              tableForm={true}\n          \n\n          />\n          }\n          \n        </div>\n\n       \n\n\n\n      </main>\n    )\n  }\n}\n\nexport default CategoryHierarchyPage;","import React from 'react';\nimport {Component} from 'react';\n\nimport ProfileIcon from 'views/SharedComponents/ProfileIcon';\n\nfunction generateEmptyTable() {\n  var n = 15;\n  var arr = new Array(n).fill(0);\n  \n\n  function stringOfRandomLength(minlen, maxlen) {\n    var s = '';\n    for(var i = 0; i < minlen + Math.floor(Math.random() * maxlen); i++) {\n      s += 'x';\n    }\n    return s;\n  }\n\n  return (\n    <table className=\"project-page-table\">\n      <tbody>\n       { arr.map((x, i) => \n        <tr> \n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n        </tr>\n      ) }\n    </tbody>\n  </table>\n  )  \n}\n\nclass InvitationsTable extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    console.log(this.props.data.pending_invitations)\n    return (\n      <table className=\"project-page-table\">\n        <tbody>\n         { this.props.data.active_users.length > 0 && <tr><td colspan=\"2\"><span className=\"inner row-divider\">Active</span></td></tr>}\n         { this.props.data.active_users.map((user, i) => \n          <tr>\n\n            <td>\n              <span className=\"inner\">\n                <ProfileIcon user={user}/>\n                <span>{user.email} ({user.username})</span>\n              </span>\n            </td>\n          </tr>\n        ) }\n\n         { this.props.data.pending_invitations.length > 0 && <tr><td colspan=\"2\"><span className=\"inner row-divider\">Pending invitations</span></td></tr>}\n         { this.props.data.pending_invitations.map((user, i) => \n          <tr>\n\n            <td>\n              <span className=\"inner\">\n                <ProfileIcon user={user.profile_icon ? user : null}/>\n                <span>{user.email} {user.username ? (\"(\" + user.username + \")\") : \"\"}</span>\n              </span>\n            </td>\n          </tr>\n        ) }\n        </tbody>\n      </table>\n\n    )\n  }\n}\n\nclass InvitationsPage extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {    \n    return ( \n      <main className=\"project-page\">\n\n        <h2>Annotators</h2>\n\n        <div className=\"wrapper\">\n          { this.props.loading && generateEmptyTable() }\n          { !this.props.loading && <InvitationsTable data={this.props.data}/> }\n          \n        </div>\n      </main>\n    )\n  }\n}\n\nexport default InvitationsPage;","import React from \"react\";\nimport {Component} from \"react\";\nimport { Redirect } from 'react-router-dom'\n\n\nclass Error401Redirect extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  componentDidMount() {\n    this.props.clearErrorCode();\n  }\n\n  render() {\n    return (\n      <Redirect to=\"/login\"/>\n    )\n  }\n}\n\nexport default Error401Redirect","import React from 'react';\nimport {Component} from 'react';\nimport _ from 'underscore';\n\nimport ControlBar from 'views/SharedComponents/ControlBar';\n\nimport getCookie from 'functions/getCookie';\n\nimport initAnnotationsArray from 'views/TaggingInterfaceView/initAnnotationsArray';\nimport Annotation from 'views/TaggingInterfaceView/Annotation';\nimport {Comment, CommentInput} from 'views/SharedComponents/Comment';\nimport ProfileIcon from 'views/SharedComponents/ProfileIcon';\n\nimport {Word, Sentence} from 'views/TaggingInterfaceView/documentComponents';\n\nimport formatDate  from 'functions/formatDate';\n\n\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }\n};\n\n\n\nclass CurationInterface extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\n\t\t\tdocumentId: null,\n\t\t\tdocuments: [],\t\t\t\n\t\t\tannotations: [],\n\t\t\tcompiledAnnotation: null, // annotations produced via compiled labels or perhaps machine learning model?\n\t\t\tcomments: [],\n\n\t\t\tannotatorAgreement: null,\n\n\t\t\tpageNumber: 1,\n\t\t\ttotalPages: 1,\n\t\t\trecentlySaved: false,\n\t\t\tchangesMade: false,\n\t\t\t\n\t\t\tsearchTerm: null,\n\t\t\tsortBy: \"Annotations\",\n\t\t\tdocumentIdQuery: null, // For searching a specific document id via a comment button\n\n\t\t\tentityColourMap: {},\n\n\t\t\tloading: {\n\t\t\t\tquerying: true,\n\t\t\t\tsaving: false,\n\t\t\t}\n\t\t}\n\t\tthis.commentBoxRef = React.createRef();\n\t\tthis._isMounted = false;\n\t\tthis.refreshDataFn = null;\n\t}\n\n\tcomponentWillMount() {\n\t\tthis._isMounted = true;\n\t\tif(this.props.documentIdQuery) {\n\t\t\tthis.setState({\n\t\t\t\tdocumentIdQuery: this.props.documentIdQuery,\n\t\t\t}, this.queryAPI);\n\t\t\treturn;\n\t\t}\n\n\n\n\t\tconsole.log(\"Loading state:\", this.props.prevState)\n\t\tif(this.props.prevState) {\n\t\t\tthis.setState(this.props.prevState);\n\t\t} else {\n\t\t\tthis.queryAPI();\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\t\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif(!_.isEqual(prevState, this.state)) {\n\t\t\tconsole.log(\"state updated\");\n\t\t\tthis.props.saveState(this.state);\n\t\t}\t\n\t\t\n\t}\n\n\n\n\tasync queryAPI() {\n\t\tif(!this._isMounted) return;\n\n\t\tawait this.setState({\n\t\t\tloading: {\n\t\t\t\tquerying: true,\n\t\t\t\tsaving: false,\n\t\t\t}\n\t\t})\n\n\t\tvar queryString = 'http://localhost:3000/api/projects/' + this.props.project_id + \"/curation?pageNumber=\" + this.state.pageNumber + \"&sortBy=\" + this.state.sortBy;\n\t\tif(this.state.searchTerm) {\n\t\t\tqueryString += \"&searchTerm=\" + this.state.searchTerm;\n\t\t}\n\t\tif(this.state.documentIdQuery) {\n\t\t\tqueryString += \"&documentId=\" + this.state.documentIdQuery;\n\t\t}\n\n\t\tfetch(queryString, fetchConfigGET)\n\t\t.then((response) => {\n\t        if(response.status === 403) {\n\t          throw new Error(403);\n\t        } else if(response.status === 401) {\n\t          throw new Error(401);\n\t        } \n\t        return response.text()\n\t    })\n      \t.then((data) => {\n      \t\tvar d = JSON.parse(data);\n\n      \t\tthis.setState({\n      \t\t\tdocumentId: d.documentId,\n      \t\t\ttokens: d.tokens,\n\n      \t\t\tannotations: initAnnotationsArray([d.tokens], d.annotations, this.state.searchTerm, true), //fix\n      \t\t\tcompiledAnnotation: d.compiledAnnotation ? initAnnotationsArray([d.tokens], [d.compiledAnnotation], this.state.searchTerm, true)[0] : null, //fix\n      \t\t\tcomments: d.comments,\n\n      \t\t\tusers: d.users,\n      \t\t\tsaveTimes: d.saveTimes,\n\n      \t\t\tdocumentIdQuery: null,\n\n      \t\t\tannotatorAgreement: d.annotatorAgreement,\n\n      \t\t\tentityColourMap: this.initEntityColourMap(d.categoryHierarchy.children),\n\n      \t\t\tpageNumber: d.pageNumber,\n      \t\t\ttotalPages: d.totalPages,\n\n      \t\t\tloading: {\n      \t\t\t\tquerying: false,\n      \t\t\t\tsaving: false,\n      \t\t\t}\n      \t\t}, () => { \n\n      \t\t\tif(this.refreshDataFn) window.clearTimeout(this.refreshDataFn)\n      \t\t\tthis.refreshDataFn = window.setTimeout(this.queryAPI.bind(this), 3000)\n\n\n      \t\t})\n      \t}).catch((err) => {\n\t        console.log(err.message);\n\t        this.props.setErrorCode(parseInt(err.message));\n\t    });;\n\n\n\n\t}\n\n\n\t// Search all documents for a specific search term.\n\tsearchDocuments(searchTerm) {\n\t\tthis.setState({\n\t\t\tpageNumber: 1,\n\t\t\tsearchTerm: searchTerm,\n\t\t}, this.queryAPI);   \n\t}\n\n\tsubmitAnnotations() {\n\t\treturn null;\n\t}\n\n\tloadPreviousPage() {\n\t\tif(this.state.loading.querying) return;\n\t\tif(this.state.pageNumber === 1) return;\n\t\tthis.setState({\n\t\t\tpageNumber: this.state.pageNumber - 1,\n\t\t}, this.queryAPI)\n\t}\n\n\tloadNextPage() {\n\t\tif(this.state.loading.querying) return;\n\t\tif(this.state.pageNumber >= this.state.totalPages) return;\n\t\tthis.setState({\n\t\t\tpageNumber: this.state.pageNumber + 1,\n\t\t}, this.queryAPI)\n\n\t}\n\n\tgoToPage(pageNumber) {\n\t\tif(this.state.loading.querying) return;\n\t\tif(pageNumber < 1 || pageNumber > this.state.totalPages) return;\n\t\tthis.setState({\n\t\t\tpageNumber: pageNumber,\n\t\t}, this.queryAPI);\n\t}\n\n\tsetSortBy(e) {\n\t\tvar sortBy = e.target.value;\n\n\t\tthis.setState({\n\t\t\tsortBy: sortBy,\n\t\t}, this.queryAPI)\n\t}\n\n\t// Initialise the entity colour map, which maps entity_class: colour_index, e.g. \"Item\": 1. Passed to the Word components to colour\n\t// their labels accordingly.\n\tinitEntityColourMap(categoryHierarchy) {\n\t\tvar entityColourMap = {}\n\t\tfor(var ec_idx in categoryHierarchy) {\n\t\t  var entityClass = categoryHierarchy[ec_idx];\n\t\t  entityColourMap[entityClass.name] = entityClass.colorId + 1;\n\t\t}\n\t\treturn entityColourMap;\n\t}\n\n\n\tsubmitComment(message, next) {\n\t\tvar t = this;\n\t\tconsole.log(\"Message:\", message);\n\n\t\tconst csrfToken = getCookie('csrf-token');\n\n\t\tconst fetchConfigPOST = {\n\t\t  method: 'POST',\n\t\t  headers: {\n\t\t    'Accept': 'application/json',\n\t\t    'Content-Type': 'application/json',\n\t\t    'csrf-token': csrfToken,\n\t\t  },\n\t\t  dataType: \"json\",\n\t\t  body: JSON.stringify({\n\t\t    text: message,\n\t\t    documentId: this.state.documentId,\n\t\t  }),  \n\t\t};\n\n\t\tfetch('http://localhost:3000/api/projects/' + this.props.project_id + '/comments/submit', fetchConfigPOST) // TODO: move localhost out\n\t\t.then((response) => {\n\t        if(response.status === 403) {\n\t          throw new Error(403);\n\t        } else if(response.status === 401) {\n\t          throw new Error(401);\n\t        } \n\t        return response.text()\n\t    })\n\t\t.then((data) => {\n\t\t  console.log(data);\n\t\t  try { \n\t\t    var d = JSON.parse(data);\t\t    \n\n\t\t    var comments = this.state.comments;\n\t\t    comments.push(d.comment);\n\n\n\t\t    this.setState({\n\t\t       comments: comments,\n\t\t    }, () => {\n\t\t    \tnext();\n\t\t    \tt.commentBoxRef.current.scrollTop = t.commentBoxRef.current.scrollHeight;\n\t\t    });\n\t\t  } catch(err) {\n\t\t    console.log(\"ERROR:\", err);\n\t\t    next();\n\t\t  }      \n\t\t}).catch((err) => {\n\t        console.log(err.message);\n\t        this.props.setErrorCode(parseInt(err.message));\n\t    });\n\n\t}\n\n\trender() {\n\t\treturn (\n\n\t\t\t<div id=\"tagging-interface\">\n\t\t\t\t<div id=\"sentence-tagging\" className=\"curation-page\">\n\t\t\t\t\t<ControlBar\n\t                  pageNumber = {this.state.pageNumber}\n\t                  totalPages = {this.state.totalPages}\n\t                  totalPagesAvailable = {this.state.totalPages}\n\t                  recentlySaved={this.state.recentlySaved}\n\t                  changesMade={this.state.changesMade}\n\t                  querying={this.state.loading.querying}\n\t                  saving={this.state.loading.saving}\n\t                  inSearchMode={this.state.searchTerm}\n\n\t                  showSortBy={true}\n                  \t  sortBy={this.state.sortBy}\n                  \t  sortByOptions={[\"Annotations\", \"Agreement\", \"Document Index\"]}\n                  \t  setSortBy={this.setSortBy.bind(this)}\n\n\n\t                  searchDocuments={this.searchDocuments.bind(this)}\n\t                  submitAnnotations={this.submitAnnotations.bind(this)}\n\t                  loadPreviousPage={this.loadPreviousPage.bind(this)}\n\t                  loadNextPage={this.loadNextPage.bind(this)}\n\t                  goToPage={this.goToPage.bind(this)}\n\n\t                  curationPage={true}\n\t                />\n\n\t                {\n                    \t(!this.state.loading.querying && !this.state.tokens) && \n                    \t<div className=\"loading-message no-results-found\">No results found.</div>\n                  \t}\n\n                  \t<div className=\"curation-interface-inner\">\n                  \t\t<div className=\"document-window\" id=\"sentence-tagging\">\n\n                  \t\t\t\n                  \t\t\t  <div className=\"agreement-score\">\n                  \t\t\t  <span className=\"name\">Agreement:</span>\n                  \t\t\t  \t{ this.state.annotatorAgreement !== null && <span className=\"value\">{(this.state.annotatorAgreement * 100).toFixed(2)}%</span>}\n                  \t\t\t  \t{ this.state.annotatorAgreement === null && <span className=\"value na\">N/A</span>}\n                  \t\t\t  </div>\n\n                  \t\t\t{\n\t\t          \t\t\t\tthis.state.annotations.map((annotations, index) => \n\t\t          \t\t\t\t<CurationDocumentContainer\n\t\t          \t\t\t\t\tuser={this.state.users[index] || null}\n\t\t          \t\t\t\t\tindex={index}\n\t\t          \t\t\t\t\ttokens={this.state.tokens}\n\t\t          \t\t\t\t\tannotations={this.state.annotations[index]}\n\t\t          \t\t\t\t\tentityColourMap={this.state.entityColourMap}\n\t\t\t\t                \tdisplayOnly={true}\n\t\t\t\t                \tsaveTime={this.state.saveTimes[index] || null}\n\t\t          \t\t\t\t/>\n\t\t          \t\t\t)}\n\t\t          \t\t\t{ this.state.compiledAnnotation && <div className=\"divider\"><span></span></div> }\n\n\t\t          \t\t\t{ this.state.compiledAnnotation &&\n\t\t          \t\t\t\t<CurationDocumentContainer\n\t\t          \t\t\t\t\tspecialName={\"Compiled labels\"}\n\t\t          \t\t\t\t\tspecialDescription={\"These labels are automatically compiled from the annotations above.\"}\n\t\t          \t\t\t\t\ttokens={this.state.tokens}\n\t\t          \t\t\t\t\tannotations={this.state.compiledAnnotation}\n\t\t          \t\t\t\t\tentityColourMap={this.state.entityColourMap}\n\t\t\t\t                \tdisplayOnly={true}\n\t\t          \t\t\t\t/>\n\t          \t\t\t\t}\n\t          \t\t\t\n\n\n                  \t\t</div>\n                  \t\t<div className=\"comments-pane\">\n\n\t\t\t\t            <div className=\"comments-wrapper\">\n\t\t\t\t            \t{ this.props.user && this.state.comments && \n\n\t\t\t\t            \t<div className=\"comments-inner\">\n\n\n\t\t\t\t            \t\t<h3 className={this.state.comments.length === 0 ? \"hidden\" : \"\"}>Comments {this.state.comments.length > 0 && \"(\" + this.state.comments.length + \")\"}</h3>\n\n\t\t\t\t            \t\t{this.state.comments.length === 0 && <div className=\"no-comments-yet\">No comments yet.</div>}\n\t\t\t\t                \t<div className=\"comments-even-more-inner\" ref={this.commentBoxRef}>\n\t\t\t\t                  \t{ this.state.comments.map((comment, i) => <Comment index={i} {...comment} hideDocumentString={true} />) }\n\t\t\t\t                \t</div>\n\t\t\t\t                \t<CommentInput user_profile_icon={this.props.user.profile_icon} submitComment={this.submitComment.bind(this)}/>\n\t\t\t\t                \t\n\n\t\t\t\t              \t</div>\n\t\t\t\t              \t}\n\t\t\t\t            </div>\n\t\t\t\t\t\t          \n\t\t\t\t\t\t\n                  \t\t</div>\n                  \t</div>\n\n\t\t\t\t</div>\n\n\n\t\t\t</div>\n\n\t\t)\n\t}\n}\n\n\nclass CurationDocumentContainer extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t}\n\n\trender() {\n\n\t\treturn (\n\t\t\t<div className=\"document-container\">\n          \t\t<div className=\"document-wrapper\">\n\t          \t\t<div className={\"curation-document\" + ((!this.props.specialName && !this.props.user) ? \" not-yet-annotated\" : \"\")}>\n\n\t          \t\t\t{ !this.props.specialName && \n\t          \t\t\t<div className=\"user-row\">\n\n\t          \t\t\t\t<ProfileIcon user={this.props.user}/><span className=\"username\">{this.props.user && this.props.user.username}</span> \n\t          \t\t\t\t<div className=\"save-time\">Saved on {formatDate(this.props.saveTime)}</div>\n\t          \t\t\t</div>\n\t          \t\t\t}\n\t          \t\t\t{ this.props.specialName && \n\t          \t\t\t\t<div className=\"user-row\">\n\t          \t\t\t\t\t<span className=\"username\"><em>{this.props.specialName}</em><i class=\"fa fa-info-circle\" title={this.props.specialDescription}></i></span>\n\t          \t\t\t\t</div>\n\t          \t\t\t}\n\t\t          \t\t<div className=\"sentence display-only\">\t\t          \t\t\n\n\t\t              \t\t<Sentence \n\t\t\t\t                index={this.props.index}\n\t\t\t\t                words={this.props.tokens}              \n\t\t\t\t                annotations={this.props.annotations}  \n\t\t\t\t                entityColourMap={this.props.entityColourMap}\n\n\t\t\t\t                displayOnly={true}\n\t\t\t\t              />\t\t\t\t            \n\t\t          \t\t\n\t\t          \t\t</div>\n\t\t          \t</div>\n\t\t       \t</div>\n\t\t    </div>\n\n\n\n\t\t)\n\t}\n}\n\nexport default CurationInterface","import React from 'react';\nimport {Component} from 'react';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { Redirect, Link, BrowserRouter, Route, Switch, withRouter } from 'react-router-dom'\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\nimport {Bar, Line, HorizontalBar } from 'react-chartjs-2';\n\nimport BASE_URL from 'globals/base_url';\nimport _fetch from 'functions/_fetch'\n\nimport { defaults } from 'react-chartjs-2'\n\nimport { Comment } from 'views/SharedComponents/Comment';\n\nimport CategoryHierarchyPage from 'views/ProjectView/CategoryHierarchyPage';\nimport InvitationsPage from 'views/ProjectView/InvitationsPage';\n\nimport Error401Redirect from 'views/Errors/Error401Redirect';\nimport Error403Page from 'views/Errors/Error403Page';\nimport Error404Page from 'views/Errors/Error404Page';\n\n\n\nimport CurationInterface from 'views/ProjectView/CurationInterface';\n\nimport _ from 'underscore';\n\n\n\nimport ProfileIcon from 'views/SharedComponents/ProfileIcon';\n\n\nconst queryString = require('query-string');\n\n\ndefaults.global.defaultFontFamily = 'Open Sans'\ndefaults.global.animation.duration = 500;\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }\n};\n\n\nconst chartColours = [\n\"#36A2EB\",\n\"#FF6384\",\n\"#6dc922\",\n\"#B4436C\",\n\"#FFCE56\",\n\"#F78154\",\n\"#5FAD56\",\n\"#4D9078\",\n\"#586BA4\",\n\"#324376\",\n\"#F5DD90\",\n\"#6665DD\",\n\"#7B4B94\",\n];\n\n\nclass AnnotationsTable extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  async downloadAnnotationsOfUser(user) {\n    var url = (\"projects/\" + this.props.project_id + \"/download_annotations/\" + user._id);\n    await _fetch(url, 'GET', this.props.setErrorCode, null, false, 0, true, 'annotations-' + user.username + '.json');\n  }\n\n  async downloadCombinedAnnotations() {\n    var url = (\"projects/\" + this.props.project_id + \"/download_combined_annotations\");\n    await _fetch(url, 'GET', this.props.setErrorCode, null, false, 0, true, 'annotations-combined.json');\n  }\n\n  render() {\n\n    return (\n\n      <main className=\"project-page\">\n        <h2>Annotations</h2>\n        <div className=\"combined-annotations-download-box\">\n\n          { this.props.data.combined_annotations_available === 0\n          ? <div>There are not yet any annotations available for download.</div>\n          : <div>\n            <strong>{this.props.data.combined_annotations_available} </strong>&nbsp;annotations are ready for download. <button className=\"annotate-button\" onClick={() => this.downloadCombinedAnnotations()}><i className=\"fa fa-download\"></i>Download all</button>\n          </div>\n          }\n\n\n        </div>\n        <div className=\"annotations-table-container\">\n          <table id=\"annotations-table\" className=\"project-page-table annotations-table\">\n            <thead>\n              <tr>\n                <th>Annotator</th>\n                <th># Annotations</th>\n                <th></th>\n              </tr>\n            </thead>\n            <tbody>\n\n            { this.props.data.users.map((user, index) => \n              <tr>\n                <td><div className=\"user-row\"><ProfileIcon user={user}/>{user.username}</div></td>\n                <td>{user.num_annotations}</td>\n                <td><button className={\"annotate-button\" + (user.num_annotations === 0 ? \" disabled\" : \"\")} onClick={() => this.downloadAnnotationsOfUser(user)}><i className=\"fa fa-download\"></i>Download</button></td>\n              </tr>\n\n            )}\n            </tbody>\n          </table>\n        </div>\n\n      </main>\n\n    )\n  }\n}\n\n// Couldn't find a good component for this online so I made my own. It visualises the 'annotations per doc' in the form of a \n// waffle chart, which looks more or less like a heat map but without any labels. The data should be ordered in descending freq\n// of number of annotations.\nclass WaffleChart extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n    var maxValue = this.props.data.length - 1;\n\n    var total = this.props.data.reduce((a, b) => a + b, 0);\n    var ratio = Math.min(100, total) / total;\n\n    var tooltips = [];\n\n    var tooltipSide = -1;\n    var rowIdx = 0;\n\n\n    //var data = this.props.data.reverse(); // Reverse the order so that the docs annotated more are on top\n\n    // Calculate the tooltip positions\n    var totalSquares = 0;\n    for(var i in this.props.data) {\n\n      var count = this.props.data[i];\n      var squares = Math.floor(count * ratio);\n\n      tooltips.push(\n        <span style={{'top': (Math.ceil(totalSquares / 10) * 19) + 'px'}} className={\"waffle-chart-tooltip tooltip-\" + (tooltipSide === 1 ? \"right\" : \"left\")}>\n\n          <b style={{'background': 'rgba(54, 162, 235,' + Math.max(0.1, ((maxValue - i) / maxValue)) + ')'}}>\n            {(maxValue - i === 0) ? \"Not yet annotated\" : ((maxValue - i) + \" annotation\" + (maxValue - i === 1 ? '' : 's'))}\n          </b>\n          <span className=\"num-docs\">{this.props.data[i]} docs</span>\n        </span>\n      );\n\n      tooltipSide *= -1;\n\n      rowIdx += Math.floor(squares / 10) + 1;\n      totalSquares += squares;\n      \n    }\n\n\n    return (\n      <div className=\"waffle-chart-container\">\n        <div className=\"waffle-chart-legend\">\n          <span>{maxValue}</span>\n          <div className=\"waffle-chart-legend-inner\"></div>\n          <span>0</span>\n\n\n        </div>\n        <div className=\"waffle-chart\" id=\"annotations-per-doc-chart\">\n          <div className=\"waffle-chart-squares\">\n            { this.props.data.map((frequency, groupIndex) => {\n\n              var value = maxValue - groupIndex;\n\n              return new Array(Math.floor(frequency * ratio)).fill(0).map((square, squareIndex) => {\n                return (\n                  <div className=\"waffle-square\" style={\n                    {'background': 'rgba(54, 162, 235,' + Math.max(0.1, ((value) / maxValue)) + ')'}}>\n                    { value }\n                  </div>\n                )\n              }\n              )}\n            )}\n          </div>\n          <div className=\"waffle-chart-info\">1 square = ~{ Math.ceil(1 / ratio) } documents</div> \n          <div className=\"waffle-chart-tooltips\">{ tooltips }</div>\n        </div>    \n\n\n      </div>\n\n      )\n  }\n}\n\n\n// Returns a JSON array of styles for the entity chart.\nfunction getEntityChartStyles() {\n  return {\n    backgroundColor: 'rgba(54, 162, 235, 0.6)',\n    borderColor: 'rgba(54, 162, 235, 0.6)',\n    borderWidth: 1,\n    hoverBackgroundColor: 'rgba(54, 162, 235, 0.6)',\n    hoverBorderColor: 'rgba(54, 162, 235, 0.6)',\n  }\n}\n\n\n// https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\nfunction numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n// Set the styles of the activity chart data.\nfunction setActivityChartStyles(activityChartData) {\n\n  for(var i in activityChartData.datasets) {\n    var colourIdx = parseInt(i) % chartColours.length;\n    activityChartData.datasets[i] = Object.assign({}, activityChartData.datasets[i], {\n      fill: false,\n      lineTension: 0.1,\n      backgroundColor: chartColours[colourIdx],\n      borderColor: chartColours[colourIdx],\n      borderCapStyle: 'square',\n      borderDash: [],\n      borderDashOffset: 0.0,\n      borderJoinStyle: 'bevel',\n      pointBorderColor: chartColours[colourIdx],\n      pointBackgroundColor: chartColours[colourIdx],\n      pointBorderWidth: 3,\n      pointHoverRadius: 6,\n      pointHoverBackgroundColor: chartColours[colourIdx],\n      pointHoverBorderColor: 'rgba(220,220,220,1)',\n      pointHoverBorderWidth: 2,\n      pointRadius: 1,\n      pointHitRadius: 10,\n      lineTension: 0,\n    })\n\n  }\n  return activityChartData;\n}\n\n\n\n// hex to RGB code found here: https://convertingcolors.com/blog/article/convert_hex_to_rgb_with_javascript.html\nString.prototype.convertToRGB = function(){\n    if(this.length != 6){\n        throw \"Only six-digit hex colors are allowed.\";\n    }\n\n    var aRgbHex = this.match(/.{1,2}/g);\n    var aRgb = [\n        parseInt(aRgbHex[0], 16),\n        parseInt(aRgbHex[1], 16),\n        parseInt(aRgbHex[2], 16)\n    ];\n    return aRgb;\n}\n\n// Simple function to darken an RGB array.\nfunction darken(colourRGB, amount) {\n  return [Math.max(colourRGB[0] - amount, 0), Math.max(colourRGB[1] - amount, 0), Math.max(colourRGB[2] - amount, 0)]\n}\n\n\nclass EntityFrequenciesChart extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: [],\n      multicolour: false,\n    }\n  }\n\n\n    // Apply colouring to entityChartData if entityChartMulticolour is true.\n  getColouredData(data, multicolour) {\n\n    const entityColours = [\"#99FFCC\", \"#FFCCCC\", \"#CCCCFF\", \"#CCFF99\", \"#CCFFCC\", \"#CCFFFF\", \"#FFCC99\", \"#FFCCFF\", \"#FFFF99\", \"#FFFFCC\", \"#CCCC99\", \"#fbafff\"];\n\n\n    console.log(data.entityClasses, \"<<\")\n    var entityChartData = data;\n\n    entityChartData.entityClasses.datasets[0].borderWidth = 1;\n   \n    if(multicolour) {\n\n      entityChartData.entityClasses.datasets[0].backgroundColor = [];\n      entityChartData.entityClasses.datasets[0].borderColor = [];\n      \n\n      for(var i in data.entityClasses.labels) {\n        var label = data.entityClasses.labels[i];\n        var colourIdx = data.colourIndexes[label];\n\n        console.log(colourIdx, label);\n        var colourHex = entityColours[colourIdx % entityColours.length];\n\n        console.log(colourHex);\n        var colourRGB = colourHex.slice(1, 7).convertToRGB();\n\n        entityChartData.entityClasses.datasets[0].backgroundColor.push('rgba(' + colourRGB[0] + ', ' + colourRGB[1] + ', ' + colourRGB[2] + ', 1)');\n\n        var colourRGBBorder = darken(colourRGB, 50);\n        entityChartData.entityClasses.datasets[0].borderColor.push('rgba(' + colourRGBBorder[0] + ', ' + colourRGBBorder[1] + ', ' + colourRGBBorder[2] + ', 1)');\n      }\n\n    } else {\n      entityChartData.entityClasses.datasets[0].backgroundColor = 'rgba(54, 162, 235, 0.6)';      \n      entityChartData.entityClasses.datasets[0].borderColor = 'rgba(54, 162, 235, 0.6)';      \n    }    \n\n    \n    return entityChartData;\n  }\n\n  componentWillMount() {\n    this.setState({\n      data: this.getColouredData(this.props.data, this.props.multicolour),\n      multicolour: this.props.multicolour\n    })\n  }\n\n\n  shouldComponentUpdate(prevProps, prevState) {\n    if(this.state.multicolour !== prevState.multicolour) return true;\n    if(prevProps.multicolour !== this.props.multicolour) return true;\n    return false;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    \n    var multicolour = this.props.multicolour;\n    this.setState({\n      multicolour: multicolour,\n      data: this.getColouredData(this.state.data, multicolour)\n    })\n  }\n\n\n\n  render() {\n\n    return (\n      <Bar\n        data={this.state.data.entityClasses}\n        height={230}\n        options={{\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: {\n            display: false\n          },\n          scales: {\n            yAxes: [{\n              ticks: {\n                beginAtZero: true,\n                precision: 0\n                \n              },\n              scaleLabel: {\n                display: true,\n                labelString: \"Frequency\"\n              }\n            }]\n          },\n        }}\n      />\n\n\n    )\n\n  }\n}\nclass ActivityChart extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: [],\n    }\n  }\n\n  componentWillMount() {\n    console.log(this.props.data);\n    this.setState({\n      data: this.props.data,\n      cumulative: this.props.cumulative\n    })\n  }\n\n  // Process the activity chart data depending on whether cumulative has been checked.\n  processActivityChartData(cumulative) {\n\n    // Transform datasets into cumulative datasets.\n    // This is probably far more complicated than it needs to be and could be significantly refactored.\n    // Turns out chartjs has a 'redraw' prop that would solve all the issues I was having, so all this weird code is probably unnecessary...\n    // Same goes for getColouredData.\n    function getCumulative(datasets) {\n      var cumulativeDatasets = [];\n      for(var i = 0; i < datasets.length; i++) {\n\n        var label = datasets[i].label;\n        var cumulativeDataset = {label: label, data: new Array(datasets[i].data.length).fill(0)};\n\n        var c = 0;\n        for(var j = datasets[i].data.length - 1; j >= 0; j--) {\n          c += datasets[i].data[j];\n          cumulativeDataset.data[j] = c;\n        }\n        console.log(cumulativeDataset, \">>\");\n        cumulativeDatasets.push(cumulativeDataset);\n      }\n      return cumulativeDatasets;\n    }\n\n    var activityChartDatasets = Object.assign({}, this.props.data.datasets);\n    console.log(\"cumu\", cumulative);\n\n    if(cumulative) {\n      console.log(this.props.data.activityChartData, \"<<\");\n\n      var cumulativeData = getCumulative(this.props.data.datasets);\n\n      var cumulativeDataset = setActivityChartStyles({\n        labels: Object.assign([], this.props.data.labels),\n        datasets: cumulativeData,\n      })\n\n      console.log(cumulativeDataset, \"<<<\")\n      return cumulativeDataset;\n    }\n\n    return this.props.data;\n  }\n\n  shouldComponentUpdate(prevProps, prevState) {\n    if(this.state.cumulative !== prevState.cumulative) return true;\n    if(prevProps.cumulative !== this.props.cumulative) return true;\n    return false;\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    \n    var cumulative = this.props.cumulative;\n    this.setState({\n      cumulative: cumulative,\n      data: this.processActivityChartData(cumulative)\n    })\n  }\n\n  render() {\n\n    console.log('rerendering', this.props.cumulative);\n\n    return (\n      <Line\n        data={this.state.data}\n        height={230}\n        redraw\n        options={{\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            xAxes: [{\n              type: 'time',\n              time: {\n                unit: 'day',\n              },\n              ticks: {\n                max: new Date()\n              }\n            }],\n            yAxes: [{\n              ticks: {\n                beginAtZero: true,\n                precision: 0\n                \n              },\n              scaleLabel: {\n                display: true,\n                labelString: \"Annotations\"\n              }\n            }]\n          }\n        }}/>\n\n\n    )\n\n  }\n}\n\n// The project dashboard, which renders in the container to the right of the navigation.\n// Its data comes from props, not state (so that the dashboard doesn't need to be reloaded when switching between\n// pages in the Project view).\nclass ProjectDashboard extends Component {\n  constructor(props) {\n    super(props);    \n    this.state = {\n      entityChartMulticolour: false,\n      activityChartCumulative: false,\n    }\n  }\n\n\n  toggleEntityChartColours() {\n    this.setState({\n      entityChartMulticolour: !this.state.entityChartMulticolour\n    });\n  }\n\n  toggleActivityChartCumulative() {\n    this.setState({\n      activityChartCumulative: !this.state.activityChartCumulative\n    });\n  }\n\n\n\n  \n\n  render() {\n\n\n    // var heatmapData = new Array(198).fill(3);\n    // var h1 = new Array(200).fill(2)\n    // var h2 = new Array(200).fill(1)\n    // var h3 = new Array(200).fill(0)\n    // heatmapData = heatmapData.concat(h1);\n    // heatmapData = heatmapData.concat(h2);\n    // heatmapData = heatmapData.concat(h3);\n\n    //console.log(this.props.data.annotationsChartData);\n\n    //heatmapData = heatmapData.map(() => Math.random())\n    return (\n     \n      <div id=\"project-dashboard\" className={\"padded \" + (this.props.loading ? \"loading\" : \"\")}>\n        <div className=\"dashboard-top-row\">\n        <div className=\"dashboard-key-items\">\n          <div className=\"dashboard-item\">\n            <div className=\"flex-wrapper\">\n\n\n\n              <div>\n                <div className=\"name\"># Annotated</div>\n                <div className=\"value\"><span class=\"st st-darker\">{ numberWithCommas(this.props.data.numDocGroupsAnnotated) } / { numberWithCommas(this.props.data.totalDocGroups) }</span></div>\n              </div>\n\n              <div class=\"pieChart\">\n\n                <span className=\"pie-chart-value\"><span className=\"inner st st-darker\">{(100 * this.props.data.numDocGroupsAnnotated / this.props.data.totalDocGroups).toFixed(0)}%</span></span>\n\n                { this.props.loading && \n                <PieChart\n                  data={[\n                    { value: 0, color: \"rgb(109, 201, 34)\"},\n                    { value: 1, color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                  ]}\n                  background={\"#d5d5d5\"}\n                  lineWidth={18}\n                  startAngle={270}\n                />\n                }\n                { !this.props.loading && \n                  <PieChart\n                  data={[\n                    { value: (this.props.data.numDocGroupsAnnotated), color: \"rgb(109, 201, 34)\"},\n                    { value: (this.props.data.totalDocGroups - this.props.data.numDocGroupsAnnotated), color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                  ]}\n                  background={\"#d5d5d5\"}\n                  animate={true}\n                  animationDuration={500}\n                  lineWidth={18}\n                  startAngle={270}\n                />\n                }\n\n\n\n              </div>\n            </div>\n\n          </div>\n          <div className=\"dashboard-item\">\n            <div className=\"name\">Avg. agreement<span className=\"information\" title=\"Average agreement is only calculated for documents with more than one annotation.\"><i class=\"fa fa-info-circle\"></i></span></div>\n            <div className=\"value\"><span class=\"st st-darker\"> { this.props.data.avgAgreement ? (Math.round(this.props.data.avgAgreement * 100) + \"%\") : \"--\"} </span></div>\n          </div>\n          <div className=\"dashboard-item\">\n            <div className=\"name\">Avg. time per document</div>\n            <div className=\"value\"><span class=\"st st-darker\">{ this.props.data.avgTimePerDocument } seconds</span></div>\n          </div>\n          </div>\n\n          <Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/tagging\"} className=\"annotate-button\"><i class=\"fa fa-pencil\"></i>Annotate<div className=\"subtitle\">{this.props.data.userDocsAnnotated}/{this.props.data.userAnnotationsRequired} complete</div></Link>\n\n        </div>\n\n\n\n        <div className=\"dashboard-white-boxes\">\n\n\n          <div className=\"dashboard-wrapper-item col-60\">\n\n\n\n            <div className=\"dashboard-item col-100\">\n              <div className=\"inner\">\n                <div className=\"dashboard-flex-header\">\n                  <h3>Entity frequencies</h3>\n                  { this.props.data.entityChartData && <div onClick={this.toggleEntityChartColours.bind(this)} className={\"chart-option\" + (this.state.entityChartMulticolour ? \" active\" : \"\")}><span className=\"checkbox\"></span><span>Colour by class</span></div> }\n                </div>\n                <div>\n                  { this.props.loading && \n                    <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                  }\n                  { !this.props.loading && !this.props.data.entityChartData && <div className=\"chart-placeholder chart-not-available\">This project does not have any annotations yet.</div>}\n                  { !this.props.loading && this.props.data.entityChartData &&\n                  \n                    <EntityFrequenciesChart data={this.props.data.entityChartData} multicolour={this.state.entityChartMulticolour} />\n                  }\n\n\n                </div>\n              </div>\n            </div>\n\n            <div className=\"dashboard-item col-60\">\n\n\n              <div className=\"inner\">\n                <div className=\"dashboard-flex-header\">\n                  <h3>Activity</h3>\n                  { this.props.data.activityChartData && <div onClick={this.toggleActivityChartCumulative.bind(this)} className={\"chart-option\" + (this.state.activityChartCumulative ? \" active\" : \"\")}><span className=\"checkbox\"></span><span>Cumulative</span></div> }\n                </div>\n\n\n                <div>\n                  { this.props.loading && \n                    <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                  }\n                  { !this.props.loading && !this.props.data.activityChartData && <div className=\"chart-placeholder chart-not-available\">This project does not have any activity yet.</div>}\n                  { !this.props.loading &&  this.props.data.activityChartData &&\n                    <ActivityChart data={this.props.data.activityChartData} cumulative={this.state.activityChartCumulative}/>\n                  }\n                </div>\n              </div>\n\n\n\n\n            </div>\n\n            \n\n            <div className=\"dashboard-item col-40\">\n              <div className=\"inner\">\n                <h3>Annotations/document</h3>\n                { this.props.loading && \n                  <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                }\n                { !this.props.loading && \n                  <WaffleChart data={this.props.data.annotationsChartData}/>\n                }\n              </div>\n            </div>\n          </div>\n\n        \n\n\n        <div className=\"dashboard-item col-40 double-height\">\n          <div className=\"inner\">\n            <h3>Comments</h3>\n\n            <div className={\"comments-wrapper\" + (this.props.data.comments.length === 0 ? \" no-comments\": \"\")}>       \n\n              { this.props.data.comments.length === 0 && <div className=\"no-comments\">This project does not have any comments yet.</div>}       \n\n              { this.props.data.comments.map((comment, i) => <Comment index={i} {...comment} project_id={this.props.project_id} />) }\n\n            </div>\n          </div>\n        </div>\n\n          \n        </div>\n\n\n      </div>    \n      \n    )\n  }\n}\n\n\n\nclass ProjectViewSidenav extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n    /* old \n    <div className=\"project-card\">\n      <div className=\"circle-icon\"><div className=\"inner\">PO</div></div>\n      <div>\n        <div className=\"project-name\">Project one</div>\n        <div className=\"project-creator\">Created by <span className=\"creator-name\">someone</span></div>\n      </div>\n    </div>\n\n\n\n    <div className=\"go-back\"><Link to=\"/projects\"><i class=\"fa fa-chevron-left\"></i>Projects</Link></div>\n\n    */\n\n    var currentLocation = window.location.pathname;\n\n\n    var view = currentLocation.split('/').slice(3, currentLocation.split('/').length);\n    console.log(view);\n\n    return (\n      <nav id=\"project-view-sidenav\">\n        <div className=\"project-card\">\n          <div className=\"project-title-creator\">\n            <div className={\"project-name\" + (!this.props.projectTitle ? \" st\" : \"\")} style={{'display': 'block'}}><Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/dashboard\"}>{this.props.projectTitle ? this.props.projectTitle : \"xxxxxxxx\"}</Link></div>\n            <div className={\"project-creator\" + (!this.props.projectAuthor ? \" st\" : \"\")} style={{'display': 'block'}}>Created by <span className=\"creator-name\">{this.props.projectAuthor ? this.props.projectAuthor : \"xxxxxxxx\"}</span></div>\n          </div>\n        </div>\n\n        <ul className=\"sidenav-items\">\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Dashboard\" icon=\"bar-chart\"/>\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Entity Hierarchy\" icon=\"sitemap\"/>  \n\n          <ProjectViewSidenavSubmenu project_id={this.props.project_id} view={view} name=\"Annotations\" menuItems={ [{name: \"Curation\", icon: \"gavel\"}, { name: \"Download\", icon: \"download\" }] } icon=\"list-alt\"/>\n\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Annotators\" icon=\"user\"/>\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Settings\" icon=\"wrench\"/>\n        </ul>\n\n      </nav>\n    )\n  }\n}\n//           <ProjectViewSidenavSubmenu project_id={this.props.project_id} view={view} name=\"Annotations\" menuItems={ [{name: \"Curation\", icon: \"list-alt\"}, { name: \"Download\", icon: \"download\" }] }icon=\"list-alt\"/>\n\n\nclass ProjectViewSidenavSubmenu extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n\n    var pathName = this.props.name.replace(\" \", \"-\").toLowerCase();\n\n    console.log(this.props.view, pathName)\n\n\n\n    var firstChildPathName = this.props.menuItems[0].name.replace(\" \", \"-\").toLowerCase();\n    var open = this.props.view[0] === pathName;\n    return (\n      <li className={\"submenu-header\" + (this.props.view[0] === pathName ? \" active\" : \"\")}>\n        <Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/\" + pathName +\"/\" + firstChildPathName} ><i className={\"fa fa-\" + this.props.icon}></i>{ this.props.name }</Link>\n        <ul className={\"submenu\" + (open ? \" open\" : \"\")}>\n        {this.props.menuItems.map((item, index) => <ProjectViewSidenavButton project_id={this.props.project_id} view={this.props.view} name={item.name} parentPath={pathName} icon={item.icon}/>)}\n        </ul>\n      </li>\n    )\n  }\n}\n\n\nclass ProjectViewSidenavButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    var pathName = this.props.name.replace(\" \", \"-\").toLowerCase();\n    if(this.props.parentPath) pathName = this.props.parentPath + \"/\" + pathName;\n    return (\n      <li className={this.props.view.join('/') === pathName ? \"active\" : \"\"}>\n        <Link to={BASE_URL + \"projects/\" + this.props.project_id + \"/\" + pathName}>\n        <i className={\"fa fa-\" + this.props.icon}></i>{ this.props.name }\n        </Link>\n\n\n      </li>\n    )\n  }\n}\n\nclass EmptyThing extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    return ( <main>This page is still a work in progress!</main> )\n  }\n}\n\n\n\n\n\n\n\n\n/*  <div className=\"wrapper\">\n          <div className=\"inner\">\n            <table className=\"category-hierarchy-table\">\n              <thead>\n                <tr>\n                  <th><span className=\"inner\">Category</span></th>\n                  <th><span className=\"inner\">Description</span></th>\n                </tr>\n              </thead>\n              <tbody>\n                { this.props.loading && generateEmptyRows(15) }\n                { this.props.data && this.props.data.categories.map((row, index) => \n                  <tr>\n                    <td className={\"color-\" + getColourIndex(row, this.props.colourIndexes)}><span className=\"inner\">{getRowName(row)}</span></td>\n                    <td><span className=\"inner\">(none)</span></td>\n                  </tr>\n                )}\n              </tbody>\n\n            </table>\n          </div>\n        </div>\n*/\n\nclass ProjectView extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n\n      error: null,\n\n      data: {\n\n        dashboard: {\n\n          userDocsAnnotated: 0,\n          userAnnotationsRequired: 0,\n\n          numDocGroupsAnnotated: 999,\n          totalDocGroups: 9999,\n\n          avgAgreement: 0.5,\n\n          avgTimePerDocument: 15,\n\n          \n\n          // Note that the comments below are just placeholders. I should probably generate a function to make these automatically\n          // These will be skeleton screens on the comments div\n          comments: [\n            {\n              author: \"Mr Pingu\",\n              date: \"4 Sept\",\n              text: \"Noot noot! I don't know what this is\",\n              document_string: \"one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Mrs Pingu\",\n              date: \"3 Sept\",\n              text: \"This doesn't make sense\",\n              document_string: \"one two three four five six seven one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Michael\",\n              date: \"1 Sept\",\n              text: \"Not sure what a flange is\",\n              document_string: \"one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Michael\",\n              date: \"1 Sept\",\n              text: \"I sure hope these never get rendered\",\n              document_string: \"one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Borat\",\n              date: \"1 Sept\",\n              text: \"very nice\",\n              document_string: \"one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            }\n          ],\n        } ,\n        categoryHierarchy: { children: [] },      \n      },\n\n       \n    }\n\n    // Store the state of the curation interface so it persists across page changes   \n    this.curationInterfaceState = null;\n  }\n\n  async componentWillMount() {\n    var t = this;\n\n    try { \n      var d = await _fetch('projects/' + this.props.project_id, 'GET', this.props.setErrorCode, 555)\n\n      if(d.dashboard.activityChartData) d.dashboard.activityChartData = setActivityChartStyles(d.dashboard.activityChartData);\n      t.setState({\n        loading: false,\n        data: d,\n        \n      }, () => { this.props.setProject(d.project_name, d.project_author); } ); \n    } catch(err) {\n      console.log(err);\n    }\n    // Query api for project\n\n  }\n\n  setCurationInterfaceData(data) {\n    console.log(\"saving state\", data);\n    this.curationInterfaceState = data;\n  }\n\n  render() {\n    var location = this.props.location;\n    console.log(\"Rendering project view\", this.curationInterfaceState)\n\n    var docId = queryString.parse(location.search).docId;\n    \n\n    return (\n      \n  \n    \n      <div id=\"project-view\" className={this.state.loading ? \"loading\" : \"\"}>\n        <ProjectViewSidenav \n                            project_id={this.props.project_id}\n                            projectTitle={this.props.projectTitle}\n                            projectAuthor={this.props.projectAuthor}\n\n                             />\n\n\n        <div className=\"project-view-wrapper\">\n          <TransitionGroup className=\"transition-group\">\n            <CSSTransition\n            key={location.key}\n            timeout={{ enter: 400, exit:400 }}\n            classNames=\"fade\"\n            >\n              <section className={\"route-section\" + (!this.state.loading ? \" loaded\" : \"\")}>\n               <Switch location={location}>\n                  <Route path=\"/projects/:id/dashboard\"           render={() => <ProjectDashboard loading={this.state.loading} data={this.state.data.dashboard} project_id={this.props.project_id} />} />     \n                  <Route path=\"/projects/:id/annotations/curation\"            render={() => <CurationInterface user={this.props.user} project_id={this.props.project_id} prevState={this.curationInterfaceState} saveState={this.setCurationInterfaceData.bind(this)} loading={this.state.loading} documentIdQuery={docId} setErrorCode={this.props.setErrorCode} />} />     \n                  <Route path=\"/projects/:id/annotations/download\"            render={() => <AnnotationsTable user={this.props.user} project_id={this.props.project_id} data={this.state.data.annotationsTable ? this.state.data.annotationsTable : {users: [], num_combined_available: 0}} setErrorCode={this.props.setErrorCode} />} />     \n                  <Route path=\"/projects/:id/entity-hierarchy\"  render={() => <CategoryHierarchyPage loading={this.state.loading} data={this.state.data.categoryHierarchy} colourIndexes={this.state.data.dashboard.entityChartData ? this.state.data.dashboard.entityChartData.colourIndexes : null} />} />     \n                  <Route path=\"/projects/:id/annotators\"         render={() => <InvitationsPage data={this.state.data.invitationsTable ? this.state.data.invitationsTable : {}} loading={this.state.loading} />} />     \n                  <Route path=\"/projects/:id/settings\"            render={() => <EmptyThing {...this.state} />} />   \n                  <Route             render={() => <Error404Page />} />   \n                </Switch>\n              </section>\n            </CSSTransition>\n          </TransitionGroup>\n        </div>\n        \n     \n      </div>\n      \n    )\n  }\n}\n// { currentView }\n\nexport default withRouter(ProjectView);","import React from \"react\";\nimport {Component} from \"react\";\nimport BASE_URL from 'globals/base_url';\n\nimport { Redirect, Link, BrowserRouter, Route, Switch, withRouter } from 'react-router-dom'\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\nimport getCookie from 'functions/getCookie';\n\n\nvar lipsumStr = \"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,\";\nvar lipsum = lipsumStr.split(\". \")\n\nfunction getRandomString() {\n  var arr = []\n  for(var i = 0; i < 200; i++) {\n    arr.push(lipsum[Math.floor(Math.random() * lipsum.length)] + \". \")\n  }\n  return arr.join(\"\")\n}\n\nfunction getNextWord(i) {\n  return lipsum[i] + \" \";\n}\n\n\n\nclass LettersBackground extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      characters: getRandomString(),\n    }\n    this.characterChangeFn = null;\n  }\n\n  changeCharacters() {\n    this.setState({\n      characters: getRandomString(),\n    })\n  }\n\n  componentWillUnmount() {\n    window.clearInterval(this.characterChangeFn);\n  }\n\n  componentWillMount() {\n    this.characterChangeFn = window.setInterval(this.changeCharacters.bind(this), 1000);\n    // Was originally rotating chars but seems unnecessary\n  }\n\n  render() {\n    return (\n      <div className=\"letters-background\">\n        {this.state.characters}\n      </div>\n    )\n  }\n}\n\nclass HomeViewRegister extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div class=\"user-form form-box\">\n        <div class=\"header\">\n          <h1>Register</h1>\n        </div>\n        <div class=\"body\">\n          <div className=\"loading-message\"><i className=\"fa fa-spinner fa-spin\"></i>Loading...</div>\n          <form action=\"/redcoat/register\" method=\"post\">\n            <div>\n              <label>Username</label>\n              <input type=\"text\" name=\"username\" autoFocus=\"autofocus\" placeholder=\"Username\"/>\n            </div>\n            <div>\n              <label>Email</label>\n              <input type=\"email\" name=\"email\" placeholder=\"Email\" required=\"required\"/>\n            </div>\n            <div>\n              <label>Password</label>\n              <input id=\"password\" type=\"password\" name=\"password\" placeholder=\"Password\" required=\"required\"/>\n              <label>Password confirmation</label>\n              <input id=\"password_confirmation\" type=\"password\" name=\"password_confirmation\" required=\"required\" placeholder=\"Password confirmation\"/>\n            </div>\n            <div class=\"buttons\">\n              <div><Link class=\"back-button\" to={BASE_URL}><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\n              <div>\n                <input type=\"submit\" value=\"Register\"/>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    )\n  }\n}\n\nclass HomeViewLogin extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      email: '',\n      password: '',\n      error: null,\n      errorMessage: null,\n    }\n  }\n\n  handleUsernameChange(e) {\n    this.setState({\n      email: e.target.value,\n    })\n  }\n\n  handlePasswordChange(e) {\n    this.setState({\n      password: e.target.value,\n    })\n  }\n\n  submitForm(e) {\n    e.preventDefault();\n    console.log(e);\n    const csrfToken = getCookie('csrf-token');\n\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify({\n        email: this.state.email,\n        password: this.state.password,\n      }),  \n      credentials: 'include',\n    };\n\n\n    this.setState({\n      errorMessage: null,\n      loading: true,\n    }, () => \n\n      window.setTimeout( () => {\n\n        fetch('http://localhost:3000/api/users/login', fetchConfigPOST) // TODO: move localhost out\n        .then(async (response) => {\n          if(response.status !== 200) {\n            var d = await response.json();\n            throw new Error(d.message);      \n          }          \n          return response.text()\n        })\n        .then((data) => {\n          try {\n            var d = JSON.parse(data);\n          } catch(err) {\n            console.log(err, d);\n            throw new Error(\"An unexpected error has occured\")\n          }\n          \n          this.props.setUserData(d);          \n        }).catch((err) => {\n          this.setState({\n            errorMessage: err.message,\n            password: '',\n            loading: false,\n          });\n        })\n      }, 1)\n    );\n\n  }\n\n  render() {\n    return (\n      <div class={\"user-form form-box\" + (this.state.loading ? \" loading\" : \"\")}>\n        <div class=\"header\">\n          <h1>Login</h1>\n        </div>\n        <div class=\"body\">\n          <div className=\"loading-message\"><i className=\"fa fa-spinner fa-spin\"></i>Loading...</div>\n          { this.state.errorMessage && <div className=\"error-message\"><span className=\"error\">Error: </span>{this.state.errorMessage}.</div>}\n          \n          <form onSubmit={this.submitForm.bind(this)} method=\"post\">\n            <div>\n              <label>Username or email</label>\n              <input type=\"text\" name=\"email\" autoFocus=\"autofocus\" required=\"required\" placeholder=\"Username or email\" value={this.state.email} onChange={this.handleUsernameChange.bind(this)} />\n            </div>\n            <div>\n              <label>Password</label>\n              <input type=\"password\" name=\"password\" required=\"required\" placeholder=\"Password\" value={this.state.password} onChange={this.handlePasswordChange.bind(this)} />\n            </div><Link class=\"forgot-password-link\" to={BASE_URL + \"forgot_password\"}>Forgot password?</Link>\n            <div class=\"buttons\">\n              <div><Link class=\"back-button\" to={BASE_URL}><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\n              <div>\n                <input type=\"submit\" value=\"Login\"/>\n              </div>\n            </div>\n          </form>\n\n        </div>\n      </div>\n    )\n  }\n}\n\nclass HomeViewForgotPassword extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div class=\"user-form form-box\">\n        <div class=\"header\">\n          <h1>Forgot Password</h1>\n        </div>\n        <div class=\"body\">\n          <form action=\"/redcoat/forgot_password\" method=\"post\">\n            <input type=\"hidden\" name=\"_csrf\" value=\"oOFHs5QK-_YPdUWgNII3vfrQ_erXv2dwFmz8\"/>\n            <div>\n              <label>Email</label>\n              <input type=\"email\" name=\"email\" placeholder=\"Email\" required=\"required\" autoFocus=\"autofocus\"/>\n            </div>\n            <div class=\"buttons\">\n              <div><Link class=\"back-button\" to={BASE_URL + \"login\"}><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\n              <div>\n                <input type=\"submit\" value=\"Reset password\"/>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    )\n  }\n}\n\nclass HomeViewMain extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"homepage-main\">\n        <h1 id=\"h1-welcome\" data-content=\"Redcoat\">Redcoat</h1>\n        <h2 id=\"h2-byline\" data-content=\"Collaborative Annotation Tool\">Collaborative Annotation Tool</h2>\n        <div class=\"buttons\"><Link to={BASE_URL + \"register\"}>\n            <div class=\"button\" id=\"register-button\">\n              <h2>\n               Register\n              </h2>\n            </div></Link><Link to={BASE_URL + \"login\"}>\n            <div class=\"button\" id=\"login-button\">\n              <h2>\n                Login\n              </h2>\n            </div></Link></div>\n        </div>\n\n      )\n\n\n  }\n}\n\nclass HomeView extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n\n    var location = this.props.location;\n\n    return (\n    \n      <section id=\"welcome\">\n        <LettersBackground/>\n\n        <TransitionGroup className=\"transition-group\">\n          <CSSTransition\n          key={location.key}\n          timeout={{ enter: 400, exit:400 }}\n          classNames=\"fade\"\n          >\n            <section className=\"route-section homepage-route-section\">\n             <Switch location={location}>\n                 \n                <Route path=\"/login\"    render={() => <HomeViewLogin setUserData={this.props.setUserData}/> } />     \n                <Route path=\"/register\" component={HomeViewRegister} />  \n                <Route path=\"/forgot_password\" component={HomeViewForgotPassword} />  \n                <Route path=\"/\"         component={HomeViewMain} />       \n                \n              </Switch>\n            </section>\n          </CSSTransition>\n        </TransitionGroup>\n\n      </section>\n      \n\n    )\n  }\n}\n\n\nexport default withRouter(HomeView);","import React from \"react\";\nimport {Component} from \"react\";\n\n// The form help icon, which can be clicked to pop up the modal.\nclass NewProjectFormHelpIcon extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <span className=\"form-help\" onClick={this.props.onClick} ><i className=\"fa fa-info-circle fa-xxs\"></i><span className=\"info\">Info</span></span>\n    )\n  }\n}\n\nexport default NewProjectFormHelpIcon;","import React from \"react\";\nimport {Component} from \"react\";\nimport _ from 'underscore';\n\nclass FileUploadForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      file: null,\n      filename: null,\n      errorCleared: false, // Whether the current form error has been cleared\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(!_.isEqual(prevState.filename, this.state.filename)) {\n      this.props.updateFile(this.state.file);\n    }    \n    if((prevProps.hasError !== this.props.hasError) && this.props.hasError) {\n      this.setState({\n        errorCleared: false,\n      })\n    }\n  }\n\n  async updateFile(e) {\n    console.log(e.target.files[0]);\n    if(!e.target.files[0]) return;\n\n    this.setState({\n      file: e.target.files[0],\n      filename: e.target.files[0].name,\n      errorCleared: true,\n    }, () => {\n      this.props.updateFile(this.state.file);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"upload-form-container\">\n        <div className={\"upload-form \" + (this.props.file_metadata ? \"saved\" : \"\")  + ((this.props.hasError && !this.state.errorCleared) ? \"error\" : \"\")}>\n\n          <input required={!this.props.file_metadata} type=\"file\" id=\"upload-dataset\" name=\"upload-dataset\" onChange={(e) => this.updateFile(e)}/>\n          <label htmlFor=\"upload-dataset\">\n\n            { this.props.saving\n            ? <span className=\"center\"><i className=\"form-icon fa fa-cog fa-spin\"></i>Uploading...</span>\n            : ((this.props.hasError && !this.state.errorCleared)              \n              ? <span className=\"center\"><i className=\"form-icon fa fa-times\"></i>An error occurred while uploading<br/><em>{this.state.filename}</em>.</span>\n              : (this.props.file_metadata \n                ? (\n                    <span>                      \n                      <span className=\"center\"><em>{this.props.file_metadata[0][1]}</em> uploaded successfully.</span>\n                      <table className=\"file-metadata\">\n                        <tbody>\n                        { this.props.file_metadata.slice(1, this.props.file_metadata.length).map((item, index) => \n                          <tr key={index}><td>{item[0]}:</td><td>{item[1]}</td></tr>                    \n                        )}\n                        </tbody>\n                      </table>\n                    </span>\n                  )\n                : (this.state.filename              \n                  ? (<span><i className=\"form-icon fa fa-check\"></i>Ready to upload <em>{this.state.filename}</em>.</span>)\n                  : <span><i className=\"form-icon fa fa-upload\"></i>Click here to upload a {this.props.name ? this.props.name : 'dataset'}.</span>\n                )\n              )\n            )\n            }\n          </label>\n\n          \n        </div>                \n      </div>\n\n\n    )\n  }\n}\n\nexport default FileUploadForm;","import React from \"react\";\nimport {Component} from \"react\";\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\nimport _ from 'underscore';\n\nimport FileUploadForm from './FileUploadForm';\n\n// Set up project details page.\n// (project title, description, data)\nclass NewProjectDetails extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: {\n        project_name: '',\n        project_description: '',  \n        dataset: null,\n      },\n    }\n  }\n\n\n  componentDidMount() {\n    this.setState({\n      data: this.props.data,\n    });\n    // if(this.props.data) {\n    //   console.log('modified 111')\n    //   this.setState({\n    //     data: this.props.data,\n    //   }, () => {\n    //     console.log(this.state.data, this.props.data, \"<<\")\n    //   })\n    // }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // if(!_.isEqual(this.props.data, this.state.data) && _.isEqual(prevState.data, this.state.data)) {\n    //   this.setState({\n    //     data: this.props.data,\n    //   });\n    // }\n\n    if(!_.isEqual(this.props.data, this.state.data) && !_.isEqual(prevState.data, this.state.data)) {\n      this.props.updateFormPageData(this.state.data, { reset_form: false });\n    }   \n  }\n\n  updateProjectName(e) {\n    var value = e.target.value;\n    if(value.trim().length === 0) value = '';\n    this.setState({\n      data: { ...this.state.data, project_name: value }\n    });\n  }\n\n  updateProjectDescription(e) {\n    var value = e.target.value;\n    if(value.trim().length === 0) value = '';\n    this.setState({\n      data: { ...this.state.data, project_description: value }\n    });\n  }\n\n  updateDataset(file) {\n    this.setState({\n      data: { ...this.state.data, dataset: file }\n    }, () => {\n      console.log('changed')\n      this.props.updateFormPageData(this.state.data, { reset_form: true });\n    })\n  }\n\n  render() {\n\n    var dataHelp = (<div>\n        <h2>Data</h2>\n        <p>Please upload your data using the form. The data may be in one of two formats: </p>\n        \n        <ul>\n          <li><b>Raw data</b>: The dataset must be saved as a .txt file. Each token within your data must be separated by a space, and each document must be on a new line.</li>\n          <li>(Coming soon): <b>Already labelled data</b>: The dataset must be saved as a .json file, in the same format as Redcoat annotation files.</li>\n        </ul>\n        \n      </div>\n    )\n    //console.log(this.state.data);\n    return (\n      <div>\n\n        <div className=\"flex-columns flex-columns-2\">\n\n          <div className=\"flex-column\">\n            <h2>Project details</h2>\n\n            <div className={\"form-group\" + (this.props.errorPaths.has(\"project_name\") ? \" error\" : \"\") }>\n              <label>Project name</label>\n              <input required\n                     onKeyDown={(e)=> e.keyCode == 13 ? e.preventDefault(): ''}\n                     maxLength={100}\n                     placeholder=\"Project name\"\n                     value={this.state.data.project_name || ''}\n                     onChange={(e) => this.updateProjectName(e)}/>\n            </div>\n\n            <div className={\"form-group\" + (this.props.errorPaths.has(\"project_description\") ? \" error\" : \"\") }>\n              <label>Project description (optional)</label>\n              <textarea maxLength={1000}\n                        placeholder=\"Project description\"\n                        value={this.state.data.project_description || ''}\n                        onChange={(e) => this.updateProjectDescription(e)}/>\n            </div>\n\n          </div>\n          <div className=\"flex-column\">\n            <h2>Data <NewProjectFormHelpIcon onClick={() => this.props.toggleFormHelp(dataHelp)} /></h2>\n            \n\n            <FileUploadForm \n              saving={this.props.saving && !this.props.data.file_metadata}\n              hasError={this.props.errorPaths && this.props.errorPaths.has(\"dataset\")}\n              updateFile={this.updateDataset.bind(this)}\n              file_metadata={this.props.data.file_metadata}\n\n            />\n          </div>\n        </div>\n\n\n      </div>\n    )\n  }\n}\n\n\nexport default NewProjectDetails;","\n\nvar hierarchyPresets = [\n\n    {\n      \"name\": \"Named Entity Recognition (NER)\",\n      \"entities\": [\n            \"Person\",\n            \"Organisation\",\n            \"Location\",\n            \"Miscellaneous\"\n      ]\n    },\n    {\n      \"name\": \"Fine-grained Entity Recognition (FIGER)\",\n            \"entities\": [\n            \"person\",\n            \"person/actor\",\n            \"person/architect\",\n            \"person/artist\",\n            \"person/athlete\",\n            \"person/author\",\n            \"person/coach\",\n            \"person/director\",\n            \"person/doctor\",\n            \"person/engineer\",\n            \"person/monarch\",\n            \"person/musician\",\n            \"person/politician\",\n            \"person/religious_leader\",\n            \"person/soldier\",\n            \"person/terrorist\",\n            \"organization\",\n            \"organization/airline\",\n            \"organization/company\",\n            \"organization/educational_institution\",\n            \"organization/fraternity_sorority\",\n            \"organization/sports_league\",\n            \"organization/sports_team\",\n            \"organization/terrorist_organisation\",\n            \"organization/government_agency\",\n            \"organization/government\",\n            \"organization/political_party\",\n            \"organization/educational_department\",\n            \"organization/military\",\n            \"organization/news_agency\",\n            \"location\",\n            \"location/city\",\n            \"location/country\",\n            \"location/county\",\n            \"location/province\",\n            \"location/railway\",\n            \"location/road\",\n            \"location/bridge\",\n            \"location/body_of_water\",\n            \"location/island\",\n            \"location/mountain\",\n            \"location/glacier\",\n            \"location/astral_body\",\n            \"location/cemetary\",\n            \"location/park\",\n            \"product\",\n            \"product/engine\",\n            \"product/airplane\",\n            \"product/car\",\n            \"product/ship\",\n            \"product/spacecraft\",\n            \"product/train\",\n            \"product/camera\",\n            \"product/mobile_phone\",\n            \"product/computer\",\n            \"product/software\",\n            \"product/game\",\n            \"product/instrument\",\n            \"product/weapon\",\n            \"art\",\n            \"art/film\",\n            \"art/play\",\n            \"art/written_work\",\n            \"art/newspaper\",\n            \"art/music\",\n            \"event\",\n            \"event/attack\",\n            \"event/election\",\n            \"event/protest\",\n            \"event/military_conflict\",\n            \"event/natural_disaster\",\n            \"event/sports_event\",\n            \"event/terrorist_attack\",\n            \"event/building\",\n            \"event/airport\",\n            \"event/dam\",\n            \"event/hospital\",\n            \"event/hotel\",\n            \"event/library\",\n            \"event/power_station\",\n            \"event/restaurant\",\n            \"event/sports_facility\",\n            \"event/theater\",\n            \"time\",\n            \"color\",\n            \"award\",\n            \"educational_degree\",\n            \"title\",\n            \"law\",\n            \"ethnicity\",\n            \"language\",\n            \"religion\",\n            \"god\",\n            \"chemical_thing\",\n            \"biological_thing\",\n            \"medical_treatment\",\n            \"disease\",\n            \"symptom\",\n            \"drug\",\n            \"body_part\",\n            \"living_thing\",\n            \"animal\",\n            \"food\",\n            \"website\",\n            \"broadcast_network\",\n            \"broadcast_program\",\n            \"tv_channel\",\n            \"currency\",\n            \"stock_exchange\",\n            \"algorithm\",\n            \"programming_language\",\n            \"transit_system\",\n            \"transit_line\"\n      ]\n    },\n    {\n      \"name\": \"Maintenance work orders\",\n      \"entities\": [\n            \"Item\",\n            \"Activity\",\n            \"Location\",\n            \"Time\",\n            \"Attribute\",\n            \"Cardinality\",\n            \"Agent\",\n            \"Consumable\",\n            \"Observation\",\n            \"Observation/Observed_state\",\n            \"Observation/Quantitative\",\n            \"Observation/Qualitative\",\n            \"Specifier\",\n            \"Event\",\n            \"Unsure\",\n            \"Typo\",\n            \"Abbreviation\",\n      ],\n      \"descriptions\": {\n            \"Item\": \"A maintainable item\",\n            \"Consumable\": \"Entities that are replaced and not repaired. & oil, grease, bolts, water, filters, gasket\",\n            \"Activity\": \"An action done by an agent\",\n            \"Observation/Observed_state\": \"The state of an item - must be discrete (in that state or not) and unambiguous\",\n            \"Observation/Qualitative\": \"An imprecise measure\",\n            \"Observation/Quantitative\": \"A precise measure (include units if available)\",\n            \"Location\": \"Where an item is, either absolutely or relative to another item\",\n            \"Specifier\": \"An adjective that specifies an item, i.e. could differentiate it from other items\",\n            \"Attribute\": \"An attribute of an item. It is specific to an item. The attribute is not a value\",\n            \"Agent\": \"A person, organisation, or individual\",\n            \"Cardinality\": \"Numerical values or terms describing members of a set\",\n            \"Time\": \"When an activity occurs, either absolutely or relative in time to another activity\",\n            \"Event\": \"A point in time that describes a state transition. No agent is specifically identified\",\n            \"Typo\": \"A spelling error or typo\",\n            \"Unsure\": \"Use this tag when not sure what something is\",\n            \"Abbreviation\": \"An abbreviated term\",\n            \n      }\n    },    \n    {\n      \"name\": \"Mining accidents\",\n      \"entities\": [\n\n            \"accident_cause\",\n            \"accident_cause/bodily_contact\",\n            \"accident_cause/caught_between\",\n            \"accident_cause/fall\",\n            \"accident_cause/fall/fall_from_heights\",\n            \"accident_cause/fall/fall_from_vehicle\",\n            \"accident_cause/over_exertion\",\n            \"accident_cause/recurrence\",\n            \"accident_cause/stepping\",\n            \"accident_cause/struck_by_object\",\n            \"accident_cause/trip_and_fall\",\n            \"accident_cause/vehicle_related\",\n            \"activity\",\n            \"activity/driving\",\n            \"activity/running\",\n            \"activity/walking\",\n            \"age_group\",\n            \"age_group/age_15_24\",\n            \"age_group/age_25_34\",\n            \"age_group/age_35_44\",\n            \"age_group/age_45_54\",\n            \"age_group/age_55_64\",\n            \"age_group/age_65_100\",\n            \"body_part\",\n            \"body_part/arm\",\n            \"body_part/arm/elbow\",\n            \"body_part/arm/elbow/left_elbow\",\n            \"body_part/arm/elbow/right_elbow\",\n            \"body_part/arm/hand\",\n            \"body_part/arm/hand/fingers\",\n            \"body_part/arm/hand/left_hand\",\n            \"body_part/arm/hand/right_hand\",\n            \"body_part/arm/hand/thumb\",\n            \"body_part/arm/hand/thumb/left_thumb\",\n            \"body_part/arm/hand/thumb/right_thumb\",\n            \"body_part/arm/left_arm\",\n            \"body_part/arm/right_arm\",\n            \"body_part/arm/shoulder\",\n            \"body_part/arm/shoulder/left_shoulder\",\n            \"body_part/arm/shoulder/right_shoulder\",\n            \"body_part/arm/wrist\",\n            \"body_part/arm/wrist/left_wrist\",\n            \"body_part/arm/wrist/right_wrist\",\n            \"body_part/back\",\n            \"body_part/back/lower_back\",\n            \"body_part/back/upper_back\",\n            \"body_part/body\",\n            \"body_part/body/chest\",\n            \"body_part/body/stomach\",\n            \"body_part/body/torso\",\n            \"body_part/groin\",\n            \"body_part/head\",\n            \"body_part/head/ear\",\n            \"body_part/head/ear/left_ear\",\n            \"body_part/head/ear/right_ear\",\n            \"body_part/head/eye\",\n            \"body_part/head/eye/left_eye\",\n            \"body_part/head/eye/right_eye\",\n            \"body_part/head/mouth\",\n            \"body_part/head/nose\",\n            \"body_part/leg\",\n            \"body_part/leg/ankle\",\n            \"body_part/leg/ankle/left_ankle\",\n            \"body_part/leg/ankle/right_ankle\",\n            \"body_part/leg/calf\",\n            \"body_part/leg/calf/left_calf\",\n            \"body_part/leg/calf/right_calf\",\n            \"body_part/leg/foot\",\n            \"body_part/leg/foot/left_foot\",\n            \"body_part/leg/foot/right_foot\",\n            \"body_part/leg/foot/toes\",\n            \"body_part/leg/knee\",\n            \"body_part/leg/knee/left_knee\",\n            \"body_part/leg/knee/right_knee\",\n            \"body_part/leg/left_leg\",\n            \"body_part/leg/right_leg\",\n            \"body_part/leg/thigh\",\n            \"body_part/leg/thigh/left_thigh\",\n            \"body_part/leg/thigh/right_thigh\",\n            \"body_part/neck\",\n            \"equipment\",\n            \"equipment/bund_wall\",\n            \"equipment/cage\",\n            \"equipment/cables\",\n            \"equipment/catenery_cable\",\n            \"equipment/chock\",\n            \"equipment/chute\",\n            \"equipment/filter\",\n            \"equipment/headframe\",\n            \"equipment/jumbo\",\n            \"equipment/mechanical_equipment\",\n            \"equipment/mechanical_equipment/auger\",\n            \"equipment/mechanical_equipment/cavity_monitoring_system\",\n            \"equipment/mechanical_equipment/conveyor\",\n            \"equipment/mechanical_equipment/crusher\",\n            \"equipment/mechanical_equipment/pump\",\n            \"equipment/mechanical_equipment/pump/sump_pump\",\n            \"equipment/mechanical_equipment/skip\",\n            \"equipment/personal_protective_equipment\",\n            \"equipment/pipe\",\n            \"gender\",\n            \"gender/female\",\n            \"gender/male\",\n            \"injury\",\n            \"injury/amputation\",\n            \"injury/bite\",\n            \"injury/bruises\",\n            \"injury/bruises/contusion\",\n            \"injury/burn\",\n            \"injury/burn/electric_burn\",\n            \"injury/burn/thermal_burn\",\n            \"injury/chemical_effect\",\n            \"injury/crush_injury\",\n            \"injury/dislocation\",\n            \"injury/dislocation/displacement\",\n            \"injury/fracture\",\n            \"injury/fracture/break\",\n            \"injury/laceration\",\n            \"injury/loss_of_conciousness\",\n            \"injury/multiple_injuries\",\n            \"injury/muscle\",\n            \"injury/muscle/sprain\",\n            \"injury/muscle/strain\",\n            \"injury/puncture\",\n            \"injury/splinter\",\n            \"injury/unspecified_injuries\",\n            \"location\",\n            \"location/camp_medical_centre\",\n            \"location/kitchen\",\n            \"location/office\",\n            \"person\",\n            \"person/blast_guard\",\n            \"person/blaster\",\n            \"person/boilermaker\",\n            \"person/chef\",\n            \"person/contractor\",\n            \"person/driller\",\n            \"person/driver\",\n            \"person/electrical_worker\",\n            \"person/employee\",\n            \"person/fitter\",\n            \"person/individual\",\n            \"person/injured_person\",\n            \"person/maintainer\",\n            \"person/offsider\",\n            \"person/operator\",\n            \"person/personnel\",\n            \"person/process_worker\",\n            \"person/service_crew\",\n            \"person/spotter\",\n            \"person/supervisor\",\n            \"person/telehandler\",\n            \"person/underground_operator\",\n            \"person/worker\",\n            \"severity\",\n            \"severity/minor\",\n            \"severity/serious\",\n            \"severity/fatal\",\n            \"severity/ndi\",\n            \"vehicle\",\n            \"vehicle/light_vehicle\",\n            \"vehicle/light_vehicle/car\",\n            \"vehicle/light_vehicle/forklift\",\n            \"vehicle/light_vehicle/man_car\",\n            \"vehicle/light_vehicle/mine_car\",\n            \"vehicle/light_vehicle/ute\",\n            \"vehicle/light_vehicle/golf_buggy\",\n            \"vehicle/heavy_vehicle\",\n            \"vehicle/heavy_vehicle/bogger\",\n            \"vehicle/heavy_vehicle/continuous_miner\",\n            \"vehicle/heavy_vehicle/dozer\",\n            \"vehicle/heavy_vehicle/dump_truck\",\n            \"vehicle/heavy_vehicle/excavator\",\n            \"vehicle/heavy_vehicle/haul_truck\",\n            \"vehicle/heavy_vehicle/scraper\",\n            \"vehicle/heavy_vehicle/grader\",\n            \"unspecified_category\"\n          ],\n      },\n  ]\n\nexport default hierarchyPresets;","import React from \"react\";\nimport {Component} from \"react\";\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\n\nimport hierarchyPresets from 'views/NewProjectView/functions/hierarchy_presets';\nimport { slash2txt, txt2json } from 'views/NewProjectView/functions/hierarchy_helpers';\n\nimport _ from 'underscore';\n\nimport { ModifiableCategoryHierarchy } from 'views/SharedComponents/CategoryHierarchy';\n\n// Setup project entity hierarchy page.\nclass NewProjectEntityHierarchy extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: {\n        entity_hierarchy: [],\n        hierarchy_preset: \"None\",\n      },\n\n      loading: false,\n      \n      \n      preset_is_modified: false,\n\n    }\n\n    this.selectLabelRef = React.createRef();\n    this.selectRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.setState({\n      data: this.props.data\n    })\n    // if(this.props.prevState) {\n    //   console.log(\"Loading state:\", this.props.prevState)\n    //   this.setState(this.props.prevState);\n    // } else {\n    //   this.setState({\n    //     entity_hierarchy: this.props.entity_hierarchy,\n    //     selectedPreset: \"None\",\n    //   });\n    // }\n  }\n\n  componentDidMount() {\n    this.setState({\n      data: this.props.data,\n      preset_is_modified: (this.props.data.hierarchy_preset.indexOf(\"(modified)\") > 0),\n     }); \n  }\n\n  componentDidUpdate(prevProps, prevState) {\n\n\n    if(!_.isEqual(this.props.data, this.state.data) && !_.isEqual(prevState.data, this.state.data)) {\n      this.props.updateFormPageData(this.state.data, { reset_form: false });            \n    }\n\n\n\n    // if(!_.isEqual(this.props.data, this.state.data) && _.isEqual(prevState.data, this.state.data)) {\n    //  this.setState({\n    //   data: { ...this.props.data}\n    //  });            \n    // } \n\n    // if(!_.isEqual(this.props.data, this.state.data) && !_.isEqual(prevState.data, this.state.data)) {\n    //   console.log('updating', this.state.data)\n    //   this.props.updateFormPageData(this.state.data);\n    // } \n  }\n\n  async markModified() {\n\n    if(this.state.preset_is_modified) { this.props.markModified(); return }\n    await this.setState({\n      data: {...this.state.data, \n        hierarchy_preset: this.state.data.hierarchy_preset === \"None\"\n          ? \"Custom\"\n          : (this.state.data.hierarchy_preset + (this.state.data.hierarchy_preset.endsWith(\" (modified)\") ? (\"\") : \" (modified)\"))\n\n      },\n      preset_is_modified: true,\n    });\n\n    return Promise.resolve();\n  }\n\n  // Update the hierarchy. Called after dragging\n  async updateHierarchy(entity_hierarchy) {\n    // if(this.state.preset_is_modified) {\n    //   this.props.updateFormPageData(this.state.data);\n    //   return;\n    // }\n\n    \n    console.log(entity_hierarchy[0], \"X\")\n    await this.setState({\n      data: { ...this.state.data,\n              entity_hierarchy: entity_hierarchy, } //...this.state.data,\n    });\n    await this.markModified();\n\n    console.log(this.state.data.hierarchy_preset);\n    this.props.updateFormPageData(this.state.data);\n\n    //this.props.updateFormPageData(this.state.data);\n  }\n\n  changePreset(e) {\n\n    function getPreset(preset_name) {\n      if(preset_name === \"None\") {\n        return {\n          name: \"None\",\n          entities: new Array(),\n          hierarchy: [],\n          descriptions: {},\n        }\n      }\n      console.log(preset_name, \"X\");\n      for(var preset of hierarchyPresets) {\n        if(preset.name === preset_name) {\n          return {\n            name: preset.name,\n            entities: preset.entities,\n            hierarchy: txt2json(slash2txt(preset.entities), preset.entities, preset.descriptions).children,\n            descriptions: preset.descriptions || {},\n          }\n        }\n      }\n    }\n\n    var value = e.target.value;\n\n    // Set loading to force an unmount of the modifiable hierarchy\n    this.setState({\n      loading: true,\n    }, (e) => {\n\n\n\n\n    var preset = getPreset(value);\n    console.log(preset.entities);\n    console.log(preset.hierarchy);\n    this.selectRef.current.blur();\n\n    this.setState({\n      data: {\n        entity_hierarchy: preset.hierarchy,\n        hierarchy_preset: preset.name,\n      },\n      loading: false,\n      preset_is_modified: false,\n    }, () => {\n      this.props.updateFormPageData(this.state.data);\n      window.scrollTo({\n        top: this.selectLabelRef.current.offsetTop + 140,\n        left: 0,\n        behavior: 'smooth'\n      });\n    })\n\n    });\n  }\n\n  render() {\n    //console.log(this.state.data.entity_hierarchy);\n\n    var help = (<div>\n        <h2>Entity Hierarchy</h2>\n        <p>Please define your entity hierarchy.</p>\n        <p>You may create new categories by entering them in the form below. You may also select from a list of presets, such as the standard 4-class Named Entity Recognition model.</p>\n      </div>\n    )\n\n    function getPresetName(preset) {\n      return preset['name']// + \" (\" + preset['entities'].length + \" entity classes)\";\n    }\n\n    function getErrorLines(errors) {\n      var names = new Set();\n      if(!errors) return names;\n      for(var err of errors) {\n        var msg = err.message;\n        var name = msg.match(/\\((\".*)\"\\)/g)[0] || '';\n        names.add(name.slice(2, name.length - 2))\n      }\n      return names;\n    }\n\n    var errorEntityNames = getErrorLines(this.props.errors);\n    // console.log(errorEntityNames)\n\n    return (\n      <div>\n        <h2>Entity Hierarchy <NewProjectFormHelpIcon onClick={() => this.props.toggleFormHelp(help)} /></h2>\n\n        {!this.props.loading && \n        <div className=\"form-group no-padding\">\n          <label ref={this.selectLabelRef} >Preset</label>\n          <select onChange={(e) => this.changePreset(e)} ref={this.selectRef} value={this.state.data.hierarchy_preset}  >\n            <option value=\"None\">None</option>\n            { hierarchyPresets.map((preset, index) => <option value={getPresetName(preset)} key={index}>{getPresetName(preset)} </option> ) }\n          \n            { this.state.preset_is_modified && <option value={this.state.data.hierarchy_preset}>{this.state.data.hierarchy_preset}</option> }\n          </select>\n        </div>\n        }\n\n        <div className=\"category-hierarchy-wrapper min-height\">\n        {!this.props.loading && !this.state.loading &&  \n          <ModifiableCategoryHierarchy\n                items={ this.state.data.entity_hierarchy || [] }  \n                preset={this.state.selectedPreset}                       \n                visible={true}   \n                limitHeight={true}\n                updateHierarchy={this.updateHierarchy.bind(this)}\n                markModified={this.markModified.bind(this)}\n                errorEntityNames={errorEntityNames}\n                userIsModifying={this.props.userIsModifying}\n          />\n        }\n        </div>\n\n\n      </div>\n    )\n  }\n}\n\n\nexport default NewProjectEntityHierarchy;","import React from \"react\";\nimport {Component} from \"react\";\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\nimport _ from 'underscore';\n\nimport FileUploadForm from './FileUploadForm';\n\nclass NewProjectAutomaticTagging extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: {\n        use_automatic_tagging: 'not-defined',\n        dataset: null,\n      },      \n    }\n    this.selectRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.setState({\n      data: this.props.data,\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(!_.isEqual(this.props.data, this.state.data) && \n      (!_.isEqual(prevState.data, this.state.data) || (this.state.data.dataset && (!_.isEqual(prevState.data.dataset.name, this.state.data.dataset.name))))) {\n      console.log('changed')\n      this.props.updateFormPageData(this.state.data, { reset_form: true });\n    }  \n  }\n\n  updateUseAutomaticTagging(e) {\n    var value = e.target.value;\n    this.selectRef.current.blur();\n\n    this.setState({\n      data: {\n        ...this.state.data,\n        use_automatic_tagging: value,\n      }\n    })\n  }\n\n\n  updateDataset(file) {\n    this.setState({\n      data: { ...this.state.data, dataset: file }\n    }, () => {\n      console.log('changed')\n      this.props.updateFormPageData(this.state.data, { reset_form: true });\n    });\n  }\n\n\n  render() {\n\n    var help = (<div>\n        <h2>Automatic Tagging</h2>\n        <p>Redcoat can automatically annotate terms according to a dictionary, helping to save annotation time. These annotations can be adjusted by your annotators when necessary.</p>\n        <p>To use automatic tagging, you can upload a CSV file where each row is a (term, entity type), e.g.</p>\n        <code>\n          car,Vehicle<br/>\n          running around,Activity<br/>\n          left leg,Body_part/Leg<br/>\n        </code>\n        <p>In the example above, \"car\" will be automatically labelled as a Vehicle, \"running around\" as an Activity, and \"left leg\" as a Body_part/Leg.</p>\n        <p>Note that the entity types must appear in your entity hierarchy, which is defined on the previous page.</p>\n          \n      </div>\n    )\n\n    return (\n      <div>\n        <h2>Automatic Tagging <NewProjectFormHelpIcon onClick={() => this.props.toggleFormHelp(help)} /></h2>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"use-automatic-tagging\">Use automatic tagging?</label>\n          <select name=\"use-automatic-tagging\"\n                  onChange={this.updateUseAutomaticTagging.bind(this)}\n                  id=\"use-automatic-tagging\"\n                  value={this.state.data.use_automatic_tagging}\n                  ref={this.selectRef}>\n            <option disabled hidden value=\"not-defined\">Click to select</option>\n            <option value=\"yes\">Yes</option>\n            <option value=\"no\">No</option>\n          </select>\n        </div>\n        <div className=\"form-group\">\n\n          { (this.state.data.use_automatic_tagging === \"yes\") && \n\n          <FileUploadForm \n                saving={this.props.saving && !this.props.data.file_metadata}\n                hasError={this.props.errorPaths && this.props.errorPaths.has(\"automatic_tagging\")}\n                updateFile={this.updateDataset.bind(this)}\n                file_metadata={this.props.data.file_metadata}\n                name={\"dictionary\"}\n\n          />\n        }\n        </div>\n\n\n\n      </div>\n    )\n  }\n}\n\nexport default NewProjectAutomaticTagging;","import React from 'react';\nimport {Component} from 'react';\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\nimport ProfileIcon from 'views/SharedComponents/ProfileIcon';\nimport formatDate from 'functions/formatDate'\nimport _fetch from 'functions/_fetch';\n\nfunction strIsEmail(str) {\n  return str.indexOf(\"@\") > 0 && str.split(\"@\").length === 2;\n}\n\nclass UserDetails extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    var user = this.props.user;\n    return (\n      <span className=\"user-details\">\n        <ProfileIcon user={user.is_registered ? user : null}/>\n        <span>\n          <div className=\"annotator-username\">{user.is_registered ? user.username : user.email}</div>\n          <div className=\"annotator-registration-date\">{user.is_registered ? \"Joined on \" + formatDate(user.created_at, { no_hours: true }) : \"Not yet registered\"}</div>\n        </span>\n      </span>\n\n    )\n  }\n}\n\nclass NewProjectAnnotators extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: {\n        users: [],\n      },\n      loading: true,\n      showingSuggestions: false,\n      userSearchResults: null,\n      userSuggestions: [],\n      searchTerm: '',\n    }\n  }\n\n  async componentDidMount() {\n    console.log('x', this.props.data);\n\n    await this.setState({\n      data: this.props.data,\n    });\n    \n    // var recentUsers = await this.queryRecentUsers();\n\n    var suggestedUsers = this.props.data.suggested_users;\n    this.setState({\n      loading: false,\n      data: this.props.data,\n      userSuggestions: suggestedUsers,\n      userSearchResults: suggestedUsers.length > 0 ? suggestedUsers : null,\n      showingSuggestions: suggestedUsers.length > 0 ? true : false,\n    });\n  }\n\n  // async queryRecentUsers() {\n  //   var d = await _fetch('http://localhost:3000/api/projects/new/getSuggestedUsers', 'GET', this.props.setErrorCode, false, false, 200);\n  //   return Promise.resolve(d.users);\n  // }\n\n  async queryAPI() {\n    await this.setState({\n      loading: true,\n    })\n    if(this.state.searchTerm.length === 0) {\n      \n      this.setState({\n        loading: false,\n        userSearchResults: this.state.userSuggestions.length > 0 ? this.state.userSuggestions : null,\n        showingSuggestions: this.state.userSuggestions.length > 0 ? true : false,\n      })\n      return;\n    }\n\n    var searchTerm = this.state.searchTerm\n    var isEmail = strIsEmail(searchTerm);\n\n    var d = await _fetch('http://localhost:3000/api/projects/new/searchUsers?searchTerm=' + searchTerm + \"&isEmail=\" + isEmail, 'GET', this.props.setErrorCode, false, false, 200);\n\n    var result = d.users;\n    if(isEmail && d.users.length === 0) {\n      result = [{\n        is_registered: false,\n        email: searchTerm,\n      }];\n    }\n    this.setState({\n      loading: false,\n      userSearchResults: result,\n      showingSuggestions: false,\n    });\n  }\n\n  // Update the search term in the input box.\n  changeSearchTerm(e) {\n    var value = e.target.value; \n    this.setState({\n      searchTerm: value,\n    })\n  }\n\n  submitViaEnter(e) {\n    console.log(e, \"EEE\");\n    e.preventDefault();\n    this.queryAPI();\n  }\n  onKeyDown(e) {\n    if(e.keyCode === 13) {\n      e.preventDefault();\n      this.queryAPI();\n    }\n  }\n\n  // Check whether the specified user has been added to this.state.data.users.\n  alreadyAddedUser(user) {\n    for(var u of this.state.data.users) {\n      if(user.username && u.username === user.username) {\n        return true;\n      }\n      if(user.email && u.email === user.email) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // Remove the user at the specified index\n  removeUser(index) {\n    var users = [...this.state.data.users];\n    users.splice(index, 1);\n    this.setState({\n      data: {\n        ...this.state.data,\n        users: users,\n      }\n    }, () => this.props.updateFormPageData(this.state.data));\n  }\n\n  // Adds the user to this.state.data.users (i.e. puts them in the table on the right).\n  addUser(user) {\n    var users = [...this.state.data.users];\n    users.push(user);\n\n    this.setState({\n      data: {\n        ...this.state.data,\n        users: users,\n      }\n    }, () => this.props.updateFormPageData(this.state.data));\n\n    return null;\n\n\n  }\n\n\n  // Highlight the row at the specified index via the delete-hover class (makes it go red).\n  deleteHighlightRow(index) {\n    document.getElementById(\"annotator-num-\" + index).classList.add('delete-hover');\n  }\n  // Remove the highlighting.\n  removeHighlightRow() {\n    var eles = document.getElementsByClassName(\"annotator\");\n    for(var ele of eles) {\n      ele.classList.remove(\"delete-hover\");\n    }\n  }\n\n  render() {\n    var help = (<div>\n        <h2>Annotators</h2>\n        <p>Please specify the annotators of this project.</p>\n        <p>You can search for annotators by username via the left-side window. Click \"add\" to add them to this project. An invitation to join your project will be sent to them once the project is created.</p>\n        <p>You can also enter an email address into the search bar. If no account with the email address exists, you can still them as an annotator - Redcoat will send them an invitation to register and join your project once your project has been created.</p>\n        <p>If no search term has been entered, Redcoat will suggest annotators for you based on your recent projects.</p>\n        <p>You can remove annotators using the trash icon in the right-side window. At present you cannot remove yourself from the annotation task.</p>\n      </div>\n    )\n\n    /*\n      If input search length < 3, clear search results so that there is nothing in the box\n      If input search length >= 3 and input[:3] !== apiSearchTerm[:3], set apiSearchTerm to input and query API for search results\n      Search results = for loop over api search results to check for matches if input search length > 3\n\n\n\n    */\n    //console.log(this.state.data.users, this.state.userSearchResults, this.state.searchTerm.length);\n\n    return (\n      <div>\n\n        <h2>Annotators <NewProjectFormHelpIcon onClick={() => this.props.toggleFormHelp(help)} /></h2>\n\n\n\n\n        <div className=\"flex-columns flex-columns-2\">\n\n\n          <div className={\"flex-column flex-column-33\" + (this.state.loading ? \" loading-prevent-action\" : \"\")}>\n\n\n\n            <div className=\"annotators-box\">\n              <div className=\"annotators-box-header\">Annotator lookup</div>\n              <div className=\"annotators-box-body\">\n                <div className=\"input-row\">\n                  <input id=\"annotator-name\"\n                    placeholder=\"Username or email address\"\n                    value={this.state.searchTerm} \n                    onKeyDown={(e) => this.onKeyDown(e)} onChange={this.changeSearchTerm.bind(this)}>\n\n                  </input>\n                  <button onClick={this.queryAPI.bind(this)} className=\"annotate-button\" type=\"button\"><i className=\"fa fa-search\"></i>Search</button>\n                </div>\n\n\n                <div className=\"annotators-box-list search-results\">\n\n                    { this.state.userSearchResults === null && \n                      <div className=\"not-searched-yet\">Enter a username or email address above to search for annotators.</div>\n                    }\n\n                    { (this.state.userSearchResults && this.state.userSearchResults.length === 0) &&\n                      <div className=\"no-search-results\">No results found.</div>\n                    }\n\n                    { (this.state.userSearchResults && this.state.userSearchResults.length > 0) &&\n                      <div className=\"search-results-found\">\n\n                        { this.state.showingSuggestions\n                          ? <h4>Suggestions ({this.state.userSearchResults.length})</h4>\n                          : <h4>Search results ({this.state.userSearchResults.length})</h4>\n                        }\n\n\n                        \n                        { this.state.userSearchResults.map((user, index) => \n                          <div className=\"annotator search-result\">\n                              <UserDetails user={user}/>\n                              {\n                                this.alreadyAddedUser(user)\n                                ? <div className=\"annotate-button user-added\">Added<i className=\"right fa fa-check\"></i></div>\n                                : <div className=\"annotate-button\" onClick={this.addUser.bind(this, user)}>Add <i className=\"right fa fa-chevron-right\"></i></div>\n                              }\n                              \n                          </div>                \n                        )}\n                      \n                        \n                      </div>\n                    }\n                </div>\n\n\n\n\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex-column flex-column-66\">\n            <div className=\"annotators-box\">\n              <div className=\"annotators-box-header\">Annotators to invite</div>\n              <div className=\"annotators-box-body\">\n\n                <div className=\"annotators-box-list \">\n\n                  { this.state.data.users.map((user, index) => \n                      <div className=\"annotator\" id={\"annotator-num-\" + index}>\n                        <UserDetails user={user}/>\n                        { index > 0 && \n                        <span className=\"delete-button-container\"><span className=\"delete-button\" \n                              onClick={this.removeUser.bind(this, index)}\n                              onMouseEnter={() => this.deleteHighlightRow(index)} onMouseLeave={this.removeHighlightRow}\n\n\n                              ><i className=\"fa fa-trash\"></i></span></span>\n                        }\n                      </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n        </div>\n      </div>\n    )\n  }\n}\n\nexport default NewProjectAnnotators;","import React from 'react';\nimport {Component} from 'react';\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\n\nclass NewProjectProjectOptions extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data: {\n        hierarchy_permissions: \"\",\n      }\n    }\n  }\n\n\n  componentDidMount() {\n    this.setState({\n      data: this.props.data,\n    })\n  }\n\n  async changeOverlap(e) {\n    var value = e.target.value;\n    await this.setState({\n      data: {...this.state.data, overlap: value}\n    })\n    this.props.updateFormPageData(this.state.data);\n  }\n\n  async setPermissions(e) {\n    var value = e.target.value;\n    await this.setState({\n      data: {...this.state.data, hierarchy_permissions: value}\n    })\n    this.props.updateFormPageData(this.state.data);\n  }\n\n  render() {\n    var help = (<div>\n        <h2>Project Options</h2>\n        <p>Please specify the options of this project.</p>\n        <ul>\n          <li><b>Hierarchy permissions</b>: If allowed, your annotators will be able to add categories as they appear, or delete ones that aren not relevant. This option is useful if you aren't sure whether your category hierarchy covers every possible category in your dataset. </li>\n          <li><b>Overlap</b>: The number of times each document will be annotated. More overlap can result in a more robust set of results, but requires longer annotation time. You can mark your project as \"complete\" at any time.</li>            \n        </ul>\n\n        \n      </div>\n    )\n\n    var overlap = this.state.data.overlap;\n    var num_users = this.state.data.num_users;\n\n    return (\n      <div>\n        <h2>Project Options <NewProjectFormHelpIcon onClick={() => this.props.toggleFormHelp(help)} /></h2>\n\n        <div className=\"form-group\">\n          <label>To what extent should annotators be able to modify the category hierarchy?</label>\n          <select value={this.state.data.hierarchy_permissions} required onChange={(e) => this.setPermissions(e)}>\n            <option disabled hidden value=\"\">Click to select</option>\n            <option value=\"no_modification\">No modifications allowed.</option>\n            <option value=\"create_edit_only\">Annotators can create new categories.</option>\n            <option value=\"full_permission\">Annotators can create, delete and rename categories.</option>\n          </select>\n        </div>\n        <div className=\"form-group\" style={{'margin-top': '40px'}}>\n\n          <label>How many times should a document be annotated before annotation is considered complete?</label>\n          <div className={\"input-range-group\" + (num_users === 1 ? \" disabled\" : \"\")}>\n            { num_users === 1 && \n              <div className=\"disabled-message\">\n                <span className=\"inapplicable\">\n                  This option is inapplicable because you are the only annotator.\n                </span>\n              </div>\n            }\n            <div className=\"inner\">\n              <div className=\"input-range-summary\">\n                <p><span className=\"num\">{overlap}</span> annotation{overlap > 1 ? \"s\" : \"\"}/document<br/></p>\n                <p className=\"small\">Each annotator labels approximately <span className=\"avg\">{(1 / num_users * overlap * 100).toFixed(2)}</span>% of the corpus.</p>\n              </div>\n              <div class=\"input-range-container\">\n                <div class=\"left\">1</div>\n                <input id=\"input-overlap\" name=\"input-overlap\" type=\"range\" min=\"1\" max={num_users} onChange={(e) =>this.changeOverlap(e)} value={overlap} onKeyDown={(e)=> e.keyCode == 13 ? e.preventDefault(): ''}/>\n                <div class=\"right\">{num_users}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default NewProjectProjectOptions;","import React from \"react\";\nimport {Component} from \"react\";\nimport { Redirect, Link, BrowserRouter, Route, Switch, withRouter } from 'react-router-dom'\nimport Modal from 'react-modal';\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\nimport Error404Page from 'views/Errors/Error404Page';\n\nimport NewProjectDetails from 'views/NewProjectView/NewProjectDetails';\nimport NewProjectEntityHierarchy from 'views/NewProjectView/NewProjectEntityHierarchy';\nimport NewProjectAutomaticTagging from 'views/NewProjectView/NewProjectAutomaticTagging';\nimport NewProjectAnnotators from 'views/NewProjectView/NewProjectAnnotators';\nimport NewProjectProjectOptions from 'views/NewProjectView/NewProjectProjectOptions';\n\nimport NewProjectFormHelpIcon from 'views/NewProjectView/NewProjectFormHelpIcon';\n\nimport _fetch from 'functions/_fetch';\n\nimport {json2slash} from 'views/NewProjectView/functions/hierarchy_helpers'\n\nModal.setAppElement('body');\n\n\nfunction generateEmptyTable() {\n  var n = 15;\n  var arr = new Array(n).fill(0);\n  \n\n  function stringOfRandomLength(minlen, maxlen) {\n    var s = '';\n    for(var i = 0; i < minlen + Math.floor(Math.random() * maxlen); i++) {\n      s += 'x';\n    }\n    return s;\n  }\n\n  return (\n    <table className=\"project-page-table\">\n      <tbody>\n       { arr.map((x, i) => \n        <tr> \n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\n        </tr>\n      ) }\n    </tbody>\n  </table>\n  )  \n}\n\n\nclass FormLoadingSkeleton extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    return (\n      <div>\n        <h2><span className=\"st st-darker\">Empty form hello</span></h2>\n        { this.props.page === \"entity_hierarchy\" && \n          <div>\n            <div className=\"form-group no-padding\">\n              <label><span className=\"st st-darker\">Preset</span></label>\n              <select className=\"st\">\n                <option>Hello</option>\n              </select>\n            </div>\n            <div className=\"category-hierarchy-wrapper\">\n              { generateEmptyTable() }\n            </div>\n          </div>\n        }\n      </div>\n\n    )\n  }\n}\n\n\n\n\n\n\nclass NewProjectHeaderItem extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div onClick={this.props.gotoFormPage} className={\"item \" + (this.props.active ? \"active\": \"\") + (this.props.ready ? \"\" : \" disabled\")}>\n        <div className=\"inner\">{this.props.name}\n        {this.props.pageProgress === \"saved\" && <i className=\"fa fa-check\"></i>}\n        {this.props.pageProgress === \"error\" && <i className=\"fa fa-times\"></i>}\n        {this.props.pageProgress === \"requires_attention\" && <i className=\"fa fa-warning\"></i>}\n        </div>\n      </div>\n    )\n  }\n}\n\nfunction getErrorPathsSet(errors) {\n  if(!errors) return new Set();\n  var errorPaths = new Set();\n  for(var e of errors) {\n    errorPaths.add(e.path);\n  }\n  return errorPaths;\n}\n\nconst PROJECT_DETAILS = 0;\nconst ENTITY_HIERARCHY = 1;\nconst AUTOMATIC_TAGGING = 2;\nconst ANNOTATORS = 3;\nconst PROJECT_OPTIONS = 4;\n\nclass NewProjectView extends Component {\n  constructor(props) {\n    super(props);\n    this.ref = React.createRef();\n\n    var sharedProps = (function() {\n      return {\n        loading: this.state.loading,\n        saving: this.state.saving,\n        toggleFormHelp: this.toggleFormHelp.bind(this),\n        errors: this.state.formErrors,\n        errorPaths: getErrorPathsSet(this.state.formErrors),\n        data: this.state.data,\n        markModified: this.markModified.bind(this),\n        updateFormPageData: this.updateFormPageData.bind(this),\n        userIsModifying: this.userIsModifying.bind(this),\n\n\n\n      }\n    }).bind(this);\n\n    this.formPages = [\n        {\n          name: \"Project details & data\",\n          pathname: \"project_details\",\n\n          component: () => <NewProjectDetails\n            //data={this.formPages[PROJECT_DETAILS].data}\n            //uploadFormHasError={this.formPages[PROJECT_DETAILS].uploadFormHasError}\n            { ... sharedProps() } />       \n        },\n        {\n          name: \"Entity hierarchy\",\n          pathname: \"entity_hierarchy\",\n\n          component: () => <NewProjectEntityHierarchy\n            //entity_hierarchy={this.formPages[ENTITY_HIERARCHY].data ? this.formPages[1].data.children : []}  \n            hierarchyPresets={[\"Named Entity Recognition (NER)\", \"Fine-grained Entity Recognition (FIGER)\", \"Maintenance\"]}\n            { ... sharedProps() }/>\n        },\n\n\n        {\n          name: \"Automatic tagging\",\n          pathname: \"automatic_tagging\",\n          component: () => <NewProjectAutomaticTagging\n          \n            { ... sharedProps() }/>\n        },\n        {\n          name: \"Annotators\",\n          pathname: \"annotators\",\n          component: () => <NewProjectAnnotators\n            //data={this.formPages[ANNOTATORS].data}\n            { ... sharedProps() }/>\n        },\n        {\n          name: \"Project options\",\n          pathname: \"project_options\",\n          component: () => <NewProjectProjectOptions\n           { ... sharedProps() }/>\n        },\n    ]\n\n    // Store the dependencies between form pages (in reverse), e.g.\n    // automatic_tagging depends on entity_hierarchy. If entity_hierarchy is changed, automatic_tagging is reset.\n    this.formPageDependencies = {\n      \"entity_hierarchy\": [\"automatic_tagging\", AUTOMATIC_TAGGING],\n      \"project_details\": [\"project_options\", PROJECT_OPTIONS],\n      \"annotators\": [\"project_options\", PROJECT_OPTIONS],\n    }\n\n    this.state = {\n      \n\n      // Pass the data down to the form pages.\n      // data: {\n      //   entity_hierarchy: { children: [], },\n      // },\n\n      data: {},\n\n      // Store JSON objects for each form page:\n      // name: the name of the page\n      // pathname: The url of the page\n      // ready: Whether the user is able to navigate to this page yet\n      // saved: Whether this page has been saved\n      currentFormPageIndex: null,\n\n      formErrors: null,\n      formErrorShake: false, // Set to true when a front-end form error happens\n\n      loading: true,\n      saving: false,\n\n      wasModified: false, // Whether the currently displayed form has been modified\n      isSaved: false, // Whether the currently displayed form has been saved\n\n      formHelpContent: null, // The content currently appearing in the modal. null if modal is not being displayed.\n\n      verifyFormPageChange: false, // Whether or not the confirmation window is showing (do you want to go back?)\n      nextPageAfterVerification: 0, // The next page after verification complete\n\n      verifySubmitNewProjectForm: false, // Whether the user is ready to submit the new project\n      creatingNewProject: false, // Whether the project is currently being created\n      creatingNewProjectErrors: null, // Any errors that appear when trying to create the new project\n      creatingNewProjectSuccess: false,\n      newlyCreatedProjectId: null, // Set when project is created\n\n      userIsModifying: false, // Whether the user is making a modification (to disable the save button). Only used for the hierarchy\n\n      formPageProgress: [\"not_started\", \"not_started\", \"not_started\", \"not_started\", \"not_started\"], // Store the progress of each form page\n\n    }\n\n    // Store the previous states of each form so that the API does not need to be queried when going back and forth between\n    // form pages.\n    // this.prevStates = {\n    //   \"Project details & data\": null,\n    //   \"Entity hierarchy\": null,\n    // };\n    \n\n  }\n\n  componentDidMount() {\n\n    this.queryAPI(true);\n\n    //this.updateCurrentFormPageIndex();\n  }\n\n  markModified() {\n    this.setState({\n      wasModified: true,\n      isSaved: false,\n    });\n  }\n\n  userIsModifying(b) {\n    this.setState({\n      userIsModifying: b,\n    });\n  }\n\n  // Save the state of the given form page.\n  async updateFormPageData(data, options) {\n    //var formPages = this.formPages;\n    //console.log(page, data);\n\n    // await this.setState({\n    //   data: data,\n    // })\n    if(options && options.reset_form) {\n      //console.log('hello')\n      await this.setState({\n        data: {...data, file_metadata: null},\n        wasModified: true,\n        isSaved: false,\n      }, () => {\n        console.log(this.state.data, \"<data\")\n      });\n      return;\n    }\n\n    this.setState({\n      data: data,\n      //formPages: formPages,\n      wasModified: true,\n      isSaved: false,\n    }, () => {\n      console.log(this.state.data);\n    });\n  }\n\n\n  async queryAPI(firstLoad) {\n    await this.setState({\n      loading: true,\n      data: {},\n    })\n    if(firstLoad) {\n      formPage = '';\n    } else {\n      var formPage = '?formPage=' +this.getFormPagePathname();      \n    }\n    \n    var d = await _fetch('projects/new/get' + formPage, 'GET', this.props.setErrorCode, false, false, firstLoad ? 0 : 555);\n\n\n\n    var formPageProgress = this.state.formPageProgress;\n\n    if(firstLoad) {\n      var latestFormPage = d.latest_form_page;\n      for(var i = 0; i < this.formPages.length; i++) {\n        \n        if(this.formPages[i].pathname === latestFormPage) {\n          var latestFormPageIndex = i;\n          break;\n        }\n      }\n    } else {\n      var latestFormPageIndex = this.state.currentFormPageIndex;\n    }\n\n\n    formPageProgress = d.form_page_progress;\n\n    console.log(d, \"RES\")\n    \n    //console.log(d, d.is_saved, \"<<<\");\n    \n    this.setState({\n      data: d.data,\n      isSaved: d.is_saved,\n      currentFormPageIndex: latestFormPageIndex,\n      wasModified: false,\n      //isSaved: true,\n      loading: false,\n      formPageProgress: formPageProgress,\n    });\n  }\n\n  // Update the form page index when this component's location is updated (i.e. a route change).\n  componentDidUpdate(prevProps) {    \n    if(this.props.location !== prevProps.location) {\n      this.updateCurrentFormPageIndex();\n    }\n  }\n\n  // Display the form help content (which pops the modal up).\n  toggleFormHelp(formHelpContent) {\n    this.setState({\n      formHelpContent: formHelpContent,\n    })\n  }\n\n  getFormPagePathname() {\n    return this.formPages[this.state.currentFormPageIndex].pathname;\n  }\n\n  async submitFormPage(e) {\n    e.preventDefault();\n\n    console.log(\"Submitting\")\n\n    await this.setState({\n      saving: true,\n    })\n    // do something\n    var formPath = this.getFormPagePathname();\n    var data = this.state.data;\n\n    var post_url = 'projects/new/submit?formPage='\n\n    console.log(\"THIS STATE DATA IS \", data);\n\n    // Project details is a bit different - we need to upload the details first and then upload the dataset afterwards\n    // This is because formidable (in the backend) seems to require the file to be the entire post body, so it has to be \n    // done separately from other data.\n    if(this.state.currentFormPageIndex === PROJECT_DETAILS) {\n\n      // Upload name/desc first\n      var response = await _fetch(post_url + 'project_details', 'POST', this.props.setErrorCode, data);\n\n\n      // Don't save the dataset again if it has not changed\n      if(!response.errors && !this.state.data.file_metadata) {\n\n        console.log(data.dataset,'xxxx')\n        // Then upload the dataset\n        var formData = new FormData();\n        formData.append('file', data.dataset);\n\n        var response = await _fetch(post_url + 'dataset', 'POST', this.props.setErrorCode, formData, true);\n      }\n\n    } else if(this.state.currentFormPageIndex === ENTITY_HIERARCHY) {\n\n      // Convert the JSON tree into 'slash' notation before sending to the back end.\n      data = { entity_hierarchy: json2slash({children: data.entity_hierarchy}), hierarchy_preset: data.hierarchy_preset };      \n      var response = await _fetch(post_url + 'entity_hierarchy', 'POST', this.props.setErrorCode, data);\n\n    } else if(this.state.currentFormPageIndex === AUTOMATIC_TAGGING) {\n      // Then upload the dataset\n\n      if(data.use_automatic_tagging === \"yes\") {\n        var formData = new FormData();\n        formData.append('file', data.dataset);\n\n        var response = await _fetch(post_url + 'automatic_tagging', 'POST', this.props.setErrorCode, formData, true);\n\n      // If there was no dataset (i.e. \"no\" was selected), clear the automatic tagging\n      } else {\n        var response = await _fetch(post_url + 'automatic_tagging', 'POST', this.props.setErrorCode, { clear_automatic_tagging: true });\n      }\n      \n\n    } else if(this.state.currentFormPageIndex === ANNOTATORS) {\n      var response = await _fetch(post_url + 'annotators', 'POST', this.props.setErrorCode, data);\n    } else if(this.state.currentFormPageIndex === PROJECT_OPTIONS) {\n      var response = await _fetch(post_url + 'project_options', 'POST', this.props.setErrorCode, data);\n    }\n\n\n\n\n    console.log(\"Response: \", response);\n\n    if(response.errors) {\n      this.renderWithErrors(response);\n    } else {\n      var updated_data = this.state.data;\n      if(response.file_metadata) {\n        updated_data.file_metadata = response.file_metadata;\n      }\n      return this.setState({\n        data: updated_data,\n        formErrors: null,\n        isSaved: true,\n        saving: false,\n        formPageProgress: response.form_page_progress,\n      });\n        \n    }\n    return null;\n\n  }\n\n  renderWithErrors(response) {\n    console.log(\"Response\", response)\n    var errors = response.errors;\n    var formPageProgress = response.form_page_progress;\n\n    //var formPageProgress = this.state.formPageProgress;\n    //formPageProgress[this.state.currentFormPageIndex] = \"error\";\n    console.log(formPageProgress, \"XX\")\n    this.setState({\n      formErrors: errors,\n      isModified: false,\n      isSaved: false,\n      saving: false,\n      formPageProgress: formPageProgress,\n    }, () => {\n      window.scrollTo({\n        top: 0,\n        left: 0,\n        behavior: 'smooth'\n      });\n    });\n  }\n\n\n  // Set wasModified to true, signifying that the current form page has been modified.\n  // setModified() {\n  //   this.setState({\n  //     wasModified: true,\n  //     isSaved: false,\n  //   })\n  // }\n\n  // Go to the previous form page.\n  async gotoPrevFormPage() {\n    if(this.state.currentFormPageIndex === 0) return;\n\n    // Reset form data\n    //var d = await _fetch('projects/new/clear?formPage=' + this.getFormPagePathname(), 'GET', this.props.setErrorCode, false, false, 333);\n    //console.log(d);\n\n    var prevIndex = this.state.currentFormPageIndex - 1;\n\n    this.gotoFormPage(prevIndex);\n    //this.props.history.push(this.formPages[prevIndex]);\n    // await this.setState({\n    //   verifyFormPageChange: false,\n    //   currentFormPageIndex: prevIndex,      \n    //   loading: true,\n    //   isSaved: false,\n    //   formErrors: null,\n    // });\n    // this.queryAPI();\n\n    // window.scrollTo({\n    //   top: 0,\n    //   left: 0,\n    // });\n  \n  }\n\n  // Go to the next form page.\n  async gotoNextFormPage() {\n\n\n\n    if(this.state.currentFormPageIndex === (this.formPages.length - 1)) return;\n    var nextIndex = this.state.currentFormPageIndex + 1;\n\n    this.gotoFormPage(nextIndex);\n\n    // await this.setState({\n    //   currentFormPageIndex: nextIndex,\n    //   loading: true,\n    //   isSaved: false,\n    // });\n    // this.queryAPI();\n\n    // window.scrollTo({\n    //   top: 0,\n    //   left: 0,\n    // });\n  }\n\n  // Close the modal, setting formHelpContent to null.\n  handleCloseModal() {\n    if(this.state.creatingNewProject) return;\n    this.setState({\n      formHelpContent: null,\n    })\n  }\n\n  // Get the previous state of the requested page.\n  // If this page was not saved, return null instead.\n  // getPrevState(pageName) {\n  //   var formIndex = -1;\n  //   for(var i in this.formPages) {\n  //     if(this.formPages[i].name === pageName) {\n  //       formIndex = i;\n  //       break;\n  //     }\n  //   }\n  //   return this.formPages[i].saved ? this.prevStates[pageName] : null;\n  // }\n\n  // Jump to the form page at the specified index (e.g. 0 = project details)\n  async gotoFormPage(formPageIndex) {\n\n\n    \n    await this.setState({\n      currentFormPageIndex: formPageIndex,\n      loading: true,\n      isSaved: false,\n      formErrors: null,\n      verifyFormPageChange: false,\n    });\n    this.queryAPI();\n    window.scrollTo({\n      top: 0,\n      left: 0,\n    });\n  \n\n    // this.setState({\n    //   verifyFormPageChange: true,\n    // });\n  }\n\n  // Verify that the user wants to go back to the previous page.\n  verifyFormPageChange(nextIndex) {\n\n    var wasModified = this.state.wasModified;\n    var isSaved = this.state.isSaved;\n    if(!wasModified || isSaved) {\n      this.gotoFormPage(nextIndex);\n      return;\n    }\n    this.setState({\n      verifyFormPageChange: true,     \n      nextPageAfterVerification: nextIndex, \n    });\n  }\n\n  verifySubmitNewProjectForm() {\n    this.setState({\n      creatingNewProjectErrors: null,\n      verifySubmitNewProjectForm: true,\n    });\n  }\n\n  async submitNewProjectForm() {\n    console.log(\"SUBMITTING\");\n\n    await this.setState({\n      creatingNewProject: true,\n\n    })\n\n    var response = await _fetch('projects/new/submitFinal', 'POST', this.props.setErrorCode, {}, false, 1000);\n    if(response.errors) {\n\n      console.log(response);\n      this.setState({\n        creatingNewProjectErrors: response.errors,\n        //creatingNewProject: false,\n        //verifySubmitNewProjectForm: false,\n      })\n      return;\n    }\n\n\n\n    this.setState({\n      newlyCreatedProjectId: response.project_id,\n      creatingNewProjectSuccess: true,\n      creatingNewProjectErrors: null,\n      creatingNewProject: false,\n      verifySubmitNewProjectForm: false,\n    })\n  }\n\n  // Shake the form when the save button is pressed. This applies the 'shake' class to the form, which will\n  // shake any inputs marked as invalid in the front end. (i.e. inputs that are required but empty will shake).\n  async shakeForm() {\n    if(this.state.isSaved) return;\n    await this.setState({\n      formErrorShake: true,\n    })\n    window.setTimeout( () => this.setState({formErrorShake: false}), 500);\n  }\n\n  renderFormPage(index) {\n    if(this.formPages[index] === undefined) return <FormLoadingSkeleton/>\n    return this.formPages[index].component();\n  }\n\n  checkFormIsComplete() {\n    console.log(this.state.formPageProgress);\n    for(var fp of this.state.formPageProgress) {\n      if(fp !== \"saved\") {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  render() {\n    //console.log(this.state.data);\n\n    var formIsComplete = this.checkFormIsComplete();\n    var lastPage = this.state.currentFormPageIndex === (this.formPages.length - 1);\n\n    if(this.state.currentFormPageIndex) var formPath = this.getFormPagePathname();\n\n    if(this.state.creatingNewProjectSuccess) {\n      return <Redirect to={\"/projects/\" + this.state.newlyCreatedProjectId + \"/dashboard\"}/>\n    }\n\n    return (\n      <form id=\"new-project-form\" className={(this.state.formErrors ? \"errors\" : \"\") + (this.state.formErrorShake ? \"shake\" : \"\") + (this.state.saving ? \" saving\" : \"\") + (this.state.loading ? \" loading\" : \"\")} ref={this.ref} onSubmit={this.state.isSaved ? null : (e) => this.submitFormPage(e)}  >\n\n        <Modal \n           isOpen={this.state.formHelpContent || this.state.verifyFormPageChange || this.state.verifySubmitNewProjectForm ? true : false}\n           contentLabel=\"Hello there\"\n           onRequestClose={this.handleCloseModal.bind(this)}\n           className={\"modal\" + (this.state.verifyFormPageChange || this.state.verifySubmitNewProjectForm ? \" verify-back\" : \"\")}\n           overlayClassName=\"modal-overlay\"\n           app={this.ref}\n\n        >\n          {\n            this.state.verifyFormPageChange\n            ? <div>\n                <p>You have unsaved changes. {\n                  this.state.nextPageAfterVerification === (this.state.currentFormPage - 1)\n                  ? \"Are you sure you want to go back to the previous page?\"\n                  : \"Are you sure you want to jump to this page?\" }\n                  </p>\n                <div className=\"verify-back-row\">\n                  <button className=\"annotate-button grey-button\" onClick={() => this.setState({ verifyFormPageChange: false })}>No</button>\n                  <button className=\"annotate-button\" onClick={() => this.gotoFormPage(this.state.nextPageAfterVerification)}>Yes</button>\n                </div>\n              </div>\n            : (this.state.verifySubmitNewProjectForm\n              ? ( this.state.creatingNewProject\n                ? \n                  <div>\n                    { !this.state.creatingNewProjectErrors && <div className=\"creating-new-project\"><i className=\"fa fa-cog fa-spin\"></i>Creating new project...</div>}\n                    \n                    { this.state.creatingNewProjectErrors && \n                      <div>\n                        <div className=\"form-notice form-errors\">\n                          <i className=\"fa fa-times\"></i>An unexpected error occured:\n                          <ul>\n                            {this.state.creatingNewProjectErrors.map((err, index) =>\n                              <li>{err.message || JSON.stringify(err)}</li>\n                            )}\n                          </ul>                          \n                        </div>                      \n                        <button className=\"annotate-button grey-button\" onClick={() => this.setState({ creatingNewProjectErrors: null, creatingNewProject: false, verifySubmitNewProjectForm: false })}><i className=\"fa fa-chevron-left\"></i>Back</button>\n                      </div>\n                    }\n                  </div>\n                : <div>\n                    <p>Are you ready to create the project?</p>\n                    <div className=\"verify-back-row\">\n                      <button className=\"annotate-button grey-button\" onClick={() => this.setState({ verifySubmitNewProjectForm: false })}>No</button>\n                      <button className=\"annotate-button gold-stripey-button\" onClick={() => this.submitNewProjectForm()}>Create Project</button>\n                    </div> \n                  </div>\n                )\n              : this.state.formHelpContent\n              )\n          }\n        </Modal>\n\n\n        <header className=\"bg-header\">\n          <div id=\"header-project-details\" className=\"title\">\n            <h1>New project</h1>\n          </div>\n        </header>\n        \n        <header className=\"new-project-header\">\n          <div className=\"container flex-container\">\n            { this.formPages.map((page, index) => \n              <NewProjectHeaderItem name={page.name}\n                gotoFormPage={this.verifyFormPageChange.bind(this, index)}\n                pathname={page.pathname}\n                key={index}\n                pageProgress={this.state.formPageProgress[index]}\n                active={index === this.state.currentFormPageIndex}\n                ready={this.state.formPageProgress[index] !== \"not_started\"}/>\n            )}            \n          </div>\n        </header>\n        <main className=\"container new-project\">\n\n            <div className=\"new-project-form-body\">\n            <TransitionGroup className=\"transition-group\">\n              <CSSTransition\n              key={this.state.currentFormPageIndex}\n              timeout={{ enter: 400, exit:400 }}\n              classNames=\"fade\"\n              >\n                \n                <section className={\"route-section\"}>\n\n                    <div className={\"form-notice form-loading \" + (this.state.loading ? \"\" : \"hidden\")}><i className=\"fa fa-cog fa-spin\"></i>Loading...</div>\n\n                    <div className={\"form-notice form-success \" + (this.state.isSaved ? \"\" : \"hidden\")}><i className=\"fa fa-check\"></i>This page is saved.\n                      \n\n                    </div>\n\n                    <div className={\"form-notice form-warning \" + (!this.state.loading && this.state.formPageProgress[this.state.currentFormPageIndex] === \"requires_attention\" ? \"\" : \"hidden\")}><i className=\"fa fa-warning\"></i>This form was reset by a previous form. Please fill it in again to continue.</div>\n\n                    <div className={\"form-notice small-margin-top form-warning \" + (this.state.isSaved && this.formPageDependencies[formPath] && this.state.formPageProgress[this.formPageDependencies[formPath][1]] === \"saved\" ? \"\" : \"hidden\")}><i className=\"fa fa-warning\"></i>Modifying the form below will reset the {formPath && this.formPageDependencies[formPath] && this.formPageDependencies[formPath][0] && this.formPageDependencies[formPath][0].replace(\"_\", \" \")} form.</div>\n\n                    <div className={\"form-notice form-errors \" + (this.state.formErrors ? \"\" : \"hidden\")}>\n                      <i className=\"fa fa-times\"></i>Please fix the following errors before saving:\n                      <ul>\n                      { this.state.formErrors && this.state.formErrors.map((err, index) => \n                        <li key={index}>{err.message}</li>\n                      )}\n                      { !this.state.formErrors && <li></li>}\n                      </ul>\n                    </div>\n                    \n                    { !this.state.loading && this.renderFormPage(this.state.currentFormPageIndex) }\n                    { this.state.loading && <FormLoadingSkeleton page={formPath}/> }\n                   \n                </section>\n              </CSSTransition>\n            </TransitionGroup>\n\n            </div>      \n             \n        </main> \n        <div className={\"new-project-submit-row\" + (this.state.userIsModifying ? \" disabled\" : \"\")}>\n          <div className=\"container\">\n            <button type=\"button\" onClick={() => this.verifyFormPageChange((this.state.currentFormPageIndex - 1))} className={\"annotate-button new-project-button grey-button\" + (this.state.currentFormPageIndex === 0 ? \" disabled\" : \"\")}><i className=\"fa fa-chevron-left\"></i>Back</button>\n            \n\n           \n\n\n           \n            <div className=\"buttons-right\">\n\n              <button type={this.state.isSaved ? \"button\": \"submit\"} \n                      className={\"annotate-button new-project-button \" +\n                      (!this.state.wasModified && !this.state.isSaved ? \"disabled\": \"\") +\n                      (this.state.isSaved ? \" saved\": \"\") + \n                      (this.state.saving ? \" saving\" : \"\")\n                      }\n                      onClick={() => this.shakeForm()}>\n                        <i className={\"fa fa-\" + (this.state.isSaved ? \"check\": (this.state.saving ? \"cog fa-spin\" : \"save\"))}></i>\n                        {this.state.saving ? \"Saving\" : \"Save\" + (this.state.isSaved ? 'd' : '')}\n              </button>\n\n              {lastPage \n                ? <button type=\"button\" onClick={() => this.verifySubmitNewProjectForm()}  className={\"annotate-button new-project-button gold-stripey-button \" + ((this.state.isSaved && formIsComplete) ? \"\" : \"disabled\")}>Create Project</button>\n                :\n                 <button type=\"button\" onClick={() => this.verifyFormPageChange(this.state.currentFormPageIndex + 1)}  className={\"annotate-button new-project-button \" + (this.state.isSaved ? \"\" : \"disabled\")}>Next<i className=\"fa fa-chevron-right after\"></i></button>\n\n              }\n              </div> \n          </div>\n        </div>\n       \n      </form>\n    )\n  }\n}\n//  { lastPage && <button onClick={() => this.submitFormPage()} className=\"annotate-button new-project-button\">Create project</button> }\nexport default NewProjectView;\n\n/*\n<Route path=\"/projects/new/entity-hierarchy\" render={() =>\n                    <NewProjectEntityHierarchy loading={this.state.loading}\n\n                      entity_hierarchy={this.formPages[ENTITY_HIERARCHY].data ? this.formPages[1].data.children : []}  \n\n                      hierarchyPresets={[\"Named Entity Recognition (NER)\", \"Fine-grained Entity Recognition (FIGER)\", \"Maintenance\"]}\n                      toggleFormHelp={this.toggleFormHelp.bind(this)} \n\n                      setModified={this.setModified.bind(this)}\n\n                      //prevState={ this.getPrevState('Entity hierarchy')}\n                      updateFormPageData={this.updateFormPageData.bind(this, \"Entity hierarchy\")}\n\n                      />} /> \n                  <Route path=\"/projects/new/automatic-tagging\" render={() =>\n                    <NewProjectAutomaticTagging loading={this.state.loading}\n                      setModified={this.setModified.bind(this)}\n                      data={this.formPages[AUTOMATIC_TAGGING].data}\n                      toggleFormHelp={this.toggleFormHelp.bind(this)} />} /> \n                  <Route path=\"/projects/new/annotators\" render={() =>\n                    <NewProjectAnnotators loading={this.state.loading}\n                      setModified={this.setModified.bind(this)}\n                      data={this.formPages[ANNOTATORS].data}\n                      toggleFormHelp={this.toggleFormHelp.bind(this)} />} />\n                  <Route path=\"/projects/new/project-options\" render={() =>\n                    <NewProjectProjectOptions loading={this.state.loading}\n                      setModified={this.setModified.bind(this)}\n                      data={this.formPages[PROJECT_OPTIONS].data}\n                      toggleFormHelp={this.toggleFormHelp.bind(this)} />} />\n                  <Route exact path=\"/projects/new\" render={() =>\n                    <NewProjectDetails loading={this.state.loading}\n                      data={this.formPages[PROJECT_DETAILS].data}\n                      toggleFormHelp={this.toggleFormHelp.bind(this)} \n                      //prevState={ this.getPrevState('Project details & data')}\n                      updateFormPageData={this.updateFormPageData.bind(this, \"Project details & data\")}\n                      setModified={this.setModified.bind(this)}\n\n\n                      />} /> \n                  <Route render={() => <Error404Page />} />    */","import React from \"react\";\nimport {Component} from \"react\";\nimport { TwitterPicker } from 'react-color';\n\nimport { Link } from \"react-router-dom\";\nimport getCookie from 'functions/getCookie'\nimport _ from 'underscore';\n\n// A list of icon options from FontAwesome that the user can choose from\nconst iconOptions = [\n  \"user\", \"anchor\", \"automobile\", \"asterisk\", \"bath\", \"battery\", \"binoculars\", \"bicycle\", \"bomb\", \"bullhorn\", \"child\", \"cubes\", \"female\", \"diamond\", \"cogs\", \"coffee\", \"fax\", \"flag\", \"fire-extinguisher\", \"flash\", \"fire\", \"male\", \"heart\", \"gift\", \"globe\", \"legal\", \"leaf\", \"microphone\", \"paw\", \"rocket\", \"magnet\", \"star\", \"space-shuttle\", \"trophy\", \"umbrella\"\n]\n\nconst colourOptions = \n[\"#f44336\", \"#e91e63\", \"#9c27b0\", \"#673ab7\", \"#3f51b5\", \"#2196f3\", \"#03a9f4\", \"#00bcd4\", \"#009688\", \"#4caf50\", \"#8bc34a\", \"#cddc39\", \"#ffeb3b\", \"#ffc107\", \"#ff9800\", \"#ff5722\", \"#795548\", \"#eee\", \"#ccc\", \"#aaa\", \"#888\", \"#444\", \"#222\"]\n\n\nclass UserProfileView extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: {                   // The user is stored in both this.state and this.props (from App.js).\n        profile_icon: {         // Unsaved changes will be stored in this.state.\n          foreground: \"#aaa\",   // Changes that are saved are pushed up to App.js in the saveChanges function.\n          background: \"#eee\",\n          icon: 'user',\n        },\n        \n      }\n    }\n  }\n\n  // When this component is updated via App.js, check whether the user profile has been updated.\n  // If it has, set this user to props.user.\n  componentDidUpdate(prevProps, prevState) {\n    if(!_.isEqual(prevProps.user, this.props.user) && !_.isEqual(this.props.user, this.state.user)) {\n      console.log('sidsp')\n      this.setState({\n        user: this.props.user,\n      });\n    }\n  }\n\n  componentWillMount() {\n    if(this.props.user) {\n      this.setState({\n        user: this.props.user,\n      });\n    }\n  }\n\n  // Submit the changes (which are saved in the state) to the API.\n  saveChanges() {\n    var t = this;\n    console.log('saving')\n    const csrfToken = getCookie('csrf-token');\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify(this.state.user.profile_icon),  \n    };\n\n    this.setState({\n      saving: true, \n    }, () => {\n      fetch('http://localhost:3000/api/users/set_profile_icon', fetchConfigPOST) // TODO: move localhost out\n      .then((response) => {\n        if(response.status !== 200) {\n          throw new Error(response.status);\n        }  \n        return response.text()\n      })\n      .then((data) => {\n\n        var d = JSON.parse(data);       \n        t.props.setUserProfileIcon(d.profile_icon);\n\n        this.setState({\n          saving: false,\n        });\n      }).catch((err) => {\n        this.props.setErrorCode(parseInt(err.message));\n      });\n    });\n  }\n\n  // Set the foreground colour\n  handleForegroundColourChange(colour) {\n    var user = this.state.user;\n    user.profile_icon.foreground = colour.hex;\n    this.setState({\n      user: user,\n    })\n  }\n\n  // Set the background colour\n  handleBackgroundColourChange(colour) {\n    console.log('hello')\n    var user = this.state.user;\n    user.profile_icon.background = colour.hex;\n    this.setState({\n      user: user,\n    })\n  }\n\n  // Set the icon\n  setIcon(icon) {\n    if(iconOptions.indexOf(icon) === -1) return;\n    var user = this.state.user;\n    user.profile_icon.icon = icon;\n    this.setState({\n      user: user,\n    }, () => { console.log(this.state.user.profile_icon.icon)})\n  }\n\n  render() {\n    return (\n      <div id=\"user-profile-page\">\n\n\n        \n        <section className=\"form-section\">\n\n          <h3>Profile icon</h3>\n\n          <div className=\"flex-columns align-center\">\n\n            <div className=\"flex-column\">\n              <div className=\"profile-icon-preview\">\n                <div className=\"circle-icon profile-icon extra-large box-shadow\" style={{'background': this.state.user.profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.state.user.profile_icon.icon} style={{'color': this.state.user.profile_icon.foreground}}></i></div>\n              </div>\n            </div>\n\n            <div className=\"flex-column vertical-align-top\">\n              <h4>Foreground colour</h4>\n              <TwitterPicker\n                colors={colourOptions}\n                color={ this.state.user.profile_icon.foreground }\n                onChangeComplete={ this.handleForegroundColourChange.bind(this) }\n              />\n            \n              <h4>Background colour</h4>\n              <TwitterPicker\n                colors={colourOptions}\n                color={ this.state.user.profile_icon.background }\n                onChangeComplete={ this.handleBackgroundColourChange.bind(this) }\n              />\n            </div>\n          \n            <div className=\"flex-column vertical-align-top\">\n              <h4>Icon</h4>\n              <div className=\"icon-options\">\n                { iconOptions.map((icon, index) => <div onClick={() => this.setIcon(icon)} className={\"icon-option\" + (icon === this.state.user.profile_icon.icon ? \" active\" : \"\")}><i class={\"fa fa-\" + icon}></i></div>)}\n              </div>\n\n            </div>\n          </div>\n          <div className=\"form-save-row\">\n            <a className=\"annotate-button submit-button\" onClick={this.saveChanges.bind(this)} ><i class=\"fa fa-save\"></i>Save</a>\n          </div>\n      </section>\n    </div>\n\n    )\n  }\n}\n\n\nexport default UserProfileView","import React from \"react\";\nimport {Component} from \"react\";\n\nclass Error500Page extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <main class=\"error-page\">\n        <h1>500: Internal server error.</h1>\n        <p>An unexpected error has occurred.</p>\n      </main>\n    )\n  }\n}\n\nexport default Error500Page","import React from \"react\";\nimport {Component} from \"react\";\nimport { withRouter } from 'react-router-dom'\n\n// A class whose sole purpose is to clear any errors on the App component\n// whenever the user navigates to a different page.\n// Without this, the error message will never go away.\n// This component has to go inside the router (which is why this isn't part of the App component).\nclass ErrorClearer extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.location.pathname !== prevProps.location.pathname) {\n      console.log('clearing');\n      this.props.clearErrorCode();\n    }\n  }\n\n  render() {\n    return (<div></div>)\n  }\n}\n\nexport default withRouter(ErrorClearer)","import React from 'react';\n\nimport './stylesheets/stylesheet.scss';\nimport {Component} from 'react';\n\nimport { Redirect, Link, BrowserRouter, Route, Switch } from 'react-router-dom'\nimport BASE_URL from 'globals/base_url';\n\nimport getCookie from './functions/getCookie';\n\nimport ScrollToTop from './functions/ScrollToTop';\n\n// Components\nimport Navbar from './views/SharedComponents/Navbar';\n\n// Views\nimport TaggingInterfaceView from './views/TaggingInterfaceView';\nimport FeaturesPage from './views/FeaturesPage';\nimport ProjectListView from './views/ProjectListView';\nimport ProjectView from './views/ProjectView';\nimport HomeView from './views/HomeView';\nimport NewProjectView from './views/NewProjectView';\nimport UserProfileView from './views/UserProfileView';\n\n// Error views\nimport Error401Redirect from './views/Errors/Error401Redirect';\nimport Error404Page from './views/Errors/Error404Page';\nimport Error403Page from './views/Errors/Error403Page';\nimport Error500Page from './views/Errors/Error500Page';\n\nimport ErrorClearer from './views/SharedComponents/ErrorClearer';\n\n\nimport redcoatMan from './images/redcoat-1-grey.png'\n\nimport _fetch from './functions/_fetch'\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  },\n  credentials: 'include',\n};\n\n\n\n\n\n\n// A template component that renders the majority of the pages.\nclass MainTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>\n        \n        <header className=\"bg-header\">\n            <div id=\"header-project-details\" className=\"title\">\n              <h1>{this.props.pageTitle}</h1>\n            </div>\n          </header>\n        <main className=\"container\">\n          { this.props.pageComponent }\n        </main>\n      </div>\n    )\n  }\n}\n\n// A template component that renders the majority of the pages.\nclass ProjectListTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>\n        \n        <header className=\"bg-header\">\n            <div id=\"header-project-details\" className=\"title\">\n              <h1>{this.props.pageTitle}</h1>\n              <div class=\"right\"><Link className=\"button\" to={BASE_URL + \"projects/new\"}><i class=\"fa fa-plus-circle\"></i>New project</Link></div>\n            </div>\n          </header>\n        <main className=\"container\">\n          { this.props.pageComponent }\n        </main>\n      </div>\n    )\n  }\n}\n\n\n// A template component for the tagging interface, which is almost the same as MainTemplate but without the <main> container.\nclass TaggingInterfaceTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>        \n        { this.props.pageComponent }\n      </div>\n    )\n  }\n}\n\n\nclass LoadingScreen extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className={\"loading-screen\" + (this.props.fadingOut ? \" fading-out\" : \"\") }>\n        <div className=\"background background-under\"></div>\n        <div className=\"background background-over\"></div>\n        <span><i className=\"fa fa-cog fa-spin\"></i>Loading...</span>\n\n      </div>\n    )\n  }\n}\n\n// A template component for the project dashboard.\nclass ProjectViewTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>\n        { this.props.pageComponent }\n      </div>\n    )\n  }\n}\n\nclass Footer extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <footer>\n        <div className=\"footer-logo\"></div>\n        <h2>Redcoat</h2>\n        <p>Built by the NLP-TLP team at UWA.</p>\n\n      </footer>\n\n    )\n  }\n}\n\nclass Logout extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  componentWillMount() {\n    this.props.logout()    \n  }\n\n  render() {\n    return (<Redirect to=\"/\"/>)\n  }\n}\n\n// The app, which routes everything and renders the pages.\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      pageTitle: \"Redcoat\",\n      username: null,\n\n      // Store the current project title and author so that they don't awkwardly reload between component changes\n      projectTitle: null,\n      projectAuthor: null,\n\n      setProject: this.setProject.bind(this),\n\n      loading: true,\n      loadingFadeOut: false,\n\n      loggingOut: false,\n\n      user: null, // stores 'username' and 'profile icon'\n\n      errorCode: null, // 401, 403, 404 etc\n    }\n  }\n\n  clearErrorCode() {\n    this.setState({\n      errorCode: null,\n    })\n  }\n\n  setErrorCode(errorCode) {\n    this.setState({\n      errorCode: errorCode,\n      user: errorCode === 401 ? null : this.state.user, // Delete user info if 401, which means user is not logged in\n    }, () => {\n      console.log(this.state.user, this.state.errorCode);\n    })\n  }\n\n  // Update the project title and author\n  setProject(title, author) {\n    this.setState({\n      projectTitle: title,\n      projectAuthor: author,\n    })\n  }\n\n  async getUserData() {\n\n    var d = await _fetch('users/userData', 'GET', this.setErrorCode.bind(this), 555)\n\n    await this.setState({\n      user: d.user,\n      loading: false,\n      loadingFadeOut: true,\n    });\n\n    window.setTimeout(() => this.setState({loadingFadeOut: false}), 500);\n  }\n\n  // set the data for the currently logged-in user\n  // Called by the homepage (after logging in)\n  setUserData(user) {\n    this.setState({\n      user: user,\n    })\n  }\n\n  // Log out.\n  async logout() {\n    if(!this.state.user) return;\n    await this.setState({\n      user: null,\n      //loggingOut: true,\n    });\n    \n    var d = await _fetch('users/logout', 'GET', this.setErrorCode.bind(this));\n\n    this.setState({\n      user: null,\n    });\n  }\n\n  // Update this component's user profile icon.\n  setUserProfileIcon(profileIcon) {\n    var user = this.state.user;\n    user.profile_icon = profileIcon;\n    console.log(profileIcon);\n    this.setState({\n      user: user,\n    })\n\n  }\n\n  async acceptInvitation(index) {\n    console.log('accept')\n    var invitations = this.state.user.project_invitations;\n\n    invitations[index].pending = true;\n    await this.setState({\n      invitations: invitations,\n    });\n    \n    var invitation_id = invitations[index]._id;\n    var d = await _fetch('projects/invitations/' + invitation_id + '/accept', 'POST', this.setErrorCode, {}, null, 555);\n\n    invitations[index].accepted = true;\n    invitations[index].pending = false;\n    this.setState({\n      invitations: invitations,\n    });\n  }\n\n  async declineInvitation(index) {\n    console.log('decline')\n    var invitations = this.state.user.project_invitations;\n\n    invitations[index].pending = true;\n    await this.setState({\n      invitations: invitations,\n    });\n    \n    var invitation_id = invitations[index]._id;\n    var d = await _fetch('http://localhost:3000/api/projects/invitations/' + invitation_id + '/decline', 'POST', this.setErrorCode, {}, null, 555);\n\n    invitations[index].declined = true;\n    invitations[index].pending = false;\n    this.setState({\n      invitations: invitations,\n    });\n  }\n\n  // When mounted, determine the logged in user.\n  componentWillMount() {\n    this.getUserData();      \n  }\n\n  render() {\n\n    return (    \n\n      <div id=\"app\" className={(this.state.loading ? \"loading\" : \"\") + (this.state.loggingOut ? \" logging-out\" : \"\")}>\n        \n\n        <BrowserRouter>\n\n          <ScrollToTop/>\n          \n\n          <ErrorClearer clearErrorCode={this.clearErrorCode.bind(this)}/>\n\n          { (this.state.loading || this.state.loadingFadeOut) && <LoadingScreen fadingOut={this.state.loadingFadeOut}/>}\n\n          {!this.state.loading && \n\n            <div className=\"fade-in\">\n              <Navbar user={this.state.user} loading={this.state.loading} acceptInvitation={this.acceptInvitation.bind(this)} declineInvitation={this.declineInvitation.bind(this)} />  \n\n              {!this.state.errorCode && <Switch>\n              <PrivateRoute user={this.state.user} path=\"/projects/:id/tagging\" render={(p) => \n                <TaggingInterfaceTemplate {...this.state} pageComponent={\n                  <TaggingInterfaceView \n                    projectTitle={this.state.projectTitle}\n                    projectAuthor={this.state.projectAuthor}\n                    setProject={this.setProject.bind(this)}\n                    project_id={p.match.params.id}\n                    user={this.state.user}\n\n                    setErrorCode={this.setErrorCode.bind(this)}\n\n                    />}\n\n                    \n                  />}\n                /> \n\n              <PrivateRoute user={this.state.user} path=\"/projects/new\" render={( ) =>\n                <NewProjectView setErrorCode={this.setErrorCode.bind(this)} /> }\n              />  \n\n\n              <PrivateRoute user={this.state.user} path=\"/projects/:id\" render={(p) => \n                <ProjectViewTemplate {...this.state} pageTitle=\"Project View\" pageComponent={ \n                  <ProjectView\n                    project_id={p.match.params.id}\n                    setProject={this.setProject.bind(this)}\n                    projectTitle={this.state.projectTitle}\n                    projectAuthor={this.state.projectAuthor}\n                    user={this.state.user} \n\n                    setErrorCode={this.setErrorCode.bind(this)}\n\n                    /> }\n\n                    \n                  />}\n                />     \n\n\n              <PrivateRoute user={this.state.user} path=\"/projects\" render={ () =>\n                <ProjectListTemplate {...this.state} pageTitle=\"Projects\"\n         pageComponent={\n                  <ProjectListView setProject={this.setProject.bind(this)} setErrorCode={this.setErrorCode.bind(this)}/> } />} />    \n              \n\n              \n\n              <PrivateRoute user={this.state.user} path=\"/profile\"  render={( ) => \n                <MainTemplate {...this.state} pageTitle=\"User Profile\" pageComponent={ \n                  <UserProfileView user={this.state.user} setUserProfileIcon={this.setUserProfileIcon.bind(this)} setErrorCode={this.setErrorCode.bind(this)}/> } />} />     \n\n\n\n              <Route path=\"/features\" component={ () =>\n                <MainTemplate {...this.state} pageTitle=\"Features\" pageComponent={ \n                  <FeaturesPage/> } />} />     \n              \n              <Route path=\"/logout\" render={ () => <Logout logout={this.logout.bind(this)}/> } />\n              <Route path=\"/\"   render={( ) =>            \n                  this.state.user && !this.state.loggingOut\n                  ? <Redirect to=\"/projects\"/>\n                  : <HomeView setUserData={this.setUserData.bind(this)}/> }  />\n              <Route                  render={( ) => \n                <MainTemplate {...this.state} pageTitle=\"\" pageComponent={ \n                  <Error404Page/> } />} /> />\n\n\n\n\n\n            </Switch> }\n\n            { this.state.errorCode === 401 && <Error401Redirect clearErrorCode={this.clearErrorCode.bind(this)}/> }    \n            { this.state.errorCode === 403 && <Error403Page/> } \n            { this.state.errorCode === 404 && <Error404Page/> } \n            { this.state.errorCode === 500 && <Error500Page/> } \n\n            \n\n          </div>\n        }\n\n\n           \n\n\n            \n        </BrowserRouter>\n\n        {!this.state.loading && <Footer/>}\n      </div>      \n    );\n  }\n}\n\n\n\n/*\n\n    var publicRoutes = [\n\n      {\n        path: \"/projects/:id/tagging\",\n        template: TaggingInterfaceTemplate,\n        component: TaggingInterface,\n        componentProps: {\n          projectTitle: this.state.projectTitle,\n          projectAuthor: this.state.projectAuthor,\n          setProject: this.setProject.bind(this),\n          project_id: p.match.params.id,\n          user: this.state.user,\n        }\n      },\n      {\n        path: \"/projects/:id/tagging\",\n        template: MainTemplate,\n        component: ProjectListPage,\n        componentProps: {\n          setProject: this.setProject.bind(this),\n        }\n      }\n    ];\n\n*/\n\nconst PrivateRoute = ({ component: Component, ...rest }) => (\n  <Route {...rest} render={(p) => {\n    var {user, ...other} = rest;\n    return rest.user\n      ? rest.render(p)\n      : <Redirect to='/login' />\n  \n  }\n  } />\n)\n\n\n\nexport default App;\n\n// Old code\n/* \n<div className=\"submit-annotations-container\">\n  <button className=\"submit-annotations-button\" onClick={this.submitAnnotations.bind(this)}>Submit annotations <i className=\"fa fa-chevron-right\"></i></button>\n</div>\n*/","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// Remove empty children from the JSON data.\nvar removeEmptyChildren = function(obj) {\n  if(obj[\"children\"].length == 0) {\n    delete obj[\"children\"];\n  } else {\n    for(var k in obj[\"children\"]) {\n      removeEmptyChildren(obj[\"children\"][k]);\n    }\n  }\n}\n\nmodule.exports.slash2txt = function(slash) {\n  var txt = [];\n  for(var i = 0; i < slash.length; i++) {\n    txt.push(slash[i].replace(/[^\\/]*\\//g, ' ')); // Replace any forwardslashes+text with a space.\n  }\n  return txt.join(\"\\n\");\n}\n\nmodule.exports.txt2json = function(text, slash, descriptions={} ) {\n  var fieldname = \"name\";\n\n  var lines = text.split('\\n');  \n  var depth = 0; // Current indentation\n  var root = {\n    \"children\": []\n  };\n  root[\"\" + fieldname] = \"entity\";\n  var parents = [];\n  var node = root;\n  var colorId = -1;\n  for(var i = 0; i < lines.length; i++) {\n    var cleanLine = lines[i].trim()//replace(/\\s/g, \"\");\n    var newDepth  = lines[i].search(/\\S/) + 1;\n    if(newDepth == 1) colorId++;\n    if(newDepth < depth) {\n      parents = parents.slice(0, newDepth);      \n    } else if (newDepth == depth + 1) {      \n      parents.push(node);\n    } else if(newDepth > depth + 1){\n      return new Error(\"Unparsable tree.\");\n    }\n    depth = newDepth;\n    node = {\"id\": i, \"children\": [], \"colorId\": colorId};\n    node[fieldname] = cleanLine;\n    node['full_name'] = slash[i];\n    if(descriptions[slash[i]]) {\n      node['description'] = descriptions[slash[i]];\n    }\n\n    if(parents.length > 0) {\n      parents[parents.length-1][\"children\"].push(node);\n    }\n  }\n  removeEmptyChildren(root); // Remove 'children' properties of all nodes without children\n  return root;\n}\n\n// Converts 'space' notation to 'slash' notation, e.g.\n// person\n//  president\n//   president_of_us\n//  burgerflipper\n// ... becomes ->\n// person\n// person/president\n// person/president/president_of_us\n// person/burgerflipper\nfunction txt2slash(text) {\n  var lines = text.split('\\n');  \n  var slashData = [];\n  var depth = 1;\n  var parents = [];\n  var prev = \"\";\n  for(var i = 0; i < lines.length; i++) {\n    var cleanLine = lines[i].replace(/\\s/g, \"\").replace(/\\//g, '|');\n    var newDepth  = lines[i].search(/\\S/) + 1;\n    if(newDepth < depth){\n      parents = parents.slice(0, newDepth-1);\n    } else if (newDepth == depth + 1) {\n      parents.push(prev);\n    } else if(newDepth > depth + 1) {\n      //return new Error(\"Unparsable tree.\");\n    }\n    depth = newDepth;\n    prev = cleanLine;\n    slashData.push(parents.join(\"/\") + (parents.length > 0 ? \"/\" : \"\") + cleanLine);\n  }\n  return slashData;\n}\n\nfunction json2text(root) {\n  var allNodes = [];\n  var depth = 1;\n  function addNode(d) {\n    allNodes.push((new Array(depth).join(\" \")) + d.name.replace(/\\|/, '/'));\n    if(d.children) {\n      depth++;\n      d.children.forEach(addNode);\n      depth--;\n    }\n    else if(d._children) {\n      depth++;\n      d._children.forEach(addNode);\n      depth--;\n    }    \n  }\n  if(root.children)\n    root.children.forEach(addNode);\n  else if(root._children) \n    root._children.forEach(addNode);\n\n  return allNodes.join(\"\\n\");\n}\n\n\nmodule.exports.json2slash = function(json) {\n  var txt = json2text(json);\n  var slash = txt2slash(txt);\n  return slash;\n}"],"sourceRoot":""}