{"version":3,"sources":["favicon.png","redcoat-1-threshold.png","images/redcoat-1-grey.png","functions/getCookie.js","functions/ScrollToTop.js","pages/Error404Page.js","components/ProfileIcon.js","components/Navbar.js","components/CategoryHierarchy.js","components/tagging_interface/documentComponents.js","functions/formatDate.js","components/Comment.js","components/ControlBar.js","functions/tagging_interface/Annotation.js","functions/tagging_interface/initAnnotationsArray.js","pages/Error403Page.js","pages/TaggingInterface.js","pages/FeaturesPage.js","pages/ProjectListPage.js","pages/CategoryHierarchyPage.js","pages/InvitationsPage.js","pages/CurationInterface.js","pages/ProjectView.js","pages/HomePage.js","pages/SetupProjectPage.js","pages/UserProfilePage.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","getCookie","name","cookieValue","undefined","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","ScrollToTop","pathname","useLocation","useEffect","window","scrollTo","Error404Page","props","class","Component","ProfileIcon","user","this","className","size","style","profile_icon","background","icon","foreground","Navbar","id","to","src","logo","username","loading","Category","item","index","children","childItems","open","map","key","openedItems","has","full_name","onClick","hotkeyMap","hotkeyChain","isTopLevelCategory","applyTag","hasHotkey","hasOwnProperty","hotkeyStr","join","content","data-hotkey-id","draggable","toString","draggableId","provided","snapshot","ref","innerRef","draggableProps","isDragging","colorId","dragHandleProps","setupItemOrder","items","itemOrder","Array","CategoryHierarchy","state","orderedItems","Set","onDragEnd","bind","prevProps","prevState","_","isEqual","setState","delete","add","result","destination","list","startIndex","endIndex","from","splice","removed","reorder","source","order","getOrderedItems","initHotkeyMap","visible","displayOnly","droppableId","droppableProps","isDraggingOver","toggleCategory","placeholder","getColourIdx","entityClass","entityColourMap","slice","Label","truncatedLabel","colourIdx","e","deleteTag","Word","selected","wordInnerRef","React","createRef","text","highlighting","output","console","log","ReactHtmlParser","hasLabel","entityClasses","tagClass","bioTag","isLastInSpan","labels","getHighlightedWord","wordColourClass","onMouseUp","updateSelections","onMouseDown","Sentence","wordIndex","action","selections","isWordSelected","selection","wordEndIndex","wordStartIndex","words","word","annotations","dateFormat","require","formatDate","d","Comment","user_profile_icon","author","created_at","hideDocumentString","document_string","project_id","document_id","CommentInput","comment","preventDefault","submitComment","target","value","onSubmit","onChange","setComment","maxlength","SaveButton","buttonClass","changesMade","recentlySaved","saving","iconClass","submitAnnotations","ProgressBar","show","totalPagesAvailable","totalPages","DocumentSearchBar","inputRef","searchDocuments","$","current","blur","inSearchMode","submit","updateValue","ControlBar","pageNumber","pageNumberError","pageInputRef","ele","val","clearPageNumberInput","parseInt","goToPage","groupName","changePageNumber","latestGroup","lastModified","curationPage","querying","loadPreviousPage","showingProgressBar","showDocsPerPage","setDocsPerPage","docsPerPageOptions","p","docsPerPage","showSortBy","setSortBy","sortByOptions","sortBy","showSaveButton","title","loadNextPage","Annotation","token","tokenIndex","spanText","spanStartIdx","spanEndIdx","alreadyHasLabel","indexOf","push","otherAnnotation","startIdx","endIdx","initAnnotationsArray","documents","automaticAnnotations","searchTerm","oneDocument","repeatedDocs","searchTermArray","doc_idx","searchIdx","token_idx","foundIdx","setHighlighting","mention_idx","mention","start","end","label_idx","label","k","addLabel","Error403Page","fetchConfigGET","method","headers","ConfidenceButton","docIdx","checked","updateConfidence","ConfidenceButtons","confidence","DocumentContainerHeader","DocumentContainer","commentsOpen","sentenceRef","documentUnderneathRef","commentBoxRef","t","node","domtoimage","toBlob","bgcolor","then","blob","saveAs","message","next","scrollTop","scrollHeight","displayIndex","comments","toggleOpenComments","saveToPng","nextNode","hasChildNodes","firstChild","nextSibling","parentNode","HotkeyInfo","ec","chain","WikipediaSummary","_isMounted","wikipediaSummary","wikipediaReadMoreUrl","tokens","snippet","wurl","wikipediaTitle","toLowerCase","ajax","url","data","srsearch","format","dataType","success","query","search","replace","err","getResult","queryWikipedia","summary","href","toggleVisibility","TaggingInterface","documentGroupAnnotationId","documentIds","documentAnnotationIds","categoryHierarchy","confidences","getEmptySelectionsArray","currentSelection","getEmptyCurrentSelection","mostRecentSelectionText","reverseHotkeyMap","terminalHotkeys","hotkeyBindingFn","hotkeyTimeoutFn","holdingCtrl","holdingShift","docGroupLastModified","selectionChangeFn","windowMouseUpFn","firstLoad","taggingCompletePage","sel","getSelection","rangeCount","r","range","startContainer","endNode","endContainer","rangeNodes","commonAncestorContainer","unshift","getRangeSelectedNodes","getRangeAt","removeClass","find","addClass","classList","contains","sentenceIndex","removeEventListener","selectionChange","windowMouseUp","addEventListener","moveSelectionHorizontally","moveSelectionVertically","hotkeyChainStr","clearTimeout","keyCode","is","prototype","concat","hotkeyTimeout","setTimeout","bindHotkeys","traverseChild","child","hotkeys","firstPass","Math","min","buildReverseHotkeyMap","setupHotkeyKeybinds","ec_idx","each","width","offsetWidth","newWidth","ceil","css","nextPageNumber","queryAPI","prevDocsPerPage","newPageNumber","floor","route","fetch","response","status","Error","JSON","parse","alert","tagging_complete","initConfidencesArray","initEntityColourMap","projectTitle","projectAuthor","setProject","initKeybinds","initMouseEvents","clearWordJustification","justifyWords","selectFirstWord","catch","error","annotationsJSON","docLabels","ann","csrfToken","annotationsToJSON","fetchConfigPOST","body","stringify","newTotalPagesAvailable","Date","now","direction","j","max","numDocs","clearSelections","s","empty","removeAllRanges","sel_idx","annotationSpanStart","annotationSpanEnd","notAllEqual","annotation","removeAllLabels","x","setSpanEndIdx","setSpanStartIdx","changeBioTag","ann_idx","labelWasModified","captureEvent","spanStart","spanEnd","removeLabel","documentIndex","documentId","eventAction","doc","TaggingCompletePage","FeaturesPage","ProjectListPage","projects","getDummyProjects","numUserInvolvedIn","numCreatedByUser","numDocGroupsAnnotated","totalDocGroups","view","randomString","minLength","maxLength","randomLength","random","dummyProjects","description","total_users","icon_name","setView","filter","project","userIsCreator","color","lineWidth","startAngle","animate","animationDuration","_id","creator","total_comments","CategoryHierarchyPage","arr","fill","stringOfRandomLength","minlen","maxlen","generateEmptyTable","InvitationsTable","active_users","colspan","email","pending_invitations","InvitationsPage","CurationInterface","compiledAnnotation","annotatorAgreement","documentIdQuery","refreshDataFn","saveState","queryString","users","saveTimes","toFixed","saveTime","specialName","specialDescription","CurationDocumentContainer","defaults","global","defaultFontFamily","animation","duration","chartColours","WaffleChart","maxValue","total","reduce","a","b","ratio","tooltips","tooltipSide","totalSquares","reverse","count","squares","frequency","groupIndex","square","squareIndex","numberWithCommas","setActivityChartStyles","activityChartData","datasets","Object","assign","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","darken","colourRGB","amount","String","convertToRGB","aRgbHex","match","ProjectDashboard","entityChartMulticolour","activityChartCumulative","entityColours","entityChartData","borderWidth","colourIndexes","colourHex","colourRGBBorder","cumulativeData","cumulativeDatasets","cumulativeDataset","c","getCumulative","avgAgreement","round","avgTimePerDocument","userDocsAnnotated","userAnnotationsRequired","toggleEntityChartColours","getColouredData","height","options","responsive","maintainAspectRatio","legend","display","scales","yAxes","ticks","beginAtZero","precision","scaleLabel","labelString","toggleActivityChartCumulative","processActivityChartData","redraw","xAxes","type","time","unit","annotationsChartData","ProjectViewSidenav","currentLocation","location","menuItems","ProjectViewSidenavSubmenu","pathName","firstChildPathName","parentPath","ProjectViewSidenavButton","EmptyThing","ProjectView","dashboard","date","curationInterfaceState","project_name","project_author","docId","TransitionGroup","CSSTransition","timeout","enter","exit","classNames","path","render","setCurationInterfaceData","invitationsTable","withRouter","lipsum","getRandomString","LettersBackground","characters","characterChangeFn","clearInterval","setInterval","changeCharacters","HomePageRegister","autoFocus","required","HomePageLogin","password","errorMessage","credentials","json","setUserData","submitForm","handleUsernameChange","handlePasswordChange","HomePageForgotPassword","HomePageMain","data-content","HomePage","component","SetupProjectPage","iconOptions","colourOptions","UserProfilePage","setUserProfileIcon","colour","hex","colors","onChangeComplete","handleForegroundColourChange","handleBackgroundColourChange","setIcon","saveChanges","MainTemplate","pageTitle","pageComponent","TaggingInterfaceTemplate","LoadingScreen","fadingOut","ProjectViewTemplate","Footer","Logout","logout","App","loadingFadeOut","loggingOut","profileIcon","getUserData","params","PrivateRoute","rest","Boolean","hostname","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.1d919489.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/redcoat-1-threshold.78b878cf.png\";","module.exports = __webpack_public_path__ + \"static/media/redcoat-1-grey.fd5c7c00.png\";","// Function for getting value from a cookie\r\nfunction getCookie(name) {\r\n    let cookieValue = undefined;\r\n    if (document.cookie && document.cookie !== '') {\r\n        const cookies = document.cookie.split(';');\r\n        for (let i = 0; i < cookies.length; i++) {\r\n            const cookie = cookies[i].trim();\r\n            // Does this cookie string begin with the name we want?\r\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\r\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return cookieValue;\r\n}\r\n\r\nexport default getCookie;","import { useEffect } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\n\r\nexport default function ScrollToTop() {\r\n  const { pathname } = useLocation();\r\n\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n  }, [pathname]);\r\n\r\n  return null;\r\n}","import React from \"react\";\r\nimport {Component} from \"react\";\r\n\r\nclass Error404Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <main class=\"error-page\">\r\n\r\n        <h1>404: Page not found.</h1>\r\n        <p>The page you were looking for does not exist.</p>\r\n\r\n\r\n      </main>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Error404Page","import React from 'react';\r\nimport {Component} from 'react';\r\n\r\nclass ProfileIcon extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender() {\r\n\t\tvar user = this.props.user;\r\n\t\tif(!user) {\r\n\t\t\treturn (\r\n\t\t\t\t<div className={\"circle-icon profile-icon \" + (this.props.size || \"small\")}style={{'background': \"#ddd\"}}></div>\r\n\t\t\t)\r\n\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<div className={\"circle-icon profile-icon \" + (this.props.size || \"small\")}style={{'background': user.profile_icon.background}}>\r\n\t\t\t\t<i className={\"profile-icon-i fa fa-\" + user.profile_icon.icon} style={{'color': user.profile_icon.foreground}}></i>\r\n            </div>\r\n        )\r\n\t}\r\n\r\n}\r\n\r\nexport default ProfileIcon;","import React from \"react\";\r\nimport { Link, Switch, Route, withRouter } from \"react-router-dom\";\r\nimport {Component} from 'react';\r\nimport logo from '../favicon.png'\r\n\r\nimport ProfileIcon from './ProfileIcon';\r\n\r\nconst BASE_URL = \"/\"\r\n\r\n// The navbar, which appears at the top of the page.\r\nclass Navbar extends Component {\r\n  render() {\r\n\r\n    return (\r\n      <nav id=\"navbar\">\r\n        <div className=\"navbar-left\">\r\n          <div id=\"logo\">\r\n            <Link to=\"/\">             \r\n              <img src={logo}/> <span class=\"text\">Redcoat</span>         \r\n            </Link>\r\n          </div>\r\n          { this.props.user && \r\n            <div className=\"dropdown-menu\">\r\n              <button>Projects</button>\r\n              <ul className=\"dropdown-menu-items\">\r\n                <li><Link to={\"\" + BASE_URL + \"projects\"}>Projects list</Link></li>\r\n                <li><Link to={\"\" + BASE_URL + \"setup-project\"}>Setup project</Link></li>\r\n              </ul>\r\n            </div>\r\n          }\r\n   \r\n        </div>\r\n        <div className=\"navbar-centre\"></div>\r\n        <div className=\"navbar-right\">\r\n\r\n\r\n\r\n          { this.props.user &&\r\n\r\n            <div className=\"dropdown-menu\">\r\n              <button className=\"flex\"><ProfileIcon user={this.props.user}/><span>Logged in as {this.props.user.username}</span></button>\r\n              <ul className=\"dropdown-menu-items\">\r\n                <li><Link to={\"\" + BASE_URL + \"profile\"}>Profile</Link></li>\r\n                <li><Link to={\"\" + BASE_URL + \"logout\"}>Logout</Link></li>\r\n              </ul>\r\n            </div>\r\n          }\r\n\r\n          { !this.props.user && \r\n\r\n\r\n\r\n            <div className=\"dropdown-menu log-in\">\r\n              <button>Not logged in</button>\r\n              <ul className=\"dropdown-menu-items\">\r\n                <li><Link to={\"\" + BASE_URL + \"login\"}>Login</Link></li>\r\n                <li><Link to={\"\" + BASE_URL + \"register\"}>Register</Link></li>\r\n              </ul>\r\n            </div>\r\n          }\r\n\r\n          {!this.props.loading && <div className=\"dropdown-menu short\">\r\n            <Link to={\"\" + BASE_URL + \"features\"}>v2.0</Link>\r\n          </div> }\r\n        </div>\r\n        {!this.props.loading && <header className=\"decorative-bar\"></header>}\r\n      </nav>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Navbar;","import React from 'react';\r\nimport {Component} from 'react';\r\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\r\nimport styled from 'styled-components';\r\nimport _ from 'underscore';\r\n\r\n// A single category in the category hierarchy tree.\r\nclass Category extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    var item = this.props.item;\r\n    var index = this.props.index;\r\n    var children = this.props.item.children;\r\n\r\n    // If this component has any children, render each of them.\r\n    if(children) {\r\n      var childItems = (\r\n        <ul className={this.props.open ? \"\" : \"hidden\"}>\r\n          { children.map((item, index) => (\r\n            <Category key={index}\r\n                      item={item}\r\n                      open={this.props.openedItems.has(item.full_name)}\r\n                      openedItems={this.props.openedItems}\r\n                      onClick={this.props.onClick}\r\n                      hotkeyMap={this.props.hotkeyMap}\r\n                      hotkeyChain={this.props.hotkeyChain}\r\n                      isTopLevelCategory={false}\r\n                      applyTag={this.props.applyTag}\r\n            />)) }\r\n        </ul>\r\n      );\r\n    } else {\r\n      var childItems = '';\r\n    }\r\n\r\n    // Determine whether this category has a hotkey (by checking hotkeyMap).\r\n    // Also determine hotkeyStr (for example '12' for 'item/pump').\r\n    if(this.props.hotkeyMap) {\r\n      var hasHotkey = this.props.hotkeyMap.hasOwnProperty(this.props.item.full_name)\r\n      var hotkeyStr = hasHotkey ? this.props.hotkeyMap[this.props.item.full_name].join('') : '';\r\n    } else {\r\n      hasHotkey = false;\r\n      hotkeyStr = '';\r\n    }\r\n    \r\n\r\n    var content = (\r\n      <span className=\"inner-container\">\r\n        \r\n         {children && <span className=\"open-button\" onClick={() => this.props.onClick(item.full_name)}><i className={\"fa fa-chevron-\" + (this.props.open ? \"up\" : \"down\")}></i></span>}\r\n       \r\n        <span className={\"category-name\" + (hasHotkey ? \" has-hotkey\" :\"\") + (this.props.hotkeyChain === hotkeyStr ? \" hotkey-active\" : \"\")}\r\n              data-hotkey-id={hotkeyStr} onClick={this.props.applyTag ? () => this.props.applyTag(this.props.item.full_name) : null}>             \r\n\r\n          {item.name}\r\n        </span>\r\n      </span>      \r\n    )\r\n\r\n\r\n    // This component will render differently depending on whether it is a top-level category or not.\r\n    // Top level categories have the drag handle, which requires a different configuration on the wrapper and li.\r\n    if(this.props.isTopLevelCategory) {\r\n\r\n\r\n      if(this.props.draggable) {\r\n        return (\r\n          <Draggable key={item.id.toString()} draggableId={item.id.toString()} index={index}>\r\n            {(provided, snapshot) => (\r\n              <li ref={provided.innerRef} {...provided.draggableProps} className={\"draggable \" + (snapshot.isDragging ? \"dragging\": \"not-dragging\") + \" color-\" + (item.colorId + 1)}>\r\n                <div {...provided.dragHandleProps} className=\"drag-handle-container\"><span className=\"drag-handle\"></span></div>\r\n                \r\n                { content }\r\n                { childItems }\r\n                \r\n              </li>\r\n            )}\r\n          </Draggable>\r\n        )\r\n      } else {\r\n        return (\r\n          <li className={\" color-\" + (item.colorId + 1)}>\r\n            { content }\r\n            { childItems }                \r\n          </li>\r\n        )\r\n      }\r\n\r\n\r\n    } else {\r\n      return (\r\n        <li>\r\n          { content }\r\n          { childItems }\r\n        </li>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n// https://codesandbox.io/s/k260nyxq9v?file=/index.js:154-2795\r\n// a little function to help us with reordering the result\r\nconst reorder = (list, startIndex, endIndex) => {\r\n  const result = Array.from(list);\r\n  const [removed] = result.splice(startIndex, 1);\r\n  result.splice(endIndex, 0, removed);\r\n\r\n  return result;\r\n};\r\n\r\n// Retrieve a list of ordered items based on an order array.\r\nfunction getOrderedItems(items, order) {\r\n  var orderedItems = new Array(items.length);\r\n  for(var i = 0; i < order.length; i++) {\r\n    orderedItems[i] = items[order[i]];\r\n  }\r\n  return orderedItems;\r\n}\r\n\r\nfunction setupItemOrder(items) {\r\n  var itemOrder = new Array(items.length);\r\n  for(var i = 0; i < itemOrder.length; i++) {\r\n    itemOrder[i] = i;\r\n  }\r\n  return itemOrder;\r\n}\r\n\r\n\r\n// The category hierarchy (on the left).\r\nclass CategoryHierarchy extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      itemOrder: [],      // An array that maintains the ordering of the top-level categories.\r\n                          // e.g. [0, 1, 3, 2]\r\n      orderedItems: [],\r\n      openedItems: new Set(),    // An set keep track of the items that have been open (indexed by name).\r\n    }\r\n    this.onDragEnd = this.onDragEnd.bind(this);\r\n  }\r\n\r\n  // When this component's items changes (should be when a new docGroup has been requested), setup a new itemOrder state.\r\n  // (which defaults to ascending order e.g. 0, 1, 2, 3, 4 ...)\r\n  componentDidUpdate(prevProps, prevState) {\r\n    var itemOrder = setupItemOrder(this.props.items);\r\n    if(!_.isEqual(prevProps.items, this.props.items)) {\r\n      this.setState({\r\n        openedItems: new Set(),\r\n        orderedItems: this.props.items,\r\n        itemOrder: itemOrder,\r\n      });      \r\n    }\r\n  }\r\n\r\n  componentWillMount() {\r\n    var itemOrder = setupItemOrder(this.props.items);\r\n\r\n    this.setState({\r\n      openedItems: new Set(),\r\n      orderedItems: this.props.items,\r\n      itemOrder: itemOrder,\r\n    });   \r\n  }\r\n\r\n  // Open or close a category.\r\n  // It's pretty awkward that this function is necessary. It would be ideal to store 'open' as a state variable inside the Category and Subcategory\r\n  // components, but that results in the wrong categories being open when the top-level categories are moved around.\r\n  // Storing them in the openedItems array in this component's state allows for the opened categories to be maintained when the user\r\n  // drags a category from one place to another.\r\n  // full_name should be the full name of the category, e.g. item/pump/centrifugal_pump, which are unique.\r\n  toggleCategory(full_name) {\r\n    var openedItems = this.state.openedItems;    \r\n\r\n    if(openedItems.has(full_name)) {\r\n      openedItems.delete(full_name);\r\n    } else {\r\n      openedItems.add(full_name);\r\n    }\r\n\r\n    this.setState({\r\n      openedItems: openedItems\r\n    })\r\n  }\r\n\r\n  // When the user has finished dragging a category, determine the new item order and save this order to the state.\r\n  onDragEnd(result) {\r\n    // dropped outside the list\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n\r\n    const itemOrder = reorder(\r\n      this.state.itemOrder,\r\n      result.source.index,\r\n      result.destination.index\r\n    );\r\n\r\n    var orderedItems = getOrderedItems(this.props.items, itemOrder)\r\n\r\n    this.props.initHotkeyMap(orderedItems, () =>\r\n      this.setState({\r\n        itemOrder: itemOrder,\r\n        orderedItems: orderedItems,\r\n      })\r\n    );\r\n  }\r\n\r\n  \r\n  render() {\r\n\r\n    var items       = this.state.orderedItems;\r\n    var openedItems = this.state.openedItems;\r\n\r\n\r\n\r\n    return (\r\n      <div id=\"category-hierarchy-tree\" className={(this.props.visible ? \"\" : \"hidden\") + (this.props.displayOnly ? \" display-only\" : \"\")}>\r\n        <DragDropContext onDragEnd={this.onDragEnd}>\r\n          <Droppable droppableId=\"droppable\">\r\n            {(provided, snapshot) => (\r\n              <ul\r\n                {...provided.droppableProps}\r\n                className={\"draggable-list\" + (snapshot.isDraggingOver ? \" dragging\" : \"\")}\r\n                ref={provided.innerRef}\r\n\r\n              >\r\n                {this.props.displayOnly && <li className=\"header-row\"><span className=\"inner-container\"><span className=\"category-name\">Entity Class</span><span className=\"description\">Description</span></span></li>}\r\n                {items.map((item, index) => (\r\n                  <Category \r\n                            key={index}\r\n                            item={item}\r\n                            index={index}\r\n                            onClick={this.toggleCategory.bind(this)}\r\n                            open={openedItems.has(item.name)} \r\n                            openedItems={this.state.openedItems} \r\n                            hotkeyMap={this.props.hotkeyMap}\r\n                            hotkeyChain={this.props.hotkeyChain}\r\n                            isTopLevelCategory={true}\r\n                            applyTag={this.props.applyTag}\r\n                            draggable={this.props.draggable}\r\n                  />\r\n                ))}\r\n                {provided.placeholder}\r\n              </ul>\r\n            )}\r\n          </Droppable>\r\n        </DragDropContext>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CategoryHierarchy;","import React from 'react';\r\nimport {Component} from 'react';\r\nimport ReactHtmlParser from 'react-html-parser';\r\n\r\n\r\n// Returns the colour id of the given entityClass according to the entityColourMap, e.g.\r\n// 'item/pump': 1 (because \"item\" is the top level category)\r\nfunction getColourIdx(entityClass, entityColourMap) {\r\n  var baseClass = entityClass.split(\"/\").slice(0, 1)[0];\r\n  return entityColourMap[baseClass];\r\n}\r\n\r\n// A label, drawn underneath a word.\r\nclass Label extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n\r\n    var split = this.props.entityClass.split('/');\r\n    var truncatedLabel = split.length > 1 ? \"/\" : \"\"\r\n    truncatedLabel = truncatedLabel + split[split.length - 1];\r\n\r\n    return (\r\n      <span className={\"label tag-\" + this.props.colourIdx} onClick={(e) => {this.props.deleteTag(this.props.entityClass);  }}><span className=\"label-name\">{truncatedLabel}</span></span>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// A single word (or token) in the tagging interface.\r\nclass Word extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      selected: false,\r\n    }\r\n    this.wordInnerRef = React.createRef();\r\n  }\r\n\r\n  // Calls this.props.deleteTag with the index of this word as a parameter.\r\n  deleteTag(entityClass) {\r\n    this.props.deleteTag(this.props.index, entityClass);\r\n  }\r\n\r\n  // Clear the word justification of this word if it is does not have a label.\r\n  componentDidUpdate(prevProps, prevState) {\r\n\r\n    /* TODO: Fix the below to be much faster.\r\n       The code should update the width of this word back to auto if this word no longer has a label,\r\n       but it is too slow on long docs so I took it out.\r\n    */\r\n\r\n    // if(this.props.entityClasses.length === 0) {\r\n\r\n    //   var ele =  this.wordInnerRef.current;\r\n    //   $(ele).css(\"min-width\", \"auto\");\r\n\r\n    //   var width = ele.offsetWidth;\r\n    //   var newWidth = Math.ceil(width / 25) * 25;\r\n    //   $(ele).css('min-width', newWidth + 'px');        \r\n\r\n    // }\r\n  }\r\n\r\n  getHighlightedWord() {\r\n    var text = this.props.text;\r\n    var highlighting = this.props.highlighting;\r\n\r\n    var output = '';\r\n\r\n    for(var i = 0; i < text.length; i++) {\r\n      if(i === highlighting[0]) {\r\n        output += '<span class=\"search-highlight\">'\r\n      }\r\n      output += text[i];\r\n      if(i === highlighting[1]) {\r\n        output += '</span>'\r\n      }\r\n    }\r\n\r\n    console.log(output);\r\n    return ReactHtmlParser(output);\r\n  }\r\n\r\n  render() {\r\n\r\n    var hasLabel = this.props.entityClasses.length > 0;\r\n\r\n    var tagClass = hasLabel ? (\" tag \" + ((this.props.bioTag === \"B\") ? \"tag-begin\" : \"\") + (this.props.isLastInSpan ? \" tag-end\" : \"\")) : \"\";\r\n\r\n    if(hasLabel) {\r\n      var labels = this.props.entityClasses.map((entityClass, i) => \r\n                  <Label deleteTag={this.deleteTag.bind(this)} key={i} bioTag={this.props.bioTag} entityClass={entityClass} colourIdx={getColourIdx(entityClass, this.props.entityColourMap)} />\r\n                  )\r\n      \r\n    } else {\r\n      var labels = '';\r\n    }\r\n\r\n    var text = this.props.text;\r\n    if(this.props.highlighting) {\r\n      text = this.getHighlightedWord();\r\n    }\r\n\r\n    var wordColourClass = (hasLabel ? (\" tag-\" + getColourIdx(this.props.entityClasses[0], this.props.entityColourMap)) : \"\")\r\n    return (\r\n      <span className={\"word\" + (this.props.selected ? \" selected\" : \"\") + tagClass}>\r\n\r\n        <span className={\"word-inner\" + wordColourClass + (this.props.highlighting ? \" search-highlight\" : \"\") } ref={this.wordInnerRef}\r\n              onMouseUp=  {() => this.props.updateSelections(this.props.index, 'up')}\r\n              onMouseDown={() => this.props.updateSelections(this.props.index, 'down')}>\r\n\r\n          {text}\r\n        </span>\r\n        {labels}\r\n        \r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\n// A sentence in the tagging interface.\r\nclass Sentence extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n  }\r\n\r\n  // Call the updateSelections function of the parent of this component (i.e. TaggingInterface), with this sentence's index included.\r\n  updateSelections(wordIndex, action) {\r\n    this.props.updateSelections(this.props.index, wordIndex, action)\r\n  }\r\n\r\n  deleteTag(wordIndex, entityClass) {\r\n    this.props.deleteTag(this.props.index, wordIndex, entityClass);\r\n  }\r\n\r\n\r\n\r\n\r\n  \r\n\r\n  render() {\r\n\r\n    var selections = this.props.selections;\r\n\r\n    // Check props.selections to determine whether the word with a given index in this sentence is selected.\r\n    // This is passed to the word as a prop so that it can be highlighted accordingly.\r\n    function isWordSelected(wordIndex) {      \r\n      if(selections.length === 0) return false;     \r\n      for(var i = 0; i < selections.length; i++) {\r\n        var selection = selections[i];\r\n        if(selection.wordEndIndex < 0) continue;\r\n        if(selection.wordEndIndex >= wordIndex && wordIndex >= selection.wordStartIndex ) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n\r\n\r\n    if(this.props.displayOnly) {\r\n      return (\r\n        <div className={\"sentence-inner\" + (this.props.displayOnly ? \" display-only\" : \"\")}>\r\n          { this.props.words.map((word, i) => \r\n            <Word key={i}\r\n                  index={i}\r\n                  text={word}\r\n                  entityClasses={this.props.annotations[i].entityClasses || []}\r\n                  bioTag={this.props.annotations[i].bioTag}\r\n                  entityColourMap={this.props.entityColourMap}\r\n                  highlighting={this.props.annotations[i].highlighting}\r\n                  updateSelections={() => {return null}}\r\n                  deleteTag={() => {return null}}\r\n                  isLastInSpan={this.props.annotations[i].isLastInSpan()}\r\n            />)\r\n          }   \r\n        </div>\r\n      );      \r\n    }\r\n\r\n\r\n    return (\r\n      <div className=\"sentence-inner\">\r\n        { this.props.words.map((word, i) => \r\n          <Word key={i}\r\n                index={i}\r\n                text={word}\r\n                selected={isWordSelected(i)}\r\n                entityClasses={this.props.annotations[i].entityClasses || []}\r\n                isLastInSpan={this.props.annotations[i].isLastInSpan()}\r\n                bioTag={this.props.annotations[i].bioTag}\r\n                updateSelections={this.updateSelections.bind(this)}\r\n                entityColourMap={this.props.entityColourMap}\r\n                deleteTag={this.deleteTag.bind(this)}\r\n                highlighting={this.props.annotations[i].highlighting}\r\n\r\n\r\n          />)\r\n        }   \r\n        \r\n\r\n\r\n       \r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport { Word };\r\nexport { Sentence };","const dateFormat = require('dateformat');\r\n\r\n// Nicely formats a date\r\nfunction formatDate(d) {\r\n  return dateFormat(d, 'dd mmm') + ' at ' + dateFormat(d, 'h:MM tt')\r\n}\r\n\r\nexport default formatDate;","import React from 'react';\r\nimport {Component} from 'react';\r\n\r\nimport formatDate from '../functions/formatDate'\r\nimport { Link } from 'react-router-dom'\r\n\r\n// text={comment.text} date={comment.created_at} author={comment.author} document={comment.document_string}\r\n\r\nclass Comment extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"comment-box\">\r\n        <div className=\"comment-left\">    \r\n          <div className=\"circle-icon profile-icon\" style={{'background': this.props.user_profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.props.user_profile_icon.icon} style={{'color': this.props.user_profile_icon.foreground}}></i></div>\r\n        </div>\r\n        <div className=\"comment-right\">\r\n          <div className={\"comment-author st\"}>{this.props.author}<span className=\"comment-date st\">{formatDate(this.props.created_at)}</span></div>\r\n          {!this.props.hideDocumentString && \r\n            <blockquote className=\"comment-document st\">\r\n              <span className=\"document-string\">{this.props.document_string}</span>\r\n              <Link to={\"/projects/\" + this.props.project_id + \"/annotations/curation?docId=\" + this.props.document_id}><i class=\"fa fa-external-link\"></i></Link>\r\n            </blockquote>}\r\n          <div className=\"comment-text st st-block\">{this.props.text}</div>\r\n          \r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass CommentInput extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      comment: '',\r\n    }\r\n  }\r\n\r\n  onSubmit(e) {\r\n    e.preventDefault();\r\n\r\n    if(this.state.comment.length === 0) return;\r\n\r\n    this.props.submitComment(this.state.comment, () => {\r\n      this.setState({\r\n        comment: '',\r\n      })\r\n    })    \r\n    return;\r\n  }\r\n\r\n  setComment(e) {\r\n    this.setState({\r\n      comment: e.target.value\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <form className=\"comment-input-box\" onSubmit={this.onSubmit.bind(this)}>\r\n        <div className=\"comment-box\">\r\n          <div className=\"comment-left\">     \r\n            { this.props.user_profile_icon &&              \r\n            <div className=\"circle-icon profile-icon\" style={{'background': this.props.user_profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.props.user_profile_icon.icon} style={{'color': this.props.user_profile_icon.foreground}}></i></div>\r\n            }\r\n          </div>\r\n          <div className=\"comment-right margin-right\">\r\n            <div className=\"comment-text\">\r\n              <textarea name=\"comment-input\" className=\"comment-input\" placeholder=\"Write a comment...\" onChange={this.setComment.bind(this)} value={this.state.comment} maxlength=\"200\" ></textarea>\r\n\r\n\r\n\r\n            </div> \r\n\r\n          </div>     \r\n           \r\n\r\n        </div>\r\n        <div className=\"submit-comment-wrapper\"><button className=\"submit-comment\"><i class=\"fa fa-send\"></i></button></div>\r\n      </form>\r\n    )\r\n  }\r\n}\r\n\r\nexport { Comment };\r\nexport { CommentInput };","import React from 'react';\r\nimport {Component} from 'react';\r\nimport $ from 'jquery';\r\nimport formatDate  from '../functions/formatDate';\r\n\r\n// The humble save button that appears at the top of the page.\r\nclass SaveButton extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  render() {\r\n\r\n    var buttonClass = \" disabled\";\r\n    if(this.props.changesMade) buttonClass = \"\";\r\n    if(this.props.recentlySaved) buttonClass = \" recently-saved\";\r\n    if(this.props.saving) buttonClass = \" saving\";\r\n\r\n    var iconClass = \"fa-save\";\r\n    if(this.props.recentlySaved) iconClass = \"fa-check\";\r\n    if(this.props.saving) iconClass = \"fa-cog fa-spin\"\r\n\r\n    var text = \"Save\";\r\n    if(this.props.recentlySaved) text = \"Saved\";\r\n    if(this.props.saving) text = \"Saving\";\r\n\r\n    return (\r\n      <button className={\"save-button\" + buttonClass} onClick={this.props.submitAnnotations}>\r\n        <i className={\"fa \" + iconClass}></i>\r\n        { text }\r\n      </button>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n// The progress bar that appears when the user saves a new doc group.\r\nclass ProgressBar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"tagging-progress-bar\" className={(this.props.show ? \"show\" : \"hide\")}>\r\n        <span className=\"progress-bar\">\r\n          <span className=\"inner\" style={{\"width\": (this.props.totalPagesAvailable - 1) / this.props.totalPages * 100 + \"%\"}}></span>\r\n        </span>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// The search bar that appears in the control bar, for searching through previously annotated docs.\r\nclass DocumentSearchBar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      value: '',\r\n    }\r\n    this.inputRef = React.createRef();\r\n  }  \r\n\r\n  updateValue(e) {\r\n    var value = e.target.value;\r\n    if(value.trim().length === 0) {\r\n      value = '';\r\n    }\r\n    this.setState({\r\n      value: value,\r\n    });\r\n  }\r\n\r\n  submit(e) {\r\n    \r\n\r\n    this.props.searchDocuments(this.state.value);\r\n\r\n    // this.setState({\r\n    //   value: null,\r\n    // }, () => {\r\n      var ele = $(this.inputRef.current);\r\n      ele.blur();\r\n    // });\r\n\r\n    e.preventDefault();\r\n    return null;\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <form className={\"search-container\" + (this.props.inSearchMode ? \" active\" : \"\")} onSubmit={this.submit.bind(this)} >\r\n        <input ref={this.inputRef} className=\"search-bar\" id=\"document-search-bar\" placeholder=\"Search...\" value={this.state.value} onChange={(e) => this.updateValue(e)} ></input><button className=\"search-button\"><i class=\"fa fa-search\"></i></button>\r\n      </form>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n// The 'control bar', which appears at the top of the interface (with page numbers, group number etc).\r\nclass ControlBar extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state =  {\r\n      pageNumber: null, // The desired page number of the user (not necessarily the one they are currently on).\r\n      pageNumberError: false,\r\n    }\r\n    this.pageInputRef = React.createRef();\r\n  }\r\n\r\n  // clearPageNumberError() {\r\n  //   this.setState({\r\n  //     pageNumber: this.props.pageNumber,\r\n  //     pageNumberError: false,\r\n  //   })\r\n  // }\r\n\r\n  clearPageNumberInput() {\r\n    var ele = $(this.pageInputRef.current);\r\n    ele.val('');\r\n    ele.blur();\r\n  }\r\n\r\n  goToPage(e) {\r\n\r\n    this.clearPageNumberInput();\r\n    if(this.state.pageNumber === '') {\r\n      this.setState({ pageNumber: this.props.pageNumber })\r\n      e.preventDefault();\r\n      return null;\r\n    }\r\n\r\n\r\n\r\n    if(this.state.pageNumber !== parseInt(this.state.pageNumber).toString()) {\r\n      this.setState({\r\n        pageNumber: this.props.totalPagesAvailable,\r\n      }, () => { this.props.goToPage(this.state.pageNumber)});\r\n      e.preventDefault();\r\n      return null;\r\n    }\r\n\r\n    if(this.state.pageNumber < 1) {\r\n      this.setState({\r\n        pageNumber: 1,\r\n      }, () => { this.props.goToPage(this.state.pageNumber)});\r\n    } else if (this.state.pageNumber > this.props.totalPagesAvailable) {\r\n      this.setState({\r\n        pageNumber: this.props.totalPagesAvailable,\r\n      }, () => { this.props.goToPage(this.state.pageNumber)});\r\n    } else {\r\n      this.props.goToPage(this.state.pageNumber);\r\n    }\r\n \r\n\r\n    e.preventDefault();\r\n    return null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    if(!this.state.pageNumber && this.props.pageNumber) {\r\n      this.setState({\r\n        pageNumber: this.props.pageNumber\r\n      })\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if(this.props.pageNumber !== prevProps.pageNumber) {\r\n      this.setState({\r\n        pageNumber: this.props.pageNumber\r\n      })\r\n    }\r\n  }\r\n\r\n\r\n  changePageNumber(e) {\r\n    this.setState({\r\n      pageNumber: e.target.value,\r\n    });\r\n  }\r\n\r\n  render() {\r\n\r\n    var groupName = (\r\n      <span className={\"group-name\"}>\r\n        <span>Page <b>\r\n          <form onSubmit={this.goToPage.bind(this)}>\r\n          <input \r\n                 id=\"page-input\"\r\n                 className={\"page-input\" + (this.state.pageNumberError ? \" error\" : \"\")}\r\n                 placeholder={this.state.pageNumber}\r\n                 name=\"page-input\"\r\n                 onChange={(e) => this.changePageNumber(e)}\r\n                 ref={this.pageInputRef}\r\n                 />\r\n          </form>\r\n          \r\n        </b> of <b>{this.props.totalPages}</b></span>\r\n      </span>\r\n    );\r\n\r\n    var latestGroup = (this.props.totalPagesAvailable) === this.props.pageNumber // Whether the user is looking at the latest group, that they have not yet annotated\r\n\r\n    var lastModified = this.props.changesMade ? (this.props.saving ? \"\" : \"Changes not saved\") : (this.props.lastModified ? \"Saved on \" + formatDate(this.props.lastModified) : \"\");\r\n\r\n    return (\r\n      <div id=\"pagination\" className={this.props.curationPage ? \"curation-page\" : \"\"}>\r\n        <div className=\"page-button-container previous-page\">\r\n          <button className={(this.props.pageNumber === 1 ? \" disabled\" : (this.props.querying ? \"loading\" : \"\"))} onClick={this.props.loadPreviousPage}><i className=\"fa fa-chevron-left\"></i>Prev\r\n          </button>\r\n        </div>\r\n        <div className=\"filler-left\">\r\n          <DocumentSearchBar inSearchMode={this.props.inSearchMode} searchDocuments={this.props.searchDocuments} />\r\n        </div>\r\n        <div className={\"current-page-container\" + (this.props.showingProgressBar ? \" progress-bar-underneath\" : \"\")}>\r\n          { groupName }\r\n\r\n\r\n          { this.props.showDocsPerPage && <div className=\"docs-per-page-select-container\">\r\n            <label>Per page:</label>\r\n            <select className=\"docs-per-page-select\" onChange={(e) => {this.props.setDocsPerPage(e); $(e.target).blur()}} >\r\n              {this.props.docsPerPageOptions.map((p, index) => \r\n                <option value={p} selected={p === this.props.docsPerPage}>{p}</option>\r\n              )}\r\n            </select>\r\n          </div> }\r\n\r\n          { this.props.showSortBy && <div className=\"docs-per-page-select-container\">\r\n            <label>Sort by:</label>\r\n            <select className=\"docs-per-page-select sort-by\" onChange={(e) => {this.props.setSortBy(e); $(e.target).blur()}} >\r\n              {this.props.sortByOptions.map((p, index) => \r\n                <option value={p} selected={p === this.props.sortBy}>{p === \"Annotations\" ? \"# Annotations\" : p}</option>\r\n              )}\r\n            </select>\r\n          </div> }\r\n\r\n\r\n\r\n          <ProgressBar \r\n            show={this.props.showingProgressBar}\r\n            totalPagesAvailable={this.props.totalPagesAvailable}\r\n            totalPages={this.props.totalPages}\r\n          />\r\n        </div>\r\n        <div className=\"group-last-modified\">{lastModified }</div>\r\n\r\n        { this.props.showSaveButton && <div className=\"page-button-container \" ><SaveButton changesMade={this.props.changesMade} recentlySaved={this.props.recentlySaved} saving={this.props.saving} submitAnnotations={this.props.submitAnnotations}  /></div> }\r\n        <div className=\"page-button-container next-page\" title={latestGroup && !this.props.inSearchMode ? \"Finish annotating this page to move on to the next page.\" : \"\"}>\r\n          <button className={(latestGroup  ? \" disabled\" : (this.props.querying ? \"loading\" : \"\"))}  onClick={this.props.loadNextPage}>Next<i className=\"fa fa-chevron-right\"></i></button>\r\n        </div>              \r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default ControlBar;","import _ from 'underscore';\r\n\r\n// A class to store an annotation for a single token.\r\n// Seemed more logical to put all the annotation logic in one class rather than sticking it in the TaggingInterface component.\r\n// Each sentence will have one Annotation object per token.\r\n// Properties:\r\n/* \r\n   token: the token e.g. 'centrifugal'\r\n   tokenIndex: the index of the token in the sentence\r\n   bioTag: the BIO tag ('B', 'I' or 'O')\r\n   entityClasses: the array of entity classes AKA labels (e.g. ['Item', 'Item/Pump'])   \r\n   spanText: the text of the span that this annotation is within (e.g. 'centrifugal pump')\r\n   spanStartIdx: the start index of the span this annotation is in, e.g. 0 if it starts at the first word of the sentence\r\n   spanEndIdx: the end index as above, e.g. 1,\r\n*/\r\nclass Annotation {\r\n  constructor(token, tokenIndex) {\r\n    this.token = token;\r\n    this.tokenIndex = tokenIndex;\r\n    this.bioTag = \"O\";    \r\n    this.highlighting = null;\r\n  }\r\n\r\n  // Adds the specified entityClass to this annotation.\r\n  // bioTag: The bioTag, e.g. \"B\" or \"I\",\r\n  // entityClass: The entity class, e.g. \"Item/Pump\"\r\n  // text: The text of the span that this annotation is inside, e.g. \"centrifugal pump\".\r\n  // spanStartIdx, spanEndIdx: self explanatory (as above)\r\n  // nextAnnotation: The Annotation object for the next token in the sentence.\r\n  //                 When called during the dictionary annotation tagging, nextAnnotation is not necessary.\r\n  // Returns whether the label of this annotation was modified at all.\r\n  addLabel(bioTag, entityClass, spanText, spanStartIdx, spanEndIdx) {\r\n    \r\n    if(this.entityClasses === undefined) this.entityClasses = new Array();\r\n\r\n    var alreadyHasLabel = this.entityClasses.indexOf(entityClass) !== -1;\r\n    if(this.bioTag === bioTag && this.spanText === spanText && this.spanStartIdx === spanStartIdx && this.spanEndIdx === spanEndIdx && alreadyHasLabel) {\r\n      return false;\r\n    }\r\n\r\n    // Adjust the span.\r\n    this.bioTag = bioTag;\r\n    this.spanText = spanText;\r\n    this.spanStartIdx = spanStartIdx;\r\n    this.spanEndIdx = spanEndIdx;\r\n\r\n    // Add the entityClass to the entityClasses array for this Annotation.\r\n    // If it is already there, don't add it again.\r\n    if(!alreadyHasLabel) {\r\n      this.entityClasses.push(entityClass);\r\n    }\r\n    return true;\r\n  \r\n    // If the nextAnnotation is from the same mention (AKA span) as this one, and does not have exactly the same labels after\r\n    // the new class has been appended to this annotation's entityClasses, change its BIO tag to B.\r\n    // This is the part that ensures mentions are split up when the user changes the label of token(s) inside that mention.\r\n    // if(nextAnnotation) {\r\n    //   if(this.sameMention(nextAnnotation) && !this.sameEntityClasses(nextAnnotation) && nextAnnotation.hasLabel()) {\r\n    //     console.log(\"Changing bio tag to B\")\r\n    //     nextAnnotation.changeBioTag(\"B\");\r\n    //     nextAnnotation.setSpanStartIdx(spanEndIdx + 1)          \r\n    //   }\r\n    // }\r\n\r\n    // If the previous annotation is from the same mention as this one, and now no longer has the same labels,\r\n    // adjust the spanEndIdx to be the start of this new span -1.\r\n    // This ensures the tags are rendered correctly in the browser.\r\n    // Note that this seems to get called multiple times when applying tags because they are applied in reverse order,\r\n    // but the spanEndIdx will be set as below for the next annotation anyway so that shouldn't be an issue.\r\n    // if(prevAnnotation) {\r\n    //   if(this.sameMention(prevAnnotation) && !this.sameEntityClasses(prevAnnotation) && prevAnnotation.hasLabel()) {  \r\n    //     prevAnnotation.setSpanEndIdx(spanStartIdx - 1);\r\n    //   }\r\n    // }\r\n  }\r\n\r\n  // Removes all the labels from this annotation and resets the bioTag to \"O\".\r\n  removeAllLabels() {\r\n    delete this.entityClasses;\r\n    delete this.spanText;\r\n    delete this.spanStartIdx;\r\n    delete this.spanEndIdx;\r\n    this.bioTag = \"O\";\r\n  }\r\n\r\n  // Simple function to determine whether this annotation is in the same mention as another annotation.\r\n  sameMention(otherAnnotation) {\r\n    return otherAnnotation.spanStartIdx === this.spanStartIdx && otherAnnotation.spanEndIdx === this.spanEndIdx;\r\n  }\r\n\r\n  // Determine whether this annotation has the same labels as another annotation.\r\n  sameEntityClasses(otherAnnotation) {\r\n    return _.isEqual(this.entityClasses, otherAnnotation.entityClasses);\r\n  }\r\n\r\n  // Removes a specific label from this annotation.\r\n  // If it was the last label, reset this annotation's bioTag to \"O\" and delete the entityClasses and other properties.\r\n  removeLabel(entityClass) {\r\n    var index = this.entityClasses.indexOf(entityClass);\r\n    if(index === -1) {\r\n      console.log(\"Warning: tried to remove an entity class from an annotation that did not exist.\")\r\n      return;\r\n    }\r\n    this.entityClasses.splice(index, 1);\r\n    if(this.entityClasses.length === 0) {\r\n      this.bioTag = \"O\";\r\n      delete this.entityClasses;\r\n      delete this.spanText;\r\n      delete this.spanStartIdx;\r\n      delete this.spanEndIdx;\r\n    }\r\n  }\r\n\r\n  // Change the bio tag of this annotation to another bio tag.\r\n  changeBioTag(bioTag) {\r\n    this.bioTag = bioTag;\r\n  }\r\n\r\n  // Returns whether this annotations has a label.\r\n  hasLabel() {\r\n    return this.bioTag !== \"O\";\r\n  }\r\n\r\n  // Determines whether this annotation is the last of its type in the given span.\r\n  isLastInSpan() {\r\n    return this.spanEndIdx === this.tokenIndex;\r\n  }\r\n\r\n  setSpanStartIdx(spanStartIdx) {\r\n    this.spanStartIdx = spanStartIdx;\r\n  }\r\n\r\n  setSpanEndIdx(spanEndIdx) {\r\n    this.spanEndIdx = spanEndIdx;\r\n  }\r\n\r\n  // Set the highlighting array (for search mode).\r\n  setHighlighting(startIdx, endIdx) {\r\n    this.highlighting = [startIdx, endIdx];\r\n  }\r\n\r\n  // Prints this annotation nicely to the console (for debugging).\r\n  prettyPrint() {\r\n    console.log(\"Token:    \", this.token);\r\n    console.log(\"BIO Tag:  \", this.bioTag)\r\n    console.log(\"Span:     \", this.spanText)\r\n    console.log(\"StartIdx: \", this.spanStartIdx)\r\n    console.log(\"EndIdx: \", this.spanEndIdx)\r\n    console.log(\"Classes:  \\n\", this.entityClasses);\r\n    console.log('\\n');\r\n  }\r\n}\r\n\r\n\r\nexport default Annotation;","import Annotation from './Annotation';\r\n\r\n// Sets up an array to store the annotations with the same length as docGroup.\r\n// Prepopulate the annotations array with the automaticAnnotations if available (after converting them to BIO).\r\n// This could be either the dictionary-based annotations or the annotations that the user has previously entered.\r\n//\r\n// oneDocument = whether this is only being passed one doc but multiple annotations i.e. curation interface\r\nfunction initAnnotationsArray(documents, automaticAnnotations, searchTerm, oneDocument) {\r\n\r\n\r\n  console.log(documents)\r\n  console.log(automaticAnnotations);\r\n  console.log('---')\r\n\r\n  var repeatedDocs = new Array();\r\n  if(oneDocument) {\r\n    for(var i in automaticAnnotations) {\r\n      repeatedDocs.push(documents[0]);\r\n    }\r\n    documents = repeatedDocs;\r\n  }\r\n\r\n  if(searchTerm) {\r\n    var searchTermArray = searchTerm.split(' ');\r\n  }\r\n\r\n  //console.log(documents, \"<\");\r\n  //console.log(automaticAnnotations, \"<\");\r\n\r\n  var annotations = new Array(documents.length);\r\n  for(var doc_idx in documents) {\r\n    annotations[doc_idx] = new Array(documents[doc_idx].length);\r\n\r\n\r\n    var searchIdx = 0;\r\n    for(var token_idx in documents[doc_idx]) {\r\n      annotations[doc_idx][token_idx] = new Annotation(documents[doc_idx][token_idx], parseInt(token_idx));\r\n\r\n      // If a search term is present (i.e. user is in search mode), adjust the highlighting of the annotation\r\n      // so that it displays the searched portion of the token differently        \r\n      if(searchTerm) {\r\n        var token = documents[doc_idx][token_idx];\r\n        var foundIdx = token.indexOf(searchTermArray[searchIdx]);\r\n        if(foundIdx >= 0) {\r\n          annotations[doc_idx][token_idx].setHighlighting(foundIdx, foundIdx + searchTermArray[searchIdx].length - 1);\r\n          searchIdx++;\r\n        } else {\r\n          searchIdx = 0;\r\n        }        \r\n      }\r\n    }\r\n\r\n    \r\n  }\r\n\r\n  if(!automaticAnnotations) return annotations;\r\n\r\n  //console.log(this.state.documents, \"<\")\r\n\r\n  // Load annotations from the automaticAnnotations array if present.\r\n  for(var doc_idx in automaticAnnotations) {\r\n    if(!automaticAnnotations[doc_idx]) continue;\r\n    for(var mention_idx in automaticAnnotations[doc_idx]['mentions']) {\r\n\r\n\r\n      var mention = automaticAnnotations[doc_idx]['mentions'][mention_idx];\r\n      var start = mention['start'];\r\n      var end = mention['end'];\r\n\r\n      for(var label_idx in mention['labels']) {\r\n        var label = mention['labels'][label_idx];\r\n\r\n        for(var k = start; k < end; k++) {\r\n          var bioTag = k === start ? 'B' : \"I\";\r\n\r\n          //console.log(annotations[doc_idx], k, automaticAnnotations[doc_idx]['mentions'])\r\n          annotations[doc_idx][k].addLabel(bioTag, label, documents[doc_idx].slice(start, end).join(' '), start, end - 1)\r\n\r\n\r\n        }\r\n      }\r\n    }        \r\n  }\r\n  return annotations;\r\n}\r\n\r\nexport default initAnnotationsArray;","import React from \"react\";\r\nimport {Component} from \"react\";\r\n\r\nclass Error403Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <main class=\"error-page\">\r\n        <h1>403: Access denied.</h1>\r\n        <p>You do not have permission to access the requested page.</p>\r\n      </main>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Error403Page","import React from 'react';\n\nimport redcoatMan from '../redcoat-1-threshold.png';\nimport {Component} from 'react';\nimport $ from 'jquery';\nimport { findDOMNode } from 'react-dom';\nimport { Link } from 'react-router-dom'\n\n//const ReactDragListView = require('react-drag-listview');\n\nimport _ from 'underscore';\n\nimport html2canvas from 'html2canvas';\nimport { saveAs } from 'file-saver';\nimport domtoimage from 'dom-to-image';\n\nimport CategoryHierarchy from '../components/CategoryHierarchy';\nimport {Word, Sentence} from '../components/tagging_interface/documentComponents';\n\nimport {Comment, CommentInput} from '../components/Comment';\nimport ControlBar from '../components/ControlBar';\n\nimport getCookie from '../functions/getCookie';\n\nimport formatDate  from '../functions/formatDate';\n\nimport initAnnotationsArray from '../functions/tagging_interface/initAnnotationsArray';\nimport Annotation from '../functions/tagging_interface/Annotation';\nimport Error403Page from '../pages/Error403Page';\nimport Error404Page from '../pages/Error404Page';\n\n\nconst BASE_URL = \"/\"\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }\n};\n\n\n// https://stackoverflow.com/questions/3169786/clear-text-selection-with-javascript\nfunction clearWindowSelection() {\n  if (window.getSelection) {\n    if (window.getSelection().empty) {  // Chrome\n      window.getSelection().empty();\n    } else if (window.getSelection().removeAllRanges) {  // Firefox\n      window.getSelection().removeAllRanges();\n    }\n  } else if (document.selection) {  // IE?\n    document.selection.empty();\n  }\n}\n\n\n\n\n\n\n\n\n\n// A single confidence button, which may have the value 'low' 'medium' or 'high'.\nclass ConfidenceButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    var docIdx = this.props.docIdx;\n    var value = this.props.value;\n    return (\n      <span className={\"confidence-button conf-\" + value + (this.props.checked ? \" checked\" : \"\")}\n            onClick={() => this.props.updateConfidence(docIdx, value)} title={\"Assign a \" + value + \" confidence to this document.\"} ></span>\n    )\n  }\n}\n\n\nclass ConfidenceButtons extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className={\"confidence-buttons\"}>\n        <ConfidenceButton value=\"low\"    checked={this.props.confidence === \"low\"} { ...this.props }/>\n        <ConfidenceButton value=\"medium\" checked={this.props.confidence === \"medium\"} { ...this.props }/>\n        <ConfidenceButton value=\"high\"   checked={this.props.confidence === \"high\"} { ...this.props }/>        \n      </div>\n    )\n  }\n}\n\n\n// The document container header, which appears at the top of the sentence tagging page.\nclass DocumentContainerHeader extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    return (\n      <div className=\"document-container header\">\n        <div className=\"document header\">\n          <div className=\"sentence-index\"></div>\n          <div className=\"sentence\">Document</div>\n          <div className=\"confidence-buttons\">Confidence</div>\n        </div>\n      </div>\n    )\n  }\n}\n\n// A document container, which contains the sentence index (on the left), the sentence, and the confidence buttons.\nclass DocumentContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      commentsOpen: false,\n      // windowMouseDownFn: null,\n    }\n    this.sentenceRef = React.createRef();\n    this.documentUnderneathRef = React.createRef(); // The reference for the grey area underneath the doc\n    this.commentBoxRef = React.createRef();\n  }\n\n\n  // Close the comment box when changing doc groups.\n  componentDidUpdate(prevProps, prevState) {\n    if(!_.isEqual(prevProps.words, this.props.words) && this.state.commentsOpen) {\n      this.setState({\n        commentsOpen: false,\n      })\n    }\n  }\n\n  // closeCommentBox(e) {\n  //   if(this.documentUnderneathRef.current && this.documentUnderneathRef.current.contains(e.target)) return;\n  //   this.setState({\n  //     commentsOpen: false,\n  //   })\n  // }\n\n  // Opens or closes the comments.\n  // Binds the mouse down function on the window if opening the comment box.\n  toggleOpenComments() {\n\n\n    // var windowMouseDownFn = (e) => this.closeCommentBox(e);\n    \n    // Remove the old event listeners.\n    // window.removeEventListener('mousedown', this.state.windowMouseDownFn);\n    // window.addEventListener('mousedown', windowMouseDownFn);\n\n    this.setState({\n      // windowMouseDownFn: windowMouseDownFn,\n      commentsOpen: !this.state.commentsOpen,\n    }, () => {\n    });\n  }\n\n  // Saves this sentence to a PNG file. wow!\n  saveToPng() {\n    var t = this;\n    var node = this.sentenceRef.current;\n\n    function filter(node) {\n      if(node.classList) {\n        return !node.classList.contains('sentence-index') && !node.classList.contains('confidence-buttons');\n      }\n      return node;\n    }\n\n    domtoimage.toBlob(node, {bgcolor: '#fefefe'})\n    .then(function(blob) {\n      saveAs(blob, \"document-\" + t.props.index + \".png\"); \n    });\n\n  }\n\n  submitComment(message, next) {\n    var t = this;\n    this.props.submitComment(message, this.props.index, () => {\n      next();\n      t.commentBoxRef.current.scrollTop = t.commentBoxRef.current.scrollHeight;\n    });\n  }\n\n  render() {\n\n\n\n    return (\n      <div className={\"document-container\" + (this.props.confidence ? \" conf conf-\" + this.props.confidence : \"\")}>\n\n        <div className=\"document-wrapper\">\n          <div className=\"document\">\n            <div className=\"sentence-index\"><span className=\"inner\">{this.props.displayIndex}</span></div>\n            <div className=\"sentence\" ref={this.sentenceRef}>\n              <Sentence \n                index={this.props.index}\n                words={this.props.words}              \n                annotations={this.props.annotations}  \n                selections={this.props.selections}\n                updateSelections={this.props.updateSelections}\n                entityColourMap={this.props.entityColourMap}\n                deleteTag={this.props.deleteTag}\n              />\n            </div>\n            <ConfidenceButtons docIdx={this.props.index} confidence={this.props.confidence} updateConfidence={this.props.updateConfidence}/>\n          </div>\n\n\n\n          <div className={\"document document-underneath\" + (this.state.commentsOpen ? \" open\" : \"\")} ref={this.documentUnderneathRef}>\n            <div className=\"sentence-index\"></div>\n            <div className=\"sentence\">\n\n              <div className=\"bottom-buttons\">\n            \n            \n                <div className={\"open-comments-button\" + (this.props.comments.length > 0 ? \" has-comment\" : \"\")}>\n                  <span className=\"inner\" onClick={this.toggleOpenComments.bind(this)}>\n                    <i className=\"fa fa-comment\"></i>\n                    <span className=\"num-comments\">{this.props.comments.length}</span>\n                  </span>            \n                </div> \n\n                <div className=\"save-to-png\" onClick={this.saveToPng.bind(this)} title=\"Click to download a .png file of this document\"><span className=\"inner\"><i className=\"fa fa-download\"></i></span>\n                </div>     \n              </div>\n\n\n\n              { this.props.user && \n                <div className=\"comments-wrapper\">\n                  <div className=\"comments-inner\">\n                    <div className=\"comments-even-more-inner\" ref={this.commentBoxRef}>\n                      { this.props.comments.map((comment, i) => <Comment index={i} {...comment} hideDocumentString={true} />) }\n                    </div>\n                    <CommentInput user_profile_icon={this.props.user.profile_icon} submitComment={this.submitComment.bind(this)}/>\n\n                  </div>\n                </div>\n              }\n            </div>\n            <div className=\"confidence-buttons\"></div>\n\n          </div>\n\n\n\n        </div>\n      </div>\n    )\n  }\n\n}\n\n\n\n\n// A simple function for traversing a list of nodes. Goes with the function below.\n// Both functions found on StackOverflow: https://stackoverflow.com/questions/7781963/js-get-array-of-all-selected-nodes-in-contenteditable-div\nfunction nextNode(node) {\n    if (node.hasChildNodes()) {\n        return node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n          node = node.parentNode;\n      }\n      if (!node) {\n          return null;\n      }\n      return node.nextSibling;\n    }\n}\n\n// A function for traversing the nodes present in the range object, which allows us to determine all html nodes\n// corresponding to selected items (items in which part of them are highlighted).\n// Note that you can't see the highlighted text on the screen because it has been hidden by css.\nfunction getRangeSelectedNodes(range) {\n    var node = range.startContainer;\n    var endNode = range.endContainer;\n\n    // Special case for a range that is contained within a single node\n    if (node == endNode) {\n        return [node.parentNode];\n    }\n\n    // Iterate nodes until we hit the end container\n    var rangeNodes = [];\n    while (node && node != endNode) {\n        rangeNodes.push( node = nextNode(node) );\n    }\n\n    // Add partially selected nodes at the start of the range\n    node = range.startContainer;\n    while (node && node != range.commonAncestorContainer) {\n        rangeNodes.unshift(node);\n        node = node.parentNode;\n    }\n\n    return rangeNodes;\n}\n\n\n// A simple class for displaying information related to the hotkeys the user is currently pressing.\nclass HotkeyInfo extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    var ec = this.props.entityClass;\n    if(ec === undefined) {\n      ec = '(not a valid class)';\n    }\n\n    return (\n      <div className={\"hotkey-info\" + (this.props.chain.length === 0 ? \" hidden\": \"\")}>\n        <span className=\"chain\">{this.props.chain}</span>: <span>{ec}</span>\n      </div>\n    )\n\n  }\n}\n\n\n\n// A debug printing function for printing out a list of annotations for a document.\nfunction prettyPrintAnnotations(documentAnnotations) {\n  console.log(\"Annotations:\\n\")\n  console.log(\"=====================\")  \n  for(var token_idx in documentAnnotations) {\n    documentAnnotations[token_idx].prettyPrint();\n  }\n}\n\n// The Wikipedia summary container, at the top-left.\nclass WikipediaSummary extends Component {\n\n  _isMounted = false;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: true,\n      querying: false, // Currently in the middle of a query\n      wikipediaSummary: null,\n      wikipediaReadMoreUrl: null,\n    }\n\n  }\n\n\n  queryWikipedia() {\n    if(this.state.querying) return; // Don't query multiple things at once\n\n    var tokens = this.props.tokens;\n\n    // Query Wikipedia for the currently selected tokens.\n    function runQuery(next) {\n\n      // Processes the result of a Wikipedia query.\n      function getResult(data, next) {\n        function stripTags(str) {\n          return str.replace(/<\\/?[^>]+(>|$)/g, \"\");\n        }\n        try {\n          var title = data.query.search[0].title;\n          var snippet = stripTags(data.query.search[0].snippet);\n          var wurl = \"https://en.wikipedia.org/wiki/\" + data.query.search[0].title.replace(/ /g, '_');\n          return next(title, snippet, wurl);\n        } catch(err) {\n          next();\n        }\n      }\n      $.ajax({\n        url: 'https://en.wikipedia.org/w/api.php',\n        data: { action: 'query', list: 'search', srsearch: tokens, format: 'json' },\n        dataType: 'jsonp',\n        success: function(data) {\n          getResult(data, next);\n        }\n      });\n    } \n\n    this.setState({\n      querying: true\n    }, () => {\n      var wikipediaSummary, wikipediaReadMoreUrl;\n      var t = this;\n\n      runQuery(function(title, snippet, wurl) {\n        if(!t._isMounted) return;\n\n\n        var wikipediaTitle = tokens;\n        if(snippet) {        \n          if(title.toLowerCase() !== tokens.toLowerCase()) {\n            wikipediaTitle = title;\n          }\n          wikipediaSummary = snippet + \"...\";\n          wikipediaReadMoreUrl = wurl;\n        } else {\n          wikipediaReadMoreUrl = null;\n          wikipediaSummary = null;  \n        }      \n\n        t.setState({\n          wikipediaTitle: wikipediaTitle,\n          wikipediaSummary: wikipediaSummary,\n          wikipediaReadMoreUrl: wikipediaReadMoreUrl,\n          querying: false,\n        })  \n      });\n\n    });\n  }\n\n\n  // Ensure API calls to Wikipedia aren't being made while this component is not mounted.\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  toggleVisibility() {\n    this.setState({\n      visible: !this.state.visible\n    })\n  }\n\n\n  componentDidUpdate(prevProps, prevState) {\n    if(prevProps.tokens !== this.props.tokens) {\n      this.queryWikipedia();\n    }\n  }\n\n  render() {    \n\n    if(!this.state.querying && this.state.wikipediaTitle && this.state.wikipediaTitle !== this.props.tokens) {\n      var title = <span className=\"different\">[{this.state.wikipediaTitle}] </span>\n    } else {\n      title = '';\n    }\n\n    var summary = this.state.wikipediaSummary ? this.state.wikipediaSummary : \"(no Wikipedia entry)\";\n    if(!this.props.tokens) {\n      summary = \"Select one or more words to automatically look them up on Wikipedia.\";\n    }\n    if(this.state.querying) {\n      summary = <span><i className=\"fa fa-spin fa-cog\"></i>&nbsp;&nbsp;Loading...</span>\n    }\n\n    // Rendering is a bit awkward, this could be tidied up\n    return (\n      <div className=\"tokens-info\">\n        <div id=\"wikipedia-summary-container\" className={this.state.visible ? \"show\" : \"hidden\"}>\n          <p className=\"tokens\">{this.props.tokens || 'Wikipedia lookup'}</p>\n          <p className=\"summary\">{ title }{ summary }</p>\n          <span className=\"more show\">\n            {(this.state.querying || !this.props.tokens) && <span className=\"left\" style={{\"color\": \"rgba(0, 0, 0, 0)\"}}>.</span>}\n            {!this.state.querying && this.props.tokens && <span className=\"left\">Results from Wikipedia</span>}\n            <span className=\"right\">\n              { !this.state.querying && this.props.tokens && <a id=\"ec-read-more\" href={this.state.wikipediaReadMoreUrl} target=\"_blank\">Read more <i className=\"fa fa-sm fa-external-link\"></i></a> } \n            </span>\n          </span>\n        </div>\n        <button id=\"wikipedia-hide-show\" className={this.state.visible ? \"up\" : \"down\"} onClick={this.toggleVisibility.bind(this)}>Show</button>\n      </div>\n    )\n  }\n}\n\n// The TaggingInterface class. Contains the vast majority of the logic for the interface.\nclass TaggingInterface extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // Data (from the server)\n      // The data in this object is only changed by calling the queryAPI method.\n      // data: {\n      //   documentGroup: [],\n      //   documentIds:   [],\n      //   categoryHierarchy: {'children': []},\n      //   pageNumber: -1,\n      //   annotatedDocGroups: -1,\n      //   username: \"\",\n      // },\n\n      documentGroupAnnotationId: null, // The ID of the document group annotation object related to the document group the user is currently\n                                       // looking at. Will be null if the doc group has not been annotated by the user yet.\n                                       // Will be set when querying the API (for a previously annotated document group) or when\n                                       // submitting the annotations of a document group via submitAnnotations().\n\n\n      documents:   [],    // Stores the current documents\n      documentIds: [],    // Stores the Mongo IDs of the current documents,\n\n      documentAnnotationIds: [],    // Stores the Mongo IDs of the current document annotations (if they exist already)\n\n      categoryHierarchy: {'children': []},  // Stores the category hierarchy\n\n\n\n      annotations: [],  // Stores the user's annotations.\n      confidences: [],  // Stores the user's confidences.\n      comments:    [],  // Stores the comments (made by any user)\n\n\n      \n\n      // Selections\n      selections: this.getEmptySelectionsArray(10),       // The selections is an array containing a sub-array for each document,\n                                                          // which in turn hold all of the current selections made by the user for that\n                                                          // document.\n      currentSelection: this.getEmptyCurrentSelection(),  // The current selection is for when the user clicks a word and is in the process\n                                                          // of selecting an end word. \n      mostRecentSelectionText: null, // Keeps track of the tokens that the user most recently selected (for Wikipedia querying)\n      // Hotkeys\n      hotkeyMap: {},  // Stores a mapping of hotkey to number, e.g. 'item/pump': '11'.\n      reverseHotkeyMap: {}, // Stores the reverse of the above (number to hotkey), e.g. '11': 'item/pump'.\n      terminalHotkeys: new Set(),  // Stores the hotkeys of classes that are terminal, e.g. '1', '2' because Item and Activity do not have subclasses\n\n      hotkeyChain: [], // Stores the current hotkey chain, e.g. [1, 2, 3] = the user has pressed 1, then 2, then 3 in quick succession\n      hotkeyBindingFn: null,  // Stores the function that gets called via an eventlistener when a hotkey is pressed. Must be stored as a state\n                              // variable so that it can be detached when the hotkeys change.\n      hotkeyTimeoutFn: null,   // Stores the current hotkey timeout function.\n\n      // Key events\n      holdingCtrl: false, // Whether the user is currently holding the ctrl key.\n      holdingShift: false, // Whether the user is currently holding the shift key.\n\n      entityColourMap: {}, // A mapping of the top-level entity classes to a colour\n\n      docGroupLastModified: null, // Stores when the current document group was last saved.\n\n      pageNumber: -1, // The current page number the user is looking at.\n      totalPagesAvailable: -1, // The total number of pages available to the user, e.g. if they have annotated 1 group so far, then it's 2.\n\n      changesMade: false, // Stores whether the user has made any changes to the current document group.\n      recentlySaved: false, // Whether the doc group has been recently saved\n\n      selectionChangeFn: null,\n      windowMouseUpFn: null,\n\n      loading: {  // Stores whether this interface is currently requesting a docgroup from the server, or saving one\n        querying: true,\n        saving: false,\n        firstLoad: true,\n      },\n      showingProgressBar: false, // Whether the progress bar is currently visible\n\n      searchTerm: null, // Whether the user is currently searching for docs\n\n      docsPerPage: 10, // The number of docs per page, can be changed by the user\n\n      taggingCompletePage: false, // Set to true when the user is on the 'tagging complete' page.\n\n    }    \n  }\n\n\n\n  // When the user highlights text anywhere on the page, this function captures the event.\n  // If the user never selected a word to begin with, nothing happens.\n  // All it does is apply the 'highlighted' class onto any words that were caught in the highlighting.\n  // This function is purely stylistic, i.e. it doesn't affect any other components etc.\n  selectionChange(e, words) {\n    if(this.state.currentSelection.wordStartIndex < 0) {\n      return;\n    }\n    var sel = window.getSelection && window.getSelection();\n\n    if (sel && sel.rangeCount > 0) {\n      var r =  getRangeSelectedNodes(sel.getRangeAt(0));  \n      words.removeClass('highlighted');\n      $(r).find('.word-inner').addClass('highlighted');  \n    }\n  }\n\n  // When the user releases the mouse, remove all highlighting from words (i.e. the words in the selection).\n  // If the user never selected a word to begin with (i.e. wordStartIndex < 0), don't do anything.\n  windowMouseUp(e, words) {\n    if(e.target.classList.contains('page-input') || e.target.classList.contains('comment-input') || e.target.classList.contains('search-bar')) return;\n\n    words.removeClass('highlighted');\n    if(this.state.currentSelection.wordStartIndex < 0) {\n      //clearWindowSelection();\n      return;\n    }\n    if(!e.target.classList.contains('word-inner')) { // Ensure that the user is not hovering over a word            \n      var sentenceIndex = this.state.currentSelection.sentenceIndex;\n      this.updateSelections(sentenceIndex, this.state.documents[sentenceIndex].length - 1, 'up');\n    } \n  }\n\n  /* Mouse and keyboard events */\n\n  // Set up some mouse events - one for when text is selected (highlighted) in the browser.\n  // Note that in order to see the default browser highlighting the CSS file needs to be modified (it makes it invisible).\n  // Another for when the user releases the mouse anywhere on the page.\n  // Note that the majority of the mouse events are not in this function but are passed down to the Word elements via updateSelections.\n  // The event listeners need to be removed and reapplied to prevent duplication.\n  initMouseEvents() {\n\n    var words = $('.word-inner');\n\n    var selectionChangeFn = (e) => this.selectionChange(e, words);\n    var windowMouseUpFn = (e) => this.windowMouseUp(e, words);\n    \n    // Remove the old event listeners.\n    document.removeEventListener(\"selectionchange\", this.state.selectionChangeFn);   \n    window.removeEventListener('mouseup', this.state.windowMouseUpFn);\n\n    this.setState({\n      selectionChangeFn: selectionChangeFn,\n      windowMouseUpFn: windowMouseUpFn\n    }, () => {\n      // Add the new event listeners.\n      document.addEventListener(\"selectionchange\", this.state.selectionChangeFn);\n      window.addEventListener('mouseup', this.state.windowMouseUpFn);\n    });    \n  }\n\n  // Set up the key binds (ctrl, shift, left right up down etc).\n  // This function does not set up the hotkeys (that is done via setupHotkeyKeybinds)\n  initKeybinds() {\n\n    document.addEventListener('keydown', (e) => {\n      switch(e.key) {\n        case 'Shift':       if(!this.state.holdingShift) this.setState({ holdingShift: true }); break;\n        case 'Control':     if(!this.state.holdingCtrl) this.setState({ holdingCtrl: true }); break;\n\n        // For the arrows, call e.preventDefault() to prevent the window from scrolling\n        case 'ArrowLeft':   e.preventDefault(); this.moveSelectionHorizontally('left'); break; \n        case 'ArrowUp':     e.preventDefault(); this.moveSelectionVertically('up'); break;\n        case 'ArrowRight':  e.preventDefault(); this.moveSelectionHorizontally('right'); break;\n        case 'ArrowDown':   e.preventDefault(); this.moveSelectionVertically('down'); break;\n      }\n    });\n\n    document.addEventListener('keyup', (e) => {\n      switch(e.key) {\n        case 'Shift':   if(this.state.holdingShift) this.setState({ holdingShift: false }); break;\n        case 'Control': if(this.state.holdingCtrl) this.setState({ holdingCtrl: false }); break;\n      }      \n    });\n  }\n\n\n\n  /* Hotkey functions */\n\n  // When the user has pressed a hotkey that is not quickly followed up with another hotkey, this function is called.\n  // Apply the corresponding entity class and reset the hotkey chain.\n  hotkeyTimeout() {\n    var hotkeyChainStr = this.state.hotkeyChain.join('');\n\n    var entityClass = this.state.reverseHotkeyMap[hotkeyChainStr];\n    if(entityClass !== undefined) this.applyTag(entityClass);\n\n    // Clear the existing hotkey timeout fn.\n    window.clearTimeout(this.state.hotkeyTimeoutFn);\n    this.setState({\n      hotkeyTimeoutFn: null,      \n      hotkeyChain: [],\n    })\n  }\n\n  // This function is called when a hotkey is pressed.\n  // If a hotkey was pressed previously within 333ms, the chain will grow until the point the user no longer presses a hotkey\n  // for 333ms.\n  bindHotkeys(e, hotkeyMap) {\n    if(e.keyCode < 49 || e.keyCode > 57) return; // Hotkeys are in the range 1-9, which are keyCode 49-57.\n    var key = e.keyCode - 48;\n\n    // If user is currently focused on the page input, do nothing.\n    if($(\"#page-input\").is(\":focus\")) return;\n    if($(\"textarea\").is(\":focus\")) return;\n\n    // Update the hotkey chain to include the key that was pressed\n    var hotkeyChain = Array.prototype.concat(this.state.hotkeyChain, key);\n    this.setState({\n      hotkeyChain: hotkeyChain\n    }, () => {\n\n      // Remove the previous timeout and set up a new one\n      window.clearTimeout(this.state.hotkeyTimeoutFn);\n\n\n\n      // Check if hotkey was terminal, i.e. at the leaf of the tree\n      if(this.state.terminalHotkeys.has(hotkeyChain.join(''))) {\n        this.hotkeyTimeout();\n      } else {\n        var hotkeyTimeoutFn = window.setTimeout(() => this.hotkeyTimeout(), 333);\n        this.setState({\n          hotkeyTimeoutFn: hotkeyTimeoutFn\n        });\n      }\n\n            \n      \n    });\n  }\n\n  // Assign keybinds to each of the hotkeys in the hotkey map.\n  setupHotkeyKeybinds() {\n    \n    console.log(\"Setting up hotkey keybinds...\")\n\n    console.log(this.state.reverseHotkeyMap);\n\n    // Clear the current hotkey binding function and set up a new one.\n    document.removeEventListener('keydown', this.state.hotkeyBindingFn);\n    var hotkeyBindingFn = (e) => this.bindHotkeys(e, this.state.hotkeyMap);\n\n    document.addEventListener('keydown', hotkeyBindingFn);\n\n    // Store the binding function in this.state so that it can be removed in subsequent calls of this function.\n    this.setState({\n      hotkeyBindingFn: hotkeyBindingFn,\n    });\n  }\n\n  // Builds the hotkey map according to the ordered category hierarchy, and saves it to this component's state.\n  // The hotkey map will change whenever the user changes the order of them items via drag and drop.\n  initHotkeyMap(orderedItems, next) {\n\n    console.log(\"Setting up hotkey map...\")\n    // Annoying that the following is a recursive function but I think it's the only way to do it.\n    // The result is a hotkeyMap as follows:\n    /*  {\n          'item': [1],\n          'item/pump': [1, 1],\n          'item/pump/centrifugal_pump': [1, 1, 1],\n          'item/pump/big_pump': [1, 1, 2],\n          'item/compressor': [1, 2],\n          'activity': [2]\n        }\n    */\n    function traverseChild(child, index, hotkeyMap, hotkeys, terminalHotkeys, firstPass) {\n      if(!firstPass) {\n        hotkeyMap[child.full_name] = hotkeys;\n      }\n      if(child.children) {\n        for(var i = 0; i < Math.min(9, child.children.length); i++) { // Don't go past index 9 so that the hotkeys make sense\n          traverseChild(child.children[i], i + 1, hotkeyMap, Array.prototype.concat(hotkeys, i + 1), terminalHotkeys);\n        }\n      } else {\n        terminalHotkeys.add(hotkeys.join(''));\n      }\n      return {hotkeyMap: hotkeyMap, terminalHotkeys: terminalHotkeys};          \n    }    \n\n    // Build the reverse of the hotkeyMap, i.e. swap the keys with the values.\n    // This assists with the hotkey bindings function.\n    function buildReverseHotkeyMap(hotkeyMap) {\n      var reverseHotkeyMap = {};\n      for(var key in hotkeyMap){\n        var val = hotkeyMap[key].join('');\n        reverseHotkeyMap[val] = key;\n      }\n      return reverseHotkeyMap;    \n    }\n\n\n    var d = traverseChild({children: orderedItems}, 1, [], [], new Set(), true);\n    var hotkeyMap = d.hotkeyMap;\n    var terminalHotkeys = d.terminalHotkeys;\n    var reverseHotkeyMap = buildReverseHotkeyMap(hotkeyMap);\n\n    // Once the hotkeyMap (and reverseHotkeyMap) has been created, set up the hotkey keybinds and call the callback fn.\n    this.setState({\n      hotkeyMap: hotkeyMap,\n      reverseHotkeyMap: reverseHotkeyMap,\n      terminalHotkeys: terminalHotkeys,\n    }, () => { this.setupHotkeyKeybinds(); if(next) next(); });\n  }\n\n\n  \n\n  // Initialise the confidences array.\n  initConfidencesArray(documents) {\n    var confidences = new Array(documents.length);\n    return confidences;\n  }\n\n  // Initialise the entity colour map, which maps entity_class: colour_index, e.g. \"Item\": 1. Passed to the Word components to colour\n  // their labels accordingly.\n  initEntityColourMap(categoryHierarchy) {\n    var entityColourMap = {}\n    for(var ec_idx in categoryHierarchy) {\n      var entityClass = categoryHierarchy[ec_idx];\n      entityColourMap[entityClass.name] = entityClass.colorId + 1;\n    }\n    return entityColourMap;\n  }\n\n\n  /* Miscellaneous */\n\n  // Justify the words to the nearest 25px (i.e. round their width up to the nearest 25px).\n  // Not really necessary but makes the diagonal stripey lines line up properly when multiple tokens are selected.\n  // I spent about 2 hours trying to figure out how to get the stripey lines to line up properly, this is the result :D\n  justifyWords() {\n    $('.word-inner').each((i, ele) => {\n      var width = ele.offsetWidth;\n      var newWidth = Math.ceil(width / 25) * 25;\n      $(ele).css('min-width', newWidth + 'px');\n    });\n  }\n\n  // Remove min-width from words that do not have a tag\n  // (necessary to call between pages)\n  clearWordJustification() {\n    $('.word:not(.tag) .word-inner').each((i, ele) => {\n       $(ele).css('min-width', 'auto');\n    })\n  }\n\n  // Load the next page by calling the API.\n  // Query without a page number (i.e. request the latest group)\n  // if the user is looking at the group before the latest group.\n  //\n  // TODO: Make it so that when the user has made a change to the group they're looking at,\n  // pop up a confirmation window to confirm their changes before loading the next page?\n  loadNextPage() {\n    if(this.state.loading.querying) return; // Don't load new page if currently loading\n    var nextPageNumber = this.state.pageNumber + 1;\n\n    if(nextPageNumber === (this.state.totalPagesAvailable)  && !this.state.searchTerm) {\n      this.queryAPI(false);\n    } else {\n      this.queryAPI(false, nextPageNumber);\n    }\n  }\n\n  goToPage(pageNumber) {\n    if(this.state.loading.querying) return; // Don't load new page if currently loading\n    \n    console.log(pageNumber);\n    if(this.state.searchTerm) {\n      this.queryAPI(false, pageNumber);\n      return;\n    }\n\n    if(pageNumber === this.state.totalPagesAvailable) {\n      this.queryAPI(false);\n    } else {\n      this.queryAPI(false, pageNumber);\n    }\n  }\n\n  // Load the previous page by calling the API.\n  loadPreviousPage() {\n    this.queryAPI(false, this.state.pageNumber - 1);\n  }\n\n  // Search all documents for a specific search term.\n  searchDocuments(searchTerm) {\n    this.setState({\n      searchTerm: searchTerm \n    }, () => {\n      if(searchTerm) {\n        this.queryAPI(false, 1);\n      } else {\n        this.queryAPI(false);\n      }\n      \n    });   \n  }\n\n  setDocsPerPage(e) {\n\n    var docsPerPage = e.target.value;\n    var pageNumber = this.state.pageNumber;\n    var prevDocsPerPage = this.state.docsPerPage;\n\n    // Load the page roughly resembling the position the user is currently in by doing some maths on the page number\n    var newPageNumber = Math.min(this.state.totalPagesAvailable + 1, Math.floor(pageNumber / docsPerPage * prevDocsPerPage));\n    if(newPageNumber === this.state.totalPagesAvailable + 1) {\n      newPageNumber = null;\n    }\n\n    this.setState({\n      docsPerPage: docsPerPage,\n    }, () => {\n      //if(this.state.searchTerm) {\n      this.queryAPI(false, newPageNumber);\n      //} else {\n      //  this.queryAPI(false, newPageNumber);\n      //}\n    })\n  }\n\n  /* API calls */\n\n  queryAPI(firstLoad, pageNumber) {\n\n    var route;\n    var searchTerm = this.state.searchTerm;\n\n    // If this function was called with a pageNumber, load a specific documentGroupAnnotation.\n    if(pageNumber) {\n      //route = 'getPreviouslyAnnotatedDocumentGroup?pageNumber=' + pageNumber + \"&perPage=20\";\n      route = 'getDocumentGroup?pageNumber=' + pageNumber + '&perPage=' + this.state.docsPerPage;\n    } else {\n      route = 'getDocumentGroup?pageNumber=latest&perPage=' + this.state.docsPerPage;\n    }\n    if(searchTerm) {\n      route += \"&searchTerm=\" + searchTerm;\n    }\n\n\n\n    this.setState({\n      loading: {\n        querying: true,\n        saving: false,\n        firstLoad: firstLoad,\n      }\n    }, function() {\n      fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/tagging/' + route, fetchConfigGET) // TODO: move localhost out\n        .then((response) => {\n          if(response.status === 403) {\n            throw new Error(403);\n          } else if(response.status === 404) {\n            throw new Error(404);\n          }           \n          return response.text()\n        })\n        .then((data) => {\n          //console.log(\"data:\", data);\n          try { \n            var d = JSON.parse(data);\n          } catch(err) {\n            alert(err);\n            return;\n          }\n\n\n          if(d.tagging_complete) {\n            //console.log(d);\n            this.setState({\n              taggingCompletePage: true,\n\n              pageNumber: d.pageNumber,\n              totalPages: d.totalPages,\n              totalPagesAvailable: d.totalPagesAvailable + 1,\n\n              changesMade: false,\n              recentlySaved: false,\n\n              loading: {\n                querying: false,\n                saving: false,\n              },\n            })\n            console.log(d)\n            return;\n          } \n\n          \n          this.setState(\n            {\n\n              data: d,\n              \n              documents:   d.documents,\n              documentIds: d.documentIds,\n\n              documentAnnotationIds: d.documentAnnotationIds ? d.documentAnnotationIds : null, // Will only be present when querying existing annotations\n\n              confidences: this.initConfidencesArray(d.documents),\n              annotations: initAnnotationsArray(d.documents, d.automaticAnnotations),\n\n              comments:    d.comments,\n\n              categoryHierarchy: d.categoryHierarchy,\n\n              entityColourMap: this.initEntityColourMap(d.categoryHierarchy.children),\n              \n              selections: this.getEmptySelectionsArray(d.documents.length),\n              mostRecentSelectionText: null,\n\n              pageNumber: d.pageNumber,\n              totalPages: d.totalPages,\n              totalPagesAvailable: d.totalPagesAvailable,\n\n              docGroupLastModified: d.lastModified,\n              documentGroupAnnotationId: d.documentGroupAnnotationId, // Will be null if this doc group has not yet been annotated\n\n              changesMade: false,\n              recentlySaved: false,\n              loading: {\n                querying: false,\n                saving: false\n              },     \n              taggingCompletePage: false,         \n            }, () => { \n\n              if(d.projectTitle && d.projectAuthor) {\n                this.props.setProject(d.projectTitle, d.projectAuthor)\n              }\n\n              // Initialise keybinds and mouse events only on the first API call.\n              if(firstLoad) {\n                this.initKeybinds();              \n                this.initHotkeyMap(this.state.categoryHierarchy.children);   \n              }\n\n              this.initMouseEvents();\n              this.clearWordJustification();    \n              this.justifyWords();    \n              this.selectFirstWord();\n\n\n              window.scrollTo(0, 0);\n            })\n        }).catch((err) => {\n          console.log(err.message);\n\n          this.setState({\n            error: parseInt(err.message)\n          })\n\n        });\n        \n\n    }.bind(this));\n  }\n\n  // Convert the annotations array into JSON.\n  annotationsToJSON() {\n    var annotations = this.state.annotations;\n    var annotationsJSON = [];\n    for(var doc_idx in annotations) {\n        \n      var docLabels = [];\n      for(var token_idx in annotations[doc_idx]) {\n        var ann = annotations[doc_idx][token_idx];\n        if(ann.entityClasses) {\n          docLabels.push([ann.bioTag + \"-\", ann.entityClasses]);\n        } else {\n          docLabels.push([\"\"])\n        }\n      }\n      annotationsJSON.push(docLabels);\n    }\n    return annotationsJSON;\n  }\n\n\n  // Submit the annotations of the document group that the user is currently looking at.\n  // TODO: Maybe make it so that you can't save the annoations until the user has put all their confidences in?\n  // Or perhaps do a check and pop a confirmation window up if they click save without doing anything to >= 1 document\n  submitAnnotations() {\n    if(this.state.recentlySaved) { return; } // If the user clicks on the green save button, provide them with the illusion that it is doing\n                                             // something when in fact nothing actually happens. Prevents people from spam clicking the save and\n                                             // calling the API 5000 times...\n                                             // It's kind of like how google sheets allows you to press Ctrl + S despite it saving every action\n                                             // automatically.\n\n    const csrfToken = getCookie('csrf-token');\n\n    var annotationsJSON = this.annotationsToJSON();\n\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify({\n        documentIds: this.state.documentIds,\n        documentAnnotationIds: this.state.documentAnnotationIds,\n        labels: annotationsJSON\n      }),  \n    };\n\n    this.setState({\n      loading: {\n        querying: false,\n        saving: true,\n      }\n    }, () => {\n\n      fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/tagging/submitAnnotations', fetchConfigPOST) // TODO: move localhost out\n      .then(response => response.text())\n      .then((data) => {\n        try { \n          var d = JSON.parse(data);\n\n          var documentAnnotationIds = d.documentAnnotationIds;\n\n          console.log(\"Submitted annotations OK\");\n\n          // If the user is on the last page (i.e. the 'current group'), add one to the totalPages array so that the user can\n          // click 'Next' to go to the latest doc group.\n          if(this.state.pageNumber === this.state.totalPagesAvailable && !this.state.searchTerm) {\n            var newTotalPagesAvailable = this.state.totalPagesAvailable + 1;\n            this.setState({\n              showingProgressBar: true,\n            }, () => {\n              window.setTimeout(() => this.setState({\n                showingProgressBar: false,\n              }), 3000);\n            })\n\n          } else {\n            var newTotalPagesAvailable = this.state.totalPagesAvailable;\n          }\n\n          this.setState({\n             docGroupLastModified: Date.now(),\n\n             totalPagesAvailable: newTotalPagesAvailable,       \n\n             documentAnnotationIds: documentAnnotationIds,\n\n             changesMade: false,\n             recentlySaved: true,\n             loading: {\n              querying: false,\n              saving: false\n             }\n          });\n        } catch(err) {\n          console.log(\"ERROR:\", err);\n          alert(data);\n        }\n        \n      });\n    });\n  }\n\n  /* Mounting function */\n\n  // When this component is mounted, call the API.\n  // Set up the keybinds and mouseup event when done.\n  componentWillMount() {\n\n    // var pathname = window.location.pathname;\n    // var project_id = pathname.split('/')[2];\n    // if(pathname === \"/\") {\n    //   //var project_id = 'RtJp98vxk'; // React development (completed project)\n    //   //var project_id = 'KPJqR4HB8'; // React development (long docs)\n    //   var project_id = '-krXeW3R2'; // React development (big work order one)\n    // }\n    // if(!project_id || project_id.length < 8) {\n    //   alert(\"invalid project\");\n    //   return;\n    // }\n\n\n\n    // this.setState({\n    //   project_id: project_id\n    // }, () => { \n    this.queryAPI(true);\n  }  \n\n  /* Selection functions */\n\n  // Get an empty current selection.\n  // Called when we need to clear the current selection.\n  getEmptyCurrentSelection() {\n    return {\n      wordStartIndex: -1,\n      wordEndIndex: -1,\n      sentenceIndex: -1\n    }\n  }\n\n  // Move the selection up or down.\n  // This function should be called when one of those keys is pressed.\n  moveSelectionVertically(direction) {\n    console.log(\"Moving\", direction) // TODO: Make this move up and down\n  }\n\n  // Move the selection in the specified direction ('left', 'right').\n  // This function should be called when one of those keys is pressed.\n  moveSelectionHorizontally(direction) {\n    console.log(\"Moving\", direction)\n\n    var selections = this.state.selections;\n    var mostRecentSelectionText;\n\n    // Move all selections left or right\n    for(var i = 0; i < selections.length; i++) {\n      for(var j = 0; j < selections[i].length; j++) {\n        var selection = selections[i][j];\n\n        // Behaviour depends on whether shift is currently being held down.\n        if(direction === \"left\") {\n          if(!this.state.holdingShift) {\n            selection.wordStartIndex = Math.max(selection.wordStartIndex - 1, 0);\n            selection.wordEndIndex = selection.wordStartIndex;\n          } else { // If shift is being held down, move the wordEndIndex backwards or move the wordStartIndex backwards depending on the current selection.\n            if(selection.wordEndIndex > selection.wordStartIndex) {\n              selection.wordEndIndex--;\n            } else {\n              selection.wordStartIndex = Math.max(selection.wordStartIndex - 1, 0);\n            }\n          }\n        } else if (direction === \"right\") {\n          if(!this.state.holdingShift) { // If shift *is* being held down, this won't happen (the wordStartIndex won't change).\n            selection.wordStartIndex = Math.min(this.state.documents[i].length - 1, selection.wordEndIndex + 1);\n          }\n          selection.wordEndIndex   = Math.min(this.state.documents[i].length - 1, selection.wordEndIndex + 1);\n        }\n\n        mostRecentSelectionText = this.state.documents[i].slice(selection.wordStartIndex, selection.wordEndIndex + 1).join(' ');\n      }\n    }\n    this.setState({\n      selections: selections,\n      mostRecentSelectionText: mostRecentSelectionText\n    });\n  }\n\n  // Get an empty selections array whose length is the number of docs in the current documentGroup.\n  getEmptySelectionsArray(numDocs) {\n    if(!numDocs) {\n      var numDocs = this.state.documents.length;\n    }\n    var selections = new Array(numDocs);\n    for(var i = 0; i < selections.length; i++) {\n      selections[i] = new Array();\n    }    \n    return selections;\n  }  \n\n  // Select the first word in the first sentence.\n  // (called when a new group is loaded).\n  selectFirstWord() {\n    var selections = this.state.selections;\n    if(selections.length === 0) return;\n    selections[0].push({\n      wordStartIndex: 0,\n      wordEndIndex: 0\n    });\n    this.setState({\n      selections: selections,\n      mostRecentSelectionText: this.state.documents.length > 0 ? this.state.documents[0][0] : \"\",\n    });\n  }\n\n  // Clear all active selections by resetting the selections array.\n  clearSelections() {\n    this.setState( {\n      currentSelection: this.getEmptyCurrentSelection(),\n      selections: this.getEmptySelectionsArray()\n    });\n  }\n\n  // Update this component's selections state.\n  // This function is called via the mouse, and has no relation to the keyboard (keyboard selections are handled above).\n  // sentenceIndex: The index of the sentence in which the selection was made.\n  // wordIndex: the index of the word that was clicked on, or hovered over and the mouse released.\n  // action: Whether the mouse was pressed down ('down') or released ('up').\n  updateSelections(sentenceIndex, wordIndex, action) {\n    var wordStartIndex, wordEndIndex;\n\n    var selections = this.state.selections;\n    var currentSelection = this.state.currentSelection;\n\n    if (action === \"down\") { // Mouse down, i.e. a word was clicked.\n\n      if(!this.state.holdingCtrl) {\n        selections = this.getEmptySelectionsArray(); // Reset all selections upon clicking a word, unless Ctrl is being held.\n      }\n      wordStartIndex = wordIndex;\n      wordEndIndex = -1;\n\n      // A new selection is made, capturing the index of the sentence that the user clicked on and the index of the word that they clicked.\n      currentSelection = {\n        sentenceIndex: sentenceIndex,\n        wordStartIndex: wordStartIndex\n      }      \n\n    } else if(action === \"up\") { // Mouse up, i.e. mouse was released when hovering over a word.\n\n      // Only allow selections where the user has clicked on a starting word.\n      if(currentSelection.wordStartIndex === -1) {\n        this.clearSelections();\n        return;\n      }\n\n      wordStartIndex = currentSelection.wordStartIndex;\n\n      // If the first word selected was in a different sentence, the wordStartIndex becomes the start of the sentence where the mouse was released.\n      if(currentSelection.sentenceIndex !== sentenceIndex) {  // TODO: Make this consider mouseX relative to the X of the initial token?\n        wordStartIndex = 0;\n      };\n\n      wordEndIndex = wordIndex;\n\n      // If the second word selected was before the first, swapperino them around (so that backwards selections work as expected).\n      if(wordIndex < wordStartIndex) {\n        var s = wordStartIndex;\n        wordStartIndex = wordIndex;\n        wordEndIndex = s;\n      }     \n\n      // Create a new selections json object and push it to the selections array for this sentence.\n      currentSelection = this.getEmptyCurrentSelection();\n      selections[sentenceIndex].push({\n        wordStartIndex: wordStartIndex,\n        wordEndIndex: wordEndIndex\n      });\n      var mostRecentSelectionText = this.state.documents[sentenceIndex].slice(wordStartIndex, wordEndIndex + 1).join(' ');\n\n      clearWindowSelection(); // Remove the default browser selection highlighty thing.\n    }    \n\n    this.setState({\n      currentSelection: currentSelection,\n      selections: selections,\n      mostRecentSelectionText: mostRecentSelectionText ? mostRecentSelectionText : this.state.mostRecentSelectionText,\n    });\n  }\n\n\n\n\n  /* Tag application function */\n\n  // Apply a specific tag to all current selections.\n  // entityClass: The full name of the entity class, e.g. 'item/pump/centrifugal_pump'.\n  // This function will either be called via clicking on an entity class in the tree, or by using hotkeys.\n  applyTag(entityClass) {    \n    //console.log(\"Applying tag:\", entityClass);\n    var selections = this.state.selections;\n    var documents = this.state.documents;\n    var annotations = this.state.annotations;\n\n    for(var doc_idx in selections) {\n      for(var sel_idx in selections[doc_idx]) {\n        var sel = selections[doc_idx][sel_idx];\n        var start = sel.wordStartIndex;\n        var end = sel.wordEndIndex;\n\n\n        /* 1. Disjoint spans */\n        // Check all labels across this selected span of tokens are the same before proceeding.\n        // If they are not, they must be cleared before adding a label.\n        var annotationSpanStart = annotations[doc_idx][start].spanStartIdx;\n        var annotationSpanEnd   = annotations[doc_idx][start].spanEndIdx;\n        var notAllEqual = false;          \n        for(var k = start + 1; k <= end; k++) {\n          var otherAnnotation = annotations[doc_idx][k]; \n          if(annotationSpanStart !== otherAnnotation.spanStartIdx || annotationSpanEnd !== otherAnnotation.spanEndIdx) {\n            notAllEqual = true;\n            break;\n          }          \n        }        \n\n        // If the labels across all tokens in the selected span are not the same, remove all labels for the entire span.\n        // Then modify the spanEndIdx of any annotations in this document whose spanEndIdx was overlapping the\n        // span that the user selected, setting them to be start index - 1 (before the span).\n        // This ensures the ends of the spans are drawn properly.\n        if(notAllEqual) {\n          for(var k = start; k <= end; k++) {\n            var annotation = annotations[doc_idx][k];\n            annotation.removeAllLabels();\n          }          \n          // Adjust the span end index of all prev labels to be start index - 1\n          // A shame that we have to iterate across all annotations in this document - this could probably be optimised\n          // but it probably barely impacts performance even on large docs (I think)\n          for(var x in annotations[doc_idx]) {\n            var annotation = annotations[doc_idx][x];\n\n\n            // If this new span overlaps the *end* of an existing span, change that span's end index to the start of this new\n            // span, -1\n\n            if(annotation.spanEndIdx >= start && annotation.spanStartIdx <= start) {              \n              annotation.setSpanEndIdx(start - 1);\n\n            }\n\n            // If this new span overlaps the *start* of an existing span, change that span's start index to be the end of this new span -1\n            // and change the BIO tag to \"B\".\n            if(annotation.spanStartIdx <= end) {\n              annotation.setSpanStartIdx(end + 1);              \n              if(annotation.tokenIndex === (end + 1)) {\n                annotation.changeBioTag(\"B\") // I am realising now that this BIO tag is unnecessary - it could be inferred\n              }\n            }\n          }\n        }\n\n        /* 2. Overlapping spans */\n        // Check for any spans that this new span will cut into.\n        // First, check to the left and adjust the spanEndIdx of all Annotation objects\n        // to the left of this span if they overlap.\n        for(var ann_idx in annotations[doc_idx].slice(0, start)) {\n          var annotation = annotations[doc_idx][ann_idx];          \n          if(annotation.spanStartIdx < start && annotation.spanEndIdx >= end) {            \n            annotation.setSpanEndIdx(start - 1);\n          }\n        }\n\n        // Do the same for any Annotation objects on the right hand side of this span, which are part of the same\n        // mention.\n        for(var ann_idx in annotations[doc_idx].slice(end + 1, annotations[doc_idx].length)) {\n          var annotation = annotations[doc_idx][parseInt(ann_idx) + end + 1];\n          if(annotation.spanStartIdx <= start && annotation.spanEndIdx >= end) {\n            annotation.setSpanStartIdx(end + 1);\n            if(ann_idx === '0') {\n              annotation.changeBioTag(\"B\");\n            }\n          }\n        }\n\n        /* 3. Applying the labels */\n        // Now, apply the tags to every token in the selected span.\n        var labelWasModified = false;\n        for(var k = start; k <= end; k++) {\n          var bioTag = k === start ? \"B\" : \"I\";\n          var spanText = documents[doc_idx].slice(start, end + 1).join(' ');\n\n          //var prevAnnotation = k > 0 ? annotations[doc_idx][k - 1] : null;\n          //var nextAnnotation = k < (documents[doc_idx].length - 1) ? annotations[doc_idx][k + 1] : null;          \n\n          labelWasModified = annotations[doc_idx][k].addLabel(bioTag, entityClass, spanText, start, end);\n\n        }\n\n        if(labelWasModified) this.captureEvent('Applied label', parseInt(doc_idx), start, end, entityClass);\n      }\n    }\n    this.setState({\n      annotations: annotations,\n    }, () => {\n      this.justifyWords(); // Justify the words again to ensure the stripey lines line up correctly\n\n      // Debug:\n      //prettyPrintAnnotations(this.state.annotations[0]);\n      //console.log(\"Updated annotations[0]:\", this.state.annotations[0]);\n    })\n\n  }\n\n  // Deletes the specified tag.\n  // Unlike applyTag, this is applied to a specified sentenceIndex and wordIndex rather than to all current selections.\n  deleteTag(sentenceIndex, wordIndex, entityClass) {\n    \n    var annotations = this.state.annotations;\n    var annotation = annotations[sentenceIndex][wordIndex];\n\n    // Retrieve the span start idx and span end idx of the annotation corresponding to (sentence_index, word_index)\n    var spanStart = annotation.spanStartIdx;\n    var spanEnd = annotation.spanEndIdx;\n\n    this.captureEvent('Deleted label', sentenceIndex, spanStart, spanEnd, entityClass);\n\n    // Find all annotations in this document in the same mention span and remove the label from all of them.\n    // (this will also remove the label from the annotation object at (sentence_index, word_index)).\n    for(var ann_idx in annotations[sentenceIndex]) {\n      var otherAnnotation = annotations[sentenceIndex][ann_idx];       \n      if(otherAnnotation.spanStartIdx === spanStart && otherAnnotation.spanEndIdx === spanEnd) {\n        otherAnnotation.removeLabel(entityClass);\n      }\n    }\n\n    this.setState({\n      annotations: annotations\n    });\n\n  }\n\n  /* Confidence */\n\n  // Updates the confidences array for the given doc.\n  // If the user clicks on the button they already clicked, then the confidence is reset to undefined.\n  updateConfidence(sentenceIndex, confidence) {\n    var confidences = this.state.confidences;\n    if(confidences[sentenceIndex] === confidence) {\n      confidences[sentenceIndex] = undefined;\n    } else {\n      confidences[sentenceIndex] = confidence;\n    }\n    this.setState({\n      confidences: confidences\n    });\n  }\n\n\n  /* Comments */\n\n  submitComment(message, documentIndex, next) {\n    console.log(\"Message:\", message, \"Document index\", documentIndex);\n\n    const csrfToken = getCookie('csrf-token');\n\n    const fetchConfigPOST = {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'csrf-token': csrfToken,\n      },\n      dataType: \"json\",\n      body: JSON.stringify({\n        text: message,\n        documentId: this.state.documentIds[documentIndex],\n      }),  \n    };\n\n    fetch('http://localhost:3000/api/projects/' + this.props.project_id + '/comments/submit', fetchConfigPOST) // TODO: move localhost out\n    .then(response => response.text())\n    .then((data) => {\n      console.log(data);\n      try { \n        var d = JSON.parse(data);\n        \n\n        console.log(\"Submitted comment OK\");\n\n        var comments = this.state.comments;\n        comments[documentIndex].push(d.comment);\n\n        this.setState({\n           comments: comments,\n        }, next);\n      } catch(err) {\n        console.log(\"ERROR:\", err);\n      }      \n    });\n\n\n    \n  }\n\n  /* Events */\n\n  // Capture an event\n  // TODO: Make it do something\n  captureEvent(eventAction, sentenceIndex, spanStart, spanEnd, entityClass) {\n\n    var tokenString = this.state.documents[sentenceIndex].slice(spanStart, spanEnd + 1).join(' ')\n\n    var event = {\n      \"action\": eventAction,\n      \"sentenceIndex\": sentenceIndex,\n      \"wordIndex\": {\n        \"start\": spanStart,\n        \"end\": spanEnd,\n      },\n      \"entityClass\": entityClass,\n      \"tokenString\": tokenString\n    }\n\n    if(eventAction === \"Applied label\" || eventAction === \"Deleted label\") {\n      this.setState({\n        changesMade: true,\n        recentlySaved: false,\n      })\n    }\n\n  }\n\n  /* Rendering function */\n\n\n  render() {\n    var taggingCompletePage = this.state.taggingCompletePage;\n\n    //console.log(this.state.documents, taggingCompletePage);\n\n    return (\n        <div>   \n          {!this.state.error &&          \n          <div id=\"tagging-interface\" className={(this.state.loading.querying ? \"loading\" : \"\") + (taggingCompletePage ? \" tagging-complete-page\" : \"\")}>\n\n            <div id=\"tagging-container\">\n              { taggingCompletePage && <TaggingCompletePage/>}\n              <div id=\"sentence-tagging\">\n\n                { this.state.loading.firstLoad && \n                  <div className=\"loading-message\">\n                    <i className=\"fa fa-cog fa-spin\"></i>Loading...\n                  </div>\n                }\n\n                <ControlBar\n                  showingProgressBar = {this.state.showingProgressBar}\n                  pageNumber = {this.state.pageNumber}\n                  totalPages = {this.state.totalPages}\n                  totalPagesAvailable = {this.state.totalPagesAvailable}\n                  lastModified={this.state.docGroupLastModified}\n                  recentlySaved={this.state.recentlySaved}\n                  changesMade={this.state.changesMade}\n                  querying={this.state.loading.querying}\n                  saving={this.state.loading.saving}\n                  inSearchMode={this.state.searchTerm}\n\n                  showDocsPerPage={true}\n                  docsPerPage={this.state.docsPerPage}\n                  docsPerPageOptions={[1, 3, 5, 10, 15, 20]}\n\n                  showSaveButton={true}\n\n                  searchDocuments={this.searchDocuments.bind(this)}\n                  submitAnnotations={this.submitAnnotations.bind(this)}\n                  loadPreviousPage={this.loadPreviousPage.bind(this)}\n                  loadNextPage={this.loadNextPage.bind(this)}\n                  goToPage={this.goToPage.bind(this)}\n                  setDocsPerPage={this.setDocsPerPage.bind(this)}\n                />\n\n                <DocumentContainerHeader/>\n                    \n                { this.state.documents.map((doc, i) => \n                  <DocumentContainer\n                    key={i}\n                    index={ i }\n                    displayIndex={( (this.state.pageNumber - 1) * 10 ) + i + 1  }\n                    words={doc}              \n                    annotations={this.state.annotations[i]}  \n                    comments={this.state.comments[i]}\n                    confidence={this.state.confidences[i]}\n                    selections={this.state.selections[i]}\n                    updateSelections={this.updateSelections.bind(this)}\n                    updateConfidence={this.updateConfidence.bind(this)}\n                    entityColourMap={this.state.entityColourMap}\n                    deleteTag={this.deleteTag.bind(this)}\n                    submitComment={this.submitComment.bind(this)}\n                    user={this.props.user}\n                  />\n                  )}\n                  {\n                    (!this.state.loading.querying && this.state.documents.length === 0 && !this.state.taggingCompletePage) && <div className=\"loading-message no-results-found\">No results found.</div>\n\n\n                  }\n\n              </div>\n            </div>\n            <div id=\"tagging-menu\">\n\n              <div className=\"project-card\">\n                <div>\n                  <div className={\"project-name\" + (!this.props.projectTitle ? \" st\" : \"\")} style={{'display': 'block'}}><Link to={\"/projects/\" + this.props.project_id + \"/dashboard\"}>{this.props.projectTitle ? this.props.projectTitle : \"xxxxxxxx\"}</Link></div>\n                  <div className={\"project-creator\" + (!this.props.projectAuthor ? \" st\" : \"\")} style={{'display': 'block'}}>Created by <span className=\"creator-name\">{this.props.projectAuthor ? this.props.projectAuthor : \"xxxxxxxx\"}</span></div>\n                </div>\n              </div>\n\n              <WikipediaSummary tokens={this.state.mostRecentSelectionText}/>\n              <HotkeyInfo \n                chain={this.state.hotkeyChain}\n                entityClass={this.state.reverseHotkeyMap[this.state.hotkeyChain.join('')]}\n              />            \n              \n              <CategoryHierarchy\n                items={this.state.categoryHierarchy.children}\n                hotkeyMap={this.state.hotkeyMap}\n                hotkeyChain={this.state.hotkeyChain.join('')}\n                initHotkeyMap={this.initHotkeyMap.bind(this)}\n                applyTag={this.applyTag.bind(this)}        \n                visible={!taggingCompletePage}      \n                draggable={true}\n              />\n            </div>      \n          </div> }\n\n          { this.state.error === 403 && <Error403Page/> }    \n          { this.state.error === 404 && <Error404Page/> }    \n        </div>\n       \n    )\n  }\n}\n\n\n\n\nclass TaggingCompletePage extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div id=\"tagging-complete-message\">\n        <span class=\"tagging-complete-text\">\n          <h2>Annotation complete!</h2>\n          <p>Thank you for your participation in this project.</p>\n\n        </span>\n\n\n      </div>\n    )\n\n  }\n}\n\nexport default TaggingInterface","import React from 'react';\r\nimport {Component} from 'react';\r\n\r\n\r\nclass FeaturesPage extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n\r\n    return (\r\n\t    <article className=\"features-list\">\r\n\r\n\t    \t<h2>Version 2.0 - List of features (19 September 2020)</h2>\r\n\r\n\t    \t<p>Redcoat underwent a significant revision for Version 2.0, bringing a wide array of new features including:</p>\r\n\r\n\t    \t<ul>\r\n\t    \t\t<li><b>Overall</b>\r\n\t\t    \t\t<ul>\r\n\t\t    \t\t\t<li>The front-end has been completely rebuilt in React. Redcoat now feels significantly more responsive as a result.</li>\r\n\t\t    \t\t</ul>\r\n\t\t    \t</li>\r\n\t    \t\t<li><b>Project dashboard</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li><b>Key information</b>: The dashboard now shows key information at the top such as number of annotations, average agreement score, and average time per doc (which is still a work in progress).</li>\r\n\t    \t\t\t\t<li><b>Entity frequencies</b>: A chart showing the number of mentions of each entity, which dynamically updates as annotators annotate the project.</li>\r\n\t    \t\t\t\t<li><b>Activity</b>: A chart showing the activity of each annotator.</li>\r\n\t    \t\t\t\t<li><b>Annotations/document</b>: A waffle chart showing the number of times each document has been annotated.</li>\r\n\t    \t\t\t\t<li><b>Comments</b>: A list of all comments made about the project, with links to the corresponding documents in the new Curation Interface.</li>\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t\t<li><b>Curation interface</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li>The curation interface visualises all of the annotations made by each annotator and allows each annotator to comment on each doc using the comments window on the right.</li>\r\n\t    \t\t\t\t<li>The compiled labels are displayed at the bottom of the annotators' annotations when more than one user has annotated the document.</li>\r\n\t    \t\t\t\t<li>Documents can be searched and sorted in a similar manner to the annotation interface.</li>\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t\t<li><b>Annotation interface</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li>Annotators may navigate back to previous documents and update them as necessary.</li>\r\n\t    \t\t\t\t<li>Annotators can search for specific documents via the search field at the top.</li>\r\n\t    \t\t\t\t<li>Annotators can choose the number of documents per page - it is no longer fixed at 10.</li>\r\n\t    \t\t\t\t<li>The categories in the category hierarchy can be dragged and dropped so that annotators can essentially rebind the hotkeys for each category when desired.</li>\r\n\t    \t\t\t\t<li>Multiple tokens can be selected at once by holding Ctrl.</li>\r\n\t    \t\t\t\t<li>Users can write comments on any document (visible by anyone also annotating the project) via the comments button at the bottom of each document.</li>\r\n\t    \t\t\t\t<li>Users may specify their confidence via the Confidence buttons on the right (still a work in progress).</li>\r\n\t    \t\t\t\t<li>There is a screenshot button at the bottom of each document which automatically saves a screenshot of the doc to a .png file.</li>\r\n\t    \t\t\t\t<li>The save button has been moved to the top.</li>\r\n\t    \t\t\t\t<li>The overall design of the interface has changed significantly to make it feel more polished.</li>  \t\t\t\t\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t\t<li><b>Projects page</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li>The projects page has also changed in appearance, and now has a more streamlined look.</li>\r\n\t    \t\t\t\t<li>There are fewer controls over searching/filtering etc - those may be implemented again later.</li>\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t\t<li><b>User profile</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li>There is now a User profile page.</li>\r\n\t    \t\t\t\t<li>Users may customise their profile icon - the background, foreground and icon can be changed. These icons will appear on any comments the user makes on any projects.</li>\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t\t<li><b>Other changes</b>\r\n\t    \t\t\t<ul>\r\n\t    \t\t\t\t<li>Annotator agreement is now calculated whenever a document annotation is saved. The agreement metric is a jaccard-based similarity metric that incorporates both token similarity and span similarity (will be discussed in a future paper).</li>\r\n\t    \t\t\t</ul>\r\n\t    \t\t</li>\r\n\t    \t</ul>\r\n\r\n\r\n\t\t\t<h2>Version 1.0 - List of features (5 April 2019)</h2>\r\n\r\n\t\t\t<p>Below is a list of features that are currently present in Redcoat.</p>\r\n\r\n\t\t\t<ul>\r\n\t\t\t\t<li> Project Setup page\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t<li>Create annotation projects for Entity Recognition on the Setup Project page</li>\r\n\t\t\t\t\t\t<li>Automatic tokenisation of data, with summary of number of tokens/documents</li>\r\n\t\t\t\t\t\t<li>Create a concept hierarchy via an interactive tree, or alternatively via text input</li>\r\n\t\t\t\t\t\t<li>Multiple built-in hierarchies: NER, FIGER, Mining</li>\r\n\t\t\t\t\t\t<li>New project and associated data is persistent across refreshes</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li>Projects page\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t<li>Sort, search, and filter projects</li>\r\n\t\t\t\t\t\t<li>Detailed project summary</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</li>\r\n\t\t\t\t\r\n\t\t\t\t<li>Annotation interface\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t<li>Annotate projects via an intuitive user interface</li>\r\n\t\t\t\t\t\t<li>Keyboard support on the annotation interface (hotkeys, selection with arrow keys)</li>\r\n\t\t\t\t\t\t<li>Wikipedia summary of words in the annotation interface</li>\r\n\t\t\t\t\t\t<li>Search/filter category hierarchy to quickly find the relevant entity category\t</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\t\t\r\n\r\n\t\t\t<h3>Attributions</h3>\r\n\t\t\t<p>The pencil icon on the tagging interface was made by <a href=\"https://www.flaticon.com/authors/icongeek26\" title=\"Icongeek26\">Icongeek26</a> from <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">www.flaticon.com</a>.</p>\r\n\t\t\t<p>The Krippendorff Alpha agreement metric calculation was found on GitHub: <a href=\"https://github.com/tanbt/krippendorff-alpha\">https://github.com/tanbt/krippendorff-alpha</a>.</p>\r\n\t\t</article>\r\n\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\nexport default FeaturesPage;","import React from 'react';\r\nimport {Component} from 'react';\r\nimport { Link } from 'react-router-dom'\r\nimport formatDate  from '../functions/formatDate';\r\nimport { PieChart } from 'react-minimal-pie-chart';\r\n\r\n// Config for all API fetch requests\r\nconst fetchConfigGET = {\r\n  method: 'GET',\r\n  headers: {\r\n    'Accept': 'application/json',\r\n    'Content-Type': 'application/json'\r\n  }\r\n};\r\n\r\n\r\n\r\nclass ProjectsTable extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (<div></div>)\r\n\r\n\r\n\r\n\r\n  }\r\n}\r\n\r\nclass ProjectListPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      data: {\r\n        projects: this.getDummyProjects(),\r\n        numUserInvolvedIn: null,\r\n        numCreatedByUser: null,       \r\n        numDocGroupsAnnotated: 0,\r\n        totalDocGroups: 1,\r\n      },\r\n      view: \"All projects\", // \"All projects\" or \"Your projects\"\r\n      loading: true,\r\n\r\n    }\r\n  }\r\n\r\n  // Get some dummy projects for the first load, so that the table looks nice.\r\n  getDummyProjects() {\r\n\r\n    function randomString(minLength, maxLength) {\r\n      var result = '';\r\n      var randomLength = minLength + Math.floor(Math.random() * (maxLength - minLength))\r\n      for(var i = 0; i < randomLength; i++ ) {\r\n        result += 'x'\r\n      }\r\n      return result;\r\n  }\r\n\r\n    function randomName() {\r\n      return randomString(5, 20);\r\n    }\r\n\r\n    function randomDesc() {\r\n      var x = Math.random();\r\n      if(x < 0.5) return null;\r\n      return randomString(20, 50);\r\n    }\r\n\r\n    var dummyProjects = [];\r\n    for(var i = 0; i < 10; i++) {\r\n      dummyProjects.push({\r\n        name:         randomName(),\r\n        description:  randomDesc(),\r\n        total_users:  0,\r\n        created_at:   null,\r\n        icon_name:    \"\",\r\n      })\r\n    }\r\n    return dummyProjects;\r\n  }\r\n\r\n  // Query the API when this component is mounted.\r\n  // Once done, set this.state.data to the returned projects, numUserInvolvedIn, and numCreatedByUser.\r\n  componentWillMount() {\r\n    this.props.setProject(null, null); // Reset the current project in the sidenav\r\n    fetch('http://localhost:3000/api/projects', fetchConfigGET) // TODO: move localhost out\r\n      .then(response => response.text())\r\n      .then((data) => {\r\n        var d = JSON.parse(data);\r\n\r\n        this.setState({\r\n          data: d,\r\n          loading: false\r\n        })\r\n      });\r\n  }\r\n\r\n  // Set this component's view to the specified view.\r\n  // Should be either \"All projects\" or \"Your projects\".\r\n  setView(view) {\r\n    this.setState({\r\n      view: view,\r\n      loading: true,\r\n      \r\n    }, () => {\r\n      window.setTimeout( () => {\r\n        this.setState({\r\n          \r\n          loading: false,\r\n        })\r\n      }, 100); // Simulate lag ?\r\n\r\n    })\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"projects-table-wrapper\">\r\n\r\n        <div id=\"projects-table-header\">            \r\n          <div className={\"row-button\" + (this.state.view === \"All projects\"  ? \" active\" : \"\")} onClick={ () => this.setView('All projects') }>All projects <span className=\"counter\">{ this.state.data.numUserInvolvedIn }</span></div>\r\n          <div className={\"row-button\" + (this.state.view === \"Your projects\" ? \" active\" : \"\")} onClick={ () =>  this.setView('Your projects') }>Your projects <span className=\"counter\">{ this.state.data.numCreatedByUser }</span></div>\r\n        </div>\r\n\r\n        <div id=\"projects-table\" className={this.state.loading ? \"loading\" : \"\"}>\r\n        \r\n        { this.state.data.projects.filter(project => (this.state.view === \"Your projects\" ? project.userIsCreator : true)).map((project, i) => \r\n          \r\n            <div className=\"row\" index={i}>\r\n              <div className=\"col-name-desc\">\r\n\r\n\r\n                <div className=\"projects-table-pie\">\r\n                { this.state.loading && \r\n                  <PieChart\r\n                    data={[\r\n                      { value: 0, color: \"rgb(109, 201, 34)\"},\r\n                      { value: 1, color: \"rgba(0, 0, 0, 0)\"}, // sneaky \r\n                    ]}\r\n                    background={\"#d5d5d5\"}\r\n                    lineWidth={18}\r\n                    startAngle={270}\r\n                  />\r\n                  }\r\n                  { !this.state.loading && \r\n                    <PieChart\r\n                    data={[\r\n                      { value: (project.numDocGroupsAnnotated), color: \"rgb(109, 201, 34)\"},\r\n                      { value: (project.totalDocGroups - project.numDocGroupsAnnotated), color: \"rgba(0, 0, 0, 0)\"}, // sneaky \r\n                    ]}\r\n                    background={\"#d5d5d5\"}\r\n                    animate={true}\r\n                    animationDuration={500}\r\n                    lineWidth={18}\r\n                    startAngle={270}\r\n                  />\r\n                  }\r\n                </div>\r\n\r\n\r\n\r\n\r\n                <div className=\"name-desc-row\">\r\n                  <div className=\"project-name\"><Link to={'/projects/' + project._id + '/dashboard'}>{ project.name}</Link></div>\r\n                  {project.description && <div className=\"project-description\">{ project.description }</div> }\r\n                  <div className=\"project-creator\">Created by <span className=\"creator-name\">{ project.creator }</span></div>\r\n                </div>\r\n              </div>\r\n              <div className=\"col-date\">\r\n                <span className=\"project-created-at\">Created on {formatDate(project.created_at)}</span>\r\n              </div>\r\n              <div className=\"col-stats\">\r\n                <span className=\"project-total-comments\"><i class=\"fa fa-comment\"></i> <span className=\"comment-count\">{project.total_comments}</span></span>\r\n                <span className=\"project-total-users\"><i class=\"fa fa-user\"></i> <span className=\"user-count\">{project.total_users}</span></span>\r\n              </div>\r\n            </div>      \r\n          )\r\n        }\r\n        </div>\r\n      </div>  \r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default ProjectListPage;","import React from 'react';\r\nimport {Component} from 'react';\r\n\r\nimport CategoryHierarchy from '../components/CategoryHierarchy';\r\n\r\n\r\nfunction generateEmptyTable() {\r\n  var n = 15;\r\n  var arr = new Array(n).fill(0);\r\n  \r\n\r\n  function stringOfRandomLength(minlen, maxlen) {\r\n    var s = '';\r\n    for(var i = 0; i < minlen + Math.floor(Math.random() * maxlen); i++) {\r\n      s += 'x';\r\n    }\r\n    return s;\r\n  }\r\n\r\n  return (\r\n    <table className=\"project-page-table\">\r\n      <tbody>\r\n       { arr.map((x, i) => \r\n        <tr> \r\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\r\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\r\n        </tr>\r\n      ) }\r\n    </tbody>\r\n  </table>\r\n  )  \r\n}\r\n\r\n\r\nfunction getColourIndex(row, colourIndexes) {\r\n  var s = row.split('/');\r\n  var base_class = s.length > 1 ? s[0] : s;\r\n  return colourIndexes[base_class] + 1\r\n}\r\n\r\nfunction getRowName(row) {\r\n  var s = row.split('/');\r\n  var rowName = s.length > 1 ? s[s.length - 1] : s;\r\n  var spacing = '';\r\n  for(var i = 1; i < s.length; i++) {\r\n    spacing += \" - \";\r\n  }\r\n  return spacing + rowName;\r\n}\r\n\r\nclass CategoryHierarchyPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n    console.log(this.props.data, this.props.loading, 'xxx');\r\n    return ( \r\n      <main className=\"project-page\">\r\n\r\n        <h2>Entity Hierarchy</h2>\r\n\r\n        <div className=\"wrapper\">\r\n          { this.props.loading && generateEmptyTable() }\r\n\r\n\r\n          { ! this.props.loading &&  <CategoryHierarchy\r\n              items={this.props.data.children}                         \r\n              visible={true}   \r\n              draggable={false}\r\n              displayOnly={true}  \r\n          \r\n\r\n          />\r\n          }\r\n          \r\n        </div>\r\n\r\n       \r\n\r\n\r\n\r\n      </main>\r\n    )\r\n  }\r\n}\r\n\r\nexport default CategoryHierarchyPage;","import React from 'react';\r\nimport {Component} from 'react';\r\n\r\nimport ProfileIcon from '../components/ProfileIcon';\r\n\r\nfunction generateEmptyTable() {\r\n  var n = 15;\r\n  var arr = new Array(n).fill(0);\r\n  \r\n\r\n  function stringOfRandomLength(minlen, maxlen) {\r\n    var s = '';\r\n    for(var i = 0; i < minlen + Math.floor(Math.random() * maxlen); i++) {\r\n      s += 'x';\r\n    }\r\n    return s;\r\n  }\r\n\r\n  return (\r\n    <table className=\"project-page-table\">\r\n      <tbody>\r\n       { arr.map((x, i) => \r\n        <tr> \r\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\r\n          <td><span className=\"inner\"><span className=\"st\">{stringOfRandomLength(30, 70)}</span></span></td>\r\n        </tr>\r\n      ) }\r\n    </tbody>\r\n  </table>\r\n  )  \r\n}\r\n\r\nclass InvitationsTable extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <table className=\"project-page-table\">\r\n        <tbody>\r\n         { this.props.data.active_users.length > 0 && <tr><td colspan=\"2\"><span className=\"inner row-divider\">Active</span></td></tr>}\r\n         { this.props.data.active_users.map((user, i) => \r\n          <tr>\r\n\r\n            <td>\r\n              <span className=\"inner\">\r\n                <ProfileIcon user={user}/>\r\n                <span>{user.email} ({user.username})</span>\r\n              </span>\r\n            </td>\r\n          </tr>\r\n        ) }\r\n\r\n         { this.props.data.pending_invitations.length > 0 && <tr><td colspan=\"2\"><span className=\"inner row-divider\">Pending invitations</span></td></tr>}\r\n         { this.props.data.pending_invitations.map((user, i) => \r\n          <tr>\r\n\r\n            <td>\r\n              <span className=\"inner\">\r\n                <ProfileIcon user={user.profile_icon ? user : null}/>\r\n                <span>{user.email} {user.username ? (\"(\" + user.username + \")\") : \"\"})</span>\r\n              </span>\r\n            </td>\r\n          </tr>\r\n        ) }\r\n        </tbody>\r\n      </table>\r\n\r\n    )\r\n  }\r\n}\r\n\r\nclass InvitationsPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n\r\n\r\n  render() {    \r\n    return ( \r\n      <main className=\"project-page\">\r\n\r\n        <h2>Annotators</h2>\r\n\r\n        <div className=\"wrapper\">\r\n          { this.props.loading && generateEmptyTable() }\r\n          { !this.props.loading && <InvitationsTable data={this.props.data}/> }\r\n          \r\n        </div>\r\n      </main>\r\n    )\r\n  }\r\n}\r\n\r\nexport default InvitationsPage;","import React from 'react';\r\nimport {Component} from 'react';\r\nimport _ from 'underscore';\r\n\r\nimport ControlBar from '../components/ControlBar';\r\n\r\nimport getCookie from '../functions/getCookie';\r\n\r\nimport initAnnotationsArray from '../functions/tagging_interface/initAnnotationsArray';\r\nimport Annotation from '../functions/tagging_interface/Annotation';\r\nimport {Comment, CommentInput} from '../components/Comment';\r\nimport ProfileIcon from '../components/ProfileIcon';\r\n\r\nimport {Word, Sentence} from '../components/tagging_interface/documentComponents';\r\n\r\nimport formatDate  from '../functions/formatDate';\r\n\r\n\r\n\r\n// Config for all API fetch requests\r\nconst fetchConfigGET = {\r\n  method: 'GET',\r\n  headers: {\r\n    'Accept': 'application/json',\r\n    'Content-Type': 'application/json'\r\n  }\r\n};\r\n\r\n\r\n\r\nclass CurationInterface extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\r\n\t\t\tdocumentId: null,\r\n\t\t\tdocuments: [],\t\t\t\r\n\t\t\tannotations: [],\r\n\t\t\tcompiledAnnotation: null, // annotations produced via compiled labels or perhaps machine learning model?\r\n\t\t\tcomments: [],\r\n\r\n\t\t\tannotatorAgreement: null,\r\n\r\n\t\t\tpageNumber: 1,\r\n\t\t\ttotalPages: 1,\r\n\t\t\trecentlySaved: false,\r\n\t\t\tchangesMade: false,\r\n\t\t\t\r\n\t\t\tsearchTerm: null,\r\n\t\t\tsortBy: \"Annotations\",\r\n\t\t\tdocumentIdQuery: null, // For searching a specific document id via a comment button\r\n\r\n\t\t\tentityColourMap: {},\r\n\r\n\t\t\tloading: {\r\n\t\t\t\tquerying: true,\r\n\t\t\t\tsaving: false,\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.commentBoxRef = React.createRef();\r\n\t\tthis._isMounted = false;\r\n\t\tthis.refreshDataFn = null;\r\n\t}\r\n\r\n\tcomponentWillMount() {\r\n\t\tthis._isMounted = true;\r\n\t\tif(this.props.documentIdQuery) {\r\n\t\t\tthis.setState({\r\n\t\t\t\tdocumentIdQuery: this.props.documentIdQuery,\r\n\t\t\t}, this.queryAPI);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\r\n\t\tconsole.log(\"Loading state:\", this.props.prevState)\r\n\t\tif(this.props.prevState) {\r\n\t\t\tthis.setState(this.props.prevState);\r\n\t\t} else {\r\n\t\t\tthis.queryAPI();\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis._isMounted = false;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif(!_.isEqual(prevState, this.state)) {\r\n\t\t\tconsole.log(\"state updated\");\r\n\t\t\tthis.props.saveState(this.state);\r\n\t\t}\t\r\n\t\t\r\n\t}\r\n\r\n\r\n\r\n\tasync queryAPI() {\r\n\t\tif(!this._isMounted) return;\r\n\r\n\t\tawait this.setState({\r\n\t\t\tloading: {\r\n\t\t\t\tquerying: true,\r\n\t\t\t\tsaving: false,\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tvar queryString = 'http://localhost:3000/api/projects/' + this.props.project_id + \"/curation?pageNumber=\" + this.state.pageNumber + \"&sortBy=\" + this.state.sortBy;\r\n\t\tif(this.state.searchTerm) {\r\n\t\t\tqueryString += \"&searchTerm=\" + this.state.searchTerm;\r\n\t\t}\r\n\t\tif(this.state.documentIdQuery) {\r\n\t\t\tqueryString += \"&documentId=\" + this.state.documentIdQuery;\r\n\t\t}\r\n\r\n\t\tfetch(queryString, fetchConfigGET)\r\n\t\t.then(response => response.text())\r\n      \t.then((data) => {\r\n      \t\tvar d = JSON.parse(data);\r\n\r\n      \t\tthis.setState({\r\n      \t\t\tdocumentId: d.documentId,\r\n      \t\t\ttokens: d.tokens,\r\n\r\n      \t\t\tannotations: initAnnotationsArray([d.tokens], d.annotations, this.state.searchTerm, true), //fix\r\n      \t\t\tcompiledAnnotation: d.compiledAnnotation ? initAnnotationsArray([d.tokens], [d.compiledAnnotation], this.state.searchTerm, true)[0] : null, //fix\r\n      \t\t\tcomments: d.comments,\r\n\r\n      \t\t\tusers: d.users,\r\n      \t\t\tsaveTimes: d.saveTimes,\r\n\r\n      \t\t\tdocumentIdQuery: null,\r\n\r\n      \t\t\tannotatorAgreement: d.annotatorAgreement,\r\n\r\n      \t\t\tentityColourMap: this.initEntityColourMap(d.categoryHierarchy.children),\r\n\r\n      \t\t\tpageNumber: d.pageNumber,\r\n      \t\t\ttotalPages: d.totalPages,\r\n\r\n      \t\t\tloading: {\r\n      \t\t\t\tquerying: false,\r\n      \t\t\t\tsaving: false,\r\n      \t\t\t}\r\n      \t\t}, () => { \r\n\r\n      \t\t\tif(this.refreshDataFn) window.clearTimeout(this.refreshDataFn)\r\n      \t\t\tthis.refreshDataFn = window.setTimeout(this.queryAPI.bind(this), 3000)\r\n\r\n\r\n      \t\t})\r\n      \t});\r\n\r\n\r\n\r\n\t}\r\n\r\n\r\n\t// Search all documents for a specific search term.\r\n\tsearchDocuments(searchTerm) {\r\n\t\tthis.setState({\r\n\t\t\tpageNumber: 1,\r\n\t\t\tsearchTerm: searchTerm,\r\n\t\t}, this.queryAPI);   \r\n\t}\r\n\r\n\tsubmitAnnotations() {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tloadPreviousPage() {\r\n\t\tif(this.state.loading.querying) return;\r\n\t\tif(this.state.pageNumber === 1) return;\r\n\t\tthis.setState({\r\n\t\t\tpageNumber: this.state.pageNumber - 1,\r\n\t\t}, this.queryAPI)\r\n\t}\r\n\r\n\tloadNextPage() {\r\n\t\tif(this.state.loading.querying) return;\r\n\t\tif(this.state.pageNumber >= this.state.totalPages) return;\r\n\t\tthis.setState({\r\n\t\t\tpageNumber: this.state.pageNumber + 1,\r\n\t\t}, this.queryAPI)\r\n\r\n\t}\r\n\r\n\tgoToPage(pageNumber) {\r\n\t\tif(this.state.loading.querying) return;\r\n\t\tif(pageNumber < 1 || pageNumber > this.state.totalPages) return;\r\n\t\tthis.setState({\r\n\t\t\tpageNumber: pageNumber,\r\n\t\t}, this.queryAPI);\r\n\t}\r\n\r\n\tsetSortBy(e) {\r\n\t\tvar sortBy = e.target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\tsortBy: sortBy,\r\n\t\t}, this.queryAPI)\r\n\t}\r\n\r\n\t// Initialise the entity colour map, which maps entity_class: colour_index, e.g. \"Item\": 1. Passed to the Word components to colour\r\n\t// their labels accordingly.\r\n\tinitEntityColourMap(categoryHierarchy) {\r\n\t\tvar entityColourMap = {}\r\n\t\tfor(var ec_idx in categoryHierarchy) {\r\n\t\t  var entityClass = categoryHierarchy[ec_idx];\r\n\t\t  entityColourMap[entityClass.name] = entityClass.colorId + 1;\r\n\t\t}\r\n\t\treturn entityColourMap;\r\n\t}\r\n\r\n\r\n\tsubmitComment(message, next) {\r\n\t\tvar t = this;\r\n\t\tconsole.log(\"Message:\", message);\r\n\r\n\t\tconst csrfToken = getCookie('csrf-token');\r\n\r\n\t\tconst fetchConfigPOST = {\r\n\t\t  method: 'POST',\r\n\t\t  headers: {\r\n\t\t    'Accept': 'application/json',\r\n\t\t    'Content-Type': 'application/json',\r\n\t\t    'csrf-token': csrfToken,\r\n\t\t  },\r\n\t\t  dataType: \"json\",\r\n\t\t  body: JSON.stringify({\r\n\t\t    text: message,\r\n\t\t    documentId: this.state.documentId,\r\n\t\t  }),  \r\n\t\t};\r\n\r\n\t\tfetch('http://localhost:3000/api/projects/' + this.props.project_id + '/comments/submit', fetchConfigPOST) // TODO: move localhost out\r\n\t\t.then(response => response.text())\r\n\t\t.then((data) => {\r\n\t\t  console.log(data);\r\n\t\t  try { \r\n\t\t    var d = JSON.parse(data);\t\t    \r\n\r\n\t\t    var comments = this.state.comments;\r\n\t\t    comments.push(d.comment);\r\n\r\n\r\n\t\t    this.setState({\r\n\t\t       comments: comments,\r\n\t\t    }, () => {\r\n\t\t    \tnext();\r\n\t\t    \tt.commentBoxRef.current.scrollTop = t.commentBoxRef.current.scrollHeight;\r\n\t\t    });\r\n\t\t  } catch(err) {\r\n\t\t    console.log(\"ERROR:\", err);\r\n\t\t    next();\r\n\t\t  }      \r\n\t\t});\r\n\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\r\n\t\t\t<div id=\"tagging-interface\">\r\n\t\t\t\t<div id=\"sentence-tagging\" className=\"curation-page\">\r\n\t\t\t\t\t<ControlBar\r\n\t                  pageNumber = {this.state.pageNumber}\r\n\t                  totalPages = {this.state.totalPages}\r\n\t                  totalPagesAvailable = {this.state.totalPages}\r\n\t                  recentlySaved={this.state.recentlySaved}\r\n\t                  changesMade={this.state.changesMade}\r\n\t                  querying={this.state.loading.querying}\r\n\t                  saving={this.state.loading.saving}\r\n\t                  inSearchMode={this.state.searchTerm}\r\n\r\n\t                  showSortBy={true}\r\n                  \t  sortBy={this.state.sortBy}\r\n                  \t  sortByOptions={[\"Annotations\", \"Agreement\", \"Document Index\"]}\r\n                  \t  setSortBy={this.setSortBy.bind(this)}\r\n\r\n\r\n\t                  searchDocuments={this.searchDocuments.bind(this)}\r\n\t                  submitAnnotations={this.submitAnnotations.bind(this)}\r\n\t                  loadPreviousPage={this.loadPreviousPage.bind(this)}\r\n\t                  loadNextPage={this.loadNextPage.bind(this)}\r\n\t                  goToPage={this.goToPage.bind(this)}\r\n\r\n\t                  curationPage={true}\r\n\t                />\r\n\r\n\t                {\r\n                    \t(!this.state.loading.querying && !this.state.tokens) && \r\n                    \t<div className=\"loading-message no-results-found\">No results found.</div>\r\n                  \t}\r\n\r\n                  \t<div className=\"curation-interface-inner\">\r\n                  \t\t<div className=\"document-window\" id=\"sentence-tagging\">\r\n\r\n                  \t\t\t\r\n                  \t\t\t  <div className=\"agreement-score\">\r\n                  \t\t\t  <span className=\"name\">Agreement:</span>\r\n                  \t\t\t  \t{ this.state.annotatorAgreement !== null && <span className=\"value\">{(this.state.annotatorAgreement * 100).toFixed(2)}%</span>}\r\n                  \t\t\t  \t{ this.state.annotatorAgreement === null && <span className=\"value na\">N/A</span>}\r\n                  \t\t\t  </div>\r\n\r\n                  \t\t\t{\r\n\t\t          \t\t\t\tthis.state.annotations.map((annotations, index) => \r\n\t\t          \t\t\t\t<CurationDocumentContainer\r\n\t\t          \t\t\t\t\tuser={this.state.users[index] || null}\r\n\t\t          \t\t\t\t\tindex={index}\r\n\t\t          \t\t\t\t\ttokens={this.state.tokens}\r\n\t\t          \t\t\t\t\tannotations={this.state.annotations[index]}\r\n\t\t          \t\t\t\t\tentityColourMap={this.state.entityColourMap}\r\n\t\t\t\t                \tdisplayOnly={true}\r\n\t\t\t\t                \tsaveTime={this.state.saveTimes[index] || null}\r\n\t\t          \t\t\t\t/>\r\n\t\t          \t\t\t)}\r\n\t\t          \t\t\t{ this.state.compiledAnnotation && <div className=\"divider\"><span></span></div> }\r\n\r\n\t\t          \t\t\t{ this.state.compiledAnnotation &&\r\n\t\t          \t\t\t\t<CurationDocumentContainer\r\n\t\t          \t\t\t\t\tspecialName={\"Compiled labels\"}\r\n\t\t          \t\t\t\t\tspecialDescription={\"These labels are automatically compiled from the annotations above.\"}\r\n\t\t          \t\t\t\t\ttokens={this.state.tokens}\r\n\t\t          \t\t\t\t\tannotations={this.state.compiledAnnotation}\r\n\t\t          \t\t\t\t\tentityColourMap={this.state.entityColourMap}\r\n\t\t\t\t                \tdisplayOnly={true}\r\n\t\t          \t\t\t\t/>\r\n\t          \t\t\t\t}\r\n\t          \t\t\t\r\n\r\n\r\n                  \t\t</div>\r\n                  \t\t<div className=\"comments-pane\">\r\n\r\n\t\t\t\t            <div className=\"comments-wrapper\">\r\n\t\t\t\t            \t{ this.props.user && \r\n\r\n\t\t\t\t            \t<div className=\"comments-inner\">\r\n\r\n\r\n\t\t\t\t            \t\t<h3 className={this.state.comments.length === 0 ? \"hidden\" : \"\"}>Comments {this.state.comments.length > 0 && \"(\" + this.state.comments.length + \")\"}</h3>\r\n\r\n\t\t\t\t            \t\t{this.state.comments.length === 0 && <div className=\"no-comments-yet\">No comments yet.</div>}\r\n\t\t\t\t                \t<div className=\"comments-even-more-inner\" ref={this.commentBoxRef}>\r\n\t\t\t\t                  \t{ this.state.comments.map((comment, i) => <Comment index={i} {...comment} hideDocumentString={true} />) }\r\n\t\t\t\t                \t</div>\r\n\t\t\t\t                \t<CommentInput user_profile_icon={this.props.user.profile_icon} submitComment={this.submitComment.bind(this)}/>\r\n\t\t\t\t                \t\r\n\r\n\t\t\t\t              \t</div>\r\n\t\t\t\t              \t}\r\n\t\t\t\t            </div>\r\n\t\t\t\t\t\t          \r\n\t\t\t\t\t\t\r\n                  \t\t</div>\r\n                  \t</div>\r\n\r\n\t\t\t\t</div>\r\n\r\n\r\n\t\t\t</div>\r\n\r\n\t\t)\r\n\t}\r\n}\r\n\r\n\r\nclass CurationDocumentContainer extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\trender() {\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"document-container\">\r\n          \t\t<div className=\"document-wrapper\">\r\n\t          \t\t<div className={\"curation-document\" + ((!this.props.specialName && !this.props.user) ? \" not-yet-annotated\" : \"\")}>\r\n\r\n\t          \t\t\t{ !this.props.specialName && \r\n\t          \t\t\t<div className=\"user-row\">\r\n\r\n\t          \t\t\t\t<ProfileIcon user={this.props.user}/><span className=\"username\">{this.props.user && this.props.user.username}</span> \r\n\t          \t\t\t\t<div className=\"save-time\">Saved on {formatDate(this.props.saveTime)}</div>\r\n\t          \t\t\t</div>\r\n\t          \t\t\t}\r\n\t          \t\t\t{ this.props.specialName && \r\n\t          \t\t\t\t<div className=\"user-row\">\r\n\t          \t\t\t\t\t<span className=\"username\"><em>{this.props.specialName}</em><i class=\"fa fa-info-circle\" title={this.props.specialDescription}></i></span>\r\n\t          \t\t\t\t</div>\r\n\t          \t\t\t}\r\n\t\t          \t\t<div className=\"sentence display-only\">\t\t          \t\t\r\n\r\n\t\t              \t\t<Sentence \r\n\t\t\t\t                index={this.props.index}\r\n\t\t\t\t                words={this.props.tokens}              \r\n\t\t\t\t                annotations={this.props.annotations}  \r\n\t\t\t\t                entityColourMap={this.props.entityColourMap}\r\n\r\n\t\t\t\t                displayOnly={true}\r\n\t\t\t\t              />\t\t\t\t            \r\n\t\t          \t\t\r\n\t\t          \t\t</div>\r\n\t\t          \t</div>\r\n\t\t       \t</div>\r\n\t\t    </div>\r\n\r\n\r\n\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default CurationInterface","import React from 'react';\nimport {Component} from 'react';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { Redirect, Link, BrowserRouter, Route, Switch, withRouter } from 'react-router-dom'\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\nimport {Bar, Line, HorizontalBar } from 'react-chartjs-2';\n\nimport { defaults } from 'react-chartjs-2'\n\nimport { Comment } from '../components/Comment';\n\nimport CategoryHierarchyPage from '../pages/CategoryHierarchyPage';\nimport InvitationsPage from '../pages/InvitationsPage';\n\nimport Error403Page from '../pages/Error403Page';\nimport Error404Page from '../pages/Error404Page';\n\nimport CurationInterface from '../pages/CurationInterface';\n\nimport _ from 'underscore';\nconst queryString = require('query-string');\n\n\ndefaults.global.defaultFontFamily = 'Open Sans'\ndefaults.global.animation.duration = 500;\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }\n};\n\n\nconst chartColours = [\n\"#36A2EB\",\n\"#FF6384\",\n\"#6dc922\",\n\"#B4436C\",\n\"#FFCE56\",\n\"#F78154\",\n\"#5FAD56\",\n\"#4D9078\",\n\"#586BA4\",\n\"#324376\",\n\"#F5DD90\",\n\"#6665DD\",\n\"#7B4B94\",\n];\n\n\n// Couldn't find a good component for this online so I made my own. It visualises the 'annotations per doc' in the form of a \n// waffle chart, which looks more or less like a heat map but without any labels. The data should be ordered in descending freq\n// of number of annotations.\nclass WaffleChart extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n    var maxValue = this.props.data.length - 1;\n\n    var total = this.props.data.reduce((a, b) => a + b, 0);\n    var ratio = Math.min(100, total) / total;\n\n    var tooltips = [];\n\n    var tooltipSide = -1;\n    var rowIdx = 0;\n\n    var data = this.props.data.reverse(); // Reverse the order so that the docs annotated more are on top\n\n    // Calculate the tooltip positions\n    var totalSquares = 0;\n    for(var i in this.props.data) {\n\n      var count = this.props.data[i];\n      var squares = Math.ceil(count * ratio);\n\n      tooltips.push(\n        <span style={{'top': (Math.ceil(totalSquares / 10) * 19) + 'px'}} className={\"waffle-chart-tooltip tooltip-\" + (tooltipSide === 1 ? \"right\" : \"left\")}>\n\n          <b style={{'background': 'rgba(54, 162, 235,' + Math.max(0.1, ((maxValue - i) / maxValue)) + ')'}}>\n            {(maxValue - i === 0) ? \"Not yet annotated\" : ((maxValue - i) + \" annotation\" + (maxValue - i === 1 ? '' : 's'))}\n          </b>\n          <span className=\"num-docs\">{this.props.data[i]} docs</span>\n        </span>\n      );\n\n      tooltipSide *= -1;\n\n      rowIdx += Math.floor(squares / 10) + 1;\n      totalSquares += squares;\n      \n    }\n\n\n    return (\n      <div className=\"waffle-chart-container\">\n        <div className=\"waffle-chart-legend\">\n          <span>{maxValue}</span>\n          <div className=\"waffle-chart-legend-inner\"></div>\n          <span>0</span>\n\n\n        </div>\n        <div className=\"waffle-chart\" id=\"annotations-per-doc-chart\">\n          <div className=\"waffle-chart-squares\">\n            { this.props.data.map((frequency, groupIndex) => {\n\n              var value = maxValue - groupIndex;\n\n              return new Array(Math.ceil(frequency * ratio)).fill(0).map((square, squareIndex) => {\n                return (\n                  <div className=\"waffle-square\" style={\n                    {'background': 'rgba(54, 162, 235,' + Math.max(0.1, ((value) / maxValue)) + ')'}}>\n                    { value }\n                  </div>\n                )\n              }\n              )}\n            )}\n          </div>\n          <div className=\"waffle-chart-info\">1 square = ~{ Math.ceil(1 / ratio) } documents</div> \n          <div className=\"waffle-chart-tooltips\">{ tooltips }</div>\n        </div>    \n\n\n      </div>\n\n      )\n  }\n}\n\n\n// Returns a JSON array of styles for the entity chart.\nfunction getEntityChartStyles() {\n  return {\n    backgroundColor: 'rgba(54, 162, 235, 0.6)',\n    borderColor: 'rgba(54, 162, 235, 0.6)',\n    borderWidth: 1,\n    hoverBackgroundColor: 'rgba(54, 162, 235, 0.6)',\n    hoverBorderColor: 'rgba(54, 162, 235, 0.6)',\n  }\n}\n\n\n// https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\nfunction numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n// Set the styles of the activity chart data.\nfunction setActivityChartStyles(activityChartData) {\n\n  for(var i in activityChartData.datasets) {\n    var colourIdx = parseInt(i) % chartColours.length;\n    activityChartData.datasets[i] = Object.assign({}, activityChartData.datasets[i], {\n      fill: false,\n      lineTension: 0.1,\n      backgroundColor: chartColours[colourIdx],\n      borderColor: chartColours[colourIdx],\n      borderCapStyle: 'square',\n      borderDash: [],\n      borderDashOffset: 0.0,\n      borderJoinStyle: 'bevel',\n      pointBorderColor: chartColours[colourIdx],\n      pointBackgroundColor: chartColours[colourIdx],\n      pointBorderWidth: 3,\n      pointHoverRadius: 6,\n      pointHoverBackgroundColor: chartColours[colourIdx],\n      pointHoverBorderColor: 'rgba(220,220,220,1)',\n      pointHoverBorderWidth: 2,\n      pointRadius: 1,\n      pointHitRadius: 10,\n      lineTension: 0,\n    })\n\n  }\n  return activityChartData;\n}\n\n\n\n// hex to RGB code found here: https://convertingcolors.com/blog/article/convert_hex_to_rgb_with_javascript.html\nString.prototype.convertToRGB = function(){\n    if(this.length != 6){\n        throw \"Only six-digit hex colors are allowed.\";\n    }\n\n    var aRgbHex = this.match(/.{1,2}/g);\n    var aRgb = [\n        parseInt(aRgbHex[0], 16),\n        parseInt(aRgbHex[1], 16),\n        parseInt(aRgbHex[2], 16)\n    ];\n    return aRgb;\n}\n\n// Simple function to darken an RGB array.\nfunction darken(colourRGB, amount) {\n  return [Math.max(colourRGB[0] - amount, 0), Math.max(colourRGB[1] - amount, 0), Math.max(colourRGB[2] - amount, 0)]\n}\n\n\n// The project dashboard, which renders in the container to the right of the navigation.\n// Its data comes from props, not state (so that the dashboard doesn't need to be reloaded when switching between\n// pages in the Project view).\nclass ProjectDashboard extends Component {\n  constructor(props) {\n    super(props);    \n    this.state = {\n      entityChartMulticolour: false,\n      activityChartCumulative: false,\n    }\n  }\n\n\n  toggleEntityChartColours() {\n    this.setState({\n      entityChartMulticolour: !this.state.entityChartMulticolour\n    });\n  }\n\n  toggleActivityChartCumulative() {\n    this.setState({\n      activityChartCumulative: !this.state.activityChartCumulative\n    });\n  }\n\n  // Apply colouring to entityChartData if entityChartMulticolour is true.\n  getColouredData() {\n\n    const entityColours = [\"#99FFCC\", \"#FFCCCC\", \"#CCCCFF\", \"#CCFF99\", \"#CCFFCC\", \"#CCFFFF\", \"#FFCC99\", \"#FFCCFF\", \"#FFFF99\", \"#FFFFCC\", \"#CCCC99\", \"#fbafff\"];\n\n\n    console.log(this.props.data.entityChartData.entityClasses, \"<<\")\n    var entityChartData = this.props.data.entityChartData;\n\n    entityChartData.entityClasses.datasets[0].borderWidth = 1;\n   \n    if(this.state.entityChartMulticolour) {\n\n      entityChartData.entityClasses.datasets[0].backgroundColor = [];\n      entityChartData.entityClasses.datasets[0].borderColor = [];\n      \n\n      for(var i in this.props.data.entityChartData.entityClasses.labels) {\n        var label = this.props.data.entityChartData.entityClasses.labels[i];\n        var colourIdx = this.props.data.entityChartData.colourIndexes[label];\n\n        console.log(colourIdx, label);\n        var colourHex = entityColours[colourIdx % entityColours.length];\n\n        console.log(colourHex);\n        var colourRGB = colourHex.slice(1, 7).convertToRGB();\n\n        entityChartData.entityClasses.datasets[0].backgroundColor.push('rgba(' + colourRGB[0] + ', ' + colourRGB[1] + ', ' + colourRGB[2] + ', 1)');\n\n        var colourRGBBorder = darken(colourRGB, 50);\n        entityChartData.entityClasses.datasets[0].borderColor.push('rgba(' + colourRGBBorder[0] + ', ' + colourRGBBorder[1] + ', ' + colourRGBBorder[2] + ', 1)');\n      }\n\n    } else {\n      entityChartData.entityClasses.datasets[0].backgroundColor = 'rgba(54, 162, 235, 0.6)';      \n      entityChartData.entityClasses.datasets[0].borderColor = 'rgba(54, 162, 235, 0.6)';      \n    }    \n\n    \n    return entityChartData.entityClasses;\n  }\n\n\n  // Process the activity chart data depending on whether cumulative has been checked.\n  processActivityChartData() {\n\n    // Transform datasets into cumulative datasets.\n    // This is probably far more complicated than it needs to be and could be significantly refactored.\n    // Turns out chartjs has a 'redraw' prop that would solve all the issues I was having, so all this weird code is probably unnecessary...\n    // Same goes for getColouredData.\n    function getCumulative(datasets) {\n      var cumulativeDatasets = [];\n      for(var i = 0; i < datasets.length; i++) {\n\n        var label = datasets[i].label;\n        var cumulativeDataset = {label: label, data: new Array(datasets[i].data.length).fill(0)};\n\n        var c = 0;\n        for(var j = datasets[i].data.length - 1; j >= 0; j--) {\n          c += datasets[i].data[j];\n          cumulativeDataset.data[j] = c;\n        }\n        console.log(cumulativeDataset, \">>\");\n        cumulativeDatasets.push(cumulativeDataset);\n      }\n      return cumulativeDatasets;\n    }\n\n    var activityChartDatasets = Object.assign({}, this.props.data.activityChartData.datasets);\n\n    if(this.state.activityChartCumulative) {\n      console.log(this.props.data.activityChartData, \"<<\");\n\n      var cumulativeData = getCumulative(this.props.data.activityChartData.datasets);\n\n      var cumulative = setActivityChartStyles({\n        labels: Object.assign([], this.props.data.activityChartData.labels),\n        datasets: cumulativeData,\n      })\n      return cumulative;\n    }\n\n    return this.props.data.activityChartData;\n  }\n\n\n  render() {\n\n\n    // var heatmapData = new Array(198).fill(3);\n    // var h1 = new Array(200).fill(2)\n    // var h2 = new Array(200).fill(1)\n    // var h3 = new Array(200).fill(0)\n    // heatmapData = heatmapData.concat(h1);\n    // heatmapData = heatmapData.concat(h2);\n    // heatmapData = heatmapData.concat(h3);\n\n    //heatmapData = heatmapData.map(() => Math.random())\n    return (\n     \n      <div id=\"project-dashboard\" className={\"padded \" + (this.props.loading ? \"loading\" : \"\")}>\n        <div className=\"dashboard-top-row\">\n        <div className=\"dashboard-key-items\">\n          <div className=\"dashboard-item\">\n            <div className=\"flex-wrapper\">\n\n\n\n              <div>\n                <div className=\"name\"># Annotated</div>\n                <div className=\"value\"><span class=\"st st-darker\">{ numberWithCommas(this.props.data.numDocGroupsAnnotated) } / { numberWithCommas(this.props.data.totalDocGroups) }</span></div>\n              </div>\n\n              <div class=\"pieChart\">\n\n                { this.props.loading && \n                <PieChart\n                  data={[\n                    { value: 0, color: \"rgb(109, 201, 34)\"},\n                    { value: 1, color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                  ]}\n                  background={\"#d5d5d5\"}\n                  lineWidth={18}\n                  startAngle={270}\n                />\n                }\n                { !this.props.loading && \n                  <PieChart\n                  data={[\n                    { value: (this.props.data.numDocGroupsAnnotated), color: \"rgb(109, 201, 34)\"},\n                    { value: (this.props.data.totalDocGroups - this.props.data.numDocGroupsAnnotated), color: \"rgba(0, 0, 0, 0)\"}, // sneaky \n                  ]}\n                  background={\"#d5d5d5\"}\n                  animate={true}\n                  animationDuration={500}\n                  lineWidth={18}\n                  startAngle={270}\n                />\n                }\n\n\n\n              </div>\n            </div>\n\n          </div>\n          <div className=\"dashboard-item\">\n            <div className=\"name\">Avg. agreement<span className=\"information\" title=\"Average agreement is only calculated for documents with more than one annotation.\"><i class=\"fa fa-info-circle\"></i></span></div>\n            <div className=\"value\"><span class=\"st st-darker\"> { this.props.data.avgAgreement ? (Math.round(this.props.data.avgAgreement * 100) + \"%\") : \"--\"} </span></div>\n          </div>\n          <div className=\"dashboard-item\">\n            <div className=\"name\">Avg. time per document</div>\n            <div className=\"value\"><span class=\"st st-darker\">{ this.props.data.avgTimePerDocument } seconds</span></div>\n          </div>\n          </div>\n\n          <Link to={\"/projects/\" + this.props.project_id + \"/tagging\"} className=\"annotate-button\"><i class=\"fa fa-pencil\"></i>Annotate<div className=\"subtitle\">{this.props.data.userDocsAnnotated}/{this.props.data.userAnnotationsRequired} complete</div></Link>\n\n        </div>\n\n\n\n        <div className=\"dashboard-white-boxes\">\n\n\n          <div className=\"dashboard-wrapper-item col-60\">\n\n\n\n            <div className=\"dashboard-item col-100\">\n              <div className=\"inner\">\n                <div className=\"dashboard-flex-header\">\n                  <h3>Entity frequencies</h3>\n                  { this.props.data.entityChartData && <div onClick={this.toggleEntityChartColours.bind(this)} className={\"chart-option\" + (this.state.entityChartMulticolour ? \" active\" : \"\")}><span className=\"checkbox\"></span><span>Colour by class</span></div> }\n                </div>\n                <div>\n                  { this.props.loading && \n                    <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                  }\n                  { !this.props.loading && !this.props.data.entityChartData && <div className=\"chart-placeholder chart-not-available\">This project does not have any annotations yet.</div>}\n                  { !this.props.loading && this.props.data.entityChartData &&\n                  <Bar\n                    data={this.getColouredData()}\n                    height={230}\n                    options={{\n                      responsive: true,\n                      maintainAspectRatio: false,\n                      legend: {\n                        display: false\n                      },\n                      scales: {\n                        yAxes: [{\n                          ticks: {\n                            beginAtZero: true,\n                            precision: 0\n                            \n                          },\n                          scaleLabel: {\n                            display: true,\n                            labelString: \"Frequency\"\n                          }\n                        }]\n                      },\n                    }}\n                  />}\n\n\n                </div>\n              </div>\n            </div>\n\n            <div className=\"dashboard-item col-60\">\n              <div className=\"inner\">\n                <div className=\"dashboard-flex-header\">\n                  <h3>Activity</h3>\n                  { this.props.data.activityChartData && <div onClick={this.toggleActivityChartCumulative.bind(this)} className={\"chart-option\" + (this.state.activityChartCumulative ? \" active\" : \"\")}><span className=\"checkbox\"></span><span>Cumulative</span></div> }\n                </div>\n                <div>\n                  { this.props.loading && \n                    <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                  }\n                  { !this.props.loading && !this.props.data.activityChartData && <div className=\"chart-placeholder chart-not-available\">This project does not have any activity yet.</div>}\n                  { !this.props.loading &&  this.props.data.activityChartData &&\n                  <Line\n                    data={() => this.processActivityChartData()}\n                    height={230}\n                    redraw\n                    options={{\n                      responsive: true,\n                      maintainAspectRatio: false,\n                      scales: {\n                        xAxes: [{\n                          type: 'time',\n                          time: {\n                            unit: 'day',\n                          },\n                          ticks: {\n                            max: new Date()\n                          }\n                        }],\n                        yAxes: [{\n                          ticks: {\n                            beginAtZero: true,\n                            precision: 0\n                            \n                          },\n                          scaleLabel: {\n                            display: true,\n                            labelString: \"Annotations\"\n                          }\n                        }]\n                      }\n                    }}/>\n                  }\n                </div>\n              </div>\n            </div>\n\n            \n\n            <div className=\"dashboard-item col-40\">\n              <div className=\"inner\">\n                <h3>Annotations/document</h3>\n                { this.props.loading && \n                  <div className=\"chart-placeholder\"><i class=\"fa fa-cog fa-spin\"></i>Loading...</div>\n                }\n                { !this.props.loading && \n                  <WaffleChart data={this.props.data.annotationsChartData}/>\n                }\n              </div>\n            </div>\n          </div>\n\n        \n\n\n        <div className=\"dashboard-item col-40 double-height\">\n          <div className=\"inner\">\n            <h3>Comments</h3>\n\n            <div className={\"comments-wrapper\" + (this.props.data.comments.length === 0 ? \" no-comments\": \"\")}>       \n\n              { this.props.data.comments.length === 0 && <div className=\"no-comments\">This project does not have any comments yet.</div>}       \n\n              { this.props.data.comments.map((comment, i) => <Comment index={i} {...comment} project_id={this.props.project_id} />) }\n\n            </div>\n          </div>\n        </div>\n\n          \n        </div>\n\n\n      </div>    \n      \n    )\n  }\n}\n\n\n\nclass ProjectViewSidenav extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n    /* old \n    <div className=\"project-card\">\n      <div className=\"circle-icon\"><div className=\"inner\">PO</div></div>\n      <div>\n        <div className=\"project-name\">Project one</div>\n        <div className=\"project-creator\">Created by <span className=\"creator-name\">someone</span></div>\n      </div>\n    </div>\n\n\n\n    <div className=\"go-back\"><Link to=\"/projects\"><i class=\"fa fa-chevron-left\"></i>Projects</Link></div>\n\n    */\n\n    var currentLocation = window.location.pathname;\n\n\n    var view = currentLocation.split('/').slice(3, currentLocation.split('/').length);\n    console.log(view);\n\n    return (\n      <nav id=\"project-view-sidenav\">\n        <div className=\"project-card\">\n          <div>\n            <div className={\"project-name\" + (!this.props.projectTitle ? \" st\" : \"\")} style={{'display': 'block'}}><Link to={\"/projects/\" + this.props.project_id + \"/dashboard\"}>{this.props.projectTitle ? this.props.projectTitle : \"xxxxxxxx\"}</Link></div>\n            <div className={\"project-creator\" + (!this.props.projectAuthor ? \" st\" : \"\")} style={{'display': 'block'}}>Created by <span className=\"creator-name\">{this.props.projectAuthor ? this.props.projectAuthor : \"xxxxxxxx\"}</span></div>\n          </div>\n        </div>\n\n        <ul className=\"sidenav-items\">\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Dashboard\" icon=\"bar-chart\"/>\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Entity Hierarchy\" icon=\"sitemap\"/>  \n\n          <ProjectViewSidenavSubmenu project_id={this.props.project_id} view={view} name=\"Annotations\" menuItems={ [{name: \"Curation\", icon: \"gavel\"}, { name: \"Download\", icon: \"download\" }] } icon=\"list-alt\"/>\n\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Annotators\" icon=\"user\"/>\n          <ProjectViewSidenavButton project_id={this.props.project_id} view={view} name=\"Settings\" icon=\"wrench\"/>\n        </ul>\n\n      </nav>\n    )\n  }\n}\n//           <ProjectViewSidenavSubmenu project_id={this.props.project_id} view={view} name=\"Annotations\" menuItems={ [{name: \"Curation\", icon: \"list-alt\"}, { name: \"Download\", icon: \"download\" }] }icon=\"list-alt\"/>\n\n\nclass ProjectViewSidenavSubmenu extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n\n\n  render() {\n\n    var pathName = this.props.name.replace(\" \", \"-\").toLowerCase();\n\n    console.log(this.props.view, pathName)\n\n\n\n    var firstChildPathName = this.props.menuItems[0].name.replace(\" \", \"-\").toLowerCase();\n    var open = this.props.view[0] === pathName;\n    return (\n      <li className={\"submenu-header\" + (this.props.view[0] === pathName ? \" active\" : \"\")}>\n        <Link to={\"/projects/\" + this.props.project_id + \"/\" + pathName +\"/\" + firstChildPathName} ><i className={\"fa fa-\" + this.props.icon}></i>{ this.props.name }</Link>\n        <ul className={\"submenu\" + (open ? \" open\" : \"\")}>\n        {this.props.menuItems.map((item, index) => <ProjectViewSidenavButton project_id={this.props.project_id} view={this.props.view} name={item.name} parentPath={pathName} icon={item.icon}/>)}\n        </ul>\n      </li>\n    )\n  }\n}\n\n\nclass ProjectViewSidenavButton extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    var pathName = this.props.name.replace(\" \", \"-\").toLowerCase();\n    if(this.props.parentPath) pathName = this.props.parentPath + \"/\" + pathName;\n    return (\n      <li className={this.props.view.join('/') === pathName ? \"active\" : \"\"}>\n        <Link to={\"/projects/\" + this.props.project_id + \"/\" + pathName}>\n        <i className={\"fa fa-\" + this.props.icon}></i>{ this.props.name }\n        </Link>\n\n\n      </li>\n    )\n  }\n}\n\nclass EmptyThing extends Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    return ( <main>This page is still a work in progress!</main> )\n  }\n}\n\n\n\n\n\n\n\n\n/*  <div className=\"wrapper\">\n          <div className=\"inner\">\n            <table className=\"category-hierarchy-table\">\n              <thead>\n                <tr>\n                  <th><span className=\"inner\">Category</span></th>\n                  <th><span className=\"inner\">Description</span></th>\n                </tr>\n              </thead>\n              <tbody>\n                { this.props.loading && generateEmptyRows(15) }\n                { this.props.data && this.props.data.categories.map((row, index) => \n                  <tr>\n                    <td className={\"color-\" + getColourIndex(row, this.props.colourIndexes)}><span className=\"inner\">{getRowName(row)}</span></td>\n                    <td><span className=\"inner\">(none)</span></td>\n                  </tr>\n                )}\n              </tbody>\n\n            </table>\n          </div>\n        </div>\n*/\n\nclass ProjectView extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n\n      error: null,\n\n      data: {\n\n        dashboard: {\n\n          userDocsAnnotated: 0,\n          userAnnotationsRequired: 0,\n\n          numDocGroupsAnnotated: 999,\n          totalDocGroups: 9999,\n\n          avgAgreement: 0.5,\n\n          avgTimePerDocument: 15,\n\n          \n\n          // Note that the comments below are just placeholders. I should probably generate a function to make these automatically\n          // These will be skeleton screens on the comments div\n          comments: [\n            {\n              author: \"Mr Pingu\",\n              date: \"4 Sept\",\n              text: \"Noot noot! I don't know what this is\",\n              document_string: \"one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Mrs Pingu\",\n              date: \"3 Sept\",\n              text: \"This doesn't make sense\",\n              document_string: \"one two three four five six seven one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Michael\",\n              date: \"1 Sept\",\n              text: \"Not sure what a flange is\",\n              document_string: \"one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Michael\",\n              date: \"1 Sept\",\n              text: \"I sure hope these never get rendered\",\n              document_string: \"one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            },\n            {\n              author: \"Borat\",\n              date: \"1 Sept\",\n              text: \"very nice\",\n              document_string: \"one two three four five six seven one two three four five six seven \",\n              user_profile_icon: {\n                foreground: \"#eee\",\n                background: \"#eee\",\n                icon: \"fa-user\",\n              }\n            }\n          ],\n        } ,\n        categoryHierarchy: { children: [] },      \n      },\n\n       \n    }\n\n    // Store the state of the curation interface so it persists across page changes   \n    this.curationInterfaceState = null;\n  }\n\n  componentWillMount() {\n    var t = this;\n\n    fetch('http://localhost:3000/api/projects/' + this.props.project_id, fetchConfigGET) // TODO: move localhost out\n      .then((response) => {\n        if(response.status === 403) {\n          throw new Error(403);\n        } else if(response.status === 404) {\n          throw new Error(404);\n        }     \n\n        return response.text()\n      })\n      .then((data) => {\n\n        //console.log(data, \"<<<\");\n        var d = JSON.parse(data);\n\n        window.setTimeout(() => {\n\n          // Add the chart styles here in the front-end\n          //var entityChartData = d.dashboard.entityChartData.entityClasses   //.datasets[0], getEntityChartStyles())\n          //d.dashboard.entityChartData.entityClasses.datasets[0] = entityChartData;\n\n          if(d.dashboard.activityChartData) d.dashboard.activityChartData = setActivityChartStyles(d.dashboard.activityChartData);\n\n          //console.log(d);\n\n\n          t.setState({\n            loading: false,\n            data: d,\n            \n          }, () => { this.props.setProject(d.project_name, d.project_author); } );\n      }, 555);\n    }).catch((err) => {\n      console.log(err.message);\n\n      this.setState({\n        error: parseInt(err.message)\n      })\n\n    });\n\n\n\n\n    \n    // Query api for project\n\n  }\n\n  setCurationInterfaceData(data) {\n    console.log(\"saving state\", data);\n    this.curationInterfaceState = data;\n  }\n\n  render() {\n    var location = this.props.location;\n    console.log(\"Rendering project view\", this.curationInterfaceState)\n\n    var docId = queryString.parse(location.search).docId;\n    \n\n    return (\n      \n      <div>\n      {!this.state.error && \n        <div id=\"project-view\" className={this.state.loading ? \"loading\" : \"\"}>\n          <ProjectViewSidenav \n                              project_id={this.props.project_id}\n                              projectTitle={this.props.projectTitle}\n                              projectAuthor={this.props.projectAuthor}\n\n                               />\n\n\n          <div className=\"project-view-wrapper\">\n            <TransitionGroup className=\"transition-group\">\n              <CSSTransition\n              key={location.key}\n              timeout={{ enter: 400, exit:400 }}\n              classNames=\"fade\"\n              >\n                <section className={\"route-section\" + (!this.state.loading ? \" loaded\" : \"\")}>\n                 <Switch location={location}>\n                    <Route path=\"/projects/:id/dashboard\"           render={() => <ProjectDashboard loading={this.state.loading} data={this.state.data.dashboard} project_id={this.props.project_id} />} />     \n                    <Route path=\"/projects/:id/annotations/curation\"            render={() => <CurationInterface user={this.props.user} project_id={this.props.project_id} prevState={this.curationInterfaceState} saveState={this.setCurationInterfaceData.bind(this)} loading={this.state.loading} documentIdQuery={docId} />} />     \n                    <Route path=\"/projects/:id/annotations/download\"            render={() => <EmptyThing {...this.state} />} />     \n                    <Route path=\"/projects/:id/entity-hierarchy\"  render={() => <CategoryHierarchyPage loading={this.state.loading} data={this.state.data.categoryHierarchy} colourIndexes={this.state.data.dashboard.entityChartData ? this.state.data.dashboard.entityChartData.colourIndexes : null} />} />     \n                    <Route path=\"/projects/:id/annotators\"         render={() => <InvitationsPage data={this.state.data.invitationsTable ? this.state.data.invitationsTable : {}} loading={this.state.loading} />} />     \n                    <Route path=\"/projects/:id/settings\"            render={() => <EmptyThing {...this.state} />} />   \n                    <Route             render={() => <Error404Page />} />   \n                  </Switch>\n                </section>\n              </CSSTransition>\n            </TransitionGroup>\n          </div>\n        \n      \n\n          \n\n\n        </div> }\n        { this.state.error === 403 && <Error403Page/> }    \n        { this.state.error === 404 && <Error404Page/> }    \n      </div>\n      \n    )\n  }\n}\n// { currentView }\n\nexport default withRouter(ProjectView);","import React from \"react\";\r\nimport {Component} from \"react\";\r\n\r\nimport { Redirect, Link, BrowserRouter, Route, Switch, withRouter } from 'react-router-dom'\r\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\r\nimport getCookie from '../functions/getCookie';\r\n\r\n\r\nvar lipsumStr = \"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui. Etiam rhoncus. Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna. Sed consequat, leo eget bibendum sodales, augue velit cursus nunc,\";\r\nvar lipsum = lipsumStr.split(\". \")\r\n\r\nfunction getRandomString() {\r\n  var arr = []\r\n  for(var i = 0; i < 200; i++) {\r\n    arr.push(lipsum[Math.floor(Math.random() * lipsum.length)] + \". \")\r\n  }\r\n  return arr.join(\"\")\r\n}\r\n\r\nfunction getNextWord(i) {\r\n  return lipsum[i] + \" \";\r\n}\r\n\r\n\r\n\r\nclass LettersBackground extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      characters: getRandomString(),\r\n    }\r\n    this.characterChangeFn = null;\r\n  }\r\n\r\n  changeCharacters() {\r\n    this.setState({\r\n      characters: getRandomString(),\r\n    })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.clearInterval(this.characterChangeFn);\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.characterChangeFn = window.setInterval(this.changeCharacters.bind(this), 1000);\r\n    // Was originally rotating chars but seems unnecessary\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"letters-background\">\r\n        {this.state.characters}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass HomePageRegister extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div class=\"user-form form-box\">\r\n        <div class=\"header\">\r\n          <h1>Register</h1>\r\n        </div>\r\n        <div class=\"body\">\r\n          <div className=\"loading-message\"><i className=\"fa fa-spinner fa-spin\"></i>Loading...</div>\r\n          <form action=\"/redcoat/register\" method=\"post\">\r\n            <div>\r\n              <label>Username</label>\r\n              <input type=\"text\" name=\"username\" autoFocus=\"autofocus\" placeholder=\"Username\"/>\r\n            </div>\r\n            <div>\r\n              <label>Email</label>\r\n              <input type=\"email\" name=\"email\" placeholder=\"Email\" required=\"required\"/>\r\n            </div>\r\n            <div>\r\n              <label>Password</label>\r\n              <input id=\"password\" type=\"password\" name=\"password\" placeholder=\"Password\" required=\"required\"/>\r\n              <label>Password confirmation</label>\r\n              <input id=\"password_confirmation\" type=\"password\" name=\"password_confirmation\" required=\"required\" placeholder=\"Password confirmation\"/>\r\n            </div>\r\n            <div class=\"buttons\">\r\n              <div><Link class=\"back-button\" to=\"/\"><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\r\n              <div>\r\n                <input type=\"submit\" value=\"Register\"/>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass HomePageLogin extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      email: '',\r\n      password: '',\r\n      error: null,\r\n      errorMessage: null,\r\n    }\r\n  }\r\n\r\n  handleUsernameChange(e) {\r\n    this.setState({\r\n      email: e.target.value,\r\n    })\r\n  }\r\n\r\n  handlePasswordChange(e) {\r\n    this.setState({\r\n      password: e.target.value,\r\n    })\r\n  }\r\n\r\n  submitForm(e) {\r\n    e.preventDefault();\r\n    console.log(e);\r\n    const csrfToken = getCookie('csrf-token');\r\n\r\n    const fetchConfigPOST = {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',\r\n        'csrf-token': csrfToken,\r\n      },\r\n      dataType: \"json\",\r\n      body: JSON.stringify({\r\n        email: this.state.email,\r\n        password: this.state.password,\r\n      }),  \r\n      credentials: 'include',\r\n    };\r\n\r\n\r\n    this.setState({\r\n      errorMessage: null,\r\n      loading: true,\r\n    }, () => \r\n\r\n      window.setTimeout( () => {\r\n\r\n        fetch('http://localhost:3000/api/users/login', fetchConfigPOST) // TODO: move localhost out\r\n        .then(async (response) => {\r\n          if(response.status !== 200) {\r\n            var d = await response.json();\r\n            throw new Error(d.message);      \r\n          }          \r\n          return response.text()\r\n        })\r\n        .then((data) => {\r\n          try {\r\n            var d = JSON.parse(data);\r\n          } catch(err) {\r\n            console.log(err, d);\r\n            throw new Error(\"An unexpected error has occured\")\r\n          }\r\n          \r\n          this.props.setUserData(d);          \r\n        }).catch((err) => {\r\n          this.setState({\r\n            errorMessage: err.message,\r\n            password: '',\r\n            loading: false,\r\n          });\r\n        })\r\n      }, 1)\r\n    );\r\n\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div class={\"user-form form-box\" + (this.state.loading ? \" loading\" : \"\")}>\r\n        <div class=\"header\">\r\n          <h1>Login</h1>\r\n        </div>\r\n        <div class=\"body\">\r\n          <div className=\"loading-message\"><i className=\"fa fa-spinner fa-spin\"></i>Loading...</div>\r\n          { this.state.errorMessage && <div className=\"error-message\"><span className=\"error\">Error: </span>{this.state.errorMessage}.</div>}\r\n          \r\n          <form onSubmit={this.submitForm.bind(this)} method=\"post\">\r\n            <div>\r\n              <label>Username or email</label>\r\n              <input type=\"text\" name=\"email\" autoFocus=\"autofocus\" required=\"required\" placeholder=\"Username or email\" value={this.state.email} onChange={this.handleUsernameChange.bind(this)} />\r\n            </div>\r\n            <div>\r\n              <label>Password</label>\r\n              <input type=\"password\" name=\"password\" required=\"required\" placeholder=\"Password\" value={this.state.password} onChange={this.handlePasswordChange.bind(this)} />\r\n            </div><Link class=\"forgot-password-link\" to=\"/forgot_password\">Forgot password?</Link>\r\n            <div class=\"buttons\">\r\n              <div><Link class=\"back-button\" to=\"/\"><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\r\n              <div>\r\n                <input type=\"submit\" value=\"Login\"/>\r\n              </div>\r\n            </div>\r\n          </form>\r\n\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass HomePageForgotPassword extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div class=\"user-form form-box\">\r\n        <div class=\"header\">\r\n          <h1>Forgot Password</h1>\r\n        </div>\r\n        <div class=\"body\">\r\n          <form action=\"/redcoat/forgot_password\" method=\"post\">\r\n            <input type=\"hidden\" name=\"_csrf\" value=\"oOFHs5QK-_YPdUWgNII3vfrQ_erXv2dwFmz8\"/>\r\n            <div>\r\n              <label>Email</label>\r\n              <input type=\"email\" name=\"email\" placeholder=\"Email\" required=\"required\" autoFocus=\"autofocus\"/>\r\n            </div>\r\n            <div class=\"buttons\">\r\n              <div><Link class=\"back-button\" to=\"/login\"><i class=\"fa fa-chevron-left\"></i>&nbsp;&nbsp; Back</Link></div>\r\n              <div>\r\n                <input type=\"submit\" value=\"Reset password\"/>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass HomePageMain extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"homepage-main\">\r\n        <h1 id=\"h1-welcome\" data-content=\"Redcoat\">Redcoat</h1>\r\n        <h2 id=\"h2-byline\" data-content=\"Collaborative Annotation Tool\">Collaborative Annotation Tool</h2>\r\n        <div class=\"buttons\"><Link to=\"/register\">\r\n            <div class=\"button\" id=\"register-button\">\r\n              <h2>\r\n               Register\r\n              </h2>\r\n            </div></Link><Link to=\"/login\">\r\n            <div class=\"button\" id=\"login-button\">\r\n              <h2>\r\n                Login\r\n              </h2>\r\n            </div></Link></div>\r\n        </div>\r\n\r\n      )\r\n\r\n\r\n  }\r\n}\r\n\r\nclass HomePage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  render() {\r\n\r\n    var location = this.props.location;\r\n\r\n    return (\r\n    \r\n      <section id=\"welcome\">\r\n        <LettersBackground/>\r\n\r\n        <TransitionGroup className=\"transition-group\">\r\n          <CSSTransition\r\n          key={location.key}\r\n          timeout={{ enter: 400, exit:400 }}\r\n          classNames=\"fade\"\r\n          >\r\n            <section className=\"route-section homepage-route-section\">\r\n             <Switch location={location}>\r\n                 \r\n                <Route path=\"/login\"    render={() => <HomePageLogin setUserData={this.props.setUserData}/> } />     \r\n                <Route path=\"/register\" component={HomePageRegister} />  \r\n                <Route path=\"/forgot_password\" component={HomePageForgotPassword} />  \r\n                <Route path=\"/\"         component={HomePageMain} />       \r\n                \r\n              </Switch>\r\n            </section>\r\n          </CSSTransition>\r\n        </TransitionGroup>\r\n\r\n      </section>\r\n      \r\n\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default withRouter(HomePage);","import React from \"react\";\r\nimport {Component} from \"react\";\r\n\r\n\r\nclass SetupProjectPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  render() {\r\n    return (\r\n      <div>\r\n        <p>Hello I am the setup project page</p>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default SetupProjectPage;","import React from \"react\";\r\nimport {Component} from \"react\";\r\nimport { TwitterPicker } from 'react-color';\r\n\r\nimport { Link } from \"react-router-dom\";\r\nimport getCookie from '../functions/getCookie'\r\nimport _ from 'underscore';\r\n\r\n// A list of icon options from FontAwesome that the user can choose from\r\nconst iconOptions = [\r\n  \"user\", \"anchor\", \"automobile\", \"asterisk\", \"bath\", \"battery\", \"binoculars\", \"bicycle\", \"bomb\", \"bullhorn\", \"child\", \"cubes\", \"female\", \"diamond\", \"cogs\", \"coffee\", \"fax\", \"flag\", \"fire-extinguisher\", \"flash\", \"fire\", \"male\", \"heart\", \"gift\", \"globe\", \"legal\", \"leaf\", \"microphone\", \"paw\", \"rocket\", \"magnet\", \"star\", \"space-shuttle\", \"trophy\", \"umbrella\"\r\n]\r\n\r\nconst colourOptions = \r\n[\"#f44336\", \"#e91e63\", \"#9c27b0\", \"#673ab7\", \"#3f51b5\", \"#2196f3\", \"#03a9f4\", \"#00bcd4\", \"#009688\", \"#4caf50\", \"#8bc34a\", \"#cddc39\", \"#ffeb3b\", \"#ffc107\", \"#ff9800\", \"#ff5722\", \"#795548\", \"#eee\", \"#ccc\", \"#aaa\", \"#888\", \"#444\", \"#222\"]\r\n\r\n\r\nclass UserProfilePage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      user: {                   // The user is stored in both this.state and this.props (from App.js).\r\n        profile_icon: {         // Unsaved changes will be stored in this.state.\r\n          foreground: \"#aaa\",   // Changes that are saved are pushed up to App.js in the saveChanges function.\r\n          background: \"#eee\",\r\n          icon: 'user',\r\n        },\r\n        \r\n      }\r\n    }\r\n  }\r\n\r\n  // When this component is updated via App.js, check whether the user profile has been updated.\r\n  // If it has, set this user to props.user.\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if(!_.isEqual(prevProps.user, this.props.user) && !_.isEqual(this.props.user, this.state.user)) {\r\n      console.log('sidsp')\r\n      this.setState({\r\n        user: this.props.user,\r\n      });\r\n    }\r\n  }\r\n\r\n  componentWillMount() {\r\n    if(this.props.user) {\r\n      this.setState({\r\n        user: this.props.user,\r\n      });\r\n    }\r\n  }\r\n\r\n  // Submit the changes (which are saved in the state) to the API.\r\n  saveChanges() {\r\n    var t = this;\r\n    console.log('saving')\r\n    const csrfToken = getCookie('csrf-token');\r\n    const fetchConfigPOST = {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',\r\n        'csrf-token': csrfToken,\r\n      },\r\n      dataType: \"json\",\r\n      body: JSON.stringify(this.state.user.profile_icon),  \r\n    };\r\n\r\n    this.setState({\r\n      saving: true, \r\n    }, () => {\r\n      fetch('http://localhost:3000/api/users/set_profile_icon', fetchConfigPOST) // TODO: move localhost out\r\n      .then(response => response.text())\r\n      .then((data) => {\r\n\r\n        var d = JSON.parse(data);       \r\n        t.props.setUserProfileIcon(d.profile_icon);\r\n\r\n        this.setState({\r\n          saving: false,\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  // Set the foreground colour\r\n  handleForegroundColourChange(colour) {\r\n    var user = this.state.user;\r\n    user.profile_icon.foreground = colour.hex;\r\n    this.setState({\r\n      user: user,\r\n    })\r\n  }\r\n\r\n  // Set the background colour\r\n  handleBackgroundColourChange(colour) {\r\n    console.log('hello')\r\n    var user = this.state.user;\r\n    user.profile_icon.background = colour.hex;\r\n    this.setState({\r\n      user: user,\r\n    })\r\n  }\r\n\r\n  // Set the icon\r\n  setIcon(icon) {\r\n    if(iconOptions.indexOf(icon) === -1) return;\r\n    var user = this.state.user;\r\n    user.profile_icon.icon = icon;\r\n    this.setState({\r\n      user: user,\r\n    }, () => { console.log(this.state.user.profile_icon.icon)})\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"user-profile-page\">\r\n\r\n\r\n        \r\n        <section className=\"form-section\">\r\n\r\n          <h3>Profile icon</h3>\r\n\r\n          <div className=\"flex-columns align-center\">\r\n\r\n            <div className=\"flex-column\">\r\n              <div className=\"profile-icon-preview\">\r\n                <div className=\"circle-icon profile-icon extra-large box-shadow\" style={{'background': this.state.user.profile_icon.background}}><i className={\"profile-icon-i fa fa-\" + this.state.user.profile_icon.icon} style={{'color': this.state.user.profile_icon.foreground}}></i></div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex-column vertical-align-top\">\r\n              <h4>Foreground colour</h4>\r\n              <TwitterPicker\r\n                colors={colourOptions}\r\n                color={ this.state.user.profile_icon.foreground }\r\n                onChangeComplete={ this.handleForegroundColourChange.bind(this) }\r\n              />\r\n            \r\n              <h4>Background colour</h4>\r\n              <TwitterPicker\r\n                colors={colourOptions}\r\n                color={ this.state.user.profile_icon.background }\r\n                onChangeComplete={ this.handleBackgroundColourChange.bind(this) }\r\n              />\r\n            </div>\r\n          \r\n            <div className=\"flex-column vertical-align-top\">\r\n              <h4>Icon</h4>\r\n              <div className=\"icon-options\">\r\n                { iconOptions.map((icon, index) => <div onClick={() => this.setIcon(icon)} className={\"icon-option\" + (icon === this.state.user.profile_icon.icon ? \" active\" : \"\")}><i class={\"fa fa-\" + icon}></i></div>)}\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n          <div className=\"form-save-row\">\r\n            <a className=\"annotate-button submit-button\" onClick={this.saveChanges.bind(this)} ><i class=\"fa fa-save\"></i>Save</a>\r\n          </div>\r\n      </section>\r\n    </div>\r\n\r\n    )\r\n  }\r\n}\r\n\r\n\r\nexport default UserProfilePage","import React from 'react';\n\nimport './stylesheets/stylesheet.scss';\nimport {Component} from 'react';\n\nimport { Redirect, Link, BrowserRouter, Route, Switch } from 'react-router-dom'\n\nimport getCookie from './functions/getCookie';\n\nimport ScrollToTop from './functions/ScrollToTop';\n\nimport Container from './Container';\nimport Navbar from './components/Navbar';\n\nimport TaggingInterface from './pages/TaggingInterface';\nimport FeaturesPage from './pages/FeaturesPage';\nimport ProjectListPage from './pages/ProjectListPage';\nimport ProjectView from './pages/ProjectView';\nimport HomePage from './pages/HomePage';\nimport Error404Page from './pages/Error404Page';\nimport SetupProjectPage from './pages/SetupProjectPage';\nimport UserProfilePage from './pages/UserProfilePage';\n\nimport redcoatMan from './images/redcoat-1-grey.png'\n\nimport Auth from \"./functions/Auth\"\n\n// Config for all API fetch requests\nconst fetchConfigGET = {\n  method: 'GET',\n  headers: {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  },\n  credentials: 'include',\n};\n\n\n// A template component that renders the majority of the pages.\nclass MainTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>\n        \n        <header className=\"bg-header\">\n            <div id=\"header-project-details\" className=\"title\">\n              <h1>{this.props.pageTitle}</h1>\n            </div>\n          </header>\n        <main className=\"container\">\n          { this.props.pageComponent }\n        </main>\n      </div>\n    )\n  }\n}\n\n\n\n\n// A template component for the tagging interface, which is almost the same as MainTemplate but without the <main> container.\nclass TaggingInterfaceTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>        \n        { this.props.pageComponent }\n      </div>\n    )\n  }\n}\n\n\nclass LoadingScreen extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className={\"loading-screen\" + (this.props.fadingOut ? \" fading-out\" : \"\") }>\n        <div className=\"background background-under\"></div>\n        <div className=\"background background-over\"></div>\n        <span><i className=\"fa fa-cog fa-spin\"></i>Loading...</span>\n\n      </div>\n    )\n  }\n}\n\n// A template component for the project dashboard.\nclass ProjectViewTemplate extends Component {\n\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n\n    return (\n      <div>\n        { this.props.pageComponent }\n      </div>\n    )\n  }\n}\n\nclass Footer extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <footer>\n        <div className=\"footer-logo\"></div>\n        <h2>Redcoat</h2>\n        <p>Built by the NLP-TLP team at UWA.</p>\n\n      </footer>\n\n    )\n  }\n}\n\nclass Logout extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  componentWillMount() {\n    this.props.logout()    \n  }\n\n  render() {\n    return (<Redirect to=\"/\"/>)\n  }\n}\n\n// The app, which routes everything and renders the pages.\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      pageTitle: \"Redcoat\",\n      username: null,\n\n      // Store the current project title and author so that they don't awkwardly reload between component changes\n      projectTitle: null,\n      projectAuthor: null,\n\n      setProject: this.setProject.bind(this),\n\n      loading: true,\n      loadingFadeOut: false,\n\n      loggingOut: false,\n\n      user: null, // stores 'username' and 'profile icon'\n    }\n  }\n\n  // Update the project title and author\n  setProject(title, author) {\n    this.setState({\n      projectTitle: title,\n      projectAuthor: author,\n    })\n  }\n\n  getUserData() {\n    window.setTimeout( () => {\n    fetch('http://localhost:3000/api/users/userData', fetchConfigGET) // TODO: move localhost out\n    .then(response => response.text())\n    .then((data) => {\n      console.log(data);\n      var d = JSON.parse(data);\n\n\n\n\n      try {\n        const username = getCookie('user');\n        console.log(username);\n      } catch(err) {\n        console.log(err);\n      }\n\n\n      this.setState({\n        user: d.user,\n        loading: false,\n        loadingFadeOut: true,\n      }, () => {\n        window.setTimeout(() => this.setState({loadingFadeOut: false}), 500);\n      })\n    });\n  }, 200);\n  }\n\n  // set the data for the currently logged-in user\n  // Called by the homepage (after logging in)\n  setUserData(user) {\n    this.setState({\n      user: user,\n    })\n  }\n\n  // Log out.\n  async logout() {\n    if(!this.state.user) return;\n    await this.setState({\n      user: null,\n      //loggingOut: true,\n    });\n\n    window.setTimeout( () => \n\n    fetch('http://localhost:3000/api/users/logout', fetchConfigGET)\n    .then(response => response.text())\n    .then((data) => {\n      console.log(\"Logged out\")\n      this.setState({\n        //loggingOut: false,\n        user: null,\n      })\n    }), 2);    \n  }\n\n  // Update this component's user profile icon.\n  setUserProfileIcon(profileIcon) {\n    var user = this.state.user;\n    user.profile_icon = profileIcon;\n    console.log(profileIcon);\n    this.setState({\n      user: user,\n    })\n\n  }\n\n  // When mounted, determine the logged in user.\n  componentWillMount() {\n\n    \n    this.getUserData();\n      \n\n\n    // The express server will save the username into a cookie so that the front-end client can be 'logged in' immediately.\n    // Check if the cookie exists. If not, query the API for the logged in user.\n    // API is necessary because it is possible to disable cookies.\n    // const username = getCookie('username');\n    // if(username !== undefined) {\n    //   console.log('Username from cookie:', username)\n    //   this.setState({\n    //     username: username,\n    //   });\n    //   return;\n    // }\n    // console.log(\"Username not found in cookie, querying API\");\n\n\n  }\n\n\n\n  render() {\n\n\n\n\n\n    return (    \n\n      <div id=\"app\" className={(this.state.loading ? \"loading\" : \"\") + (this.state.loggingOut ? \" logging-out\" : \"\")}>\n        <BrowserRouter>\n\n          <ScrollToTop/>\n          \n\n\n\n          { (this.state.loading || this.state.loadingFadeOut) && <LoadingScreen fadingOut={this.state.loadingFadeOut}/>}\n          {!this.state.loading &&\n\n            <div className=\"fade-in\">\n            <Navbar user={this.state.user} loading={this.state.loading} />  \n\n            <Switch>\n            <PrivateRoute user={this.state.user} path=\"/projects/:id/tagging\" render={(p) => \n              <TaggingInterfaceTemplate {...this.state} pageComponent={\n                <TaggingInterface \n                  projectTitle={this.state.projectTitle}\n                  projectAuthor={this.state.projectAuthor}\n                  setProject={this.setProject.bind(this)}\n                  project_id={p.match.params.id}\n                  user={this.state.user}/>}\n                />}\n              /> \n            <PrivateRoute user={this.state.user} path=\"/projects/:id\" render={(p) => \n              <ProjectViewTemplate {...this.state} pageTitle=\"Project View\" pageComponent={ \n                <ProjectView\n                  project_id={p.match.params.id}\n                  setProject={this.setProject.bind(this)}\n                  projectTitle={this.state.projectTitle}\n                  projectAuthor={this.state.projectAuthor}\n                  user={this.state.user} /> }\n                />}\n              />     \n\n\n            <PrivateRoute user={this.state.user} path=\"/projects\" render={ () =>\n              <MainTemplate {...this.state} pageTitle=\"Projects\" pageComponent={\n                <ProjectListPage setProject={this.setProject.bind(this)}/> } />} />    \n            \n\n            <PrivateRoute user={this.state.user} path=\"/setup-project\" render={( ) =>\n              <MainTemplate {...this.state} pageTitle=\"Setup project\" pageComponent={ \n                <SetupProjectPage/> }\n                  />} />  \n\n            <PrivateRoute user={this.state.user} path=\"/profile\"  render={( ) => \n              <MainTemplate {...this.state} pageTitle=\"User Profile\" pageComponent={ \n                <UserProfilePage user={this.state.user} setUserProfileIcon={this.setUserProfileIcon.bind(this)}/> } />} />     \n\n\n\n            <Route path=\"/features\" component={ () =>\n              <MainTemplate {...this.state} pageTitle=\"Features\" pageComponent={ \n                <FeaturesPage/> } />} />     \n            \n            <Route path=\"/logout\" render={ () => <Logout logout={this.logout.bind(this)}/> } />\n            <Route path=\"/\"   render={( ) =>            \n                this.state.user && !this.state.loggingOut\n                ? <Redirect to=\"/projects\"/>\n                : <HomePage setUserData={this.setUserData.bind(this)}/> }  />\n            <Route                  render={( ) => \n              <MainTemplate {...this.state} pageTitle=\"\" pageComponent={ \n                <Error404Page/> } />} /> />\n\n\n\n\n\n          </Switch>\n\n          </div>\n        }\n\n\n            \n        </BrowserRouter>\n        {!this.state.loading && <Footer/>}\n      </div>      \n    );\n  }\n}\n\n\n\n/*\n\n    var publicRoutes = [\n\n      {\n        path: \"/projects/:id/tagging\",\n        template: TaggingInterfaceTemplate,\n        component: TaggingInterface,\n        componentProps: {\n          projectTitle: this.state.projectTitle,\n          projectAuthor: this.state.projectAuthor,\n          setProject: this.setProject.bind(this),\n          project_id: p.match.params.id,\n          user: this.state.user,\n        }\n      },\n      {\n        path: \"/projects/:id/tagging\",\n        template: MainTemplate,\n        component: ProjectListPage,\n        componentProps: {\n          setProject: this.setProject.bind(this),\n        }\n      }\n    ];\n\n*/\n\nconst PrivateRoute = ({ component: Component, ...rest }) => (\n  <Route {...rest} render={(p) => {\n    var {user, ...other} = rest;\n    return rest.user\n      ? rest.render(p)\n      : <Redirect to='/login' />\n  \n  }\n  } />\n)\n\n\n\nexport default App;\n\n// Old code\n/* \n<div className=\"submit-annotations-container\">\n  <button className=\"submit-annotations-button\" onClick={this.submitAnnotations.bind(this)}>Submit annotations <i className=\"fa fa-chevron-right\"></i></button>\n</div>\n*/","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}